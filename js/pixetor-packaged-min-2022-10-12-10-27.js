!function(y,_){function N(t,e){return(e+"").toUpperCase()}function M(){v.addEventListener?(v.removeEventListener("DOMContentLoaded",M,!1),b.ready()):"complete"===v.readyState&&(v.detachEvent("onreadystatechange",M),b.ready())}var U,z,v=y.document,B=y.location,H=y.navigator,W=y.jQuery,$=y.$,G=Array.prototype.push,p=Array.prototype.slice,j=Array.prototype.indexOf,q=Object.prototype.toString,V=Object.prototype.hasOwnProperty,K=String.prototype.trim,b=function(t,e){return new b.fn.init(t,e,U)},X=/[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source,Z=/\S/,E=/\s+/,Y=Z.test("Â ")?/^[\s\xA0]+|[\s\xA0]+$/g:/^\s+|\s+$/g,Q=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,J=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,tt=/^[\],:{}\s]*$/,et=/(?:^|:|,)(?:\s*\[)+/g,rt=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,it=/"[^"\\\r\n]*"|true|false|null|-?(?:\d\d*\.|)\d+(?:[eE][\-+]?\d+|)/g,ot=/^-ms-/,nt=/-([\da-z])/gi,st={},at=(b.fn=b.prototype={constructor:b,init:function(t,e,r){var i,o;if(t)if(t.nodeType)this.context=this[0]=t,this.length=1;else{if("string"!=typeof t)return b.isFunction(t)?r.ready(t):(t.selector!==_&&(this.selector=t.selector,this.context=t.context),b.makeArray(t,this));if(!(i="<"===t.charAt(0)&&">"===t.charAt(t.length-1)&&3<=t.length?[null,t,null]:Q.exec(t))||!i[1]&&e)return(!e||e.jquery?e||r:this.constructor(e)).find(t);if(i[1])return o=(e=e instanceof b?e[0]:e)&&e.nodeType?e.ownerDocument||e:v,t=b.parseHTML(i[1],o,!0),J.test(i[1])&&b.isPlainObject(e)&&this.attr.call(t,e,!0),b.merge(this,t);if((o=v.getElementById(i[2]))&&o.parentNode){if(o.id!==i[2])return r.find(t);this.length=1,this[0]=o}this.context=v,this.selector=t}return this},selector:"",jquery:"1.8.0",length:0,size:function(){return this.length},toArray:function(){return p.call(this)},get:function(t){return null==t?this.toArray():t<0?this[this.length+t]:this[t]},pushStack:function(t,e,r){t=b.merge(this.constructor(),t);return t.prevObject=this,t.context=this.context,"find"===e?t.selector=this.selector+(this.selector?" ":"")+r:e&&(t.selector=this.selector+"."+e+"("+r+")"),t},each:function(t,e){return b.each(this,t,e)},ready:function(t){return b.ready.promise().done(t),this},eq:function(t){return-1===(t=+t)?this.slice(t):this.slice(t,t+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(p.apply(this,arguments),"slice",p.call(arguments).join(","))},map:function(r){return this.pushStack(b.map(this,function(t,e){return r.call(t,e,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:G,sort:[].sort,splice:[].splice},b.fn.init.prototype=b.fn,b.extend=b.fn.extend=function(){var t,e,r,i,o,n=arguments[0]||{},s=1,a=arguments.length,l=!1;for("boolean"==typeof n&&(l=n,n=arguments[1]||{},s=2),"object"==typeof n||b.isFunction(n)||(n={}),a===s&&(n=this,--s);s<a;s++)if(null!=(t=arguments[s]))for(e in t)o=n[e],n!==(r=t[e])&&(l&&r&&(b.isPlainObject(r)||(i=b.isArray(r)))?(o=i?(i=!1,o&&b.isArray(o)?o:[]):o&&b.isPlainObject(o)?o:{},n[e]=b.extend(l,o,r)):r!==_&&(n[e]=r));return n},b.extend({noConflict:function(t){return y.$===b&&(y.$=$),t&&y.jQuery===b&&(y.jQuery=W),b},isReady:!1,readyWait:1,holdReady:function(t){t?b.readyWait++:b.ready(!0)},ready:function(t){if(!0===t?!--b.readyWait:!b.isReady){if(!v.body)return setTimeout(b.ready,1);(b.isReady=!0)!==t&&0<--b.readyWait||(z.resolveWith(v,[b]),b.fn.trigger&&b(v).trigger("ready").off("ready"))}},isFunction:function(t){return"function"===b.type(t)},isArray:Array.isArray||function(t){return"array"===b.type(t)},isWindow:function(t){return null!=t&&t==t.window},isNumeric:function(t){return!isNaN(parseFloat(t))&&isFinite(t)},type:function(t){return null==t?String(t):st[q.call(t)]||"object"},isPlainObject:function(t){if(!t||"object"!==b.type(t)||t.nodeType||b.isWindow(t))return!1;try{if(t.constructor&&!V.call(t,"constructor")&&!V.call(t.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}for(var e in t);return e===_||V.call(t,e)},isEmptyObject:function(t){for(var e in t)return!1;return!0},error:function(t){throw new Error(t)},parseHTML:function(t,e,r){var i;return t&&"string"==typeof t?("boolean"==typeof e&&(r=e,e=0),e=e||v,(i=J.exec(t))?[e.createElement(i[1])]:(i=b.buildFragment([t],e,r?null:[]),b.merge([],(i.cacheable?b.clone(i.fragment):i.fragment).childNodes))):null},parseJSON:function(t){return t&&"string"==typeof t?(t=b.trim(t),y.JSON&&y.JSON.parse?y.JSON.parse(t):tt.test(t.replace(rt,"@").replace(it,"]").replace(et,""))?new Function("return "+t)():void b.error("Invalid JSON: "+t)):null},parseXML:function(t){var e;if(!t||"string"!=typeof t)return null;try{y.DOMParser?e=(new DOMParser).parseFromString(t,"text/xml"):((e=new ActiveXObject("Microsoft.XMLDOM")).async="false",e.loadXML(t))}catch(t){e=_}return e&&e.documentElement&&!e.getElementsByTagName("parsererror").length||b.error("Invalid XML: "+t),e},noop:function(){},globalEval:function(t){t&&Z.test(t)&&(y.execScript||function(t){y.eval.call(y,t)})(t)},camelCase:function(t){return t.replace(ot,"ms-").replace(nt,N)},nodeName:function(t,e){return t.nodeName&&t.nodeName.toUpperCase()===e.toUpperCase()},each:function(t,e,r){var i,o=0,n=t.length,s=n===_||b.isFunction(t);if(r)if(s){for(i in t)if(!1===e.apply(t[i],r))break}else for(;o<n&&!1!==e.apply(t[o++],r););else if(s){for(i in t)if(!1===e.call(t[i],i,t[i]))break}else for(;o<n&&!1!==e.call(t[o],o,t[o++]););return t},trim:K?function(t){return null==t?"":K.call(t)}:function(t){return null==t?"":t.toString().replace(Y,"")},makeArray:function(t,e){var r,e=e||[];return null!=t&&(r=b.type(t),null==t.length||"string"===r||"function"===r||"regexp"===r||b.isWindow(t)?G.call(e,t):b.merge(e,t)),e},inArray:function(t,e,r){var i;if(e){if(j)return j.call(e,t,r);for(i=e.length,r=r?r<0?Math.max(0,i+r):r:0;r<i;r++)if(r in e&&e[r]===t)return r}return-1},merge:function(t,e){var r=e.length,i=t.length,o=0;if("number"==typeof r)for(;o<r;o++)t[i++]=e[o];else for(;e[o]!==_;)t[i++]=e[o++];return t.length=i,t},grep:function(t,e,r){var i=[],o=0,n=t.length;for(r=!!r;o<n;o++)r!==!!e(t[o],o)&&i.push(t[o]);return i},map:function(t,e,r){var i,o,n=[],s=0,a=t.length;if(t instanceof b||a!==_&&"number"==typeof a&&(0<a&&t[0]&&t[a-1]||0===a||b.isArray(t)))for(;s<a;s++)null!=(i=e(t[s],s,r))&&(n[n.length]=i);else for(o in t)null!=(i=e(t[o],o,r))&&(n[n.length]=i);return n.concat.apply([],n)},guid:1,proxy:function(t,e){var r,i;return"string"==typeof e&&(i=t[e],e=t,t=i),b.isFunction(t)?(r=p.call(arguments,2),(i=function(){return t.apply(e,r.concat(p.call(arguments)))}).guid=t.guid=t.guid||i.guid||b.guid++,i):_},access:function(t,e,r,i,o,n,s){var a,l=null==r,c=0,p=t.length;if(r&&"object"==typeof r){for(c in r)b.access(t,e,c,r[c],1,n,i);o=1}else if(i!==_){if(a=s===_&&b.isFunction(i),e=l?a?(a=e,function(t,e,r){return a.call(b(t),r)}):(e.call(t,i),null):e)for(;c<p;c++)e(t[c],r,a?i.call(t[c],c,e(t[c],r)):i,s);o=1}return o?t:l?e.call(t):p?e(t[0],r):n},now:function(){return(new Date).getTime()}}),b.ready.promise=function(t){if(!z)if(z=b.Deferred(),"complete"===v.readyState||"loading"!==v.readyState&&v.addEventListener)setTimeout(b.ready,1);else if(v.addEventListener)v.addEventListener("DOMContentLoaded",M,!1),y.addEventListener("load",b.ready,!1);else{v.attachEvent("onreadystatechange",M),y.attachEvent("onload",b.ready);var r=!1;try{r=null==y.frameElement&&v.documentElement}catch(t){}r&&r.doScroll&&!function e(){if(!b.isReady){try{r.doScroll("left")}catch(t){return setTimeout(e,50)}b.ready()}}()}return z.promise(t)},b.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(t,e){st["[object "+e+"]"]=e.toLowerCase()}),U=b(v),{});b.Callbacks=function(i){var t,r;i="string"==typeof i?at[i]||(r=at[t=i]={},b.each(t.split(E),function(t,e){r[e]=!0}),r):b.extend({},i);function o(t){for(e=i.memory&&t,n=!0,c=a||0,a=0,l=p.length,s=!0;p&&c<l;c++)if(!1===p[c].apply(t[0],t[1])&&i.stopOnFalse){e=!1;break}s=!1,p&&(h?h.length&&o(h.shift()):e?p=[]:u.disable())}var e,n,s,a,l,c,p=[],h=!i.once&&[],u={add:function(){var t;return p&&(t=p.length,function r(t){b.each(t,function(t,e){!b.isFunction(e)||i.unique&&u.has(e)?e&&e.length&&r(e):p.push(e)})}(arguments),s?l=p.length:e&&(a=t,o(e))),this},remove:function(){return p&&b.each(arguments,function(t,e){for(var r;-1<(r=b.inArray(e,p,r));)p.splice(r,1),s&&(r<=l&&l--,r<=c&&c--)}),this},has:function(t){return-1<b.inArray(t,p)},empty:function(){return p=[],this},disable:function(){return p=h=e=_,this},disabled:function(){return!p},lock:function(){return h=_,e||u.disable(),this},locked:function(){return!h},fireWith:function(t,e){return e=[t,(e=e||[]).slice?e.slice():e],!p||n&&!h||(s?h.push(e):o(e)),this},fire:function(){return u.fireWith(this,arguments),this},fired:function(){return!!n}};return u},b.extend({Deferred:function(t){var s=[["resolve","done",b.Callbacks("once memory"),"resolved"],["reject","fail",b.Callbacks("once memory"),"rejected"],["notify","progress",b.Callbacks("memory")]],o="pending",n={state:function(){return o},always:function(){return a.done(arguments).fail(arguments),this},then:function(){var n=arguments;return b.Deferred(function(o){b.each(s,function(t,e){var r=e[0],i=n[t];a[e[1]](b.isFunction(i)?function(){var t=i.apply(this,arguments);t&&b.isFunction(t.promise)?t.promise().done(o.resolve).fail(o.reject).progress(o.notify):o[r+"With"](this===a?o:this,[t])}:o[r])}),n=null}).promise()},promise:function(t){return"object"==typeof t?b.extend(t,n):n}},a={};return n.pipe=n.then,b.each(s,function(t,e){var r=e[2],i=e[3];n[e[1]]=r.add,i&&r.add(function(){o=i},s[1^t][2].disable,s[2][2].lock),a[e[0]]=r.fire,a[e[0]+"With"]=r.fireWith}),n.promise(a),t&&t.call(a,a),a},when:function(t){function e(e,r,i){return function(t){r[e]=this,i[e]=1<arguments.length?p.call(arguments):t,i===o?c.notifyWith(r,i):--l||c.resolveWith(r,i)}}var o,r,i,n=0,s=p.call(arguments),a=s.length,l=1!==a||t&&b.isFunction(t.promise)?a:0,c=1===l?t:b.Deferred();if(1<a)for(o=new Array(a),r=new Array(a),i=new Array(a);n<a;n++)s[n]&&b.isFunction(s[n].promise)?s[n].promise().done(e(n,i,s)).fail(c.reject).progress(e(n,r,o)):--l;return l||c.resolveWith(i,s),c.promise()}}),b.support=function(){var n,t,e,r,i,o,s,a,l=v.createElement("div");if(l.setAttribute("className","t"),l.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",e=l.getElementsByTagName("*"),(t=l.getElementsByTagName("a")[0]).style.cssText="top:1px;float:left;opacity:.5",!e||!e.length||!t)return{};a=(e=v.createElement("select")).appendChild(v.createElement("option")),r=l.getElementsByTagName("input")[0],n={leadingWhitespace:3===l.firstChild.nodeType,tbody:!l.getElementsByTagName("tbody").length,htmlSerialize:!!l.getElementsByTagName("link").length,style:/top/.test(t.getAttribute("style")),hrefNormalized:"/a"===t.getAttribute("href"),opacity:/^0.5/.test(t.style.opacity),cssFloat:!!t.style.cssFloat,checkOn:"on"===r.value,optSelected:a.selected,getSetAttribute:"t"!==l.className,enctype:!!v.createElement("form").enctype,html5Clone:"<:nav></:nav>"!==v.createElement("nav").cloneNode(!0).outerHTML,boxModel:"CSS1Compat"===v.compatMode,submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1},r.checked=!0,n.noCloneChecked=r.cloneNode(!0).checked,e.disabled=!0,n.optDisabled=!a.disabled;try{delete l.test}catch(t){n.deleteExpando=!1}if(!l.addEventListener&&l.attachEvent&&l.fireEvent&&(l.attachEvent("onclick",a=function(){n.noCloneEvent=!1}),l.cloneNode(!0).fireEvent("onclick"),l.detachEvent("onclick",a)),(r=v.createElement("input")).value="t",r.setAttribute("type","radio"),n.radioValue="t"===r.value,r.setAttribute("checked","checked"),r.setAttribute("name","t"),l.appendChild(r),(a=v.createDocumentFragment()).appendChild(l.lastChild),n.checkClone=a.cloneNode(!0).cloneNode(!0).lastChild.checked,n.appendChecked=r.checked,a.removeChild(r),a.appendChild(l),l.attachEvent)for(o in{submit:!0,change:!0,focusin:!0})(s=(i="on"+o)in l)||(l.setAttribute(i,"return;"),s="function"==typeof l[i]),n[o+"Bubbles"]=s;return b(function(){var t,e,r,i="padding:0;margin:0;border:0;display:block;overflow:hidden;",o=v.getElementsByTagName("body")[0];o&&((t=v.createElement("div")).style.cssText="visibility:hidden;border:0;width:0;height:0;position:static;top:0;margin-top:1px",o.insertBefore(t,o.firstChild),e=v.createElement("div"),t.appendChild(e),e.innerHTML="<table><tr><td></td><td>t</td></tr></table>",(r=e.getElementsByTagName("td"))[0].style.cssText="padding:0;margin:0;border:0;display:none",s=0===r[0].offsetHeight,r[0].style.display="",r[1].style.display="none",n.reliableHiddenOffsets=s&&0===r[0].offsetHeight,e.innerHTML="",e.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",n.boxSizing=4===e.offsetWidth,n.doesNotIncludeMarginInBodyOffset=1!==o.offsetTop,y.getComputedStyle&&(n.pixelPosition="1%"!==(y.getComputedStyle(e,null)||{}).top,n.boxSizingReliable="4px"===(y.getComputedStyle(e,null)||{width:"4px"}).width,(r=v.createElement("div")).style.cssText=e.style.cssText=i,r.style.marginRight=r.style.width="0",e.style.width="1px",e.appendChild(r),n.reliableMarginRight=!parseFloat((y.getComputedStyle(r,null)||{}).marginRight)),void 0!==e.style.zoom&&(e.innerHTML="",e.style.cssText=i+"width:1px;padding:1px;display:inline;zoom:1",n.inlineBlockNeedsLayout=3===e.offsetWidth,e.style.display="block",e.style.overflow="visible",e.innerHTML="<div></div>",e.firstChild.style.width="5px",n.shrinkWrapBlocks=3!==e.offsetWidth,t.style.zoom=1),o.removeChild(t))}),a.removeChild(l),t=e=r=a=l=null,n}();var lt=/^(?:\{.*\}|\[.*\])$/,ct=/([A-Z])/g;function pt(t,e,r){if(r===_&&1===t.nodeType){var i="data-"+e.replace(ct,"-$1").toLowerCase();if("string"==typeof(r=t.getAttribute(i))){try{r="true"===r||"false"!==r&&("null"===r?null:+r+""===r?+r:lt.test(r)?b.parseJSON(r):r)}catch(t){}b.data(t,e,r)}else r=_}return r}function ht(t){for(var e in t)if(("data"!==e||!b.isEmptyObject(t[e]))&&"toJSON"!==e)return;return 1}b.extend({cache:{},deletedIds:[],uuid:0,expando:"jQuery"+(b.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(t){return!!(t=t.nodeType?b.cache[t[b.expando]]:t[b.expando])&&!ht(t)},data:function(t,e,r,i){if(b.acceptData(t)){var o,n=b.expando,s="string"==typeof e,a=t.nodeType,l=a?b.cache:t,c=a?t[n]:t[n]&&n;if(c&&l[c]&&(i||l[c].data)||!s||r!==_)return c||(a?t[n]=c=b.deletedIds.pop()||++b.uuid:c=n),l[c]||(l[c]={},a||(l[c].toJSON=b.noop)),"object"!=typeof e&&"function"!=typeof e||(i?l[c]=b.extend(l[c],e):l[c].data=b.extend(l[c].data,e)),t=l[c],i||(t.data||(t.data={}),t=t.data),r!==_&&(t[b.camelCase(e)]=r),s?null==(o=t[e])&&(o=t[b.camelCase(e)]):o=t,o}},removeData:function(t,e,r){if(b.acceptData(t)){var i,o,n,s=t.nodeType,a=s?b.cache:t,l=s?t[b.expando]:b.expando;if(a[l]){if(e&&(i=r?a[l]:a[l].data)){for((o=0,n=(e=b.isArray(e)?e:e in i||(e=b.camelCase(e))in i?[e]:e.split(" ")).length);o<n;o++)delete i[e[o]];if(!(r?ht:b.isEmptyObject)(i))return}(r||(delete a[l].data,ht(a[l])))&&(s?b.cleanData([t],!0):b.support.deleteExpando||a!=a.window?delete a[l]:a[l]=null)}}},_data:function(t,e,r){return b.data(t,e,r,!0)},acceptData:function(t){var e=t.nodeName&&b.noData[t.nodeName.toLowerCase()];return!e||!0!==e&&t.getAttribute("classid")===e}}),b.fn.extend({data:function(r,t){var i,o,e,n,s,a=this[0],l=0,c=null;if(r!==_)return"object"==typeof r?this.each(function(){b.data(this,r)}):((i=r.split(".",2))[1]=i[1]?"."+i[1]:"",o=i[1]+"!",b.access(this,function(e){if(e===_)return(c=this.triggerHandler("getData"+o,[i[0]]))===_&&a&&(c=b.data(a,r),c=pt(a,r,c)),c===_&&i[1]?this.data(i[0]):c;i[1]=e,this.each(function(){var t=b(this);t.triggerHandler("setData"+o,i),b.data(this,r,e),t.triggerHandler("changeData"+o,i)})},null,t,1<arguments.length,null,!1));if(this.length&&(c=b.data(a),1===a.nodeType&&!b._data(a,"parsedAttrs"))){for(s=(e=a.attributes).length;l<s;l++)0===(n=e[l].name).indexOf("data-")&&(n=b.camelCase(n.substring(5)),pt(a,n,c[n]));b._data(a,"parsedAttrs",!0)}return c},removeData:function(t){return this.each(function(){b.removeData(this,t)})}}),b.extend({queue:function(t,e,r){var i;if(t)return i=b._data(t,e=(e||"fx")+"queue"),r&&(!i||b.isArray(r)?i=b._data(t,e,b.makeArray(r)):i.push(r)),i||[]},dequeue:function(t,e){e=e||"fx";var r=b.queue(t,e),i=r.shift(),o=b._queueHooks(t,e);(i="inprogress"===i?r.shift():i)&&("fx"===e&&r.unshift("inprogress"),delete o.stop,i.call(t,function(){b.dequeue(t,e)},o)),!r.length&&o&&o.empty.fire()},_queueHooks:function(t,e){var r=e+"queueHooks";return b._data(t,r)||b._data(t,r,{empty:b.Callbacks("once memory").add(function(){b.removeData(t,e+"queue",!0),b.removeData(t,r,!0)})})}}),b.fn.extend({queue:function(e,r){var t=2;return"string"!=typeof e&&(r=e,e="fx",t--),arguments.length<t?b.queue(this[0],e):r===_?this:this.each(function(){var t=b.queue(this,e,r);b._queueHooks(this,e),"fx"===e&&"inprogress"!==t[0]&&b.dequeue(this,e)})},dequeue:function(t){return this.each(function(){b.dequeue(this,t)})},delay:function(i,t){return i=b.fx&&b.fx.speeds[i]||i,this.queue(t=t||"fx",function(t,e){var r=setTimeout(t,i);e.stop=function(){clearTimeout(r)}})},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,e){function r(){--o||n.resolveWith(s,[s])}var i,o=1,n=b.Deferred(),s=this,a=this.length;for("string"!=typeof t&&(e=t,t=_),t=t||"fx";a--;)(i=b._data(s[a],t+"queueHooks"))&&i.empty&&(o++,i.empty.add(r));return r(),n.promise(e)}});function ut(t){return b.event.special.hover?t:t.replace(Et,"mouseenter$1 mouseleave$1")}var a,dt,ft,gt=/[\t\r\n]/g,mt=/\r/g,yt=/^(?:button|input)$/i,vt=/^(?:button|input|object|select|textarea)$/i,xt=/^a(?:rea|)$/i,Ct=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,St=b.support.getSetAttribute,_t=(b.fn.extend({attr:function(t,e){return b.access(this,b.attr,t,e,1<arguments.length)},removeAttr:function(t){return this.each(function(){b.removeAttr(this,t)})},prop:function(t,e){return b.access(this,b.prop,t,e,1<arguments.length)},removeProp:function(t){return t=b.propFix[t]||t,this.each(function(){try{this[t]=_,delete this[t]}catch(t){}})},addClass:function(e){var t,r,i,o,n,s,a;if(b.isFunction(e))return this.each(function(t){b(this).addClass(e.call(this,t,this.className))});if(e&&"string"==typeof e)for(t=e.split(E),r=0,i=this.length;r<i;r++)if(1===(o=this[r]).nodeType)if(o.className||1!==t.length){for(n=" "+o.className+" ",s=0,a=t.length;s<a;s++)~n.indexOf(" "+t[s]+" ")||(n+=t[s]+" ");o.className=b.trim(n)}else o.className=e;return this},removeClass:function(e){var t,r,i,o,n,s,a;if(b.isFunction(e))return this.each(function(t){b(this).removeClass(e.call(this,t,this.className))});if(e&&"string"==typeof e||e===_)for(t=(e||"").split(E),s=0,a=this.length;s<a;s++)if(1===(i=this[s]).nodeType&&i.className){for(r=(" "+i.className+" ").replace(gt," "),o=0,n=t.length;o<n;o++)for(;-1<r.indexOf(" "+t[o]+" ");)r=r.replace(" "+t[o]+" "," ");i.className=e?b.trim(r):""}return this},toggleClass:function(n,s){var a=typeof n,l="boolean"==typeof s;return b.isFunction(n)?this.each(function(t){b(this).toggleClass(n.call(this,t,this.className,s),s)}):this.each(function(){if("string"==a)for(var t,e=0,r=b(this),i=s,o=n.split(E);t=o[e++];)i=l?i:!r.hasClass(t),r[i?"addClass":"removeClass"](t);else"undefined"!=a&&"boolean"!=a||(this.className&&b._data(this,"__className__",this.className),this.className=!this.className&&!1!==n&&b._data(this,"__className__")||"")})},hasClass:function(t){for(var e=" "+t+" ",r=0,i=this.length;r<i;r++)if(1===this[r].nodeType&&-1<(" "+this[r].className+" ").replace(gt," ").indexOf(e))return!0;return!1},val:function(r){var i,t,o,e=this[0];return arguments.length?(o=b.isFunction(r),this.each(function(t){var e=b(this);1===this.nodeType&&(null==(t=o?r.call(this,t,e.val()):r)?t="":"number"==typeof t?t+="":b.isArray(t)&&(t=b.map(t,function(t){return null==t?"":t+""})),(i=b.valHooks[this.type]||b.valHooks[this.nodeName.toLowerCase()])&&"set"in i&&i.set(this,t,"value")!==_||(this.value=t))})):e?(i=b.valHooks[e.type]||b.valHooks[e.nodeName.toLowerCase()])&&"get"in i&&(t=i.get(e,"value"))!==_?t:"string"==typeof(t=e.value)?t.replace(mt,""):null==t?"":t:void 0}}),b.extend({valHooks:{option:{get:function(t){var e=t.attributes.value;return!e||e.specified?t.value:t.text}},select:{get:function(t){var e,r,i,o=t.selectedIndex,n=[],s=t.options,a="select-one"===t.type;if(o<0)return null;for(e=a?o:0,r=a?o+1:s.length;e<r;e++)if((i=s[e]).selected&&!((b.support.optDisabled?i.disabled:null!==i.getAttribute("disabled"))||i.parentNode.disabled&&b.nodeName(i.parentNode,"optgroup"))){if(i=b(i).val(),a)return i;n.push(i)}return a&&!n.length&&s.length?b(s[o]).val():n},set:function(t,e){var r=b.makeArray(e);return b(t).find("option").each(function(){this.selected=0<=b.inArray(b(this).val(),r)}),r.length||(t.selectedIndex=-1),r}}},attrFn:{},attr:function(t,e,r,i){var o,n,s=t.nodeType;if(t&&3!==s&&8!==s&&2!==s)return i&&b.isFunction(b.fn[e])?b(t)[e](r):void 0===t.getAttribute?b.prop(t,e,r):((i=1!==s||!b.isXMLDoc(t))&&(e=e.toLowerCase(),n=b.attrHooks[e]||(Ct.test(e)?dt:a)),r===_?!(n&&"get"in n&&i&&null!==(o=n.get(t,e)))&&null===(o=t.getAttribute(e))?_:o:null!==r?n&&"set"in n&&i&&(o=n.set(t,r,e))!==_?o:(t.setAttribute(e,""+r),r):void b.removeAttr(t,e))},removeAttr:function(t,e){var r,i,o,n,s=0;if(e&&1===t.nodeType)for(i=e.split(E);s<i.length;s++)(o=i[s])&&(r=b.propFix[o]||o,(n=Ct.test(o))||b.attr(t,o,""),t.removeAttribute(St?o:r),n&&r in t&&(t[r]=!1))},attrHooks:{type:{set:function(t,e){var r;if(yt.test(t.nodeName)&&t.parentNode)b.error("type property can't be changed");else if(!b.support.radioValue&&"radio"===e&&b.nodeName(t,"input"))return r=t.value,t.setAttribute("type",e),r&&(t.value=r),e}},value:{get:function(t,e){return a&&b.nodeName(t,"button")?a.get(t,e):e in t?t.value:null},set:function(t,e,r){if(a&&b.nodeName(t,"button"))return a.set(t,e,r);t.value=e}}},propFix:{tabindex:"tabIndex",readonly:"readOnly",for:"htmlFor",class:"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(t,e,r){var i,o,n=t.nodeType;if(t&&3!==n&&8!==n&&2!==n)return(1!==n||!b.isXMLDoc(t))&&(e=b.propFix[e]||e,o=b.propHooks[e]),r!==_?o&&"set"in o&&(i=o.set(t,r,e))!==_?i:t[e]=r:o&&"get"in o&&null!==(i=o.get(t,e))?i:t[e]},propHooks:{tabIndex:{get:function(t){var e=t.getAttributeNode("tabindex");return e&&e.specified?parseInt(e.value,10):vt.test(t.nodeName)||xt.test(t.nodeName)&&t.href?0:_}}}}),dt={get:function(t,e){var r=b.prop(t,e);return!0===r||"boolean"!=typeof r&&(r=t.getAttributeNode(e))&&!1!==r.nodeValue?e.toLowerCase():_},set:function(t,e,r){return!1===e?b.removeAttr(t,r):((e=b.propFix[r]||r)in t&&(t[e]=!0),t.setAttribute(r,r.toLowerCase())),r}},St||(ft={name:!0,id:!0,coords:!0},a=b.valHooks.button={get:function(t,e){t=t.getAttributeNode(e);return t&&(ft[e]?""!==t.value:t.specified)?t.value:_},set:function(t,e,r){var i=t.getAttributeNode(r);return i||(i=v.createAttribute(r),t.setAttributeNode(i)),i.value=e+""}},b.each(["width","height"],function(t,r){b.attrHooks[r]=b.extend(b.attrHooks[r],{set:function(t,e){if(""===e)return t.setAttribute(r,"auto"),e}})}),b.attrHooks.contenteditable={get:a.get,set:function(t,e,r){a.set(t,e=""===e?"false":e,r)}}),b.support.hrefNormalized||b.each(["href","src","width","height"],function(t,e){b.attrHooks[e]=b.extend(b.attrHooks[e],{get:function(t){t=t.getAttribute(e,2);return null===t?_:t}})}),b.support.style||(b.attrHooks.style={get:function(t){return t.style.cssText.toLowerCase()||_},set:function(t,e){return t.style.cssText=""+e}}),b.support.optSelected||(b.propHooks.selected=b.extend(b.propHooks.selected,{get:function(t){t=t.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}})),b.support.enctype||(b.propFix.enctype="encoding"),b.support.checkOn||b.each(["radio","checkbox"],function(){b.valHooks[this]={get:function(t){return null===t.getAttribute("value")?"on":t.value}}}),b.each(["radio","checkbox"],function(){b.valHooks[this]=b.extend(b.valHooks[this],{set:function(t,e){if(b.isArray(e))return t.checked=0<=b.inArray(b(t).val(),e)}})}),/^(?:textarea|input|select)$/i),bt=/^([^\.]*|)(?:\.(.+)|)$/,Et=/(?:^|\s)hover(\.\S+|)\b/,wt=/^key/,Tt=/^(?:mouse|contextmenu)|click/,Pt=/^(?:focusinfocus|focusoutblur)$/;function l(){return!1}function It(){return!0}b.event={add:function(t,e,r,i,o){var n,s,a,l,c,p,h,u,d,f;if(3!==t.nodeType&&8!==t.nodeType&&e&&r&&(n=b._data(t)))for(r.handler&&(r=(u=r).handler,o=u.selector),r.guid||(r.guid=b.guid++),(a=n.events)||(n.events=a={}),(s=n.handle)||(n.handle=s=function(t){return void 0===b||t&&b.event.triggered===t.type?_:b.event.dispatch.apply(s.elem,arguments)},s.elem=t),e=b.trim(ut(e)).split(" "),l=0;l<e.length;l++)c=(h=bt.exec(e[l])||[])[1],p=(h[2]||"").split(".").sort(),f=b.event.special[c]||{},c=(o?f.delegateType:f.bindType)||c,f=b.event.special[c]||{},h=b.extend({type:c,origType:h[1],data:i,handler:r,guid:r.guid,selector:o,namespace:p.join(".")},u),(d=a[c])||((d=a[c]=[]).delegateCount=0,f.setup&&!1!==f.setup.call(t,i,p,s)||(t.addEventListener?t.addEventListener(c,s,!1):t.attachEvent&&t.attachEvent("on"+c,s))),f.add&&(f.add.call(t,h),h.handler.guid||(h.handler.guid=r.guid)),o?d.splice(d.delegateCount++,0,h):d.push(h),b.event.global[c]=!0},global:{},remove:function(t,e,r,i,o){var n,s,a,l,c,p,h,u,d,f,g=b.hasData(t)&&b._data(t);if(g&&(h=g.events)){for(e=b.trim(ut(e||"")).split(" "),n=0;n<e.length;n++)if(s=a=(c=bt.exec(e[n])||[])[1],l=c[2],s){for(u=b.event.special[s]||{},c=(d=h[s=(i?u.delegateType:u.bindType)||s]||[]).length,l=l?new RegExp("(^|\\.)"+l.split(".").sort().join("\\.(?:.*\\.|)")+"(\\.|$)"):null,p=0;p<d.length;p++)f=d[p],!o&&a!==f.origType||r&&r.guid!==f.guid||l&&!l.test(f.namespace)||i&&i!==f.selector&&("**"!==i||!f.selector)||(d.splice(p--,1),f.selector&&d.delegateCount--,u.remove&&u.remove.call(t,f));0===d.length&&c!==d.length&&(u.teardown&&!1!==u.teardown.call(t,l,g.handle)||b.removeEvent(t,s,g.handle),delete h[s])}else for(s in h)b.event.remove(t,s+e[n],r,i,!0);b.isEmptyObject(h)&&(delete g.handle,b.removeData(t,"events",!0))}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(t,e,r,i){if(!r||3!==r.nodeType&&8!==r.nodeType){var o,n,s,a,l,c,p,h,u,d=t.type||t,f=[];if(!Pt.test(d+b.event.triggered)&&(0<=d.indexOf("!")&&(d=d.slice(0,-1),c=!0),0<=d.indexOf(".")&&(d=(f=d.split(".")).shift(),f.sort()),r&&!b.event.customEvent[d]||b.event.global[d]))if((t="object"==typeof t?t[b.expando]?t:new b.Event(d,t):new b.Event(d)).type=d,t.isTrigger=!0,t.exclusive=c,t.namespace=f.join("."),t.namespace_re=t.namespace?new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,l=d.indexOf(":")<0?"on"+d:"",r){if(t.result=_,t.target||(t.target=r),(e=null!=e?b.makeArray(e):[]).unshift(t),!(c=b.event.special[d]||{}).trigger||!1!==c.trigger.apply(r,e)){if(h=[[r,c.bindType||d]],!i&&!c.noBubble&&!b.isWindow(r)){for(u=c.delegateType||d,s=Pt.test(u+d)?r:r.parentNode,a=r;s;s=s.parentNode)h.push([s,u]),a=s;a===(r.ownerDocument||v)&&h.push([a.defaultView||a.parentWindow||y,u])}for(n=0;n<h.length&&!t.isPropagationStopped();n++)s=h[n][0],t.type=h[n][1],(p=(b._data(s,"events")||{})[t.type]&&b._data(s,"handle"))&&p.apply(s,e),(p=l&&s[l])&&b.acceptData(s)&&!1===p.apply(s,e)&&t.preventDefault();return t.type=d,i||t.isDefaultPrevented()||c._default&&!1!==c._default.apply(r.ownerDocument,e)||"click"===d&&b.nodeName(r,"a")||!b.acceptData(r)||l&&r[d]&&("focus"!==d&&"blur"!==d||0!==t.target.offsetWidth)&&!b.isWindow(r)&&((a=r[l])&&(r[l]=null),r[b.event.triggered=d](),b.event.triggered=_,a&&(r[l]=a)),t.result}}else for(n in o=b.cache)o[n].events&&o[n].events[d]&&b.event.trigger(t,e,o[n].handle.elem,!0)}},dispatch:function(t){t=b.event.fix(t||y.event);var e,r,i,o,n,s,a,l,c,p,h=(b._data(this,"events")||{})[t.type]||[],u=h.delegateCount,d=[].slice.call(arguments),f=!t.exclusive&&!t.namespace,g=b.event.special[t.type]||{},m=[];if((d[0]=t).delegateTarget=this,!g.preDispatch||!1!==g.preDispatch.call(this,t)){if(u&&(!t.button||"click"!==t.type))for((o=b(this)).context=this,i=t.target;i!=this;i=i.parentNode||this)if(!0!==i.disabled||"click"!==t.type){for(s={},l=[],o[0]=i,e=0;e<u;e++)s[p=(c=h[e]).selector]===_&&(s[p]=o.is(p)),s[p]&&l.push(c);l.length&&m.push({elem:i,matches:l})}for(h.length>u&&m.push({elem:this,matches:h.slice(u)}),e=0;e<m.length&&!t.isPropagationStopped();e++)for(a=m[e],t.currentTarget=a.elem,r=0;r<a.matches.length&&!t.isImmediatePropagationStopped();r++)c=a.matches[r],(f||!t.namespace&&!c.namespace||t.namespace_re&&t.namespace_re.test(c.namespace))&&(t.data=c.data,t.handleObj=c,(n=((b.event.special[c.origType]||{}).handle||c.handler).apply(a.elem,d))!==_&&!1===(t.result=n)&&(t.preventDefault(),t.stopPropagation()));return g.postDispatch&&g.postDispatch.call(this,t),t.result}},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(t,e){return null==t.which&&(t.which=null!=e.charCode?e.charCode:e.keyCode),t}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(t,e){var r,i,o=e.button,n=e.fromElement;return null==t.pageX&&null!=e.clientX&&(r=(i=t.target.ownerDocument||v).documentElement,i=i.body,t.pageX=e.clientX+(r&&r.scrollLeft||i&&i.scrollLeft||0)-(r&&r.clientLeft||i&&i.clientLeft||0),t.pageY=e.clientY+(r&&r.scrollTop||i&&i.scrollTop||0)-(r&&r.clientTop||i&&i.clientTop||0)),!t.relatedTarget&&n&&(t.relatedTarget=n===t.target?e.toElement:n),t.which||o===_||(t.which=1&o?1:2&o?3:4&o?2:0),t}},fix:function(t){if(t[b.expando])return t;var e,r,i=t,o=b.event.fixHooks[t.type]||{},n=o.props?this.props.concat(o.props):this.props;for(t=b.Event(i),e=n.length;e;)t[r=n[--e]]=i[r];return t.target||(t.target=i.srcElement||v),3===t.target.nodeType&&(t.target=t.target.parentNode),t.metaKey=!!t.metaKey,o.filter?o.filter(t,i):t},special:{ready:{setup:b.bindReady},load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(t,e,r){b.isWindow(this)&&(this.onbeforeunload=r)},teardown:function(t,e){this.onbeforeunload===e&&(this.onbeforeunload=null)}}},simulate:function(t,e,r,i){t=b.extend(new b.Event,r,{type:t,isSimulated:!0,originalEvent:{}});i?b.event.trigger(t,null,e):b.event.dispatch.call(e,t),t.isDefaultPrevented()&&r.preventDefault()}},b.event.handle=b.event.dispatch,b.removeEvent=v.removeEventListener?function(t,e,r){t.removeEventListener&&t.removeEventListener(e,r,!1)}:function(t,e,r){e="on"+e;t.detachEvent&&(void 0===t[e]&&(t[e]=null),t.detachEvent(e,r))},b.Event=function(t,e){if(!(this instanceof b.Event))return new b.Event(t,e);t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||!1===t.returnValue||t.getPreventDefault&&t.getPreventDefault()?It:l):this.type=t,e&&b.extend(this,e),this.timeStamp=t&&t.timeStamp||b.now(),this[b.expando]=!0},b.Event.prototype={preventDefault:function(){this.isDefaultPrevented=It;var t=this.originalEvent;t&&(t.preventDefault?t.preventDefault():t.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=It;var t=this.originalEvent;t&&(t.stopPropagation&&t.stopPropagation(),t.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=It,this.stopPropagation()},isDefaultPrevented:l,isPropagationStopped:l,isImmediatePropagationStopped:l},b.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(t,o){b.event.special[t]={delegateType:o,bindType:o,handle:function(t){var e,r=t.relatedTarget,i=t.handleObj;i.selector;return r&&(r===this||b.contains(this,r))||(t.type=i.origType,e=i.handler.apply(this,arguments),t.type=o),e}}}),b.support.submitBubbles||(b.event.special.submit={setup:function(){if(b.nodeName(this,"form"))return!1;b.event.add(this,"click._submit keypress._submit",function(t){t=t.target,t=b.nodeName(t,"input")||b.nodeName(t,"button")?t.form:_;t&&!b._data(t,"_submit_attached")&&(b.event.add(t,"submit._submit",function(t){t._submit_bubble=!0}),b._data(t,"_submit_attached",!0))})},postDispatch:function(t){t._submit_bubble&&(delete t._submit_bubble,this.parentNode&&!t.isTrigger&&b.event.simulate("submit",this.parentNode,t,!0))},teardown:function(){if(b.nodeName(this,"form"))return!1;b.event.remove(this,"._submit")}}),b.support.changeBubbles||(b.event.special.change={setup:function(){if(_t.test(this.nodeName))return"checkbox"!==this.type&&"radio"!==this.type||(b.event.add(this,"propertychange._change",function(t){"checked"===t.originalEvent.propertyName&&(this._just_changed=!0)}),b.event.add(this,"click._change",function(t){this._just_changed&&!t.isTrigger&&(this._just_changed=!1),b.event.simulate("change",this,t,!0)})),!1;b.event.add(this,"beforeactivate._change",function(t){t=t.target;_t.test(t.nodeName)&&!b._data(t,"_change_attached")&&(b.event.add(t,"change._change",function(t){!this.parentNode||t.isSimulated||t.isTrigger||b.event.simulate("change",this.parentNode,t,!0)}),b._data(t,"_change_attached",!0))})},handle:function(t){var e=t.target;if(this!==e||t.isSimulated||t.isTrigger||"radio"!==e.type&&"checkbox"!==e.type)return t.handleObj.handler.apply(this,arguments)},teardown:function(){return b.event.remove(this,"._change"),_t.test(this.nodeName)}}),b.support.focusinBubbles||b.each({focus:"focusin",blur:"focusout"},function(t,e){function r(t){b.event.simulate(e,t.target,b.event.fix(t),!0)}var i=0;b.event.special[e]={setup:function(){0==i++&&v.addEventListener(t,r,!0)},teardown:function(){0==--i&&v.removeEventListener(t,r,!0)}}}),b.fn.extend({on:function(t,e,r,i,o){var n,s;if("object"==typeof t){for(s in"string"!=typeof e&&(r=r||e,e=_),t)this.on(s,e,r,t[s],o);return this}if(null==r&&null==i?(i=e,r=e=_):null==i&&("string"==typeof e?(i=r,r=_):(i=r,r=e,e=_)),!1===i)i=l;else if(!i)return this;return 1===o&&(n=i,(i=function(t){return b().off(t),n.apply(this,arguments)}).guid=n.guid||(n.guid=b.guid++)),this.each(function(){b.event.add(this,t,i,r,e)})},one:function(t,e,r,i){return this.on(t,e,r,i,1)},off:function(t,e,r){var i,o;if(t&&t.preventDefault&&t.handleObj)i=t.handleObj,b(t.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler);else{if("object"!=typeof t)return!1!==e&&"function"!=typeof e||(r=e,e=_),!1===r&&(r=l),this.each(function(){b.event.remove(this,t,r,e)});for(o in t)this.off(o,e,t[o])}return this},bind:function(t,e,r){return this.on(t,null,e,r)},unbind:function(t,e){return this.off(t,null,e)},live:function(t,e,r){return b(this.context).on(t,this.selector,e,r),this},die:function(t,e){return b(this.context).off(t,this.selector||"**",e),this},delegate:function(t,e,r,i){return this.on(e,t,r,i)},undelegate:function(t,e,r){return 1==arguments.length?this.off(t,"**"):this.off(e,t||"**",r)},trigger:function(t,e){return this.each(function(){b.event.trigger(t,e,this)})},triggerHandler:function(t,e){if(this[0])return b.event.trigger(t,e,this[0],!0)},toggle:function(r){function t(t){var e=(b._data(this,"lastToggle"+r.guid)||0)%o;return b._data(this,"lastToggle"+r.guid,1+e),t.preventDefault(),i[e].apply(this,arguments)||!1}var i=arguments,e=r.guid||b.guid++,o=0;for(t.guid=e;o<i.length;)i[o++].guid=e;return this.click(t)},hover:function(t,e){return this.mouseenter(t).mouseleave(e||t)}}),b.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(t,r){b.fn[r]=function(t,e){return null==e&&(e=t,t=null),0<arguments.length?this.on(r,null,t,e):this.trigger(r)},wt.test(r)&&(b.event.fixHooks[r]=b.event.keyHooks),Tt.test(r)&&(b.event.fixHooks[r]=b.event.mouseHooks)});var At=void 0;function Lt(t){return t.sizzleFilter=!0,t}function t(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}function Rt(r){return function(t){var e=t.nodeName.toLowerCase();return("input"===e||"button"===e)&&t.type===r}}function e(t){var e=!1,r=f.createElement("div");try{e=t(r)}catch(t){}return e}var Ot,Dt,Ft,h,kt,f=y.document,r=f.documentElement,i="undefined",Nt=!1,Mt=!0,Ut=0,x=[].slice,w=[].push,c=("sizcache"+Math.random()).replace(".",""),T="[\\x20\\t\\r\\n\\f]",o=(u="(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+").replace("w","w#"),n=":("+u+")(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|((?:[^,]|\\\\,|(?:,(?=[^\\[]*\\]))|(?:,(?=[^\\(]*\\))))*))\\)|)",s=":(nth|eq|gt|lt|first|last|even|odd)(?:\\((\\d*)\\)|)(?=[^-]|$)",zt=T+"*([\\x20\\t\\r\\n\\f>+~])"+T+"*",Bt="(?=[^\\x20\\t\\r\\n\\f])(?:\\\\.|"+(o="\\["+T+"*("+u+")"+T+"*(?:([*^$|!~]?=)"+T+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+o+")|)|)"+T+"*\\]")+"|"+n.replace(2,7)+"|[^\\\\(),])+",Ht=new RegExp("^"+T+"+|((?:^|[^\\\\])(?:\\\\.)*)"+T+"+$","g"),Wt=new RegExp("^"+zt),$t=new RegExp(Bt+"?(?="+T+"*,|$)","g"),Gt=new RegExp("^(?:(?!,)(?:(?:^|,)"+T+"*"+Bt+")*?|"+T+"*(.*?))(\\)|$)"),jt=new RegExp(Bt.slice(19,-6)+"\\x20\\t\\r\\n\\f>+~])+|"+zt,"g"),qt=/^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,Vt=/[\x20\t\r\n\f]*[+~]/,Kt=/:not\($/,Xt=/h\d/i,Zt=/input|select|textarea|button/i,C=/\\(?!\\)/g,P={ID:new RegExp("^#("+u+")"),CLASS:new RegExp("^\\.("+u+")"),NAME:new RegExp("^\\[name=['\"]?("+u+")['\"]?\\]"),TAG:new RegExp("^("+u.replace("[-","[-\\*")+")"),ATTR:new RegExp("^"+o),PSEUDO:new RegExp("^"+n),CHILD:new RegExp("^:(only|nth|last|first)-child(?:\\("+T+"*(even|odd|(([+-]|)(\\d*)n|)"+T+"*(?:([+-]|)"+T+"*(\\d+)|))"+T+"*\\)|)","i"),POS:new RegExp(s,"ig"),needsContext:new RegExp("^"+T+"*[>+~]|"+s,"i")},Yt={},Qt=[],Jt={},te=[],ee=e(function(t){t.innerHTML="<select></select>";t=typeof t.lastChild.getAttribute("multiple");return"boolean"!=t&&"string"!=t}),Bt=e(function(t){t.id=c+0,t.innerHTML="<a name='"+c+"'></a><div name='"+c+"'></div>",r.insertBefore(t,r.firstChild);var e=f.getElementsByName&&f.getElementsByName(c).length===2+f.getElementsByName(c+0).length;return kt=!f.getElementById(c),r.removeChild(t),e}),zt=e(function(t){return t.appendChild(f.createComment("")),0===t.getElementsByTagName("*").length}),u=e(function(t){return t.innerHTML="<a href='#'></a>",t.firstChild&&typeof t.firstChild.getAttribute!=i&&"#"===t.firstChild.getAttribute("href")}),re=e(function(t){return t.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",!(!t.getElementsByClassName||0===t.getElementsByClassName("e").length)&&(t.lastChild.className="e",1!==t.getElementsByClassName("e").length)}),I=function(t,e,r,i){r=r||[];var o,n,s,a,l=(e=e||f).nodeType;if(1!==l&&9!==l)return[];if(!t||"string"!=typeof t)return r;if(!(s=ie(e))&&!i&&(o=qt.exec(t)))if(a=o[1]){if(9===l){if(!(n=e.getElementById(a))||!n.parentNode)return r;if(n.id===a)return r.push(n),r}else if(e.ownerDocument&&(n=e.ownerDocument.getElementById(a))&&oe(e,n)&&n.id===a)return r.push(n),r}else{if(o[2])return w.apply(r,x.call(e.getElementsByTagName(t),0)),r;if((a=o[3])&&re&&e.getElementsByClassName)return w.apply(r,x.call(e.getElementsByClassName(a),0)),r}return ge(t,e,r,i,s)},A=I.selectors={cacheLength:50,match:P,order:["ID","TAG"],attrHandle:{},createPseudo:Lt,find:{ID:kt?function(t,e,r){if(typeof e.getElementById!=i&&!r)return(r=e.getElementById(t))&&r.parentNode?[r]:[]}:function(t,e,r){if(typeof e.getElementById!=i&&!r)return(r=e.getElementById(t))?r.id===t||typeof r.getAttributeNode!=i&&r.getAttributeNode("id").value===t?[r]:At:[]},TAG:zt?function(t,e){if(typeof e.getElementsByTagName!=i)return e.getElementsByTagName(t)}:function(t,e){var r=e.getElementsByTagName(t);if("*"!==t)return r;for(var i,o=[],n=0;i=r[n];n++)1===i.nodeType&&o.push(i);return o}},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(t){return t[1]=t[1].replace(C,""),t[3]=(t[4]||t[5]||"").replace(C,""),"~="===t[2]&&(t[3]=" "+t[3]+" "),t.slice(0,4)},CHILD:function(t){return t[1]=t[1].toLowerCase(),"nth"===t[1]?(t[2]||I.error(t[0]),t[3]=+(t[3]?t[4]+(t[5]||1):2*("even"===t[2]||"odd"===t[2])),t[4]=+(t[6]+t[7]||"odd"===t[2])):t[2]&&I.error(t[0]),t},PSEUDO:function(t){var e,r=t[4];return P.CHILD.test(t[0])?null:(r&&(e=Gt.exec(r))&&e.pop()&&(t[0]=t[0].slice(0,e[0].length-r.length-1),r=e[0].slice(0,-1)),t.splice(2,3,r||t[3]),t)}},filter:{ID:kt?function(e){return e=e.replace(C,""),function(t){return t.getAttribute("id")===e}}:function(e){return e=e.replace(C,""),function(t){t=typeof t.getAttributeNode!=i&&t.getAttributeNode("id");return t&&t.value===e}},TAG:function(e){return"*"===e?function(){return!0}:(e=e.replace(C,"").toLowerCase(),function(t){return t.nodeName&&t.nodeName.toLowerCase()===e})},CLASS:function(t){var e=Yt[t];return e||(e=Yt[t]=new RegExp("(^|"+T+")"+t+"("+T+"|$)"),Qt.push(t),Qt.length>A.cacheLength&&delete Yt[Qt.shift()]),function(t){return e.test(t.className||typeof t.getAttribute!=i&&t.getAttribute("class")||"")}},ATTR:function(r,i,o){return i?function(t){var t=I.attr(t,r),e=t+"";if(null==t)return"!="===i;switch(i){case"=":return e===o;case"!=":return e!==o;case"^=":return o&&0===e.indexOf(o);case"*=":return o&&-1<e.indexOf(o);case"$=":return o&&e.substr(e.length-o.length)===o;case"~=":return-1<(" "+e+" ").indexOf(o);case"|=":return e===o||e.substr(0,o.length+1)===o+"-"}}:function(t){return null!=I.attr(t,r)}},CHILD:function(r,t,o,n){var s;return"nth"===r?(s=Ut++,function(t){var e,r=0,i=t;if(1===o&&0===n)return!0;if((e=t.parentNode)&&(e[c]!==s||!t.sizset)){for(i=e.firstChild;i&&(1!==i.nodeType||(i.sizset=++r,i!==t));i=i.nextSibling);e[c]=s}return e=t.sizset-n,0===o?0==e:e%o==0&&0<=e/o}):function(t){var e=t;switch(r){case"only":case"first":for(;e=e.previousSibling;)if(1===e.nodeType)return!1;if("first"===r)return!0;e=t;case"last":for(;e=e.nextSibling;)if(1===e.nodeType)return!1;return!0}}},PSEUDO:function(t,e,r,i){var o=A.pseudos[t]||A.pseudos[t.toLowerCase()];return o||I.error("unsupported pseudo: "+t),o.sizzleFilter?o(e,r,i):o}},pseudos:{not:Lt(function(t,e,r){var i=fe(t.replace(Ht,"$1"),e,r);return function(t){return!i(t)}}),enabled:function(t){return!1===t.disabled},disabled:function(t){return!0===t.disabled},checked:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&!!t.checked||"option"===e&&!!t.selected},selected:function(t){return t.parentNode&&t.parentNode.selectedIndex,!0===t.selected},parent:function(t){return!A.pseudos.empty(t)},empty:function(t){var e;for(t=t.firstChild;t;){if("@"<t.nodeName||3===(e=t.nodeType)||4===e)return!1;t=t.nextSibling}return!0},contains:Lt(function(e){return function(t){return-1<(t.textContent||t.innerText||ne(t)).indexOf(e)}}),has:Lt(function(e){return function(t){return 0<I(e,t).length}}),header:function(t){return Xt.test(t.nodeName)},text:function(t){var e;return"input"===t.nodeName.toLowerCase()&&"text"===(e=t.type)&&(null==(t=t.getAttribute("type"))||t.toLowerCase()===e)},radio:t("radio"),checkbox:t("checkbox"),file:t("file"),password:t("password"),image:t("image"),submit:Rt("submit"),reset:Rt("reset"),button:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&"button"===t.type||"button"===e},input:function(t){return Zt.test(t.nodeName)},focus:function(t){var e=t.ownerDocument;return t===e.activeElement&&(!e.hasFocus||e.hasFocus())&&!(!t.type&&!t.href)},active:function(t){return t===t.ownerDocument.activeElement}},setFilters:{first:function(t,e,r){return r?t.slice(1):[t[0]]},last:function(t,e,r){var i=t.pop();return r?t:[i]},even:function(t,e,r){for(var i=[],o=r?1:0,n=t.length;o<n;o+=2)i.push(t[o]);return i},odd:function(t,e,r){for(var i=[],o=r?0:1,n=t.length;o<n;o+=2)i.push(t[o]);return i},lt:function(t,e,r){return r?t.slice(+e):t.slice(0,+e)},gt:function(t,e,r){return r?t.slice(0,+e+1):t.slice(+e+1)},eq:function(t,e,r){e=t.splice(+e,1);return r?t:e}}};A.setFilters.nth=A.setFilters.eq,A.filters=A.pseudos,u||(A.attrHandle={href:function(t){return t.getAttribute("href",2)},type:function(t){return t.getAttribute("type")}}),Bt&&(A.order.push("NAME"),A.find.NAME=function(t,e){if(typeof e.getElementsByName!=i)return e.getElementsByName(t)}),re&&(A.order.splice(1,0,"CLASS"),A.find.CLASS=function(t,e,r){if(typeof e.getElementsByClassName!=i&&!r)return e.getElementsByClassName(t)});try{x.call(r.childNodes,0)[0].nodeType}catch(t){x=function(t){for(var e,r=[];e=this[t];t++)r.push(e);return r}}var ie=I.isXML=function(t){t=t&&(t.ownerDocument||t).documentElement;return!!t&&"HTML"!==t.nodeName},oe=I.contains=r.compareDocumentPosition?function(t,e){return!!(16&t.compareDocumentPosition(e))}:r.contains?function(t,e){var r=9===t.nodeType?t.documentElement:t,e=e.parentNode;return t===e||!!(e&&1===e.nodeType&&r.contains&&r.contains(e))}:function(t,e){for(;e=e.parentNode;)if(e===t)return!0;return!1},ne=I.getText=function(t){var e,r="",i=0,o=t.nodeType;if(o){if(1===o||9===o||11===o){if("string"==typeof t.textContent)return t.textContent;for(t=t.firstChild;t;t=t.nextSibling)r+=ne(t)}else if(3===o||4===o)return t.nodeValue}else for(;e=t[i];i++)r+=ne(e);return r};function se(t,e,r,i){for(var o=0,n=e.length;o<n;o++)I(t,e[o],r,i)}function ae(t,e,r,i,o){function n(){for(var t=1,e=arguments.length-2;t<e;t++)arguments[t]===At&&(s[t]=At)}for(var s,a,l,c,p,h,u,d,f,g,m,y,v,x=0,C=o.length,S=P.POS,_=new RegExp("^"+S.source+"(?!"+T+")","i");x<C;x++){for(S.exec(""),t=o[x],l=[],a=0,c=i;s=S.exec(t);)a<(f=S.lastIndex=s.index+s[0].length)&&(p=t.slice(a,s.index),a=f,f=[e],Wt.test(p)&&(c&&(f=c),c=i),(m=Kt.test(p))&&(p=p.slice(0,-5).replace(Wt,"$&*")),1<s.length&&s[0].replace(_,n),h=p,u=s[1],d=s[2],f=f,g=c,m=m,v=y=void 0,(v=A.setFilters[u.toLowerCase()])||I.error(u),!h&&(y=g)||se(h||"*",f,y=[],g),c=0<y.length?v(y,d,m):[]);c?(l=l.concat(c),(p=t.slice(a))&&")"!==p?Wt.test(p)?se(p,l,r,i):I(p,e,r,i?i.concat(c):c):w.apply(r,l)):I(t,e,r,i)}return 1===C?r:I.uniqueSort(r)}function le(t,e,r){for(var i,o,n=0;i=t[n];n++)o=A.relative[i.part]?function(n,t,e){var s=t.dir,a=Ut++;return n=n||function(t){return t===e},t.first?function(t,e){for(;t=t[s];)if(1===t.nodeType)return n(t,e)&&t}:function(t,e){for(var r,i=a+"."+Dt,o=i+"."+Ot;t=t[s];)if(1===t.nodeType){if((r=t[c])===o)return t.sizset;if("string"==typeof r&&0===r.indexOf(i)){if(t.sizset)return t}else{if(t[c]=o,n(t,e))return t.sizset=!0,t;t.sizset=!1}}}}(o,A.relative[i.part],e):(i.captures.push(e,r),function(i,o){return i?function(t,e){var r=o(t,e);return r&&i(!0===r?t:r,e)}:o}(o,A.filter[i.part].apply(null,i.captures)));return o}I.attr=function(t,e){var r=ie(t);return r||(e=e.toLowerCase()),A.attrHandle[e]?A.attrHandle[e](t):ee||r?t.getAttribute(e):(r=t.getAttributeNode(e))?"boolean"==typeof t[e]?t[e]?e:null:r.specified?r.value:null:null},I.error=function(t){throw new Error("Syntax error, unrecognized expression: "+t)},[0,0].sort(function(){return Mt=0}),r.compareDocumentPosition?Ft=function(t,e){return t===e?(Nt=!0,0):(t.compareDocumentPosition&&e.compareDocumentPosition?4&t.compareDocumentPosition(e):t.compareDocumentPosition)?-1:1}:(Ft=function(t,e){if(t===e)return Nt=!0,0;if(t.sourceIndex&&e.sourceIndex)return t.sourceIndex-e.sourceIndex;var r=[],i=[],o=t.parentNode,n=e.parentNode,s=o;if(o===n)return h(t,e);if(!o)return-1;if(!n)return 1;for(;s;)r.unshift(s),s=s.parentNode;for(s=n;s;)i.unshift(s),s=s.parentNode;for(var a=r.length,l=i.length,c=0;c<a&&c<l;c++)if(r[c]!==i[c])return h(r[c],i[c]);return c===a?h(t,i[c],-1):h(r[c],e,1)},h=function(t,e,r){if(t===e)return r;for(var i=t.nextSibling;i;){if(i===e)return-1;i=i.nextSibling}return 1}),I.uniqueSort=function(t){var e,r=1;if(Ft&&(Nt=Mt,t.sort(Ft),Nt))for(;e=t[r];r++)e===t[r-1]&&t.splice(r--,1);return t};var ce,pe,he,ue,d,g,de,fe=I.compile=function(t,e,r){var i,o,n,s,a=Jt[t];if(!a||a.context!==e){for(o=function(t,e,r){for(var i,o,n,s=[],a=0,l=Gt.exec(t),c=!l.pop()&&!l.pop(),p=c&&t.match($t)||[""],h=A.preFilter,u=A.filter,d=!r&&e!==f;null!=(o=p[a])&&c;a++)for(s.push(i=[]),d&&(o=" "+o);o;){for(n in c=!1,(l=Wt.exec(o))&&(o=o.slice(l[0].length),c=i.push({part:l.pop().replace(Ht," "),captures:l})),u)!(l=P[n].exec(o))||h[n]&&!(l=h[n](l,e,r))||(o=o.slice(l.shift().length),c=i.push({part:n,captures:l}));if(!c)break}return c||I.error(t),s}(t,e,r),n=0;i=o[n];n++)o[n]=le(i,e,r);(a=Jt[t]=(s=o,function(t,e){for(var r,i=0;r=s[i];i++)if(r(t,e))return!0;return!1})).context=e,a.runs=a.dirruns=0,te.push(t),te.length>A.cacheLength&&delete Jt[te.shift()]}return a},ge=(I.matches=function(t,e){return I(t,null,null,e)},I.matchesSelector=function(t,e){return 0<I(e,null,null,[t]).length},function(t,e,r,i,o){var n,s,a,l,c,p,h,u,d,f=(t=t.replace(Ht,"$1")).match($t),g=t.match(jt),m=e.nodeType;if(P.POS.test(t))return ae(t,e,r,i,f);if(i)n=x.call(i,0);else if(f&&1===f.length){if(1<g.length&&9===m&&!o&&(f=P.ID.exec(g[0]))){if(!(e=A.find.ID(f[1],e,o)[0]))return r;t=t.slice(g.shift().length)}for(u=(f=Vt.exec(g[0]))&&!f.index&&e.parentNode||e,p=(d=g.pop()).split(":not")[0],a=0,l=A.order.length;a<l;a++)if(h=A.order[a],(f=P[h].exec(p))&&null!=(n=A.find[h]((f[1]||"").replace(C,""),u,o))){p!==d||(t=t.slice(0,t.length-d.length)+p.replace(P[h],""))||w.apply(r,x.call(n,0));break}}if(t)for(s=fe(t,e,o),Dt=s.dirruns++,null==n&&(n=A.find.TAG("*",Vt.test(t)&&e.parentNode||e)),a=0;c=n[a];a++)Ot=s.runs++,s(c,e)&&r.push(c);return r}),me=(f.querySelectorAll&&(pe=ge,he=/'|\\/g,ue=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,d=[],g=[":active"],de=r.matchesSelector||r.mozMatchesSelector||r.webkitMatchesSelector||r.oMatchesSelector||r.msMatchesSelector,e(function(t){t.innerHTML="<select><option selected></option></select>",t.querySelectorAll("[selected]").length||d.push("\\["+T+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),t.querySelectorAll(":checked").length||d.push(":checked")}),e(function(t){t.innerHTML="<p test=''></p>",t.querySelectorAll("[test^='']").length&&d.push("[*^$]="+T+"*(?:\"\"|'')"),t.innerHTML="<input type='hidden'>",t.querySelectorAll(":enabled").length||d.push(":enabled",":disabled")}),d=d.length&&new RegExp(d.join("|")),ge=function(t,e,r,i,o){if(!(i||o||d&&d.test(t)))if(9===e.nodeType)try{return w.apply(r,x.call(e.querySelectorAll(t),0)),r}catch(t){}else if(1===e.nodeType&&"object"!==e.nodeName.toLowerCase()){var n=e.getAttribute("id"),s=n||c,a=Vt.test(t)&&e.parentNode||e;n?s=s.replace(he,"\\$&"):e.setAttribute("id",s);try{return w.apply(r,x.call(a.querySelectorAll(t.replace($t,"[id='"+s+"'] $&")),0)),r}catch(t){}finally{n||e.removeAttribute("id")}}return pe(t,e,r,i,o)},de&&(e(function(t){ce=de.call(t,"div");try{de.call(t,"[test!='']:sizzle"),g.push(A.match.PSEUDO)}catch(t){}}),g=new RegExp(g.join("|")),I.matchesSelector=function(t,e){if(e=e.replace(ue,"='$1']"),!(ie(t)||g.test(e)||d&&d.test(e)))try{var r=de.call(t,e);if(r||ce||t.document&&11!==t.document.nodeType)return r}catch(t){}return 0<I(e,null,null,[t]).length})),I.attr=b.attr,b.find=I,b.expr=I.selectors,b.expr[":"]=b.expr.pseudos,b.unique=I.uniqueSort,b.text=I.getText,b.isXMLDoc=I.isXML,b.contains=I.contains,/Until$/),ye=/^(?:parents|prev(?:Until|All))/,ve=/^.[^:#\[\.,]*$/,xe=b.expr.match.needsContext,Ce={children:!0,contents:!0,next:!0,prev:!0};function Se(t){return!t||!t.parentNode||11===t.parentNode.nodeType}function _e(t,e){for(;(t=t[e])&&1!==t.nodeType;);return t}function be(t,r,i){if(r=r||0,b.isFunction(r))return b.grep(t,function(t,e){return!!r.call(t,e,t)===i});if(r.nodeType)return b.grep(t,function(t,e){return t===r===i});if("string"==typeof r){var e=b.grep(t,function(t){return 1===t.nodeType});if(ve.test(r))return b.filter(r,e,!i);r=b.filter(r,e)}return b.grep(t,function(t,e){return 0<=b.inArray(t,r)===i})}function Ee(t){var e=we.split("|"),r=t.createDocumentFragment();if(r.createElement)for(;e.length;)r.createElement(e.pop());return r}b.fn.extend({find:function(t){var e,r,i,o,n,s,a=this;if("string"!=typeof t)return b(t).filter(function(){for(e=0,r=a.length;e<r;e++)if(b.contains(a[e],this))return!0});for(s=this.pushStack("","find",t),e=0,r=this.length;e<r;e++)if(i=s.length,b.find(t,this[e],s),0<e)for(o=i;o<s.length;o++)for(n=0;n<i;n++)if(s[n]===s[o]){s.splice(o--,1);break}return s},has:function(t){var e,r=b(t,this),i=r.length;return this.filter(function(){for(e=0;e<i;e++)if(b.contains(this,r[e]))return!0})},not:function(t){return this.pushStack(be(this,t,!1),"not",t)},filter:function(t){return this.pushStack(be(this,t,!0),"filter",t)},is:function(t){return!!t&&("string"==typeof t?xe.test(t)?0<=b(t,this.context).index(this[0]):0<b.filter(t,this).length:0<this.filter(t).length)},closest:function(t,e){for(var r,i=0,o=this.length,n=[],s=xe.test(t)||"string"!=typeof t?b(t,e||this.context):0;i<o;i++)for(r=this[i];r&&r.ownerDocument&&r!==e&&11!==r.nodeType;){if(s?-1<s.index(r):b.find.matchesSelector(r,t)){n.push(r);break}r=r.parentNode}return n=1<n.length?b.unique(n):n,this.pushStack(n,"closest",t)},index:function(t){return t?"string"==typeof t?b.inArray(this[0],b(t)):b.inArray(t.jquery?t[0]:t,this):this[0]&&this[0].parentNode?this.prevAll().length:-1},add:function(t,e){e="string"==typeof t?b(t,e):b.makeArray(t&&t.nodeType?[t]:t),t=b.merge(this.get(),e);return this.pushStack(Se(e[0])||Se(t[0])?t:b.unique(t))},addBack:function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}}),b.fn.andSelf=b.fn.addBack,b.each({parent:function(t){t=t.parentNode;return t&&11!==t.nodeType?t:null},parents:function(t){return b.dir(t,"parentNode")},parentsUntil:function(t,e,r){return b.dir(t,"parentNode",r)},next:function(t){return _e(t,"nextSibling")},prev:function(t){return _e(t,"previousSibling")},nextAll:function(t){return b.dir(t,"nextSibling")},prevAll:function(t){return b.dir(t,"previousSibling")},nextUntil:function(t,e,r){return b.dir(t,"nextSibling",r)},prevUntil:function(t,e,r){return b.dir(t,"previousSibling",r)},siblings:function(t){return b.sibling((t.parentNode||{}).firstChild,t)},children:function(t){return b.sibling(t.firstChild)},contents:function(t){return b.nodeName(t,"iframe")?t.contentDocument||t.contentWindow.document:b.merge([],t.childNodes)}},function(i,o){b.fn[i]=function(t,e){var r=b.map(this,o,t);return(e=me.test(i)?e:t)&&"string"==typeof e&&(r=b.filter(e,r)),r=1<this.length&&!Ce[i]?b.unique(r):r,1<this.length&&ye.test(i)&&(r=r.reverse()),this.pushStack(r,i,p.call(arguments).join(","))}}),b.extend({filter:function(t,e,r){return r&&(t=":not("+t+")"),1===e.length?b.find.matchesSelector(e[0],t)?[e[0]]:[]:b.find.matches(t,e)},dir:function(t,e,r){for(var i=[],o=t[e];o&&9!==o.nodeType&&(r===_||1!==o.nodeType||!b(o).is(r));)1===o.nodeType&&i.push(o),o=o[e];return i},sibling:function(t,e){for(var r=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&r.push(t);return r}});var we="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",Te=/ jQuery\d+="(?:null|\d+)"/g,Pe=/^\s+/,Ie=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Ae=/<([\w:]+)/,Le=/<tbody/i,Re=/<|&#?\w+;/,Oe=/<(?:script|style|link)/i,De=/<(?:script|object|embed|option|style)/i,Fe=new RegExp("<(?:"+we+")[\\s/>]","i"),ke=/^(?:checkbox|radio)$/,Ne=/checked\s*(?:[^=]|=\s*.checked.)/i,Me=/\/(java|ecma)script/i,Ue=/^\s*<!(?:\[CDATA\[|\-\-)|[\]\-]{2}>\s*$/g,S={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},ze=Ee(v),Be=ze.appendChild(v.createElement("div"));function He(t,e){if(1===e.nodeType&&b.hasData(t)){var r,i,o,t=b._data(t),n=b._data(e,t),s=t.events;if(s)for(r in delete n.handle,n.events={},s)for(i=0,o=s[r].length;i<o;i++)b.event.add(e,r,s[r][i]);n.data&&(n.data=b.extend({},n.data))}}function We(t,e){var r;1===e.nodeType&&(e.clearAttributes&&e.clearAttributes(),e.mergeAttributes&&e.mergeAttributes(t),"object"===(r=e.nodeName.toLowerCase())?(e.parentNode&&(e.outerHTML=t.outerHTML),b.support.html5Clone&&t.innerHTML&&!b.trim(e.innerHTML)&&(e.innerHTML=t.innerHTML)):"input"===r&&ke.test(t.type)?(e.defaultChecked=e.checked=t.checked,e.value!==t.value&&(e.value=t.value)):"option"===r?e.selected=t.defaultSelected:"input"===r||"textarea"===r?e.defaultValue=t.defaultValue:"script"===r&&e.text!==t.text&&(e.text=t.text),e.removeAttribute(b.expando))}function $e(t){return void 0!==t.getElementsByTagName?t.getElementsByTagName("*"):void 0!==t.querySelectorAll?t.querySelectorAll("*"):[]}function Ge(t){ke.test(t.type)&&(t.defaultChecked=t.checked)}S.optgroup=S.option,S.tbody=S.tfoot=S.colgroup=S.caption=S.thead,S.th=S.td,b.support.htmlSerialize||(S._default=[1,"X<div>","</div>"]),b.fn.extend({text:function(t){return b.access(this,function(t){return t===_?b.text(this):this.empty().append((this[0]&&this[0].ownerDocument||v).createTextNode(t))},null,t,arguments.length)},wrapAll:function(e){var t;return b.isFunction(e)?this.each(function(t){b(this).wrapAll(e.call(this,t))}):(this[0]&&(t=b(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var t=this;t.firstChild&&1===t.firstChild.nodeType;)t=t.firstChild;return t}).append(this)),this)},wrapInner:function(r){return b.isFunction(r)?this.each(function(t){b(this).wrapInner(r.call(this,t))}):this.each(function(){var t=b(this),e=t.contents();e.length?e.wrapAll(r):t.append(r)})},wrap:function(e){var r=b.isFunction(e);return this.each(function(t){b(this).wrapAll(r?e.call(this,t):e)})},unwrap:function(){return this.parent().each(function(){b.nodeName(this,"body")||b(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(t){1!==this.nodeType&&11!==this.nodeType||this.appendChild(t)})},prepend:function(){return this.domManip(arguments,!0,function(t){1!==this.nodeType&&11!==this.nodeType||this.insertBefore(t,this.firstChild)})},before:function(){var t;return Se(this[0])?arguments.length?(t=b.clean(arguments),this.pushStack(b.merge(t,this),"before",this.selector)):void 0:this.domManip(arguments,!1,function(t){this.parentNode.insertBefore(t,this)})},after:function(){var t;return Se(this[0])?arguments.length?(t=b.clean(arguments),this.pushStack(b.merge(this,t),"after",this.selector)):void 0:this.domManip(arguments,!1,function(t){this.parentNode.insertBefore(t,this.nextSibling)})},remove:function(t,e){for(var r,i=0;null!=(r=this[i]);i++)t&&!b.filter(t,[r]).length||(e||1!==r.nodeType||(b.cleanData(r.getElementsByTagName("*")),b.cleanData([r])),r.parentNode&&r.parentNode.removeChild(r));return this},empty:function(){for(var t,e=0;null!=(t=this[e]);e++)for(1===t.nodeType&&b.cleanData(t.getElementsByTagName("*"));t.firstChild;)t.removeChild(t.firstChild);return this},clone:function(t,e){return t=null!=t&&t,e=null==e?t:e,this.map(function(){return b.clone(this,t,e)})},html:function(t){return b.access(this,function(t){var e=this[0]||{},r=0,i=this.length;if(t===_)return 1===e.nodeType?e.innerHTML.replace(Te,""):_;if("string"==typeof t&&!Oe.test(t)&&(b.support.htmlSerialize||!Fe.test(t))&&(b.support.leadingWhitespace||!Pe.test(t))&&!S[(Ae.exec(t)||["",""])[1].toLowerCase()]){t=t.replace(Ie,"<$1></$2>");try{for(;r<i;r++)1===(e=this[r]||{}).nodeType&&(b.cleanData(e.getElementsByTagName("*")),e.innerHTML=t);e=0}catch(t){}}e&&this.empty().append(t)},null,t,arguments.length)},replaceWith:function(i){return Se(this[0])?this.length?this.pushStack(b(b.isFunction(i)?i():i),"replaceWith",i):this:b.isFunction(i)?this.each(function(t){var e=b(this),r=e.html();e.replaceWith(i.call(this,t,r))}):("string"!=typeof i&&(i=b(i).detach()),this.each(function(){var t=this.nextSibling,e=this.parentNode;b(this).remove(),t?b(t).before(i):b(e).append(i)}))},detach:function(t){return this.remove(t,!0)},domManip:function(r,i,o){var t,e,n,s,a,l,c=0,p=(r=[].concat.apply([],r))[0],h=[],u=this.length;if(!b.support.checkClone&&1<u&&"string"==typeof p&&Ne.test(p))return this.each(function(){b(this).domManip(r,i,o)});if(b.isFunction(p))return this.each(function(t){var e=b(this);r[0]=p.call(this,t,i?e.html():_),e.domManip(r,i,o)});if(this[0]){if(e=(n=(t=b.buildFragment(r,this,h)).fragment).firstChild,1===n.childNodes.length&&(n=e),e)for(i=i&&b.nodeName(e,"tr"),s=t.cacheable||u-1;c<u;c++)o.call(i&&b.nodeName(this[c],"table")?(a=this[c],l="tbody",a.getElementsByTagName(l)[0]||a.appendChild(a.ownerDocument.createElement(l))):this[c],c===s?n:b.clone(n,!0,!0));n=null,h.length&&b.each(h,function(t,e){e.src?b.ajax?b.ajax({url:e.src,type:"GET",dataType:"script",async:!1,global:!1,throws:!0}):b.error("no ajax"):b.globalEval((e.text||e.textContent||e.innerHTML||"").replace(Ue,"")),e.parentNode&&e.parentNode.removeChild(e)})}return this}}),b.buildFragment=function(t,e,r){var i,o,n,s=t[0];return void 0===(e=((e=e||v)[0]||e).ownerDocument||e[0]||e).createDocumentFragment&&(e=v),!(1===t.length&&"string"==typeof s&&s.length<512&&e===v&&"<"===s.charAt(0))||De.test(s)||!b.support.checkClone&&Ne.test(s)||!b.support.html5Clone&&Fe.test(s)||(o=!0,n=(i=b.fragments[s])!==_),i||(i=e.createDocumentFragment(),b.clean(t,e,i,r),o&&(b.fragments[s]=n&&i)),{fragment:i,cacheable:o}},b.fragments={},b.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(s,a){b.fn[s]=function(t){var e,r=0,i=[],o=b(t),n=o.length,t=1===this.length&&this[0].parentNode;if((null==t||t&&11===t.nodeType&&1===t.childNodes.length)&&1===n)return o[a](this[0]),this;for(;r<n;r++)e=(0<r?this.clone(!0):this).get(),b(o[r])[a](e),i=i.concat(e);return this.pushStack(i,s,o.selector)}}),b.extend({clone:function(t,e,r){var i,o,n,s;if(b.support.html5Clone||b.isXMLDoc(t)||!Fe.test("<"+t.nodeName+">")?s=t.cloneNode(!0):(Be.innerHTML=t.outerHTML,Be.removeChild(s=Be.firstChild)),!(b.support.noCloneEvent&&b.support.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||b.isXMLDoc(t)))for(We(t,s),i=$e(t),o=$e(s),n=0;i[n];++n)o[n]&&We(i[n],o[n]);if(e&&(He(t,s),r))for(i=$e(t),o=$e(s),n=0;i[n];++n)He(i[n],o[n]);return i=o=null,s},clean:function(t,e,r,i){for(var o,n,s,a,l,c,p,h,u,d,f=0,g=[],m=(e=e&&void 0!==e.createDocumentFragment?e:v)===v&&ze;null!=(n=t[f]);f++)if("number"==typeof n&&(n+=""),n){if("string"==typeof n)if(Re.test(n)){for(m=m||Ee(e),c=c||m.appendChild(e.createElement("div")),n=n.replace(Ie,"<$1></$2>"),s=(Ae.exec(n)||["",""])[1].toLowerCase(),l=(a=S[s]||S._default)[0],c.innerHTML=a[1]+n+a[2];l--;)c=c.lastChild;if(!b.support.tbody)for(p=Le.test(n),o=(h="table"!==s||p?"<table>"!==a[1]||p?[]:c.childNodes:c.firstChild&&c.firstChild.childNodes).length-1;0<=o;--o)b.nodeName(h[o],"tbody")&&!h[o].childNodes.length&&h[o].parentNode.removeChild(h[o]);!b.support.leadingWhitespace&&Pe.test(n)&&c.insertBefore(e.createTextNode(Pe.exec(n)[0]),c.firstChild),n=c.childNodes,c=m.lastChild}else n=e.createTextNode(n);n.nodeType?g.push(n):g=b.merge(g,n)}if(c&&(m.removeChild(c),n=c=m=null),!b.support.appendChecked)for(f=0;null!=(n=g[f]);f++)b.nodeName(n,"input")?Ge(n):void 0!==n.getElementsByTagName&&b.grep(n.getElementsByTagName("input"),Ge);if(r)for(u=function(t){if(!t.type||Me.test(t.type))return i?i.push(t.parentNode?t.parentNode.removeChild(t):t):r.appendChild(t)},f=0;null!=(n=g[f]);f++)b.nodeName(n,"script")&&u(n)||(r.appendChild(n),void 0!==n.getElementsByTagName&&(d=b.grep(b.merge([],n.getElementsByTagName("script")),u),g.splice.apply(g,[f+1,0].concat(d)),f+=d.length));return g},cleanData:function(t,e){for(var r,i,o,n,s=0,a=b.expando,l=b.cache,c=b.support.deleteExpando,p=b.event.special;null!=(o=t[s]);s++)if((e||b.acceptData(o))&&(r=(i=o[a])&&l[i])){if(r.events)for(n in r.events)p[n]?b.event.remove(o,n):b.removeEvent(o,n,r.handle);l[i]&&(delete l[i],c?delete o[a]:o.removeAttribute?o.removeAttribute(a):o[a]=null,b.deletedIds.push(i))}}}),b.uaMatch=function(t){t=t.toLowerCase();t=/(chrome)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(t)||[];return{browser:t[1]||"",version:t[2]||"0"}},o={},(n=b.uaMatch(H.userAgent)).browser&&(o[n.browser]=!0,o.version=n.version),o.webkit&&(o.safari=!0),b.browser=o,b.sub=function(){function r(t,e){return new r.fn.init(t,e)}b.extend(!0,r,this),r.superclass=this,((r.fn=r.prototype=this()).constructor=r).sub=this.sub,r.fn.init=function(t,e){return e&&e instanceof b&&!(e instanceof r)&&(e=r(e)),b.fn.init.call(this,t,e,i)},r.fn.init.prototype=r.fn;var i=r(v);return r};var m,L,je,qe=/alpha\([^)]*\)/i,Ve=/opacity=([^)]*)/,Ke=/^(top|right|bottom|left)$/,Xe=/^margin/,Ze=new RegExp("^("+X+")(.*)$","i"),Ye=new RegExp("^("+X+")(?!px)[a-z%]+$","i"),Qe=new RegExp("^([-+])=("+X+")","i"),Je={},tr={position:"absolute",visibility:"hidden",display:"block"},er={letterSpacing:0,fontWeight:400,lineHeight:1},R=["Top","Right","Bottom","Left"],rr=["Webkit","O","Moz","ms"],ir=b.fn.toggle;function or(t,e){if(e in t)return e;for(var r=e.charAt(0).toUpperCase()+e.slice(1),i=e,o=rr.length;o--;)if((e=rr[o]+r)in t)return e;return i}function nr(t,e){return"none"===b.css(t=e||t,"display")||!b.contains(t.ownerDocument,t)}function sr(t,e){for(var r,i,o=[],n=0,s=t.length;n<s;n++)(r=t[n]).style&&(o[n]=b._data(r,"olddisplay"),e?(o[n]||"none"!==r.style.display||(r.style.display=""),""===r.style.display&&nr(r)&&(o[n]=b._data(r,"olddisplay",pr(r.nodeName)))):(i=m(r,"display"),o[n]||"none"===i||b._data(r,"olddisplay",i)));for(n=0;n<s;n++)!(r=t[n]).style||e&&"none"!==r.style.display&&""!==r.style.display||(r.style.display=e?o[n]||"":"none");return t}function ar(t,e,r){var i=Ze.exec(e);return i?Math.max(0,i[1]-(r||0))+(i[2]||"px"):e}function lr(t,e,r,i){for(var o=r===(i?"border":"content")?4:"width"===e?1:0,n=0;o<4;o+=2)"margin"===r&&(n+=b.css(t,r+R[o],!0)),i?("content"===r&&(n-=parseFloat(m(t,"padding"+R[o]))||0),"margin"!==r&&(n-=parseFloat(m(t,"border"+R[o]+"Width"))||0)):(n+=parseFloat(m(t,"padding"+R[o]))||0,"padding"!==r&&(n+=parseFloat(m(t,"border"+R[o]+"Width"))||0));return n}function cr(t,e,r){var i="width"===e?t.offsetWidth:t.offsetHeight,o=!0,n=b.support.boxSizing&&"border-box"===b.css(t,"boxSizing");if(i<=0){if(((i=m(t,e))<0||null==i)&&(i=t.style[e]),Ye.test(i))return i;o=n&&(b.support.boxSizingReliable||i===t.style[e]),i=parseFloat(i)||0}return i+lr(t,e,r||(n?"border":"content"),o)+"px"}function pr(t){var e,r;return Je[t]||(r=(e=b("<"+t+">").appendTo(v.body)).css("display"),e.remove(),"none"!==r&&""!==r||(L=v.body.appendChild(L||b.extend(v.createElement("iframe"),{frameBorder:0,width:0,height:0})),je&&L.createElement||((je=(L.contentWindow||L.contentDocument).document).write("<!doctype html><html><body>"),je.close()),e=je.body.appendChild(je.createElement(t)),r=m(e,"display"),v.body.removeChild(L)),Je[t]=r)}b.fn.extend({css:function(t,e){return b.access(this,function(t,e,r){return r!==_?b.style(t,e,r):b.css(t,e)},t,e,1<arguments.length)},show:function(){return sr(this,!0)},hide:function(){return sr(this)},toggle:function(t,e){var r="boolean"==typeof t;return b.isFunction(t)&&b.isFunction(e)?ir.apply(this,arguments):this.each(function(){(r?t:nr(this))?b(this).show():b(this).hide()})}}),b.extend({cssHooks:{opacity:{get:function(t,e){if(e)return""===(e=m(t,"opacity"))?"1":e}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:b.support.cssFloat?"cssFloat":"styleFloat"},style:function(t,e,r,i){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var o,n,s,a=b.camelCase(e),l=t.style;if(e=b.cssProps[a]||(b.cssProps[a]=or(l,a)),s=b.cssHooks[e]||b.cssHooks[a],r===_)return s&&"get"in s&&(o=s.get(t,!1,i))!==_?o:l[e];if("string"===(n=typeof r)&&(o=Qe.exec(r))&&(r=(o[1]+1)*o[2]+parseFloat(b.css(t,e)),n="number"),!(null==r||"number"===n&&isNaN(r)||("number"!==n||b.cssNumber[a]||(r+="px"),s&&"set"in s&&(r=s.set(t,r,i))===_)))try{l[e]=r}catch(t){}}},css:function(t,e,r,i){var o,n=b.camelCase(e);return e=b.cssProps[n]||(b.cssProps[n]=or(t.style,n)),"normal"===(o=(o=(n=b.cssHooks[e]||b.cssHooks[n])&&"get"in n?n.get(t,!0,i):o)===_?m(t,e):o)&&e in er&&(o=er[e]),(r||i!==_)&&(n=parseFloat(o),r||b.isNumeric(n))?n||0:o},swap:function(t,e,r){var i,o={};for(i in e)o[i]=t.style[i],t.style[i]=e[i];for(i in r=r.call(t),e)t.style[i]=o[i];return r}}),y.getComputedStyle?m=function(t,e){var r,i,o=getComputedStyle(t,null),n=t.style;return o&&(""!==(r=o[e])||b.contains(t.ownerDocument.documentElement,t)||(r=b.style(t,e)),Ye.test(r)&&Xe.test(e)&&(t=n.width,e=n.minWidth,i=n.maxWidth,n.minWidth=n.maxWidth=n.width=r,r=o.width,n.width=t,n.minWidth=e,n.maxWidth=i)),r}:v.documentElement.currentStyle&&(m=function(t,e){var r,i,o=t.currentStyle&&t.currentStyle[e],n=t.style;return null==o&&n&&n[e]&&(o=n[e]),Ye.test(o)&&!Ke.test(e)&&(r=n.left,(i=t.runtimeStyle&&t.runtimeStyle.left)&&(t.runtimeStyle.left=t.currentStyle.left),n.left="fontSize"===e?"1em":o,o=n.pixelLeft+"px",n.left=r,i&&(t.runtimeStyle.left=i)),""===o?"auto":o}),b.each(["height","width"],function(t,i){b.cssHooks[i]={get:function(t,e,r){if(e)return 0!==t.offsetWidth||"none"!==m(t,"display")?cr(t,i,r):b.swap(t,tr,function(){return cr(t,i,r)})},set:function(t,e,r){return ar(0,e,r?lr(t,i,r,b.support.boxSizing&&"border-box"===b.css(t,"boxSizing")):0)}}}),b.support.opacity||(b.cssHooks.opacity={get:function(t,e){return Ve.test((e&&t.currentStyle?t.currentStyle:t.style).filter||"")?.01*parseFloat(RegExp.$1)+"":e?"1":""},set:function(t,e){var r=t.style,t=t.currentStyle,i=b.isNumeric(e)?"alpha(opacity="+100*e+")":"",o=t&&t.filter||r.filter||"";(r.zoom=1)<=e&&""===b.trim(o.replace(qe,""))&&r.removeAttribute&&(r.removeAttribute("filter"),t&&!t.filter)||(r.filter=qe.test(o)?o.replace(qe,i):o+" "+i)}}),b(function(){b.support.reliableMarginRight||(b.cssHooks.marginRight={get:function(t,e){return b.swap(t,{display:"inline-block"},function(){if(e)return m(t,"marginRight")})}}),!b.support.pixelPosition&&b.fn.position&&b.each(["top","left"],function(t,r){b.cssHooks[r]={get:function(t,e){if(e)return e=m(t,r),Ye.test(e)?b(t).position()[r]+"px":e}}})}),b.expr&&b.expr.filters&&(b.expr.filters.hidden=function(t){return 0===t.offsetWidth&&0===t.offsetHeight||!b.support.reliableHiddenOffsets&&"none"===(t.style&&t.style.display||m(t,"display"))},b.expr.filters.visible=function(t){return!b.expr.filters.hidden(t)}),b.each({margin:"",padding:"",border:"Width"},function(o,n){b.cssHooks[o+n]={expand:function(t){for(var e="string"==typeof t?t.split(" "):[t],r={},i=0;i<4;i++)r[o+R[i]+n]=e[i]||e[i-2]||e[0];return r}},Xe.test(o)||(b.cssHooks[o+n].set=ar)});var hr=/%20/g,ur=/\[\]$/,dr=/\r?\n/g,fr=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,gr=/^(?:select|textarea)/i;b.fn.extend({serialize:function(){return b.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?b.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||gr.test(this.nodeName)||fr.test(this.type))}).map(function(t,r){var e=b(this).val();return null==e?null:b.isArray(e)?b.map(e,function(t,e){return{name:r.name,value:t.replace(dr,"\r\n")}}):{name:r.name,value:e.replace(dr,"\r\n")}}).get()}}),b.param=function(t,e){function r(t,e){e=b.isFunction(e)?e():null==e?"":e,o[o.length]=encodeURIComponent(t)+"="+encodeURIComponent(e)}var i,o=[];if(e===_&&(e=b.ajaxSettings&&b.ajaxSettings.traditional),b.isArray(t)||t.jquery&&!b.isPlainObject(t))b.each(t,function(){r(this.name,this.value)});else for(i in t)!function r(i,t,o,n){if(b.isArray(t))b.each(t,function(t,e){o||ur.test(i)?n(i,e):r(i+"["+("object"==typeof e?t:"")+"]",e,o,n)});else if(o||"object"!==b.type(t))n(i,t);else for(var e in t)r(i+"["+e+"]",t[e],o,n)}(i,t[i],e,r);return o.join("&").replace(hr,"+")};var O,D,mr=/#.*$/,yr=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,vr=/^(?:GET|HEAD)$/,xr=/^\/\//,Cr=/\?/,Sr=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,_r=/([?&])_=[^&]*/,br=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,Er=b.fn.load,wr={},Tr={},Pr=["*/"]+["*"];try{O=B.href}catch(t){(O=v.createElement("a")).href="",O=O.href}function Ir(a){return function(t,e){"string"!=typeof t&&(e=t,t="*");var r,i,o=t.toLowerCase().split(E),n=0,s=o.length;if(b.isFunction(e))for(;n<s;n++)r=o[n],(i=/^\+/.test(r))&&(r=r.substr(1)||"*"),(a[r]=a[r]||[])[i?"unshift":"push"](e)}}function Ar(t,e,r,i,o,n){(n=n||{})[o=o||e.dataTypes[0]]=!0;for(var s,a=t[o],l=0,c=a?a.length:0,p=t===wr;l<c&&(p||!s);l++)"string"==typeof(s=a[l](e,r,i))&&(s=!p||n[s]?_:(e.dataTypes.unshift(s),Ar(t,e,r,i,s,n)));return s=!p&&s||n["*"]?s:Ar(t,e,r,i,"*",n)}function Lr(t,e){var r,i,o=b.ajaxSettings.flatOptions||{};for(r in e)e[r]!==_&&((o[r]?t:i=i||{})[r]=e[r]);i&&b.extend(!0,t,i)}D=br.exec(O.toLowerCase())||[],b.fn.load=function(t,e,r){var i,o,n,s,a;return"string"!=typeof t&&Er?Er.apply(this,arguments):(this.length&&(s=this,0<=(a=t.indexOf(" "))&&(i=t.slice(a,t.length),t=t.slice(0,a)),b.isFunction(e)?(r=e,e=_):"object"==typeof e&&(o="POST"),b.ajax({url:t,type:o,dataType:"html",data:e,complete:function(t,e){r&&s.each(r,n||[t.responseText,e,t])}}).done(function(t){n=arguments,s.html(i?b("<div>").append(t.replace(Sr,"")).find(i):t)})),this)},b.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(t,e){b.fn[e]=function(t){return this.on(e,t)}}),b.each(["get","post"],function(t,o){b[o]=function(t,e,r,i){return b.isFunction(e)&&(i=i||r,r=e,e=_),b.ajax({type:o,url:t,data:e,success:r,dataType:i})}}),b.extend({getScript:function(t,e){return b.get(t,_,e,"script")},getJSON:function(t,e,r){return b.get(t,e,r,"json")},ajaxSetup:function(t,e){return e?Lr(t,b.ajaxSettings):(e=t,t=b.ajaxSettings),Lr(t,e),t},ajaxSettings:{url:O,isLocal:/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/.test(D[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":Pr},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":y.String,"text html":!0,"text json":b.parseJSON,"text xml":b.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:Ir(wr),ajaxTransport:Ir(Tr),ajax:function(t,e){"object"==typeof t&&(e=t,t=_);var c,p,r,h,u,i,d=b.ajaxSetup({},e=e||{}),f=d.context||d,g=f!==d&&(f.nodeType||f instanceof b)?b(f):b.event,m=b.Deferred(),y=b.Callbacks("once memory"),v=d.statusCode||{},o={},n={},x=0,s="canceled",C={readyState:0,setRequestHeader:function(t,e){var r;return x||(r=t.toLowerCase(),t=n[r]=n[r]||t,o[t]=e),this},getAllResponseHeaders:function(){return 2===x?p:null},getResponseHeader:function(t){var e;if(2===x){if(!r)for(r={};e=yr.exec(p);)r[e[1].toLowerCase()]=e[2];e=r[t.toLowerCase()]}return e===_?null:e},overrideMimeType:function(t){return x||(d.mimeType=t),this},abort:function(t){return t=t||s,h&&h.abort(t),a(0,t),this}};function a(t,e,r,i){var o,n,s,a,l=e;2!==x&&(x=2,u&&clearTimeout(u),h=_,p=i||"",C.readyState=0<t?4:0,r&&(a=function(t,e,r){var i,o,n,s,a=t.contents,l=t.dataTypes,c=t.responseFields;for(o in c)o in r&&(e[c[o]]=r[o]);for(;"*"===l[0];)l.shift(),i===_&&(i=t.mimeType||e.getResponseHeader("content-type"));if(i)for(o in a)if(a[o]&&a[o].test(i)){l.unshift(o);break}if(l[0]in r)n=l[0];else{for(o in r){if(!l[0]||t.converters[o+" "+l[0]]){n=o;break}s=s||o}n=n||s}if(n)return n!==l[0]&&l.unshift(n),r[n]}(d,C,r)),200<=t&&t<300||304===t?(d.ifModified&&((i=C.getResponseHeader("Last-Modified"))&&(b.lastModified[c]=i),(i=C.getResponseHeader("Etag"))&&(b.etag[c]=i)),o=304===t?(l="notmodified",!0):(l=(o=function(t,e){var r,i,o,n,s=t.dataTypes.slice(),a=s[0],l={},c=0;t.dataFilter&&(e=t.dataFilter(e,t.dataType));if(s[1])for(r in t.converters)l[r.toLowerCase()]=t.converters[r];for(;o=s[++c];)if("*"!==o){if("*"!==a&&a!==o){if(!(r=l[a+" "+o]||l["* "+o]))for(i in l)if((n=i.split(" "))[1]===o&&(r=l[a+" "+n[0]]||l["* "+n[0]])){!0===r?r=l[i]:!0!==l[i]&&(o=n[0],s.splice(c--,0,o));break}if(!0!==r)if(r&&t.throws)e=r(e);else try{e=r(e)}catch(t){return{state:"parsererror",error:r?t:"No conversion from "+a+" to "+o}}}a=o}return{state:"success",data:e}}(d,a)).state,n=o.data,!(s=o.error))):(s=l)&&!t||(l="error",t<0&&(t=0)),C.status=t,C.statusText=""+(e||l),o?m.resolveWith(f,[n,l,C]):m.rejectWith(f,[C,l,s]),C.statusCode(v),v=_,S&&g.trigger("ajax"+(o?"Success":"Error"),[C,d,o?n:s]),y.fireWith(f,[C,l]),S&&(g.trigger("ajaxComplete",[C,d]),--b.active||b.event.trigger("ajaxStop")))}if(m.promise(C),C.success=C.done,C.error=C.fail,C.complete=y.add,C.statusCode=function(t){if(t)if(x<2)for(var e in t)v[e]=[v[e],t[e]];else e=t[C.status],C.always(e);return this},d.url=((t||d.url)+"").replace(mr,"").replace(xr,D[1]+"//"),d.dataTypes=b.trim(d.dataType||"*").toLowerCase().split(E),null==d.crossDomain&&(t=br.exec(d.url.toLowerCase()),d.crossDomain=!(!t||t[1]==D[1]&&t[2]==D[2]&&(t[3]||("http:"===t[1]?80:443))==(D[3]||("http:"===D[1]?80:443)))),d.data&&d.processData&&"string"!=typeof d.data&&(d.data=b.param(d.data,d.traditional)),Ar(wr,d,e,C),2!==x){var l,S=d.global;for(i in d.type=d.type.toUpperCase(),d.hasContent=!vr.test(d.type),S&&0==b.active++&&b.event.trigger("ajaxStart"),d.hasContent||(d.data&&(d.url+=(Cr.test(d.url)?"&":"?")+d.data,delete d.data),c=d.url,!1===d.cache&&(t=b.now(),l=d.url.replace(_r,"$1_="+t),d.url=l+(l===d.url?(Cr.test(d.url)?"&":"?")+"_="+t:""))),(d.data&&d.hasContent&&!1!==d.contentType||e.contentType)&&C.setRequestHeader("Content-Type",d.contentType),d.ifModified&&(c=c||d.url,b.lastModified[c]&&C.setRequestHeader("If-Modified-Since",b.lastModified[c]),b.etag[c]&&C.setRequestHeader("If-None-Match",b.etag[c])),C.setRequestHeader("Accept",d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+("*"!==d.dataTypes[0]?", "+Pr+"; q=0.01":""):d.accepts["*"]),d.headers)C.setRequestHeader(i,d.headers[i]);if(d.beforeSend&&(!1===d.beforeSend.call(f,C,d)||2===x))return C.abort();for(i in s="abort",{success:1,error:1,complete:1})C[i](d[i]);if(h=Ar(Tr,d,e,C)){C.readyState=1,S&&g.trigger("ajaxSend",[C,d]),d.async&&0<d.timeout&&(u=setTimeout(function(){C.abort("timeout")},d.timeout));try{x=1,h.send(o,a)}catch(t){if(!(x<2))throw t;a(-1,t)}}else a(-1,"No Transport")}return C},active:0,lastModified:{},etag:{}});var Rr=[],Or=/\?/,Dr=/(=)\?(?=&|$)|\?\?/,Fr=b.now();b.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var t=Rr.pop()||b.expando+"_"+Fr++;return this[t]=!0,t}}),b.ajaxPrefilter("json jsonp",function(t,e,r){var i,o,n,s=t.data,a=t.url,l=!1!==t.jsonp,c=l&&Dr.test(a),p=l&&!c&&"string"==typeof s&&!(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&Dr.test(s);if("jsonp"===t.dataTypes[0]||c||p)return i=t.jsonpCallback=b.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,o=y[i],c?t.url=a.replace(Dr,"$1"+i):p?t.data=s.replace(Dr,"$1"+i):l&&(t.url+=(Or.test(a)?"&":"?")+t.jsonp+"="+i),t.converters["script json"]=function(){return n||b.error(i+" was not called"),n[0]},t.dataTypes[0]="json",y[i]=function(){n=arguments},r.always(function(){y[i]=o,t[i]&&(t.jsonpCallback=e.jsonpCallback,Rr.push(i)),n&&b.isFunction(o)&&o(n[0]),n=o=_}),"script"}),b.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(t){return b.globalEval(t),t}}}),b.ajaxPrefilter("script",function(t){t.cache===_&&(t.cache=!1),t.crossDomain&&(t.type="GET",t.global=!1)}),b.ajaxTransport("script",function(e){var i,o;if(e.crossDomain)return o=v.head||v.getElementsByTagName("head")[0]||v.documentElement,{send:function(t,r){(i=v.createElement("script")).async="async",e.scriptCharset&&(i.charset=e.scriptCharset),i.src=e.url,i.onload=i.onreadystatechange=function(t,e){!e&&i.readyState&&!/loaded|complete/.test(i.readyState)||(i.onload=i.onreadystatechange=null,o&&i.parentNode&&o.removeChild(i),i=_,e||r(200,"success"))},o.insertBefore(i,o.firstChild)},abort:function(){i&&i.onload(0,1)}}});var F,kr=!!y.ActiveXObject&&function(){for(var t in F)F[t](0,1)},Nr=0;function Mr(){try{return new y.XMLHttpRequest}catch(t){}}b.ajaxSettings.xhr=y.ActiveXObject?function(){return!this.isLocal&&Mr()||function(){try{return new y.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}()}:Mr,s=b.ajaxSettings.xhr(),b.extend(b.support,{ajax:!!s,cors:!!s&&"withCredentials"in s}),b.support.ajax&&b.ajaxTransport(function(p){var h;if(!p.crossDomain||b.support.cors)return{send:function(t,a){var l,e,c=p.xhr();if(p.username?c.open(p.type,p.url,p.async,p.username,p.password):c.open(p.type,p.url,p.async),p.xhrFields)for(e in p.xhrFields)c[e]=p.xhrFields[e];p.mimeType&&c.overrideMimeType&&c.overrideMimeType(p.mimeType),p.crossDomain||t["X-Requested-With"]||(t["X-Requested-With"]="XMLHttpRequest");try{for(e in t)c.setRequestHeader(e,t[e])}catch(t){}c.send(p.hasContent&&p.data||null),h=function(t,e){var r,i,o,n,s;try{if(h&&(e||4===c.readyState))if(h=_,l&&(c.onreadystatechange=b.noop,kr&&delete F[l]),e)4!==c.readyState&&c.abort();else{r=c.status,o=c.getAllResponseHeaders(),n={},(s=c.responseXML)&&s.documentElement&&(n.xml=s);try{n.text=c.responseText}catch(t){}try{i=c.statusText}catch(t){i=""}r||!p.isLocal||p.crossDomain?1223===r&&(r=204):r=n.text?200:404}}catch(t){e||a(-1,t)}n&&a(r,i,n,o)},p.async?4===c.readyState?setTimeout(h,0):(l=++Nr,kr&&(F||(F={},b(y).unload(kr)),F[l]=h),c.onreadystatechange=h):h()},abort:function(){h&&h(0,1)}}});var Ur,zr,Br=/^(?:toggle|show|hide)$/,Hr=new RegExp("^(?:([-+])=|)("+X+")([a-z%]*)$","i"),Wr=/queueHooks$/,$r=[function(e,t,r){var i,o,n,s,a,l,c,p,h=this,u=e.style,d={},f=[],g=e.nodeType&&nr(e);r.queue||(null==(c=b._queueHooks(e,"fx")).unqueued&&(c.unqueued=0,p=c.empty.fire,c.empty.fire=function(){c.unqueued||p()}),c.unqueued++,h.always(function(){h.always(function(){c.unqueued--,b.queue(e,"fx").length||c.empty.fire()})}));1===e.nodeType&&("height"in t||"width"in t)&&(r.overflow=[u.overflow,u.overflowX,u.overflowY],"inline"===b.css(e,"display")&&"none"===b.css(e,"float")&&(b.support.inlineBlockNeedsLayout&&"inline"!==pr(e.nodeName)?u.zoom=1:u.display="inline-block"));r.overflow&&(u.overflow="hidden",b.support.shrinkWrapBlocks||h.done(function(){u.overflow=r.overflow[0],u.overflowX=r.overflow[1],u.overflowY=r.overflow[2]}));for(i in t)n=t[i],Br.exec(n)&&(delete t[i],n!==(g?"hide":"show")&&f.push(i));if(s=f.length)for(a=b._data(e,"fxshow")||b._data(e,"fxshow",{}),g?b(e).show():h.done(function(){b(e).hide()}),h.done(function(){for(var t in b.removeData(e,"fxshow",!0),d)b.style(e,t,d[t])}),i=0;i<s;i++)o=f[i],l=h.createTween(o,g?a[o]:0),d[o]=a[o]||b.style(e,o),o in a||(a[o]=l.start,g&&(l.end=l.start,l.start="width"===o||"height"===o?1:0))}],Gr={"*":[function(t,e){var r,i,o,n=this.createTween(t,e),e=Hr.exec(e),s=n.cur(),a=+s||0,l=1;if(e){if(r=+e[2],"px"!==(i=e[3]||(b.cssNumber[t]?"":"px"))&&a)for(a=b.css(n.elem,t,!0)||r||1;o=l=l||".5",b.style(n.elem,t,(a/=l)+i),1!==(l=n.cur()/s)&&l!==o;);n.unit=i,n.start=a,n.end=e[1]?a+(e[1]+1)*r:r}return n}]};function jr(){return setTimeout(function(){Ur=_},0),Ur=b.now()}function qr(o,t,e){var r,i,n,s,a,l,c,p=0,h=$r.length,u=b.Deferred().always(function(){delete d.elem}),d=function(){for(var t=Ur||jr(),t=Math.max(0,f.startTime+f.duration-t),e=1-(t/f.duration||0),r=0,i=f.tweens.length;r<i;r++)f.tweens[r].run(e);return u.notifyWith(o,[f,e,t]),e<1&&i?t:(u.resolveWith(o,[f]),!1)},f=u.promise({elem:o,props:b.extend({},t),opts:b.extend(!0,{specialEasing:{}},e),originalProperties:t,originalOptions:e,startTime:Ur||jr(),duration:e.duration,tweens:[],createTween:function(t,e,r){e=b.Tween(o,f.opts,t,e,f.opts.specialEasing[t]||f.opts.easing);return f.tweens.push(e),e},stop:function(t){for(var e=0,r=t?f.tweens.length:0;e<r;e++)f.tweens[e].run(1);return t?u.resolveWith(o,[f,t]):u.rejectWith(o,[f,t]),this}}),g=f.props,m=g,y=f.opts.specialEasing;for(i in m)if(n=b.camelCase(i),s=y[n],a=m[i],b.isArray(a)&&(s=a[1],a=m[i]=a[0]),i!==n&&(m[n]=a,delete m[i]),(l=b.cssHooks[n])&&"expand"in l)for(i in a=l.expand(a),delete m[n],a)i in m||(m[i]=a[i],y[i]=s);else y[n]=s;for(;p<h;p++)if(r=$r[p].call(f,o,g,f.opts))return r;return c=f,b.each(g,function(t,e){for(var r=(Gr[t]||[]).concat(Gr["*"]),i=0,o=r.length;i<o;i++)if(r[i].call(c,t,e))return}),b.isFunction(f.opts.start)&&f.opts.start.call(o,f),b.fx.timer(b.extend(d,{anim:f,queue:f.opts.queue,elem:o})),f.progress(f.opts.progress).done(f.opts.done,f.opts.complete).fail(f.opts.fail).always(f.opts.always)}function k(t,e,r,i,o){return new k.prototype.init(t,e,r,i,o)}function Vr(t,e){for(var r,i={height:t},o=0;o<4;o+=2-e)i["margin"+(r=R[o])]=i["padding"+r]=t;return e&&(i.opacity=i.width=t),i}b.Animation=b.extend(qr,{tweener:function(t,e){for(var r,i=0,o=(t=b.isFunction(t)?(e=t,["*"]):t.split(" ")).length;i<o;i++)r=t[i],Gr[r]=Gr[r]||[],Gr[r].unshift(e)},prefilter:function(t,e){e?$r.unshift(t):$r.push(t)}}),((b.Tween=k).prototype={constructor:k,init:function(t,e,r,i,o,n){this.elem=t,this.prop=r,this.easing=o||"swing",this.options=e,this.start=this.now=this.cur(),this.end=i,this.unit=n||(b.cssNumber[r]?"":"px")},cur:function(){var t=k.propHooks[this.prop];return(t&&t.get?t:k.propHooks._default).get(this)},run:function(t){var e=k.propHooks[this.prop];return this.pos=t=b.easing[this.easing](t,this.options.duration*t,0,1,this.options.duration),this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),(e&&e.set?e:k.propHooks._default).set(this),this}}).init.prototype=k.prototype,(k.propHooks={_default:{get:function(t){var e;return null==t.elem[t.prop]||t.elem.style&&null!=t.elem.style[t.prop]?(e=b.css(t.elem,t.prop,!1,""))&&"auto"!==e?e:0:t.elem[t.prop]},set:function(t){b.fx.step[t.prop]?b.fx.step[t.prop](t):t.elem.style&&(null!=t.elem.style[b.cssProps[t.prop]]||b.cssHooks[t.prop])?b.style(t.elem,t.prop,t.now+t.unit):t.elem[t.prop]=t.now}}}).scrollTop=k.propHooks.scrollLeft={set:function(t){t.elem.nodeType&&t.elem.parentNode&&(t.elem[t.prop]=t.now)}},b.each(["toggle","show","hide"],function(i,o){var n=b.fn[o];b.fn[o]=function(t,e,r){return null==t||"boolean"==typeof t||!i&&b.isFunction(t)&&b.isFunction(e)?n.apply(this,arguments):this.animate(Vr(o,!0),t,e,r)}}),b.fn.extend({fadeTo:function(t,e,r,i){return this.filter(nr).css("opacity",0).show().end().animate({opacity:e},t,r,i)},animate:function(e,t,r,i){function o(){var t=qr(this,b.extend({},e),s);n&&t.stop(!0)}var n=b.isEmptyObject(e),s=b.speed(t,r,i);return n||!1===s.queue?this.each(o):this.queue(s.queue,o)},stop:function(o,t,n){function s(t){var e=t.stop;delete t.stop,e(n)}return"string"!=typeof o&&(n=t,t=o,o=_),t&&!1!==o&&this.queue(o||"fx",[]),this.each(function(){var t=!0,e=null!=o&&o+"queueHooks",r=b.timers,i=b._data(this);if(e)i[e]&&i[e].stop&&s(i[e]);else for(e in i)i[e]&&i[e].stop&&Wr.test(e)&&s(i[e]);for(e=r.length;e--;)r[e].elem!==this||null!=o&&r[e].queue!==o||(r[e].anim.stop(n),t=!1,r.splice(e,1));!t&&n||b.dequeue(this,o)})}}),b.each({slideDown:Vr("show"),slideUp:Vr("hide"),slideToggle:Vr("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(t,i){b.fn[t]=function(t,e,r){return this.animate(i,t,e,r)}}),b.speed=function(t,e,r){var i=t&&"object"==typeof t?b.extend({},t):{complete:r||!r&&e||b.isFunction(t)&&t,duration:t,easing:r&&e||e&&!b.isFunction(e)&&e};return i.duration=b.fx.off?0:"number"==typeof i.duration?i.duration:i.duration in b.fx.speeds?b.fx.speeds[i.duration]:b.fx.speeds._default,null!=i.queue&&!0!==i.queue||(i.queue="fx"),i.old=i.complete,i.complete=function(){b.isFunction(i.old)&&i.old.call(this),i.queue&&b.dequeue(this,i.queue)},i},b.easing={linear:function(t){return t},swing:function(t){return.5-Math.cos(t*Math.PI)/2}},b.timers=[],b.fx=k.prototype.init,b.fx.tick=function(){for(var t,e=b.timers,r=0;r<e.length;r++)(t=e[r])()||e[r]!==t||e.splice(r--,1);e.length||b.fx.stop()},b.fx.timer=function(t){t()&&b.timers.push(t)&&!zr&&(zr=setInterval(b.fx.tick,b.fx.interval))},b.fx.interval=13,b.fx.stop=function(){clearInterval(zr),zr=null},b.fx.speeds={slow:600,fast:200,_default:400},b.fx.step={},b.expr&&b.expr.filters&&(b.expr.filters.animated=function(e){return b.grep(b.timers,function(t){return e===t.elem}).length});var Kr=/^(?:body|html)$/i;function Xr(t){return b.isWindow(t)?t:9===t.nodeType&&(t.defaultView||t.parentWindow)}b.fn.offset=function(e){var t,r,i,o,n,s;return arguments.length?e===_?this:this.each(function(t){b.offset.setOffset(this,e,t)}):(s=(n=this[0])&&n.ownerDocument)?(i=s.body)===n?b.offset.bodyOffset(n):(t=s.documentElement,b.contains(t,n)?(n=n.getBoundingClientRect(),s=Xr(s),r=t.clientTop||i.clientTop||0,i=t.clientLeft||i.clientLeft||0,o=s.pageYOffset||t.scrollTop,s=s.pageXOffset||t.scrollLeft,{top:n.top+o-r,left:n.left+s-i}):{top:0,left:0}):void 0},b.offset={bodyOffset:function(t){var e=t.offsetTop,r=t.offsetLeft;return b.support.doesNotIncludeMarginInBodyOffset&&(e+=parseFloat(b.css(t,"marginTop"))||0,r+=parseFloat(b.css(t,"marginLeft"))||0),{top:e,left:r}},setOffset:function(t,e,r){var i,o=b.css(t,"position"),n=("static"===o&&(t.style.position="relative"),b(t)),s=n.offset(),a=b.css(t,"top"),l=b.css(t,"left"),c={},o=("absolute"===o||"fixed"===o)&&-1<b.inArray("auto",[a,l])?(i=(o=n.position()).top,o.left):(i=parseFloat(a)||0,parseFloat(l)||0);null!=(e=b.isFunction(e)?e.call(t,r,s):e).top&&(c.top=e.top-s.top+i),null!=e.left&&(c.left=e.left-s.left+o),"using"in e?e.using.call(t,c):n.css(c)}},b.fn.extend({position:function(){var t,e,r,i;if(this[0])return t=this[0],e=this.offsetParent(),r=this.offset(),i=Kr.test(e[0].nodeName)?{top:0,left:0}:e.offset(),r.top-=parseFloat(b.css(t,"marginTop"))||0,r.left-=parseFloat(b.css(t,"marginLeft"))||0,i.top+=parseFloat(b.css(e[0],"borderTopWidth"))||0,i.left+=parseFloat(b.css(e[0],"borderLeftWidth"))||0,{top:r.top-i.top,left:r.left-i.left}},offsetParent:function(){return this.map(function(){for(var t=this.offsetParent||v.body;t&&!Kr.test(t.nodeName)&&"static"===b.css(t,"position");)t=t.offsetParent;return t||v.body})}}),b.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,o){var n=/Y/.test(o);b.fn[e]=function(t){return b.access(this,function(t,e,r){var i=Xr(t);if(r===_)return i?o in i?i[o]:i.document.documentElement[e]:t[e];i?i.scrollTo(n?b(i).scrollLeft():r,n?r:b(i).scrollTop()):t[e]=r},e,t,arguments.length,null)}}),b.each({Height:"height",Width:"width"},function(n,s){b.each({padding:"inner"+n,content:s,"":"outer"+n},function(i,t){b.fn[t]=function(t,e){var r=arguments.length&&(i||"boolean"!=typeof t),o=i||(!0===t||!0===e?"margin":"border");return b.access(this,function(t,e,r){var i;return b.isWindow(t)?t.document.documentElement["client"+n]:9===t.nodeType?(i=t.documentElement,Math.max(t.body["scroll"+n],i["scroll"+n],t.body["offset"+n],i["offset"+n],i["client"+n])):r===_?b.css(t,e,r,o):b.style(t,e,r,o)},s,r?t:_,r)}})}),y.jQuery=y.$=b,"function"==typeof define&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return b})}(window),function(a){var t,e,r=0,i=/^ui-id-\d+$/;function o(t,e){var r,i,o=t.nodeName.toLowerCase();return"area"===o?(r=(i=t.parentNode).name,!(!t.href||!r||"map"!==i.nodeName.toLowerCase())&&(!!(i=a("img[usemap=#"+r+"]")[0])&&n(i))):(/input|select|textarea|button|object/.test(o)?!t.disabled:"a"===o&&t.href||e)&&n(t)}function n(t){return a.expr.filters.visible(t)&&!a(t).parents().addBack().filter(function(){return"hidden"===a.css(this,"visibility")}).length}a.ui=a.ui||{},a.extend(a.ui,{version:"1.10.3",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),a.fn.extend({focus:(t=a.fn.focus,function(e,r){return"number"==typeof e?this.each(function(){var t=this;setTimeout(function(){a(t).focus(),r&&r.call(t)},e)}):t.apply(this,arguments)}),scrollParent:function(){var t=(a.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(a.css(this,"position"))&&/(auto|scroll)/.test(a.css(this,"overflow")+a.css(this,"overflow-y")+a.css(this,"overflow-x"))}):this.parents().filter(function(){return/(auto|scroll)/.test(a.css(this,"overflow")+a.css(this,"overflow-y")+a.css(this,"overflow-x"))})).eq(0);return/fixed/.test(this.css("position"))||!t.length?a(document):t},zIndex:function(t){if(void 0!==t)return this.css("zIndex",t);if(this.length)for(var e,r=a(this[0]);r.length&&r[0]!==document;){if(("absolute"===(e=r.css("position"))||"relative"===e||"fixed"===e)&&(e=parseInt(r.css("zIndex"),10),!isNaN(e)&&0!==e))return e;r=r.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++r)})},removeUniqueId:function(){return this.each(function(){i.test(this.id)&&a(this).removeAttr("id")})}}),a.extend(a.expr[":"],{data:a.expr.createPseudo?a.expr.createPseudo(function(e){return function(t){return!!a.data(t,e)}}):function(t,e,r){return!!a.data(t,r[3])},focusable:function(t){return o(t,!isNaN(a.attr(t,"tabindex")))},tabbable:function(t){var e=a.attr(t,"tabindex"),r=isNaN(e);return(r||0<=e)&&o(t,!r)}}),a("<a>").outerWidth(1).jquery||a.each(["Width","Height"],function(t,r){var o="Width"===r?["Left","Right"]:["Top","Bottom"],i=r.toLowerCase(),n={innerWidth:a.fn.innerWidth,innerHeight:a.fn.innerHeight,outerWidth:a.fn.outerWidth,outerHeight:a.fn.outerHeight};function s(t,e,r,i){return a.each(o,function(){e-=parseFloat(a.css(t,"padding"+this))||0,r&&(e-=parseFloat(a.css(t,"border"+this+"Width"))||0),i&&(e-=parseFloat(a.css(t,"margin"+this))||0)}),e}a.fn["inner"+r]=function(t){return void 0===t?n["inner"+r].call(this):this.each(function(){a(this).css(i,s(this,t)+"px")})},a.fn["outer"+r]=function(t,e){return"number"!=typeof t?n["outer"+r].call(this,t):this.each(function(){a(this).css(i,s(this,t,!0,e)+"px")})}}),a.fn.addBack||(a.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),a("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(a.fn.removeData=(e=a.fn.removeData,function(t){return arguments.length?e.call(this,a.camelCase(t)):e.call(this)})),a.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),a.support.selectstart="onselectstart"in document.createElement("div"),a.fn.extend({disableSelection:function(){return this.bind((a.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(t){t.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),a.extend(a.ui,{plugin:{add:function(t,e,r){var i,o=a.ui[t].prototype;for(i in r)o.plugins[i]=o.plugins[i]||[],o.plugins[i].push([e,r[i]])},call:function(t,e,r){var i,o=t.plugins[e];if(o&&t.element[0].parentNode&&11!==t.element[0].parentNode.nodeType)for(i=0;i<o.length;i++)t.options[o[i][0]]&&o[i][1].apply(t.element,r)}},hasScroll:function(t,e){var r;return"hidden"!==a(t).css("overflow")&&(r=!1,0<t[e=e&&"left"===e?"scrollLeft":"scrollTop"]||(t[e]=1,r=0<t[e],t[e]=0,r))}})}(jQuery),function(c,a){var r=0,l=Array.prototype.slice,i=c.cleanData;c.cleanData=function(t){for(var e,r=0;null!=(e=t[r]);r++)try{c(e).triggerHandler("remove")}catch(t){}i(t)},c.widget=function(t,r,e){var i,o,n,s,a={},l=t.split(".")[0];t=t.split(".")[1],i=l+"-"+t,e||(e=r,r=c.Widget),c.expr[":"][i.toLowerCase()]=function(t){return!!c.data(t,i)},c[l]=c[l]||{},o=c[l][t],n=c[l][t]=function(t,e){if(!this._createWidget)return new n(t,e);arguments.length&&this._createWidget(t,e)},c.extend(n,o,{version:e.version,_proto:c.extend({},e),_childConstructors:[]}),(s=new r).options=c.widget.extend({},s.options),c.each(e,function(e,i){function o(){return r.prototype[e].apply(this,arguments)}function n(t){return r.prototype[e].apply(this,t)}c.isFunction(i)?a[e]=function(){var t,e=this._super,r=this._superApply;return this._super=o,this._superApply=n,t=i.apply(this,arguments),this._super=e,this._superApply=r,t}:a[e]=i}),n.prototype=c.widget.extend(s,{widgetEventPrefix:o?s.widgetEventPrefix:t},a,{constructor:n,namespace:l,widgetName:t,widgetFullName:i}),o?(c.each(o._childConstructors,function(t,e){var r=e.prototype;c.widget(r.namespace+"."+r.widgetName,n,e._proto)}),delete o._childConstructors):r._childConstructors.push(n),c.widget.bridge(t,n)},c.widget.extend=function(t){for(var e,r,i=l.call(arguments,1),o=0,n=i.length;o<n;o++)for(e in i[o])r=i[o][e],i[o].hasOwnProperty(e)&&r!==a&&(c.isPlainObject(r)?t[e]=c.isPlainObject(t[e])?c.widget.extend({},t[e],r):c.widget.extend({},r):t[e]=r);return t},c.widget.bridge=function(n,e){var s=e.prototype.widgetFullName||n;c.fn[n]=function(r){var t="string"==typeof r,i=l.call(arguments,1),o=this;return r=!t&&i.length?c.widget.extend.apply(null,[r].concat(i)):r,t?this.each(function(){var t,e=c.data(this,s);return e?c.isFunction(e[r])&&"_"!==r.charAt(0)?(t=e[r].apply(e,i))!==e&&t!==a?(o=t&&t.jquery?o.pushStack(t.get()):t,!1):void 0:c.error("no such method '"+r+"' for "+n+" widget instance"):c.error("cannot call methods on "+n+" prior to initialization; attempted to call method '"+r+"'")}):this.each(function(){var t=c.data(this,s);t?t.option(r||{})._init():c.data(this,s,new e(r,this))}),o}},c.Widget=function(){},c.Widget._childConstructors=[],c.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,e){e=c(e||this.defaultElement||this)[0],this.element=c(e),this.uuid=r++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=c.widget.extend({},this.options,this._getCreateOptions(),t),this.bindings=c(),this.hoverable=c(),this.focusable=c(),e!==this&&(c.data(e,this.widgetFullName,this),this._on(!0,this.element,{remove:function(t){t.target===e&&this.destroy()}}),this.document=c(e.style?e.ownerDocument:e.document||e),this.window=c(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:c.noop,_getCreateEventData:c.noop,_create:c.noop,_init:c.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(c.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:c.noop,widget:function(){return this.element},option:function(t,e){var r,i,o,n=t;if(0===arguments.length)return c.widget.extend({},this.options);if("string"==typeof t)if(n={},t=(r=t.split(".")).shift(),r.length){for(i=n[t]=c.widget.extend({},this.options[t]),o=0;o<r.length-1;o++)i[r[o]]=i[r[o]]||{},i=i[r[o]];if(t=r.pop(),e===a)return i[t]===a?null:i[t];i[t]=e}else{if(e===a)return this.options[t]===a?null:this.options[t];n[t]=e}return this._setOptions(n),this},_setOptions:function(t){for(var e in t)this._setOption(e,t[e]);return this},_setOption:function(t,e){return this.options[t]=e,"disabled"===t&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!e).attr("aria-disabled",e),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(o,n,t){var s,a=this;"boolean"!=typeof o&&(t=n,n=o,o=!1),t?(n=s=c(n),this.bindings=this.bindings.add(n)):(t=n,n=this.element,s=this.widget()),c.each(t,function(t,e){function r(){if(o||!0!==a.options.disabled&&!c(this).hasClass("ui-state-disabled"))return("string"==typeof e?a[e]:e).apply(a,arguments)}"string"!=typeof e&&(r.guid=e.guid=e.guid||r.guid||c.guid++);var t=t.match(/^(\w+)\s*(.*)$/),i=t[1]+a.eventNamespace,t=t[2];t?s.delegate(t,i,r):n.bind(i,r)})},_off:function(t,e){e=(e||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,t.unbind(e).undelegate(e)},_delay:function(t,e){var r=this;return setTimeout(function(){return("string"==typeof t?r[t]:t).apply(r,arguments)},e||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){c(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){c(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){c(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){c(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,e,r){var i,o,n=this.options[t];if(r=r||{},(e=c.Event(e)).type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),e.target=this.element[0],o=e.originalEvent)for(i in o)i in e||(e[i]=o[i]);return this.element.trigger(e,r),!(c.isFunction(n)&&!1===n.apply(this.element[0],[e].concat(r))||e.isDefaultPrevented())}},c.each({show:"fadeIn",hide:"fadeOut"},function(n,s){c.Widget.prototype["_"+n]=function(e,t,r){var i=(t="string"==typeof t?{effect:t}:t)?!0!==t&&"number"!=typeof t&&t.effect||s:n,o=!c.isEmptyObject(t="number"==typeof(t=t||{})?{duration:t}:t);t.complete=r,t.delay&&e.delay(t.delay),o&&c.effects&&c.effects.effect[i]?e[n](t):i!==n&&e[i]?e[i](t.duration,t.easing,r):e.queue(function(t){c(this)[n](),r&&r.call(e[0]),t()})}})}(jQuery),function(o){var n=!1;o(document).mouseup(function(){n=!1}),o.widget("ui.mouse",{version:"1.10.3",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var e=this;this.element.bind("mousedown."+this.widgetName,function(t){return e._mouseDown(t)}).bind("click."+this.widgetName,function(t){if(!0===o.data(t.target,e.widgetName+".preventClickEvent"))return o.removeData(t.target,e.widgetName+".preventClickEvent"),t.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&o(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(t){var e,r,i;if(!n)return this._mouseStarted&&this._mouseUp(t),r=1===(this._mouseDownEvent=t).which,i=!("string"!=typeof(e=this).options.cancel||!t.target.nodeName)&&o(t.target).closest(this.options.cancel).length,r&&!i&&this._mouseCapture(t)&&(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){e.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=!1!==this._mouseStart(t),!this._mouseStarted)?t.preventDefault():(!0===o.data(t.target,this.widgetName+".preventClickEvent")&&o.removeData(t.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(t){return e._mouseMove(t)},this._mouseUpDelegate=function(t){return e._mouseUp(t)},o(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),t.preventDefault(),n=!0)),!0},_mouseMove:function(t){return o.ui.ie&&(!document.documentMode||document.documentMode<9)&&!t.button?this._mouseUp(t):this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=!1!==this._mouseStart(this._mouseDownEvent,t),this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(t){return o(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&o.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),!1},_mouseDistanceMet:function(t){return Math.max(Math.abs(this._mouseDownEvent.pageX-t.pageX),Math.abs(this._mouseDownEvent.pageY-t.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function(d){function f(t,e,r){return e<t&&t<e+r}function g(t){return/left|right/.test(t.css("float"))||/inline|table-cell/.test(t.css("display"))}d.widget("ui.sortable",d.ui.mouse,{version:"1.10.3",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_create:function(){var t=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=!!this.items.length&&("x"===t.axis||g(this.items[0].item)),this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var t=this.items.length-1;0<=t;t--)this.items[t].item.removeData(this.widgetName+"-item");return this},_setOption:function(t,e){"disabled"===t?(this.options[t]=e,this.widget().toggleClass("ui-sortable-disabled",!!e)):d.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(t,e){var r=null,i=!1,o=this;return!this.reverting&&(!this.options.disabled&&"static"!==this.options.type&&(this._refreshItems(t),d(t.target).parents().each(function(){if(d.data(this,o.widgetName+"-item")===o)return r=d(this),!1}),!!(r=d.data(t.target,o.widgetName+"-item")===o?d(t.target):r)&&(!(this.options.handle&&!e&&(d(this.options.handle,r).find("*").addBack().each(function(){this===t.target&&(i=!0)}),!i))&&(this.currentItem=r,this._removeCurrentsFromItems(),!0))))},_mouseStart:function(t,e,r){var i,o,n=this.options;if((this.currentContainer=this).refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},d.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,n.cursorAt&&this._adjustOffsetFromHelper(n.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),n.containment&&this._setContainment(),n.cursor&&"auto"!==n.cursor&&(o=this.document.find("body"),this.storedCursor=o.css("cursor"),o.css("cursor",n.cursor),this.storedStylesheet=d("<style>*{ cursor: "+n.cursor+" !important; }</style>").appendTo(o)),n.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",n.opacity)),n.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",n.zIndex)),this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!r)for(i=this.containers.length-1;0<=i;i--)this.containers[i]._trigger("activate",t,this._uiHash(this));return d.ui.ddmanager&&(d.ui.ddmanager.current=this),d.ui.ddmanager&&!n.dropBehaviour&&d.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){var e,r,i,o,n=this.options,s=!1;for(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<n.scrollSensitivity?this.scrollParent[0].scrollTop=s=this.scrollParent[0].scrollTop+n.scrollSpeed:t.pageY-this.overflowOffset.top<n.scrollSensitivity&&(this.scrollParent[0].scrollTop=s=this.scrollParent[0].scrollTop-n.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<n.scrollSensitivity?this.scrollParent[0].scrollLeft=s=this.scrollParent[0].scrollLeft+n.scrollSpeed:t.pageX-this.overflowOffset.left<n.scrollSensitivity&&(this.scrollParent[0].scrollLeft=s=this.scrollParent[0].scrollLeft-n.scrollSpeed)):(t.pageY-d(document).scrollTop()<n.scrollSensitivity?s=d(document).scrollTop(d(document).scrollTop()-n.scrollSpeed):d(window).height()-(t.pageY-d(document).scrollTop())<n.scrollSensitivity&&(s=d(document).scrollTop(d(document).scrollTop()+n.scrollSpeed)),t.pageX-d(document).scrollLeft()<n.scrollSensitivity?s=d(document).scrollLeft(d(document).scrollLeft()-n.scrollSpeed):d(window).width()-(t.pageX-d(document).scrollLeft())<n.scrollSensitivity&&(s=d(document).scrollLeft(d(document).scrollLeft()+n.scrollSpeed))),!1!==s&&d.ui.ddmanager&&!n.dropBehaviour&&d.ui.ddmanager.prepareOffsets(this,t)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),e=this.items.length-1;0<=e;e--)if(i=(r=this.items[e]).item[0],(o=this._intersectsWithPointer(r))&&r.instance===this.currentContainer&&!(i===this.currentItem[0]||this.placeholder[1===o?"next":"prev"]()[0]===i||d.contains(this.placeholder[0],i)||"semi-dynamic"===this.options.type&&d.contains(this.element[0],i))){if(this.direction=1===o?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(r))break;this._rearrange(t,r),this._trigger("change",t,this._uiHash());break}return this._contactContainers(t),d.ui.ddmanager&&d.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,e){var r,i,o,n;if(t)return d.ui.ddmanager&&!this.options.dropBehaviour&&d.ui.ddmanager.drop(this,t),this.options.revert?(i=(r=this).placeholder.offset(),n={},(o=this.options.axis)&&"x"!==o||(n.left=i.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft)),o&&"y"!==o||(n.top=i.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,d(this.helper).animate(n,parseInt(this.options.revert,10)||500,function(){r._clear(t)})):this._clear(t,e),!1},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var t=this.containers.length-1;0<=t;t--)this.containers[t]._trigger("deactivate",null,this._uiHash(this)),this.containers[t].containerCache.over&&(this.containers[t]._trigger("out",null,this._uiHash(this)),this.containers[t].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),d.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?d(this.domPosition.prev).after(this.currentItem):d(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(e){var t=this._getItemsAsjQuery(e&&e.connected),r=[];return e=e||{},d(t).each(function(){var t=(d(e.item||this).attr(e.attribute||"id")||"").match(e.expression||/(.+)[\-=_](.+)/);t&&r.push((e.key||t[1]+"[]")+"="+(e.key&&e.expression?t[1]:t[2]))}),!r.length&&e.key&&r.push(e.key+"="),r.join("&")},toArray:function(t){var e=this._getItemsAsjQuery(t&&t.connected),r=[];return t=t||{},e.each(function(){r.push(d(t.item||this).attr(t.attribute||"id")||"")}),r},_intersectsWith:function(t){var e=this.positionAbs.left,r=e+this.helperProportions.width,i=this.positionAbs.top,o=i+this.helperProportions.height,n=t.left,s=n+t.width,a=t.top,l=a+t.height,c=this.offset.click.top,p=this.offset.click.left,c="x"===this.options.axis||a<i+c&&i+c<l,p="y"===this.options.axis||n<e+p&&e+p<s;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>t[this.floating?"width":"height"]?c&&p:n<e+this.helperProportions.width/2&&r-this.helperProportions.width/2<s&&a<i+this.helperProportions.height/2&&o-this.helperProportions.height/2<l},_intersectsWithPointer:function(t){var e="x"===this.options.axis||f(this.positionAbs.top+this.offset.click.top,t.top,t.height),t="y"===this.options.axis||f(this.positionAbs.left+this.offset.click.left,t.left,t.width),e=e&&t,t=this._getDragVerticalDirection(),r=this._getDragHorizontalDirection();return!!e&&(this.floating?r&&"right"===r||"down"===t?2:1:t&&("down"===t?2:1))},_intersectsWithSides:function(t){var e=f(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),t=f(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),r=this._getDragVerticalDirection(),i=this._getDragHorizontalDirection();return this.floating&&i?"right"===i&&t||"left"===i&&!t:r&&("down"===r&&e||"up"===r&&!e)},_getDragVerticalDirection:function(){var t=this.positionAbs.top-this.lastPositionAbs.top;return 0!=t&&(0<t?"down":"up")},_getDragHorizontalDirection:function(){var t=this.positionAbs.left-this.lastPositionAbs.left;return 0!=t&&(0<t?"right":"left")},refresh:function(t){return this._refreshItems(t),this.refreshPositions(),this},_connectWith:function(){var t=this.options;return t.connectWith.constructor===String?[t.connectWith]:t.connectWith},_getItemsAsjQuery:function(t){var e,r,i,o,n=[],s=[],a=this._connectWith();if(a&&t)for(e=a.length-1;0<=e;e--)for(r=(i=d(a[e])).length-1;0<=r;r--)(o=d.data(i[r],this.widgetFullName))&&o!==this&&!o.options.disabled&&s.push([d.isFunction(o.options.items)?o.options.items.call(o.element):d(o.options.items,o.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),o]);for(s.push([d.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):d(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),e=s.length-1;0<=e;e--)s[e][0].each(function(){n.push(this)});return d(n)},_removeCurrentsFromItems:function(){var r=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=d.grep(this.items,function(t){for(var e=0;e<r.length;e++)if(r[e]===t.item[0])return!1;return!0})},_refreshItems:function(t){this.items=[],this.containers=[this];var e,r,i,o,n,s,a,l,c=this.items,p=[[d.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):d(this.options.items,this.element),this]],h=this._connectWith();if(h&&this.ready)for(e=h.length-1;0<=e;e--)for(r=(i=d(h[e])).length-1;0<=r;r--)(o=d.data(i[r],this.widgetFullName))&&o!==this&&!o.options.disabled&&(p.push([d.isFunction(o.options.items)?o.options.items.call(o.element[0],t,{item:this.currentItem}):d(o.options.items,o.element),o]),this.containers.push(o));for(e=p.length-1;0<=e;e--)for(n=p[e][1],l=(s=p[e][r=0]).length;r<l;r++)(a=d(s[r])).data(this.widgetName+"-item",n),c.push({item:a,instance:n,width:0,height:0,left:0,top:0})},refreshPositions:function(t){var e,r,i,o;for(this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset()),e=this.items.length-1;0<=e;e--)(r=this.items[e]).instance!==this.currentContainer&&this.currentContainer&&r.item[0]!==this.currentItem[0]||(i=this.options.toleranceElement?d(this.options.toleranceElement,r.item):r.item,t||(r.width=i.outerWidth(),r.height=i.outerHeight()),o=i.offset(),r.left=o.left,r.top=o.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(e=this.containers.length-1;0<=e;e--)o=this.containers[e].element.offset(),this.containers[e].containerCache.left=o.left,this.containers[e].containerCache.top=o.top,this.containers[e].containerCache.width=this.containers[e].element.outerWidth(),this.containers[e].containerCache.height=this.containers[e].element.outerHeight();return this},_createPlaceholder:function(r){var i,o=(r=r||this).options;o.placeholder&&o.placeholder.constructor!==String||(i=o.placeholder,o.placeholder={element:function(){var t=r.currentItem[0].nodeName.toLowerCase(),e=d("<"+t+">",r.document[0]).addClass(i||r.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tr"===t?r.currentItem.children().each(function(){d("<td>&#160;</td>",r.document[0]).attr("colspan",d(this).attr("colspan")||1).appendTo(e)}):"img"===t&&e.attr("src",r.currentItem.attr("src")),i||e.css("visibility","hidden"),e},update:function(t,e){i&&!o.forcePlaceholderSize||(e.height()||e.height(r.currentItem.innerHeight()-parseInt(r.currentItem.css("paddingTop")||0,10)-parseInt(r.currentItem.css("paddingBottom")||0,10)),e.width()||e.width(r.currentItem.innerWidth()-parseInt(r.currentItem.css("paddingLeft")||0,10)-parseInt(r.currentItem.css("paddingRight")||0,10)))}}),r.placeholder=d(o.placeholder.element.call(r.element,r.currentItem)),r.currentItem.after(r.placeholder),o.placeholder.update(r,r.placeholder)},_contactContainers:function(t){for(var e,r,i,o,n,s,a,l,c,p=null,h=null,u=this.containers.length-1;0<=u;u--)d.contains(this.currentItem[0],this.containers[u].element[0])||(this._intersectsWith(this.containers[u].containerCache)?p&&d.contains(this.containers[u].element[0],p.element[0])||(p=this.containers[u],h=u):this.containers[u].containerCache.over&&(this.containers[u]._trigger("out",t,this._uiHash(this)),this.containers[u].containerCache.over=0));if(p)if(1===this.containers.length)this.containers[h].containerCache.over||(this.containers[h]._trigger("over",t,this._uiHash(this)),this.containers[h].containerCache.over=1);else{for(r=1e4,i=null,n=(c=p.floating||g(this.currentItem))?"width":"height",s=this.positionAbs[o=c?"left":"top"]+this.offset.click[o],e=this.items.length-1;0<=e;e--)!d.contains(this.containers[h].element[0],this.items[e].item[0])||this.items[e].item[0]===this.currentItem[0]||c&&!f(this.positionAbs.top+this.offset.click.top,this.items[e].top,this.items[e].height)||(a=this.items[e].item.offset()[o],l=!1,Math.abs(a-s)>Math.abs(a+this.items[e][n]-s)&&(l=!0,a+=this.items[e][n]),Math.abs(a-s)<r&&(r=Math.abs(a-s),i=this.items[e],this.direction=l?"up":"down"));(i||this.options.dropOnEmpty)&&this.currentContainer!==this.containers[h]&&(i?this._rearrange(t,i,null,!0):this._rearrange(t,null,this.containers[h].element,!0),this._trigger("change",t,this._uiHash()),this.containers[h]._trigger("change",t,this._uiHash(this)),this.currentContainer=this.containers[h],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[h]._trigger("over",t,this._uiHash(this)),this.containers[h].containerCache.over=1)}},_createHelper:function(t){var e=this.options,t=d.isFunction(e.helper)?d(e.helper.apply(this.element[0],[t,this.currentItem])):"clone"===e.helper?this.currentItem.clone():this.currentItem;return t.parents("body").length||d("parent"!==e.appendTo?e.appendTo:this.currentItem[0].parentNode)[0].appendChild(t[0]),t[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),t[0].style.width&&!e.forceHelperSize||t.width(this.currentItem.width()),t[0].style.height&&!e.forceHelperSize||t.height(this.currentItem.height()),t},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),"left"in(t=d.isArray(t)?{left:+t[0],top:+t[1]||0}:t)&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&d.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),{top:(t=this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&d.ui.ie?{top:0,left:0}:t).top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){var t;return"relative"===this.cssPosition?{top:(t=this.currentItem.position()).top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}:{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,e,r=this.options;"parent"===r.containment&&(r.containment=this.helper[0].parentNode),"document"!==r.containment&&"window"!==r.containment||(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,d("document"===r.containment?document:window).width()-this.helperProportions.width-this.margins.left,(d("document"===r.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(r.containment)||(t=d(r.containment)[0],r=d(r.containment).offset(),e="hidden"!==d(t).css("overflow"),this.containment=[r.left+(parseInt(d(t).css("borderLeftWidth"),10)||0)+(parseInt(d(t).css("paddingLeft"),10)||0)-this.margins.left,r.top+(parseInt(d(t).css("borderTopWidth"),10)||0)+(parseInt(d(t).css("paddingTop"),10)||0)-this.margins.top,r.left+(e?Math.max(t.scrollWidth,t.offsetWidth):t.offsetWidth)-(parseInt(d(t).css("borderLeftWidth"),10)||0)-(parseInt(d(t).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,r.top+(e?Math.max(t.scrollHeight,t.offsetHeight):t.offsetHeight)-(parseInt(d(t).css("borderTopWidth"),10)||0)-(parseInt(d(t).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(t,e){e=e||this.position;var t="absolute"===t?1:-1,r="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&d.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,i=/(html|body)/i.test(r[0].tagName);return{top:e.top+this.offset.relative.top*t+this.offset.parent.top*t-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():i?0:r.scrollTop())*t,left:e.left+this.offset.relative.left*t+this.offset.parent.left*t-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():i?0:r.scrollLeft())*t}},_generatePosition:function(t){var e=this.options,r=t.pageX,i=t.pageY,o="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&d.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,n=/(html|body)/i.test(o[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==document&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(r=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(i=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(r=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(i=this.containment[3]+this.offset.click.top)),e.grid&&(t=this.originalPageY+Math.round((i-this.originalPageY)/e.grid[1])*e.grid[1],i=!this.containment||t-this.offset.click.top>=this.containment[1]&&t-this.offset.click.top<=this.containment[3]?t:t-this.offset.click.top>=this.containment[1]?t-e.grid[1]:t+e.grid[1],t=this.originalPageX+Math.round((r-this.originalPageX)/e.grid[0])*e.grid[0],r=!this.containment||t-this.offset.click.left>=this.containment[0]&&t-this.offset.click.left<=this.containment[2]?t:t-this.offset.click.left>=this.containment[0]?t-e.grid[0]:t+e.grid[0])),{top:i-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():n?0:o.scrollTop()),left:r-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():n?0:o.scrollLeft())}},_rearrange:function(t,e,r,i){r?r[0].appendChild(this.placeholder[0]):e.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?e.item[0]:e.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var o=this.counter;this._delay(function(){o===this.counter&&this.refreshPositions(!i)})},_clear:function(t,e){this.reverting=!1;var r,i=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(r in this._storedCSS)"auto"!==this._storedCSS[r]&&"static"!==this._storedCSS[r]||(this._storedCSS[r]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!e&&i.push(function(t){this._trigger("receive",t,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||e||i.push(function(t){this._trigger("update",t,this._uiHash())}),this===this.currentContainer||e||(i.push(function(t){this._trigger("remove",t,this._uiHash())}),i.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}.call(this,this.currentContainer)),i.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}.call(this,this.currentContainer))),r=this.containers.length-1;0<=r;r--)e||i.push(function(e){return function(t){e._trigger("deactivate",t,this._uiHash(this))}}.call(this,this.containers[r])),this.containers[r].containerCache.over&&(i.push(function(e){return function(t){e._trigger("out",t,this._uiHash(this))}}.call(this,this.containers[r])),this.containers[r].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!e){for(this._trigger("beforeStop",t,this._uiHash()),r=0;r<i.length;r++)i[r].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1}if(e||this._trigger("beforeStop",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null,!e){for(r=0;r<i.length;r++)i[r].call(this,t);this._trigger("stop",t,this._uiHash())}return!(this.fromOutside=!1)},_trigger:function(){!1===d.Widget.prototype._trigger.apply(this,arguments)&&this.cancel()},_uiHash:function(t){var e=t||this;return{helper:e.helper,placeholder:e.placeholder||d([]),position:e.position,originalPosition:e.originalPosition,offset:e.positionAbs,item:e.currentItem,sender:t?t.element:null}}})}(jQuery),function(t){var e=t({});t.subscribe=function(){e.on.apply(e,arguments)},t.unsubscribe=function(){e.off.apply(e,arguments)},t.publish=function(){e.trigger.apply(e,arguments)}}(jQuery),function(i){"use strict";function o(t,e){this.init("tooltip",t,e)}o.prototype={constructor:o,init:function(t,e,r){this.type=t,this.$element=i(e),this.options=this.getOptions(r),this.enabled=!0,"click"==this.options.trigger?this.$element.on("click."+this.type,this.options.selector,i.proxy(this.toggle,this)):"manual"!=this.options.trigger&&(t="hover"==this.options.trigger?"mouseenter":"focus",e="hover"==this.options.trigger?"mouseleave":"blur",this.$element.on(t+"."+this.type,this.options.selector,i.proxy(this.enter,this)),this.$element.on(e+"."+this.type,this.options.selector,i.proxy(this.leave,this))),this.options.selector?this._options=i.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},getOptions:function(t){return(t=i.extend({},i.fn[this.type].defaults,t,this.$element.data())).delay&&"number"==typeof t.delay&&(t.delay={show:t.delay,hide:t.delay}),t},enter:function(t){var e=i(t.currentTarget)[this.type](this._options).data(this.type);if(!e.options.delay||!e.options.delay.show)return e.show();clearTimeout(this.timeout),e.hoverState="in",this.timeout=setTimeout(function(){"in"==e.hoverState&&e.show()},e.options.delay.show)},leave:function(t){var e=i(t.currentTarget)[this.type](this._options).data(this.type);if(this.timeout&&clearTimeout(this.timeout),!e.options.delay||!e.options.delay.hide)return e.hide();e.hoverState="out",this.timeout=setTimeout(function(){"out"==e.hoverState&&e.hide()},e.options.delay.hide)},show:function(){var t,e,r,i,o,n,s;if(this.hasContent()&&this.enabled){switch(t=this.tip(),this.setContent(),this.options.animation&&t.addClass("fade"),n="function"==typeof this.options.placement?this.options.placement.call(this,t[0],this.$element[0]):this.options.placement,e=/in/.test(n),t.remove().css({top:0,left:0,display:"block"}).appendTo(e?this.$element:document.body),r=this.getPosition(e),i=t[0].offsetWidth,o=t[0].offsetHeight,e?n.split(" ")[1]:n){case"bottom":s={top:r.top+r.height,left:r.left+r.width/2-i/2};break;case"top":s={top:r.top-o,left:r.left+r.width/2-i/2};break;case"left":s={top:r.top+r.height/2-o/2,left:r.left-i};break;case"right":s={top:r.top+r.height/2-o/2,left:r.left+r.width}}t.css(s).addClass(n).addClass("in")}},setContent:function(){var t=this.tip(),e=this.getTitle();t.find(".tooltip-inner")[this.options.html?"html":"text"](e),t.removeClass("fade in top bottom left right")},hide:function(){var t,e=this.tip();return e.removeClass("in"),i.support.transition&&this.$tip.hasClass("fade")?(t=setTimeout(function(){e.off(i.support.transition.end).remove()},500),e.one(i.support.transition.end,function(){clearTimeout(t),e.remove()})):e.remove(),this},fixTitle:function(){var t=this.$element;!t.attr("title")&&"string"==typeof t.attr("data-original-title")||t.attr("data-original-title",t.attr("title")||"").removeAttr("title")},hasContent:function(){return this.getTitle()},getPosition:function(t){return i.extend({},t?{top:0,left:0}:this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight})},getTitle:function(){var t=this.$element,e=this.options;return t.attr("data-original-title")||("function"==typeof e.title?e.title.call(t[0]):e.title)},tip:function(){return this.$tip=this.$tip||i(this.options.template)},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(){this[this.tip().hasClass("in")?"hide":"show"]()},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}},i.fn.tooltip=function(r){return this.each(function(){var t=i(this),e=t.data("tooltip");e||t.data("tooltip",e=new o(this,"object"==typeof r&&r)),"string"==typeof r&&e[r]()})},i.fn.tooltip.Constructor=o,i.fn.tooltip.defaults={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover",title:"",delay:0,html:!0}}(window.jQuery);var Constants={DEFAULT:{HEIGHT:32,WIDTH:32,FPS:12,LAYER_OPACITY:.2},MODEL_VERSION:2,MAX_HEIGHT:1024,MAX_WIDTH:1024,MAX_PALETTE_COLORS:256,MAX_WORKER_COLORS:256,PREVIEW_FILM_SIZE:96,ANIMATED_PREVIEW_WIDTH:200,RIGHT_COLUMN_PADDING_LEFT:10,DEFAULT_PEN_COLOR:"#000000",TRANSPARENT_COLOR:"rgba(0, 0, 0, 0)",SEAMLESS_MODE_OVERLAY_COLOR:"rgba(255, 255, 255, 0)",CURRENT_COLORS_PALETTE_ID:"__current-colors",SELECTION_TRANSPARENT_COLOR:"rgba(160, 215, 240, 0.6)",TOOL_HIGHLIGHT_COLOR_LIGHT:"rgba(255, 255, 255, 0.2)",TOOL_HIGHLIGHT_COLOR_DARK:"rgba(0, 0, 0, 0.2)",ZOOMED_OUT_BACKGROUND_COLOR:"#A0A0A0",LEFT_BUTTON:0,MIDDLE_BUTTON:1,RIGHT_BUTTON:2,MOUSEMOVE_THROTTLING:10,ABSTRACT_FUNCTION:function(){throw"abstract method should be implemented"},EMPTY_FUNCTION:function(){},DRAWING_TEST_FOLDER:"drawing",APPENGINE_SAVE_LIMIT:1048576,CONFIRM_OVERWRITE:"This will replace your current animation, are you sure you want to continue?",APPENGINE_SAVE_URL:"save",IMAGE_SERVICE_UPLOAD_URL:"{{protocol}}://pixetor-imgstore-b.appspot.com/__/upload",IMAGE_SERVICE_GET_URL:"{{protocol}}://pixetor-imgstore-b.appspot.com/img/"},Events={TOOL_SELECTED:"TOOL_SELECTED",SELECT_TOOL:"SELECT_TOOL",TOOL_RELEASED:"TOOL_RELEASED",TOOL_PRESSED:"TOOL_PRESSED",SELECT_PRIMARY_COLOR:"SELECT_PRIMARY_COLOR",SELECT_SECONDARY_COLOR:"SELECT_SECONDARY_COLOR",PRIMARY_COLOR_SELECTED:"PRIMARY_COLOR_SELECTED",SECONDARY_COLOR_SELECTED:"SECONDARY_COLOR_SELECTED",CURSOR_MOVED:"CURSOR_MOVED",DRAG_START:"DRAG_START",DRAG_END:"DRAG_END",DIALOG_SHOW:"DIALOG_SHOW",DIALOG_HIDE:"DIALOG_HIDE",PALETTE_LIST_UPDATED:"PALETTE_LIST_UPDATED",USER_SETTINGS_CHANGED:"USER_SETTINGS_CHANGED",SHORTCUTS_CHANGED:"SHORTCUTS_CHANGED",CLOSE_SETTINGS_DRAWER:"CLOSE_SETTINGS_DRAWER",PIXETOR_RESET:"PIXETOR_RESET",PIXETOR_SAVE_STATE:"PIXETOR_SAVE_STATE",PIXETOR_DESCRIPTOR_UPDATED:"PIXETOR_DESCRIPTOR_UPDATED",PIXETOR_SAVED_STATUS_UPDATE:"PIXETOR_SAVED_STATUS_UPDATE",HISTORY_STATE_SAVED:"HISTORY_STATE_SAVED",HISTORY_STATE_LOADED:"HISTORY_STATE_LOADED",PEN_SIZE_CHANGED:"PEN_SIZE_CHANGED",PIXETOR_SAVED:"PIXETOR_SAVED",BEFORE_SAVING_PIXETOR:"BEFORE_SAVING_PIXETOR",AFTER_SAVING_PIXETOR:"AFTER_SAVING_PIXETOR",FRAME_SIZE_CHANGED:"FRAME_SIZE_CHANGED",FPS_CHANGED:"FPS_CHANGED",SELECTION_CREATED:"SELECTION_CREATED",SELECTION_MOVE_REQUEST:"SELECTION_MOVE_REQUEST",SELECTION_DISMISSED:"SELECTION_DISMISSED",CLIPBOARD_COPY:"CLIPBOARD_COPY",CLIPBOARD_CUT:"CLIPBOARD_CUT",CLIPBOARD_PASTE:"CLIPBOARD_PASTE",SHOW_NOTIFICATION:"SHOW_NOTIFICATION",HIDE_NOTIFICATION:"HIDE_NOTIFICATION",SHOW_PROGRESS:"SHOW_PROGRESS",UPDATE_PROGRESS:"UPDATE_PROGRESS",HIDE_PROGRESS:"HIDE_PROGRESS",ZOOM_CHANGED:"ZOOM_CHANGED",EXPORT_SCALE_CHANGED:"EXPORT_SCALE_CHANGED",CURRENT_COLORS_UPDATED:"CURRENT_COLORS_UPDATED",PERFORMANCE_REPORT_CHANGED:"PERFORMANCE_REPORT_CHANGED",PIXETOR_FILE_IMPORT_FAILED:"PIXETOR_FILE_IMPORT_FAILED",MOUSE_EVENT:"MOUSE_EVENT",KEYBOARD_EVENT:"KEYBOARD_EVENT",TRANSFORMATION_EVENT:"TRANSFORMATION_EVENT",TEST_RECORD_END:"TEST_RECORD_END",TEST_CASE_END:"TEST_CASE_END",TEST_SUITE_END:"TEST_SUITE_END"},ns=(jQuery.namespace=function(){for(var t=arguments,e=null,r=0;r<t.length;r++)for(var i=t[r].split("."),e=window,o=0;o<i.length;o++)e[i[o]]=e[i[o]]||{},e=e[i[o]];return e},Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");function t(){var t=r.concat(Array.prototype.slice.call(arguments));return i.apply(this instanceof o&&e?this:e,t)}var r=Array.prototype.slice.call(arguments,1),i=this,o=function(){};return o.prototype=this.prototype,t.prototype=new o,t}),Uint32Array.prototype.fill||(Uint32Array.prototype.fill=function(t,e,r){r=void 0===r?this.length:r,(e=void 0===e?0:e)<0&&(e=this.length+e),r<0&&(r=this.length+r);for(var i=e;i<r;i++)this[i]=t}),!function(){var r=$.namespace("pxtr.utils"),i=(r.rgbToHex=function(t,e,r){return"#"+pxtr.utils.componentToHex(t)+pxtr.utils.componentToHex(e)+pxtr.utils.componentToHex(r)},r.componentToHex=function(t){t=t.toString(16);return 1==t.length?"0"+t:t},{}),o=(r.intToHex=function(t){var e;return i[t]||(e=r.rgbToHex(255&t,t>>8&255,t>>16&255),i[t]=e)},r.normalize=function(t,e){return null==t?e:t},r.inherit=function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).prototype.superclass=e.prototype},r.wrap=function(t,e){for(var r in e)"function"==typeof e[r]&&void 0===t[r]&&(t[r]=e[r].bind(e))},r.hashCode=function(t){var e=0;if(0!==t.length)for(var r=0,i=t.length;r<i;r++)e=31*e+t.charCodeAt(r),e|=0;return e},r.copy=function(t){return JSON.parse(JSON.stringify(t))},{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"}),n=(r.escapeHtml=function(t){return String(t).replace(/[&<>"'\/]/g,function(t){return o[t]})},{}),s={},a=(r.colorToInt=function(t){var e,r;return"number"==typeof t?t:void 0!==n[t]?n[t]:(e=window.tinycolor(t))&&e.ok?(e=e.toRgb(),e=((r=Math.round(255*e.a))<<24>>>0)+(e.b<<16)+(e.g<<8)+e.r,n[t]=e=0===r?0:e,s[e]=t,e):((r=document.createElement("div")).style.color=t,document.body.appendChild(r),t=window.getComputedStyle(r).color,document.body.removeChild(r),pxtr.utils.colorToInt(t))},r.intToColor=function(t){var e;return"string"==typeof t?t:void 0!==s[t]?s[t]:(n[e="rgba("+(255&t)+","+(t>>8&255)+","+(t>>16&255)+","+(t>>24>>>0&255)/255+")"]=t,s[t]=e)},{});r.unescapeHtml=function(e){return Object.keys(o).forEach(function(t){a[t]=a[t]||new RegExp(o[t],"g"),e=e.replace(a[t],t)}),e}}(),!function(){var e=$.namespace("pxtr.utils"),t=navigator.userAgent;e.UserAgent={isIE:/MSIE/i.test(t),isIE11:/trident/i.test(t),isEdge:/edge\//i.test(t),isFirefox:/Firefox/i.test(t),isMac:/Mac/.test(t),isOpera:/OPR\//.test(t),hasChrome:/Chrome/i.test(t),hasSafari:/Safari\//.test(t)};e.UserAgent.isChrome=e.UserAgent.hasChrome&&!e.UserAgent.isOpera&&!e.UserAgent.isEdge,e.UserAgent.isSafari=e.UserAgent.hasSafari&&!e.UserAgent.isOpera&&!e.UserAgent.isEdge,e.UserAgent.supportedUserAgents=["isIE11","isEdge","isChrome","isFirefox"],e.UserAgent.version=pxtr.utils.UserAgent.isIE?parseInt(/MSIE\s?(\d+)/i.exec(t)[1],10):pxtr.utils.UserAgent.isChrome?parseInt(/Chrome\/(\d+)/i.exec(t)[1],10):pxtr.utils.UserAgent.isFirefox?parseInt(/Firefox\/(\d+)/i.exec(t)[1],10):void 0,e.UserAgent.isUnsupported=function(){return e.UserAgent.supportedUserAgents.every(function(t){return!e.UserAgent[t]})},e.UserAgent.getDisplayName=function(){return e.UserAgent.isIE?"Internet Explorer":e.UserAgent.isChrome?"Chrome":e.UserAgent.isFirefox?"Firefox":e.UserAgent.isSafari?"Safari":e.UserAgent.isOpera?"Opera":t}}(),$.namespace("pxtr.utils").Array={find:function(t,e){var r=null,t=(t=Array.isArray(t)?t:[]).filter(e);return r=t.length?t[0]:r},chunk:function(t,e){for(var r=[],i=(e=Math.min(e,t.length),e=Math.max(1,e),Math.round(t.length/e)),o=0;o<e;o++){var n=o==e-1?t.length:(o+1)*i;r.push(t.slice(o*i,n))}return r}},!function(){var p,t=$.namespace("pxtr.utils");Uint8Array&&(p=new Uint8Array([62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51])),t.Base64={toText:function(t){return window.atob(t.replace(/data\:.*?\;base64\,/,""))},decode:function(t){for(var e=0,r=[0,0],i=0,o=0,n=t.length,s=0,a=new Uint8Array(n/4*3|0);n--;){var l=t.charCodeAt(s++),c=p[l-43];255!==c&&void 0!==c&&(r[1]=r[0],r[0]=l,o=o<<6|c,4===++i&&(a[e++]=o>>>16,61!==r[1]&&(a[e++]=o>>>8),61!==r[0]&&(a[e++]=o),i=0))}return a.buffer}}}(),!function(){var t=$.namespace("pxtr.utils"),s=/\s*;\s*base64\s*(?:;|$)/i;t.BlobUtils={dataToBlob:function(t,e,r){var i,o=t.indexOf(","),n=t.substring(o+1),t=s.test(t.substring(0,o));Blob.fake?((i=new Blob).encoding=t?"base64":"URI",i.data=n,i.size=n.length):Uint8Array&&(o=t?pxtr.utils.Base64.decode(n):decodeURIComponent(n),i=new Blob([o],{type:e})),r(i)},canvasToBlob:function(t,e,r){var i;r=r||"image/png",t.mozGetAsFile?e(t.mozGetAsFile("canvas",r)):(i=Array.prototype.slice.call(arguments,2),i=t.toDataURL.apply(t,i),pxtr.utils.BlobUtils.dataToBlob(i,r,e))},stringToBlob:function(t,e,r){r=r||"text/plain",pxtr.utils.BlobUtils.dataToBlob("data:"+r+","+t,r,e)}}}(),$.namespace("pxtr.utils").CanvasUtils={createCanvas:function(t,e,r){var i=document.createElement("canvas");if(i.setAttribute("width",t),i.setAttribute("height",e),"string"==typeof r&&(r=[r]),Array.isArray(r))for(var o=0;o<r.length;o++)i.classList.add(r[o]);return i},createFromImageData:function(t){var e=pxtr.utils.CanvasUtils.createCanvas(t.width,t.height);return e.getContext("2d").putImageData(t,0,0),e},createFromImage:function(t){var e=pxtr.utils.CanvasUtils.createCanvas(t.width,t.height);return e.getContext("2d").drawImage(t,0,0),e},createFramesFromImage:function(t,e,r,i,o,n,s){for(var a=[],l=e,c=r,p=pxtr.utils.CanvasUtils.createCanvas(i,o).toDataURL();l+i<=t.width&&c+o<=t.height;){var h=pxtr.utils.CanvasUtils.createCanvas(i,o);h.getContext("2d").drawImage(t,l,c,i,o,0,0,i,o),s&&h.toDataURL()===p||a.push(h),n?(l+=i)+i>t.width&&(l=e,c+=o):(c+=o)+o>t.height&&(l+=i,c=r)}return a},disableImageSmoothing:function(t){pxtr.utils.CanvasUtils.setImageSmoothing(t,!1)},enableImageSmoothing:function(t){pxtr.utils.CanvasUtils.setImageSmoothing(t,!0)},setImageSmoothing:function(t,e){t=t.getContext("2d");t.imageSmoothingEnabled=e,t.mozImageSmoothingEnabled=e,t.oImageSmoothingEnabled=e,t.webkitImageSmoothingEnabled=e,t.msImageSmoothingEnabled=e},clear:function(t){t&&t.getContext("2d").clearRect(0,0,t.width,t.height)},clone:function(t){var e=pxtr.utils.CanvasUtils.createCanvas(t.width,t.height);return e.getContext("2d").drawImage(t,0,0),e},getImageDataFromCanvas:function(t){return t.getContext("2d").getImageData(0,0,t.width,t.height).data},getBase64FromCanvas:function(t,e){t=t.toDataURL("image/"+(e=e||"png"));return t.substr(t.indexOf(",")+1)}},$.namespace("pxtr.utils").ColorUtils={getUnusedColor:function(t){for(var e={},r=((t=t||[]).forEach(function(t){e[t.toUpperCase()]=!0}),{r:255,g:255,b:0}),i=null;;){var o=window.tinycolor(r).toHexString().toUpperCase();if(!e[o]){i=o;break}o=(r.r?"r":r.g&&"g")||r.b&&"b";if(!o)break;r[o]=r[o]-1}return i}},!function(){function r(t){return t<10?"0"+t:""+t}var t=$.namespace("pxtr.utils");t.DateUtils={format:function(t,e){return t=new Date(t),pxtr.utils.Template.replace(e,{Y:t.getFullYear(),M:r(t.getMonth()+1),D:r(t.getDate()),H:r(t.getHours()),m:r(t.getMinutes()),s:r(t.getSeconds())})}}}(),!function(){var r=$.namespace("pxtr.utils");r.Dom={isParent:function(t,e,r){if(t&&e)for(r&&(t=t.parentNode);t;){if(t===e)return!0;t=t.parentNode}return!1},getParentWithData:function(t,e){for(;t;){if(t.dataset&&void 0!==t.dataset[e])return t;t=t.parentNode}return null},getData:function(t,e){t=r.Dom.getParentWithData(t,e);if(null!==t)return t.dataset[e]},removeClass:function(t,e){for(var r=(e=e||document).querySelectorAll("."+t),i=0;i<r.length;i++)r[i].classList.remove(t)}}}(),!function(){var t=$.namespace("pxtr.utils");t.Event={},t.Event.addEventListener=function(t,e,r,i,o){o={el:t="string"==typeof t?document.querySelector(t):t,type:e,callback:r,handler:o?r.bind(i,o):r.bind(i)};i.__pxtr_listeners=i.__pxtr_listeners||[],i.__pxtr_listeners.push(o),t.addEventListener(e,o.handler)},t.Event.removeEventListener=function(t,e,r,i){if(i&&i.__pxtr_listeners)for(var o=i.__pxtr_listeners,n=0;n<o.length;n++){var s=o[n];if(s.callback===r&&s.el===t&&s.type===e){t.removeEventListener(e,o[n].handler),o.splice(n,1);break}}},t.Event.removeAllEventListeners=function(t){if(t&&t.__pxtr_listeners){for(var e=t.__pxtr_listeners,r=0;r<e.length;r++){var i=e[r];i.el.removeEventListener(i.type,i.handler)}t.__pxtr_listeners=[]}}}(),$.namespace("pxtr.utils").Environment={detectNodeWebkit:function(){var e=!1;if(void 0!==window.process&&void 0!==window.require)try{e=void 0!==window.require("nw.gui")}catch(t){e=!1}return e},isIntegrationTest:function(){return-1!==window.location.href.indexOf("integration-test")},isDebug:function(){return-1!==window.location.href.indexOf("debug")},isHttps:function(){return 0===window.location.href.indexOf("https://")}},$.namespace("pxtr.utils").FunctionUtils={memo:function(e,r,i){return function(){var t=Array.prototype.join.call(arguments,"-");return r[t]||(r[t]=e.apply(i,arguments)),r[t]}},throttle:function(e,r){var i,o;return function(){var t=Date.now();i&&t<i+r?(clearTimeout(o),o=setTimeout(function(){i=t,e()},r)):(i=t,e())}}},$.namespace("pxtr.utils").Math={minmax:function(t,e,r){return Math.max(Math.min(t,r),e)},distance:function(t,e,r,i){e=Math.abs(e-t),t=Math.abs(i-r);return Math.sqrt(Math.pow(e,2)+Math.pow(t,2))}},!function(){function i(t){t.stopPropagation()}var e=$.namespace("pxtr.utils");e.FileUtils={readFile:function(t,e){var r=new FileReader;r.addEventListener("loadend",function(){e(r.result)}),r.readAsDataURL(t)},readFileAsArrayBuffer:function(t,e){var r=new FileReader;r.addEventListener("loadend",function(){e(r.result)}),r.readAsArrayBuffer(t)},readImageFile:function(t,r){e.FileUtils.readFile(t,function(t){var e=new Image;e.onload=r.bind(null,e),e.src=t})},downloadAsFile:function(t,e){var r=window.saveAs||navigator.msSaveBlob&&navigator.msSaveBlob.bind(navigator);r?r(t,e):(r=document.createElement("a"),t=window.URL.createObjectURL(t),r.setAttribute("href",t),r.setAttribute("download",e),document.body.appendChild(r),r.addEventListener("click",i),r.click(),r.removeEventListener("click",i),document.body.removeChild(r))}}}(),!function(){var t=$.namespace("pxtr.utils");t.FileUtilsDesktop={chooseFilenameDialog:function(t,e){function r(t){n.removeEventListener("change",r),document.removeEventListener("click",r),o.resolve(n.value)}var i,o=Q.defer(),n=(t=t,e=e,(i=document.createElement("INPUT")).setAttribute("type","file"),i.setAttribute("nwworkingdir",""),t&&i.setAttribute("nwsaveas",t),e&&i.setAttribute("accept",e),i);return window.setTimeout(function(){n.click(),n.addEventListener("change",r),document.addEventListener("mousedown",r)},50),o.promise},saveToFile:function(t,e){var r=Q.defer();return window.require("fs").writeFile(e,t,function(t){t?r.reject("FileUtilsDesktop::savetoFile() - error saving file: "+e+" Error: "+t):r.resolve()}),r.promise},readFile:function(r){var i=Q.defer();return window.require("fs").readFile(r,"utf8",function(t,e){t?i.reject("FileUtilsDesktop::readFile() - error reading file: "+r+" Error: "+t):i.resolve(e)}),i.promise}}}(),!function(){var n=$.namespace("pxtr.utils"),h={},u={};n.FrameUtils={toImage:function(t,e,r){e=e||1,r=isNaN(r)?1:r;t=new pxtr.rendering.CanvasRenderer(t,e);return t.drawTransparentAs(Constants.TRANSPARENT_COLOR),t.setOpacity(r),t.render()},drawToCanvas:function(t,e,r,i){e=e.getContext("2d");if(i=isNaN(i)?1:i,e.globalAlpha=i,r=r||Constants.TRANSPARENT_COLOR,t instanceof pxtr.model.frame.RenderedFrame)e.fillRect(r,0,0,t.getWidth(),t.getHeight()),e.drawImage(t.getRenderedFrame(),0,0);else{var i=t.getWidth(),o=t.getHeight(),n=t.pixels,s=pxtr.utils.colorToInt(Constants.TRANSPARENT_COLOR),a=pxtr.utils.colorToInt(r);if(a!=s)for(var l=0,c=(n=t.getPixels()).length;l<c;l++)n[l]==s&&(n[l]=a);var p,r=i+"-"+o,t=u[r]||(u[r]=e.createImageData(i,o)),r=new Uint8ClampedArray(n.buffer),r=(t.data.set(r),i+"-"+o);h[r]?p=h[r]:(p=h[r]=pxtr.utils.CanvasUtils.createCanvas(i,o)).context=p.getContext("2d"),p.context.putImageData(t,0,0),e.drawImage(p,0,0,i,o),e.globalAlpha=1}},renderLine_:function(t,e,r,i,o){t!==Constants.TRANSPARENT_COLOR&&null!==t&&(o.fillStyle=t,o.fillRect(e,r,1,i))},merge:function(t){var e=null;if(t.length)for(var e=t[0].clone(),r=1;r<t.length;r++)pxtr.utils.FrameUtils.mergeFrames_(e,t[r]);return e},mergeFrames_:function(t,e){for(var r=pxtr.utils.colorToInt(Constants.TRANSPARENT_COLOR),i=0,o=t.getWidth()*t.getHeight();i<o;++i)e.pixels[i]!=r&&t.pixels[i]!=e.pixels[i]&&(t.pixels[i]=e.pixels[i])},addImageToFrame:function(i,t,o,n){t=pxtr.utils.FrameUtils.createFromImage(t);o-=Math.floor(t.width/2),n-=Math.floor(t.height/2),o=Math.max(0,o),n=Math.max(0,n),t.width<=i.width&&(o=Math.min(o,i.width-t.width)),t.height<=i.height&&(n=Math.min(n,i.height-t.height)),t.forEachPixel(function(t,e,r){t!=pxtr.utils.colorToInt(Constants.TRANSPARENT_COLOR)&&i.setPixel(o+e,n+r,t)})},resize:function(t,e,r,i){t=pxtr.utils.FrameUtils.toImage(t),t=pxtr.utils.ImageResizer.resize(t,e,r,i);return pxtr.utils.FrameUtils.createFromImage(t)},removeTransparency:function(n){n.forEachPixel(function(t,e,r){var i,o=t>>24>>>0&255;o&&255!=o&&(i=255*Math.round(o/255),n.setPixel(e,r,t-(o<<24>>>0)+(i<<24>>>0)))})},createFromCanvas:function(t,e,r,i,o,n){t=t.getContext("2d").getImageData(e,r,i,o).data;return pxtr.utils.FrameUtils.createFromImageData_(t,i,o,n)},createFromImageSrc:function(t,r,i){var o=new Image;o.addEventListener("load",function t(){o.removeEventListener("load",t);var e=n.FrameUtils.createFromImage(o,r);i(e)}),o.src=t},createFromImage:function(t,e){var r=t.width,i=t.height,o=pxtr.utils.CanvasUtils.createCanvas(r,i).getContext("2d"),t=(o.drawImage(t,0,0,r,i,0,0,r,i),o.getImageData(0,0,r,i).data);return pxtr.utils.FrameUtils.createFromImageData_(t,r,i,e)},createFromImageData_:function(t,e,r,i){e=new pxtr.model.Frame(e,r);return e.pixels=new Uint32Array(t.buffer),i||pxtr.utils.FrameUtils.removeTransparency(e),e},createFramesFromSpritesheet:function(t,e){for(var r=[],i=0;i<e;i++)r.push([i]);return pxtr.utils.FrameUtils.createFramesFromChunk(t,r).map(function(t){return t.frame})},createFramesFromChunk:function(t,e){for(var r=t.width,i=t.height,o=r/e.length,n=i/e[0].length,s=pxtr.utils.CanvasUtils.createCanvas(o,n),a=s.getContext("2d"),l=[],c=0;c<e.length;c++)for(var p=e[c],h=0;h<p.length;h++){a.clearRect(0,0,o,n),a.drawImage(t,o*c,n*h,o,n,0,0,o,n);var u=pxtr.utils.FrameUtils.createFromCanvas(s,0,0,o,n);l.push({index:e[c][h],frame:u})}return l},toFrameGrid:function(t){for(var e=[],r=t[0].length,i=t.length,o=0;o<r;o++){e[o]=[];for(var n=0;n<i;n++)e[o][n]=t[n][o]}return e}}}(),!function(){var i=$.namespace("pxtr.utils");i.ImageResizer={scale:function(t,e,r){return i.ImageResizer.resize(t,t.width*e,t.height*e,r)},resize:function(t,e,r,i){var o=pxtr.utils.CanvasUtils.createCanvas(e,r),n=o.getContext("2d");return n.save(),i||pxtr.utils.CanvasUtils.disableImageSmoothing(o),n.translate(o.width/2,o.height/2),n.scale(e/t.width,r/t.height),n.drawImage(t,-t.width/2,-t.height/2),n.restore(),o}}}(),!function(){var a=$.namespace("pxtr.utils");a.LayerUtils={clone:function(t){var e=t.getFrames().map(function(t){return t.clone()});return pxtr.model.Layer.fromFrames(t.getName()+" (clone)",e)},mergeLayers:function(t,e){var r=t.getFrames(),i=e.getFrames(),o=[];return r.forEach(function(t,e){e=i[e];o.push(pxtr.utils.FrameUtils.merge([e,t]))}),pxtr.model.Layer.fromFrames(t.getName(),o)},getFrameHashAt:function(t,r){var i=[];return t.forEach(function(t){var e=t.getFrameAt(r);return i.push(e.getHash()),i.push(t.getOpacity()),e}),i.join("-")},mergeFrameAt:function(t,e){return t.some(function(t){return t.isTransparent()})?pxtr.utils.LayerUtils.mergeTransparentFrameAt_(t,e):pxtr.utils.LayerUtils.mergeOpaqueFrameAt_(t,e)},mergeTransparentFrameAt_:function(t,e){var r=pxtr.utils.LayerUtils.getFrameHashAt(t,e),i=t[0].frames[0].getWidth(),o=t[0].frames[0].getHeight();return new pxtr.model.frame.RenderedFrame(function(){return pxtr.utils.LayerUtils.flattenFrameAt(t,e,!0)},i,o,r)},mergeOpaqueFrameAt_:function(t,e){var r=pxtr.utils.LayerUtils.getFrameHashAt(t,e),t=t.map(function(t){return t.getFrameAt(e)}),t=pxtr.utils.FrameUtils.merge(t);return t.id=r,t.version=0,t},renderFrameAt:function(t,e,r){r=r?t.getOpacity():1,t=t.getFrameAt(e);return pxtr.utils.FrameUtils.toImage(t,1,r)},flattenFrameAt:function(t,e,r){var i=t[0].getFrameAt(e).getWidth(),o=t[0].getFrameAt(e).getHeight(),n=pxtr.utils.CanvasUtils.createCanvas(i,o),s=n.getContext("2d");return t.forEach(function(t){t=a.LayerUtils.renderFrameAt(t,e,r);s.drawImage(t,0,0,i,o,0,0,i,o)}),n}}}(),!function(){var a=$.namespace("pxtr.utils");a.MergeUtils={merge:function(n,t,e){(t.getWidth()>n.getWidth()||t.getHeight()>n.getHeight())&&"expand"===e.resize?n=pxtr.utils.ResizeUtils.resizePixetor(n,{width:Math.max(n.getWidth(),t.getWidth()),height:Math.max(n.getHeight(),t.getHeight()),origin:e.origin,resizeContent:!1}):t=pxtr.utils.ResizeUtils.resizePixetor(t,{width:n.getWidth(),height:n.getHeight(),origin:e.origin,resizeContent:!1});for(var s=e.insertIndex,r=("insert"===e.insertMode&&(s-=1),t.getFrameCount()),i=0;i<r;i++){var o=i+s;("add"===e.insertMode||o>=n.getFrameCount())&&a.MergeUtils.addFrameToLayers_(n,o)}return t.getLayers().forEach(function(t){for(var e=t.getName()+" (imported)",r=new pxtr.model.Layer(e),i=0;i<n.getFrameCount();i++){var o=i-s,o=(o=t.getFrameAt(o))||a.MergeUtils.createEmptyFrame_(n);r.addFrame(o)}n.addLayer(r)}),n},createEmptyFrame_:function(t){return new pxtr.model.Frame(t.getWidth(),t.getHeight())},addFrameToLayers_:function(e,r){e.getLayers().forEach(function(t){t.addFrameAt(a.MergeUtils.createEmptyFrame_(e),r)})}}}(),$.namespace("pxtr").PixelUtils={getRectanglePixels:function(t,e,r,i){for(var o=this.getOrderedRectangleCoordinates(t,e,r,i),n=[],s=o.x0;s<=o.x1;s++)for(var a=o.y0;a<=o.y1;a++)n.push({col:s,row:a});return n},getOrderedRectangleCoordinates:function(t,e,r,i){return{x0:Math.min(t,r),y0:Math.min(e,i),x1:Math.max(t,r),y1:Math.max(e,i)}},getSimilarConnectedPixelsFromFrame:function(r,t,e){var i,o=r.getPixel(t,e);return null===o?[]:(i={},pxtr.PixelUtils.visitConnectedPixels({col:t,row:e},r,function(t){var e=t.col+"-"+t.row;return!i[e]&&(i[e]=!0,r.getPixel(t.col,t.row)==o)}))},resizePixel:function(t,e,r){for(var i=[],o=0;o<r;o++)for(var n=0;n<r;n++)i.push([t-Math.floor(r/2)+n,e-Math.floor(r/2)+o]);return i},resizePixels:function(t,r){return t.reduce(function(t,e){return t.concat(pxtr.PixelUtils.resizePixel(e.col,e.row,r))},[])},paintSimilarConnectedPixelsFromFrame:function(e,t,r,i){var o;"string"==typeof i&&(i=pxtr.utils.colorToInt(i));try{o=e.getPixel(t,r)}catch(t){}if(null!==o&&o!=i)return pxtr.PixelUtils.visitConnectedPixels({col:t,row:r},e,function(t){return e.getPixel(t.col,t.row)==o&&(e.setPixel(t.col,t.row,i),!0)})},visitConnectedPixels:function(t,e,r){t.col,t.row;for(var i=[],o=[],n=[-1,0,1,0],s=[0,1,0,-1],a=(i.push(t),o.push(t),r(t),0),l=e.getWidth()*e.getHeight();0<i.length;){a++;for(var c=i.pop(),p=0;p<4;p++){var h=c.col+s[p],u=c.row+n[p];try{var d={col:h,row:u};r(d)&&(i.push(d),o.push(d))}catch(t){}}if(10*l<a){console.log("loop breaker called");break}}return o},calculateZoomForContainer:function(t,e,r){return this.calculateZoom(t.height(),t.width(),e,r)},getLinePixels:function(t,e,r,i){for(var o=[],n=(e=pxtr.utils.normalize(e,0),i=pxtr.utils.normalize(i,0),Math.abs(e-t)),s=Math.abs(i-r),a=t<e?1:-1,l=r<i?1:-1,c=n-s;o.push({col:t,row:r}),t!=e||r!=i;){var p=2*c;-s<p&&(c-=s,t+=a),p<n&&(c+=n,r+=l)}return o},getUniformLinePixels:function(t,e,r,i){for(var o=[],n=(e=pxtr.utils.normalize(e,0),i=pxtr.utils.normalize(i,0),Math.abs(e-t)+1),s=Math.abs(i-r)+1,a=t<e?1:-1,l=r<i?1:-1,c=Math.max(n,s)/Math.min(n,s),p=Math.round(c)||0,h=(p>Math.min(n,s)&&(p=1/0),pxtr.utils.Math.distance(t,e,r,i)),u=t,d=r,f=0;f++,o.push({col:u,row:d}),!(pxtr.utils.Math.distance(t,u,r,d)>=h);){var g=f%p==0;(s<=n||g)&&(u+=a),(n<=s||g)&&(d+=l)}return o}},!function(){var o=$.namespace("pxtr.utils");o.PixetorFileUtils={FAILURE:{EMPTY:"No data found in pixetor file",INVALID:"Invalid pixetor file, contact us on twitter @pixetorapp",DESERIALIZATION:"Pixetor data deserialization failed"},loadFromFile:function(e,r,i){pxtr.utils.FileUtils.readFile(e,function(t){t=pxtr.utils.Base64.toText(t);o.PixetorFileUtils.decodePixetorFile(t,function(t){pxtr.utils.Environment.detectNodeWebkit()&&(t.savePath=e.path),r(t)},i)})},decodePixetorFile:function(t,e,r){var i;if(0===t.length)r(o.PixetorFileUtils.FAILURE.EMPTY);else{try{i=JSON.parse(t)}catch(t){return void r(o.PixetorFileUtils.FAILURE.INVALID)}i.pixetor;pxtr.utils.serialization.Deserializer.deserialize(i,e,function(){r(o.PixetorFileUtils.FAILURE.DESERIALIZATION)})}}}}(),!function(){var s=$.namespace("pxtr.utils");s.ResizeUtils={resizePixetor:function(t,e){var r=t.getFPS(),i=t.getLayers().map(function(t){return s.ResizeUtils.resizeLayer(t,e)}),i=pxtr.model.Pixetor.fromLayers(i,r,t.getDescriptor());return i.savePath=t.savePath,i},resizeLayer:function(t,e){var r=t.getOpacity(),i=t.getFrames().map(function(t){return s.ResizeUtils.resizeFrame(t,e)}),t=pxtr.model.Layer.fromFrames(t.getName(),i);return t.setOpacity(r),t},resizeFrame:function(i,t){var o,e=t.width,r=t.height,n=t.origin;return t.resizeContent?pxtr.utils.FrameUtils.resize(i,e,r,!1):(o=new pxtr.model.Frame(e,r),i.forEachPixel(function(t,e,r){e=s.ResizeUtils.translateCoordinates(e,r,i,o,n);o.containsPixel(e.x,e.y)&&o.setPixel(e.x,e.y,t)}),o)},translateCoordinates:function(t,e,r,i,o){return{x:s.ResizeUtils.translateX(t,r.width,i.width,o),y:s.ResizeUtils.translateY(e,r.height,i.height,o)}},translateX:function(t,e,r,i){return-1!=i.indexOf("LEFT")?t:-1!=i.indexOf("RIGHT")?t-(e-r):t-Math.round((e-r)/2)},translateY:function(t,e,r,i){return-1!=i.indexOf("TOP")?t:-1!=i.indexOf("BOTTOM")?t-(e-r):t-Math.round((e-r)/2)}}}(),$.namespace("pxtr.utils").StringUtils={leftPad:function(t,e,r){return(new Array(e).join(r)+t).slice(-e)},formatSize:function(t,e){return t+"Ã"+e}},!function(){var o=$.namespace("pxtr.utils"),r={};o.Template={get:function(t){var e;return r[t]||((e=document.getElementById(t))?r[t]=e.innerHTML:console.error("Could not find template for id :",t)),r[t]},getAsHTML:function(t){t=o.Template.get(t);if(t)return o.Template.createFromHTML(t)},createFromHTML:function(t){var e=o.Template._getDummyEl(),t=(e.innerHTML=t,e.children[0]);return pxtr.utils.UserAgent.isIE11||(e.innerHTML=""),t},replace:function(t,e){for(var r in e){var i;e.hasOwnProperty(r)&&(i=e[r],-1!==r.indexOf(":")&&(!0===i?i=r.split(":")[1]:!1===i&&(i="")),/^!.*!$/.test(r)||(i=o.Template.sanitize(i)),t=t.replace(new RegExp("\\{\\{"+r+"\\}\\}","g"),i))}return t},getAndReplace:function(t,e){var r="",t=pxtr.utils.Template.get(t);return r=t?pxtr.utils.Template.replace(t,e):r},sanitize:function(t){var e=o.Template._getDummyEl(),t=(e.textContent=t,e.innerHTML);return pxtr.utils.UserAgent.isIE11||(e.innerHTML=""),t},_getDummyEl:pxtr.utils.UserAgent.isIE11?function(){return document.createElement("div")}:function(){return o.Template._dummyEl||(o.Template._dummyEl=document.createElement("div")),o.Template._dummyEl}}}(),!function(){var t=$.namespace("pxtr.utils");t.TooltipFormatter={},t.TooltipFormatter.format=function(t,e,r){var i=pxtr.utils.Template.get("tooltip-container-template");return e=e?"("+e.getDisplayKey()+")":"",pxtr.utils.Template.replace(i,{helptext:t,shortcut:e,"!descriptors!":this.formatDescriptors_(r)})},t.TooltipFormatter.formatDescriptors_=function(t){return(t=t||[]).reduce(function(t,e){return t+this.formatDescriptor_(e)}.bind(this),"")},t.TooltipFormatter.formatDescriptor_=function(t){var e;return t.key?(e=pxtr.utils.Template.get("tooltip-modifier-descriptor-template"),t.key=t.key.toUpperCase(),pxtr.utils.UserAgent.isMac&&(t.key=t.key.replace("CTRL","CMD"),t.key=t.key.replace("ALT","OPTION"))):e=pxtr.utils.Template.get("tooltip-simple-descriptor-template"),pxtr.utils.Template.replace(e,t)}}(),$.namespace("pxtr").UserSettings={GRID_COLOR:"GRID_COLOR",GRID_ENABLED:"GRID_ENABLED",GRID_WIDTH:"GRID_WIDTH",GRID_SPACING:"GRID_SPACING",MAX_FPS:"MAX_FPS",DEFAULT_SIZE:"DEFAULT_SIZE",CANVAS_BACKGROUND:"CANVAS_BACKGROUND",SELECTED_PALETTE:"SELECTED_PALETTE",SEAMLESS_OPACITY:"SEAMLESS_OPACITY",SEAMLESS_MODE:"SEAMLESS_MODE",PREVIEW_SIZE:"PREVIEW_SIZE",ONION_SKIN:"ONION_SKIN",LAYER_PREVIEW:"LAYER_PREVIEW",LAYER_OPACITY:"LAYER_OPACITY",EXPORT_SCALE:"EXPORT_SCALE",EXPORT_TAB:"EXPORT_TAB",EXPORT_GIF_REPEAT:"EXPORT_GIF_REPEAT",PEN_SIZE:"PEN_SIZE",RESIZE_SETTINGS:"RESIZE_SETTINGS",COLOR_FORMAT:"COLOR_FORMAT",TRANSFORM_SHOW_MORE:"TRANSFORM_SHOW_MORE",PREFERENCES_TAB:"PREFERENCES_TAB",KEY_TO_DEFAULT_VALUE_MAP_:{GRID_COLOR:Constants.TRANSPARENT_COLOR,GRID_ENABLED:!1,GRID_WIDTH:1,GRID_SPACING:1,MAX_FPS:24,DEFAULT_SIZE:{width:Constants.DEFAULT.WIDTH,height:Constants.DEFAULT.HEIGHT},CANVAS_BACKGROUND:"lowcont-dark-canvas-background",SELECTED_PALETTE:Constants.CURRENT_COLORS_PALETTE_ID,SEAMLESS_OPACITY:.3,SEAMLESS_MODE:!1,PREVIEW_SIZE:"original",ONION_SKIN:!1,LAYER_OPACITY:.2,LAYER_PREVIEW:!0,EXPORT_SCALE:1,EXPORT_TAB:"gif",EXPORT_GIF_REPEAT:!0,PEN_SIZE:1,RESIZE_SETTINGS:{maintainRatio:!0,resizeContent:!1,origin:"TOPLEFT"},COLOR_FORMAT:"hex",TRANSFORM_SHOW_MORE:!1,PREFERENCES_TAB:"misc"},cache_:{},get:function(t){var e;return this.checkKeyValidity_(t),t in this.cache_||(e=this.readFromLocalStorage_(t),this.cache_[t]=null!=e?e:this.readFromDefaults_(t)),this.cache_[t]},set:function(t,e){this.checkKeyValidity_(t),this.cache_[t]=e,this.writeToLocalStorage_(t,e),$.publish(Events.USER_SETTINGS_CHANGED,[t,e])},readFromLocalStorage_:function(t){t=window.localStorage[t];return t=void 0!==t?JSON.parse(t):t},writeToLocalStorage_:function(t,e){window.localStorage[t]=JSON.stringify(e)},readFromDefaults_:function(t){return this.KEY_TO_DEFAULT_VALUE_MAP_[t]},checkKeyValidity_:function(t){if(0===t.indexOf(pxtr.service.keyboard.Shortcut.USER_SETTINGS_PREFIX))return!0;t in this.KEY_TO_DEFAULT_VALUE_MAP_||console.error("UserSettings key <"+t+"> not found in supported keys.")}},!function(){var t=$.namespace("pxtr.utils");t.Uuid={generate:function(){return"ss-s-s-s-sss".replace(/s/g,function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)})}}}(),!function(){var r=$.namespace("pxtr.utils"),i={};r.WorkerUtils={createWorker:function(t,e){return i[e]||(i[e]=r.WorkerUtils.createWorkerURL(t)),new Worker(i[e])},createWorkerURL:function(t){t=[(t+"").replace(/function\s*\(\)\s*\{/,"").replace(/\}[^}]*$/,"")],t=new Blob(t,{type:"application/javascript"});return window.URL.createObjectURL(t)}}}(),!function(){var s=$.namespace("pxtr.utils");s.Xhr={get:function(t,e,r){s.Xhr.xhr_(t,"GET",e,r).send()},post:function(t,e,r,i){var t=s.Xhr.xhr_(t,"POST",r,i),o=new FormData;if("object"==typeof e)for(var n in e)e.hasOwnProperty(n)&&o.append(n,e[n]);t.send(o)},xhr_:function(t,e,r,i){r=r||function(){},i=i||function(){};var o=new XMLHttpRequest;return o.open(e,t,!0),o.onload=function(t){200==this.status?r(this):this.onerror(this,t)},o.onerror=function(t){i(t,this)},o}}}(),!function(){var l=$.namespace("pxtr.utils.serialization");l.Serializer={serialize:function(t){var e=t.getLayers().map(function(t){return pxtr.utils.serialization.Serializer.serializeLayer(t)});return JSON.stringify({modelVersion:Constants.MODEL_VERSION,pixetor:{name:t.getDescriptor().name,description:t.getDescriptor().description,fps:pxtr.app.pixetorController.getFPS(),height:t.getHeight(),width:t.getWidth(),layers:e,hiddenFrames:t.hiddenFrames}})},serializeLayer:function(t){for(var e,r=t.getFrames(),t={name:t.getName(),opacity:t.getOpacity(),frameCount:r.length},i=[];!(e=i).length||!e.every(function(t){return t.base64PNG&&"data:,"!==t.base64PNG});){if(i.length>=r.length){i=[];break}for(var o=pxtr.utils.Array.chunk(r,i.length+1),i=[],n=0,s=0;s<o.length;s++){var a=o[s];i.push({layout:function(t,e){for(var r=[],i=0;i<t;i++)r.push([i+e]);return r}(a.length,n),base64PNG:l.Serializer.serializeFramesToBase64(a)}),n+=a.length}}return t.chunks=i,JSON.stringify(t)},serializeFramesToBase64:function(t){try{return new pxtr.rendering.FramesheetRenderer(t).renderAsCanvas().toDataURL()}catch(t){return""}}}}(),!function(){var o=$.namespace("pxtr.utils.serialization");o.Deserializer=function(t,e){this.layersToLoad_=0,this.data_=t,this.callback_=e,this.pixetor_=null,this.layers_=[]},o.Deserializer.deserialize=function(t,e,r){try{var i=new(t.modelVersion==Constants.MODEL_VERSION?o.Deserializer:1==t.modelVersion?o.backward.Deserializer_v1:o.backward.Deserializer_v0)(t,e);i.deserialize()}catch(t){console.error(t),"function"==typeof r&&r(t)}},o.Deserializer.prototype.deserialize=function(){var t=this.data_.pixetor,e=t.name||"Deserialized pixetor",r=t.description||"",i=void 0!==t.fps?t.fps:12,e=new pxtr.model.pixetor.Descriptor(e,r);this.pixetor_=new pxtr.model.Pixetor(t.width,t.height,i,e),this.hiddenFrames=t.hiddenFrames||[],this.layersToLoad_=t.layers.length,t.layers.forEach(this.deserializeLayer.bind(this))},o.Deserializer.prototype.deserializeLayer=function(t,e){var t=JSON.parse(t),r=new pxtr.model.Layer(t.name),t=(r.setOpacity(t.opacity),void 0===t.chunks&&t.base64PNG&&this.normalizeLayerData_(t),t.chunks),i=[];return Q.all(t.map(function(t){var e=Q.defer(),r=new Image;return r.onload=function(){pxtr.utils.FrameUtils.createFramesFromChunk(r,t.layout).forEach(function(t){i[t.index]=t.frame}),e.resolve()},r.src=t.base64PNG,e.promise})).then(function(){i.forEach(function(t){r.addFrame(t)}),this.layers_[e]=r,this.onLayerLoaded_()}.bind(this)).catch(function(t){console.error("Failed to deserialize layer"),console.error(t)}),r},o.Deserializer.prototype.onLayerLoaded_=function(){this.layersToLoad_=this.layersToLoad_-1,0===this.layersToLoad_&&(this.layers_.forEach(function(t){this.pixetor_.addLayer(t)}.bind(this)),this.pixetor_.hiddenFrames=this.hiddenFrames,this.callback_(this.pixetor_))},o.Deserializer.prototype.normalizeLayerData_=function(t){for(var e=[],r=0;r<t.frameCount;r++)e.push([r]);t.chunks=[{base64PNG:t.base64PNG,layout:e}]}}(),$.namespace("pxtr.utils.serialization.arraybuffer").ArrayBufferDeserializer={deserialize:function(t,e){for(var r=new Uint8Array(t),i=new Uint16Array(r.buffer),t=(i[0],i[1]),o=i[2],n=i[3],s=i[4],a=i[5],l=i[6],c=i[7],p=8,h="",u=0;u<s;u++)h+=String.fromCharCode(i[p+u]);p+=s;var d="";for(u=0;u<a;u++)d=String.fromCharCode(i[8+s+u]);p+=a;var f="";for(u=0;u<c;u++)f=String.fromCharCode(i[8+s+u]);var g=f.split("-"),m=(p+=c,[]);for(u=0;u<l;u++){for(var y={},v=i[p],x=i[p+1]/65535,C=i[p+2],S=i[p+3],_=i[p+4]>>>0|S<<16>>>0,b="",E=0;E<v;E++)b+=String.fromCharCode(i[p+5+E]);var w="";for(E=0;E<_;E++)w+=String.fromCharCode(r[2*(p+5+v)+E]);w="data:image/png;base64,"+w,p+=Math.ceil(5+v+_/2),y.name=b,y.opacity=x,y.frameCount=C,y.dataUri=w,m.push(y)}function T(e,t){var r=new Image;r.onload=function(){pxtr.utils.FrameUtils.createFramesFromSpritesheet(this,e.frameCount).forEach(function(t){e.model.addFrame(t)}),++A==l&&t(I)},r.src=e.dataUri}var P=new pxtr.model.pixetor.Descriptor(h,d),I=new pxtr.model.Pixetor(t,o,n,P),A=(I.hiddenFrames=g,0);for(u=0;u<l;u++){y=m[u];var L=new pxtr.model.Layer(y.name);(y.model=L).setOpacity(y.opacity),I.addLayer(L),T.bind(this,y,e)()}}},!function(){var _=$.namespace("pxtr.utils.serialization.arraybuffer");_.ArrayBufferSerializer={calculateRequiredBytes:function(t,e){t.getWidth(),t.getHeight();for(var r=t.getDescriptor().name.length,i=t.getDescriptor().description.length,o=(t.getLayers().length,0),o=(o=(o+=8)+4+2)+2*r+2*i,n=0,s=t.getLayers();n<s.length;n++)(o=(o=(o+=10)+2*s[n].name.length)+e[n].length)%2==1&&o++;return o},serialize:function(t){for(var e,r=[],i=0,o=t.getLayers();i<o.length;i++){var n,s=(n=new pxtr.rendering.FramesheetRenderer(o[i].getFrames()).renderAsCanvas().toDataURL().split(",")[1]).length;r.push({uri:n,length:s})}pxtr.app.pixetorController.getLayerAt(0).getFrames();var a=t.hiddenFrames.join("-"),l=_.ArrayBufferSerializer.calculateRequiredBytes(t,r,a),l=new ArrayBuffer(l),c=new Uint8Array(l),p=new Uint16Array(l),h=t.getWidth(),u=t.getHeight(),d=t.getDescriptor().name,f=d.length,g=t.getDescriptor().description,m=g.length,y=(p[0]=Constants.MODEL_VERSION,p[1]=h,p[2]=u,p[3]=pxtr.app.pixetorController.getFPS(),p[4]=f,p[5]=m,p[6]=t.getLayers().length,p[7]=a.length,8);for(i=0;i<f;i++)p[y+i]=d.charCodeAt(i);for(y+=f,i=0;i<m;i++)p[y+i]=g.charCodeAt(i);for(y+=m,i=0;i<a.length;i++)p[y+i]=a.charCodeAt(i);for(y+=a.length,i=0,o=t.getLayers();i<o.length;i++){var v=o[i],x=v.getFrames(),C=v.getName(),S=C.length,v=v.getOpacity(),x=x.length;for(n=r[i].uri,s=r[i].length,p[y]=S,p[y+1]=Math.floor(65535*v),p[y+2]=x,p[y+3]=(4294901760&s)>>16>>>0,p[y+4]=(65535&s)>>>0,e=0;e<S;e++)p[y+5+e]=C.charCodeAt(e);for(e=0;e<s;e++)c[2*(y+5+S)+e]=n.charCodeAt(e);y+=Math.ceil(5+S+s/2)}return l}}}(),!function(){var t=$.namespace("pxtr.utils.serialization.backward");t.Deserializer_v0=function(t,e){this.data_=t,this.callback_=e},t.Deserializer_v0.prototype.deserialize=function(){var t=this.data_.map(function(t){return pxtr.model.Frame.fromPixelGrid(t)}),e=new pxtr.model.pixetor.Descriptor("Deserialized pixetor",""),t=pxtr.model.Layer.fromFrames("Layer 1",t);this.callback_(pxtr.model.Pixetor.fromLayers([t],Constants.DEFAULT.FPS,e))}}(),!function(){var t=$.namespace("pxtr.utils.serialization.backward");t.Deserializer_v1=function(t,e){this.callback_=e,this.data_=t},t.Deserializer_v1.prototype.deserialize=function(){var t=this.data_.pixetor,e=new pxtr.model.pixetor.Descriptor("Deserialized pixetor",""),r=new pxtr.model.Pixetor(t.width,t.height,Constants.DEFAULT.FPS,e);t.layers.forEach(function(t){t=this.deserializeLayer(t);r.addLayer(t)}.bind(this)),this.callback_(r)},t.Deserializer_v1.prototype.deserializeLayer=function(t){var t=JSON.parse(t),e=new pxtr.model.Layer(t.name);return t.frames.forEach(function(t){t=this.deserializeFrame(t);e.addFrame(t)}.bind(this)),e},t.Deserializer_v1.prototype.deserializeFrame=function(t){t=JSON.parse(t);return pxtr.model.Frame.fromPixelGrid(t)}}(),!function(){function t(){!function(t){function p(t,e){if({}.hasOwnProperty.call(p.cache,t))return p.cache[t];var r,i=p.resolve(t);if(i)return r={id:t,require:p,filename:t,exports:{},loaded:!1,parent:e,children:[]},e&&e.children.push(r),e=t.slice(0,t.lastIndexOf("/")+1),p.cache[t]=r.exports,i.call(r.exports,r,r.exports,e,t),r.loaded=!0,p.cache[t]=r.exports;throw new Error("Failed to resolve module "+t)}p.modules={},p.cache={},p.resolve=function(t){return{}.hasOwnProperty.call(p.modules,t)?p.modules[t]:void 0},p.define=function(t,e){p.modules[t]=e},p.define("/gif.worker.coffee",function(t,e,r,i){var n=p("/GIFEncoder.js",t),o=function(i){var o,t=new n(i.width,i.height);return 0===i.index?t.writeHeader():t.firstFrame=!1,t.setTransparent(i.transparent),t.setRepeat(i.repeat),t.setDelay(i.delay),t.setQuality(i.quality),t.setPreserveColors(i.preserveColors),t.addFrame(i.data),i.last&&t.finish(),t=t.stream(),i.data=t.pages,i.cursor=t.cursor,i.pageSize=t.constructor.pageSize,i.canTransfer?(t=function(t){for(var e=0,r=i.data.length;e<r;++e)o=i.data[e],t.push(o.buffer);return t}.call(this,[]),self.postMessage(i,t)):self.postMessage(i)};self.onmessage=function(t){return o(t.data)}}),p.define("/GIFEncoder.js",function(t,e,r,i){function o(){this.page=-1,this.pages=[],this.newPage()}function n(t,e){this.width=~~t,this.height=~~e,this.transparent=null,this.transIndex=0,this.repeat=-1,this.delay=0,this.image=null,this.pixels=null,this.indexedPixels=null,this.colorDepth=null,this.colorTab=null,this.usedEntry=new Array,this.palSize=7,this.dispose=-1,this.firstFrame=!0,this.sample=10,this.out=new o}var s=p("/TypedNeuQuant.js",t),a=p("/SimpleQuant.js",t),l=p("/LZWEncoder.js",t);o.pageSize=4096,o.charMap={};for(var c=0;c<256;c++)o.charMap[c]=String.fromCharCode(c);o.prototype.newPage=function(){this.pages[++this.page]=new Uint8Array(o.pageSize),this.cursor=0},o.prototype.getData=function(){for(var t="",e=0;e<this.pages.length;e++)for(var r=0;r<o.pageSize;r++)t+=o.charMap[this.pages[e][r]];return t},o.prototype.writeByte=function(t){this.cursor>=o.pageSize&&this.newPage(),this.pages[this.page][this.cursor++]=t},o.prototype.writeUTFBytes=function(t){for(var e=t.length,r=0;r<e;r++)this.writeByte(t.charCodeAt(r))},o.prototype.writeBytes=function(t,e,r){for(var i=r||t.length,o=e||0;o<i;o++)this.writeByte(t[o])},n.prototype.setDelay=function(t){this.delay=Math.round(t/10)},n.prototype.setFrameRate=function(t){this.delay=Math.round(100/t)},n.prototype.setDispose=function(t){0<=t&&(this.dispose=t)},n.prototype.setRepeat=function(t){this.repeat=t},n.prototype.setTransparent=function(t){this.transparent=t},n.prototype.setPreserveColors=function(t){this.preserveColors=t},n.prototype.addFrame=function(t){this.image=t,this.getImagePixels(),this.analyzePixels(),this.firstFrame&&(this.writeLSD(),this.writePalette(),0<=this.repeat&&this.writeNetscapeExt()),this.writeGraphicCtrlExt(),this.writeImageDesc(),this.firstFrame||this.writePalette(),this.writePixels(),this.firstFrame=!1},n.prototype.finish=function(){this.out.writeByte(59)},n.prototype.setQuality=function(t){this.sample=t=t<1?1:t},n.prototype.writeHeader=function(){this.out.writeUTFBytes("GIF89a")},n.prototype.analyzePixels=function(){for(var t,e,r=this.pixels.length/3,i=(this.indexedPixels=new Uint8Array(r),(e=this.preserveColors?(t=this.toRGBComponents(this.transparent),new a(this.pixels,this.sample,t)):new s(this.pixels,this.sample)).buildColormap(),this.colorTab=e.getColormap(),0),o=0;o<r;o++){var n=e.lookupRGB(255&this.pixels[i++],255&this.pixels[i++],255&this.pixels[i++]);this.usedEntry[n]=!0,this.indexedPixels[o]=n}this.pixels=null,this.colorDepth=8,this.palSize=7,null!==this.transparent&&(this.transIndex=this.findClosest(this.transparent))},n.prototype.toRGBComponents=function(t){return t?{r:(16711680&t)>>16,g:(65280&t)>>8,b:255&t}:null},n.prototype.findClosest=function(t){if(null===this.colorTab)return-1;for(var e=(16711680&t)>>16,r=(65280&t)>>8,i=255&t,o=0,n=16777216,s=this.colorTab.length,a=0;a<s;){var l=e-(255&this.colorTab[a++]),c=r-(255&this.colorTab[a++]),p=i-(255&this.colorTab[a]),l=l*l+c*c+p*p,c=parseInt(a/3);(this.preserveColors||this.usedEntry[c])&&l<n&&(n=l,o=c),a++}return o},n.prototype.getImagePixels=function(){for(var t=this.width,e=this.height,r=(this.pixels=new Uint8Array(t*e*3),this.image),i=0,o=0;o<e;o++)for(var n=0;n<t;n++){var s=o*t*4+4*n;this.pixels[i++]=r[s],this.pixels[i++]=r[1+s],this.pixels[i++]=r[2+s]}},n.prototype.writeGraphicCtrlExt=function(){var t,e;this.out.writeByte(33),this.out.writeByte(249),this.out.writeByte(4),e=null===this.transparent?t=0:(t=1,2),0<=this.dispose&&(e=7&dispose),this.out.writeByte(0|(e<<=2)|t),this.writeShort(this.delay),this.out.writeByte(this.transIndex),this.out.writeByte(0)},n.prototype.writeImageDesc=function(){this.out.writeByte(44),this.writeShort(0),this.writeShort(0),this.writeShort(this.width),this.writeShort(this.height),this.firstFrame?this.out.writeByte(0):this.out.writeByte(128|this.palSize)},n.prototype.writeLSD=function(){this.writeShort(this.width),this.writeShort(this.height),this.out.writeByte(240|this.palSize),this.out.writeByte(0),this.out.writeByte(0)},n.prototype.writeNetscapeExt=function(){this.out.writeByte(33),this.out.writeByte(255),this.out.writeByte(11),this.out.writeUTFBytes("NETSCAPE2.0"),this.out.writeByte(3),this.out.writeByte(1),this.writeShort(this.repeat),this.out.writeByte(0)},n.prototype.writePalette=function(){this.out.writeBytes(this.colorTab);for(var t=768-this.colorTab.length,e=0;e<t;e++)this.out.writeByte(0)},n.prototype.writeShort=function(t){this.out.writeByte(255&t),this.out.writeByte(t>>8&255)},n.prototype.writePixels=function(){new l(this.width,this.height,this.indexedPixels,this.colorDepth).encode(this.out)},n.prototype.stream=function(){return this.out},t.exports=n}),p.define("/LZWEncoder.js",function(t,e,r,i){var E=-1,w=12,T=5003,P=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535];t.exports=function(e,r,t,i){function o(t,e){v[d++]=t,254<=d&&s(e)}function c(t){for(var e=0;e<t;++e)x[e]=-1}function n(t,e){var r,i,o,n,s,a,l;for(b=!1,n_bits=g=t,f=p(n_bits),y=(m=1<<t-1)+1,_=m+2,d=0,o=h(),a=0,r=T;r<65536;r*=2)++a;a=8-a,c(s=T),u(m,e);t:for(;(l=h())!=E;)if(x[i=l<<a^o]===(r=(l<<w)+o))o=C[i];else{if(0<=x[i]){n=0===i?1:s-i;do{if((i-=n)<0&&(i+=s),x[i]===r){o=C[i];continue t}}while(0<=x[i])}u(o,e),o=l,_<1<<w?(C[i]=_++,x[i]=r):(l=e,c(T),_=m+2,b=!0,u(m,l))}u(o,e),u(y,e)}function s(t){0<d&&(t.writeByte(d),t.writeBytes(v,0,d),d=0)}function p(t){return(1<<t)-1}function h(){return 0===remaining?E:(--remaining,255&t[curPixel++])}function u(t,e){for(a&=P[S],0<S?a|=t<<S:a=t,S+=n_bits;8<=S;)o(255&a,e),a>>=8,S-=8;if((f<_||b)&&(b?(f=p(n_bits=g),b=!1):(++n_bits,f=n_bits==w?1<<w:p(n_bits))),t==y){for(;0<S;)o(255&a,e),a>>=8,S-=8;s(e)}}var a,d,f,g,m,y,l=Math.max(2,i),v=new Uint8Array(256),x=new Int32Array(T),C=new Int32Array(T),S=0,_=0,b=!1;this.encode=function(t){t.writeByte(l),remaining=e*r,curPixel=0,n(l+1,t),t.writeByte(0)}}}),p.define("/SimpleQuant.js",function(t,e,r,i){function o(t,e,r){return[t,e,r].join(".")}t.exports=function(t,e,s){this.pixels=t,this.palette=[],this.paletteIndex={},this.getColormap=function(){return this.palette},this.buildColormap=function(){for(var t=this.pixels.length/3,e=0,r=0;r<t;r++){var i=this.pixels[e++],o=this.pixels[e++],n=this.pixels[e++];this.addColorToPalette(i,o,n)}s&&this.addColorToPalette(s.r,s.g,s.b)},this.addColorToPalette=function(t,e,r){var i=o(t,e,r);this.paletteIndex.hasOwnProperty(i)||(this.palette.push(t),this.palette.push(e),this.palette.push(r),this.paletteIndex[i]=this.palette.length/3-1)},this.lookupRGB=function(t,e,r){return this.paletteIndex[o(t,e,r)]}}}),p.define("/TypedNeuQuant.js",function(t,e,r,i){var k=100,N=256,d=N-1,M=4,U=16,f=1<<U,z=10,B=10,H=f>>B,W=f<<z-B,$=6,G=(N>>3)*(1<<$),j=30,q=1024,V=256,K=1<<18,X=499,Z=491,Y=487,Q=503,J=3*Q;t.exports=function(A,L){function h(){var t=A.length,e=30+(L-1)/3,r=t/(3*L),i=~~(r/k),o=q,n=G,s=n>>$;for(s<=1&&(s=0),m=0;m<s;m++)F[m]=o*((s*s-m*m)*V/(s*s));for(var a,l,c,p,h,u,d,f=t<J?(L=1,3):t%X!=0?3*X:t%Z!=0?3*Z:t%Y!=0?3*Y:3*Q,g=0,m=0;m<r;){if(a=(255&A[g])<<M,l=(255&A[g+1])<<M,c=(255&A[g+2])<<M,p=function(t,e,r){for(var i,o=2147483647,n=o,s=-1,a=s,l=0;l<N;l++)i=R[l],(i=Math.abs(i[0]-t)+Math.abs(i[1]-e)+Math.abs(i[2]-r))<o&&(o=i,s=l),(i=i-(O[l]>>U-M))<n&&(n=i,a=l),i=D[l]>>B,D[l]-=i,O[l]+=i<<z;return D[s]+=H,O[s]-=W,a}(a,l,c),h=o,y=a,v=l,d=c,R[u=p][0]-=h*(R[u][0]-y)/q,R[u][1]-=h*(R[u][1]-v)/q,R[u][2]-=h*(R[u][2]-d)/q,0!==s){b=_=I=P=T=w=E=S=C=x=v=y=void 0;for(var y=s,v=p,x=a,C=l,S=c,_,b,E=Math.abs(v-y),w=Math.min(v+y,N),T=v+1,P=v-1,I=1;T<w||E<P;)b=F[I++],T<w&&((_=R[T++])[0]-=b*(_[0]-x)/K,_[1]-=b*(_[1]-C)/K,_[2]-=b*(_[2]-S)/K),E<P&&((_=R[P--])[0]-=b*(_[0]-x)/K,_[1]-=b*(_[1]-C)/K,_[2]-=b*(_[2]-S)/K)}if(t<=(g+=f)&&(g-=t),++m%(i=0===i?1:i)==0)for(o-=o/e,(s=(n-=n/j)>>$)<=1&&(s=0),p=0;p<s;p++)F[p]=o*((s*s-p*p)*V/(s*s))}}var R,u,O,D,F;this.buildColormap=function(){var t,e;for(R=[],u=new Int32Array(256),O=new Int32Array(N),D=new Int32Array(N),F=new Int32Array(N>>3),t=0;t<N;t++)e=(t<<M+8)/N,R[t]=new Float64Array([e,e,e,0]),D[t]=f/N,O[t]=0;h();for(var r=0;r<N;r++)R[r][0]>>=M,R[r][1]>>=M,R[r][2]>>=M,R[r][3]=r;for(var i,o,n,s,a,l=0,c=0,p=0;p<N;p++){for(a=(o=R[s=p])[1],i=p+1;i<N;i++)(n=R[i])[1]<a&&(s=i,a=n[1]);if(n=R[s],p!=s&&(i=n[0],n[0]=o[0],o[0]=i,i=n[1],n[1]=o[1],o[1]=i,i=n[2],n[2]=o[2],o[2]=i,i=n[3],n[3]=o[3],o[3]=i),a!=l){for(u[l]=c+p>>1,i=l+1;i<a;i++)u[i]=p;l=a,c=p}}for(u[l]=c+d>>1,i=l+1;i<256;i++)u[i]=d},this.getColormap=function(){for(var t=[],e=[],r=0;r<N;r++)e[R[r][3]]=r;for(var i=0,o=0;o<N;o++){var n=e[o];t[i++]=R[n][0],t[i++]=R[n][1],t[i++]=R[n][2]}return t},this.lookupRGB=function(t,e,r){for(var i,o,n,s=1e3,a=-1,l=u[e],c=l-1;l<N||0<=c;)l<N&&(s<=(n=(o=R[l])[1]-e)?l=N:(l++,n<0&&(n=-n),(n+=i=(i=o[0]-t)<0?-i:i)<s&&((n+=i=(i=o[2]-r)<0?-i:i)<s&&(s=n,a=o[3])))),0<=c&&(s<=(n=e-(o=R[c])[1])?c=-1:(c--,n<0&&(n=-n),(n+=i=(i=o[0]-t)<0?-i:i)<s&&((n+=i=(i=o[2]-r)<0?-i:i)<s&&(s=n,a=o[3]))));return a}}}),p("/gif.worker.coffee")}.call(this,this)}var e,r,i;try{pxtr.utils.UserAgent.isIE11?(i="js/lib/gif/gif.ie.worker.js",window.pxtr&&window.pxtr.appEngineToken_&&(i="../"+i)):(e=(t+"").replace(/function\s?\(\)\s?\{/,"").replace(/\}[^}]*$/,""),r=new Blob([e],{type:"application/javascript"}),i=URL.createObjectURL(r)),window.GifWorkerURL=i}catch(t){console.error("Could not create worker",t.message)}}(),!function(t){function p(t,e){if({}.hasOwnProperty.call(p.cache,t))return p.cache[t];var r,i=p.resolve(t);if(i)return r={id:t,require:p,filename:t,exports:{},loaded:!1,parent:e,children:[]},e&&e.children.push(r),e=t.slice(0,t.lastIndexOf("/")+1),p.cache[t]=r.exports,i.call(r.exports,r,r.exports,e,t),r.loaded=!0,p.cache[t]=r.exports;throw new Error("Failed to resolve module "+t)}p.modules={},p.cache={},p.resolve=function(t){return{}.hasOwnProperty.call(p.modules,t)?p.modules[t]:void 0},p.define=function(t,e){p.modules[t]=e};e="/";var e,o={title:"browser",version:"v0.8.19",browser:!0,env:{},argv:[],nextTick:t.setImmediate||function(t){setTimeout(t,0)},cwd:function(){return e},chdir:function(t){e=t}};p.define("/gif.coffee",function(t,e,r,i){function n(t,e){return{}.hasOwnProperty.call(t,e)}var s,a,l=p("events",t).EventEmitter,c=p("/browser.coffee",t),o=function(){function t(t){var e,r;for(e in this.running=!1,this.options={},this.frames=[],this.freeWorkers=[],this.activeWorkers=[],this.setOptions(t),s)r=s[e],null!=this.options[e]?this.options[e]:this.options[e]=r}var e,r=t,i=l;function o(){this.constructor=r}for(e in i)n(i,e)&&(r[e]=i[e]);return o.prototype=i.prototype,r.prototype=new o,r.__super__=i.prototype,s={workerScript:window.GifWorkerURL,workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null,transparent:null,preserveColors:!1},a={delay:500,copy:!1},t.prototype.setOption=function(t,e){return this.options[t]=e,null==this._canvas||"width"!==t&&"height"!==t?void 0:this._canvas[t]=e},t.prototype.setOptions=function(e){var r,i;return function(t){for(r in e)n(e,r)&&(i=e[r],t.push(this.setOption(r,i)));return t}.call(this,[])},t.prototype.addFrame=function(t,e){var r,i;for(i in null==e&&(e={}),(r={}).transparent=this.options.transparent,a)r[i]=e[i]||a[i];if(null==this.options.width&&this.setOption("width",t.width),null==this.options.height&&this.setOption("height",t.height),"undefined"!=typeof ImageData&&null!=ImageData&&t instanceof ImageData)r.data=t.data;else if("undefined"!=typeof CanvasRenderingContext2D&&null!=CanvasRenderingContext2D&&t instanceof CanvasRenderingContext2D||"undefined"!=typeof WebGLRenderingContext&&null!=WebGLRenderingContext&&t instanceof WebGLRenderingContext)e.copy?r.data=this.getContextData(t):r.context=t;else{if(null==t.childNodes)throw new Error("Invalid image");e.copy?r.data=this.getImageData(t):r.image=t}return this.frames.push(r)},t.prototype.render=function(){if(this.running)throw new Error("Already running");if(null==this.options.width||null==this.options.height)throw new Error("Width and height must be set prior to rendering");this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=function(t){for(var e=function(){for(var t=[],e=0;0<=this.frames.length?e<this.frames.length:e>this.frames.length;0<=this.frames.length?++e:--e)t.push(e);return t}.apply(this,arguments),r=0,i=e.length;r<i;++r)e[r],t.push(null);return t}.call(this,[]);for(var r=this.spawnWorkers(),t=function(){for(var t=[],e=0;0<=r?e<r:r<e;0<=r?++e:--e)t.push(e);return t}.apply(this,arguments),e=0,i=t.length;e<i;++e)t[e],this.renderNextFrame();return this.emit("start"),this.emit("progress",0)},t.prototype.abort=function(){for(var t;null!=(t=this.activeWorkers.shift());)console.log("killing active worker"),t.terminate();return this.running=!1,this.emit("abort")},t.prototype.spawnWorkers=function(){var i,r=Math.min(this.options.workers,this.frames.length);return function(){for(var t=[],e=this.freeWorkers.length;this.freeWorkers.length<=r?e<r:r<e;this.freeWorkers.length<=r?++e:--e)t.push(e);return t}.apply(this,arguments).forEach((i=this,function(t){var e,r;return console.log("spawning worker "+t),(e=new Worker(i.options.workerScript)).onmessage=(r=i,function(t){return r.activeWorkers.splice(r.activeWorkers.indexOf(e),1),r.freeWorkers.push(e),r.frameFinished(t.data)}),i.freeWorkers.push(e)})),r},t.prototype.frameFinished=function(t){return console.log("frame "+t.index+" finished - "+this.activeWorkers.length+" active"),this.finishedFrames++,this.emit("progress",this.finishedFrames/this.frames.length),this.imageParts[t.index]=t,function(t,e){for(var r=0,i=e.length;r<i;++r)if(r in e&&e[r]===t)return 1}(null,this.imageParts)?this.renderNextFrame():this.finishRendering()},t.prototype.finishRendering=function(){for(var t,e,r,i=0,o=0,n=this.imageParts.length;o<n;++o)i+=((p=this.imageParts[o]).data.length-1)*p.pageSize+p.cursor;i+=p.pageSize-p.cursor,console.log("rendering finished - filesize "+Math.round(i/1e3)+"kb");for(var s=new Uint8Array(i),a=0,l=0,c=this.imageParts.length;l<c;++l)for(var p,h=0,u=(p=this.imageParts[l]).data.length;h<u;++h)r=p.data[h],t=h,s.set(r,a),t===p.data.length-1?a+=p.cursor:a+=p.pageSize;return e=new Blob([s],{type:"image/gif"}),this.emit("finished",e,s)},t.prototype.renderNextFrame=function(){var t,e;if(0===this.freeWorkers.length)throw new Error("No free workers");return this.nextFrame>=this.frames.length?void 0:(t=this.frames[this.nextFrame++],e=this.freeWorkers.shift(),t=this.getTask(t),console.log("starting frame "+(t.index+1)+" of "+this.frames.length),this.activeWorkers.push(e),e.postMessage(t))},t.prototype.getContextData=function(t){return t.getImageData(0,0,this.options.width,this.options.height).data},t.prototype.getImageData=function(t){var e;return null==this._canvas&&(this._canvas=document.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height),(e=this._canvas.getContext("2d")).setFill=this.options.background,e.fillRect(0,0,this.options.width,this.options.height),e.drawImage(t,0,0),this.getContextData(e)},t.prototype.getTask=function(t){var e=this.frames.indexOf(t),e={index:e,last:e===this.frames.length-1,delay:t.delay,transparent:t.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,preserveColors:this.options.preserveColors,repeat:this.options.repeat,canTransfer:"chrome"===c.name};if(null!=t.data)e.data=t.data;else if(null!=t.context)e.data=this.getContextData(t.context);else{if(null==t.image)throw new Error("Invalid frame");e.data=this.getImageData(t.image)}return e},t}();t.exports=o}),p.define("/browser.coffee",function(t,e,r,i){var o=navigator.userAgent.toLowerCase(),n=navigator.platform.toLowerCase(),s=o.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0],a="ie"===s[1]&&document.documentMode,a={name:"version"===s[1]?s[3]:s[1],version:a||parseFloat("opera"===s[1]&&s[4]?s[4]:s[2]),platform:{name:o.match(/ip(?:ad|od|hone)/)?"ios":(o.match(/(?:webos|android)/)||n.match(/mac|win|linux/)||["other"])[0]}};a[a.name]=!0,a[a.name+parseInt(a.version,10)]=!0,a.platform[a.platform.name]=!0,t.exports=a}),p.define("events",function(t,e,r,i){o.EventEmitter||(o.EventEmitter=function(){});var e=e.EventEmitter=o.EventEmitter,s="function"==typeof Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};e.prototype.setMaxListeners=function(t){this._events||(this._events={}),this._events.maxListeners=t},e.prototype.emit=function(t){if("error"===t&&(!this._events||!this._events.error||s(this._events.error)&&!this._events.error.length))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;var e=this._events[t];if(!e)return!1;if("function"!=typeof e){if(s(e)){for(var r=Array.prototype.slice.call(arguments,1),i=e.slice(),o=0,n=i.length;o<n;o++)i[o].apply(this,r);return!0}return!1}switch(arguments.length){case 1:e.call(this);break;case 2:e.call(this,arguments[1]);break;case 3:e.call(this,arguments[1],arguments[2]);break;default:r=Array.prototype.slice.call(arguments,1);e.apply(this,r)}return!0},e.prototype.addListener=function(t,e){if("function"!=typeof e)throw new Error("addListener only takes instances of Function");var r;return this._events||(this._events={}),this.emit("newListener",t,e),this._events[t]?s(this._events[t])?(this._events[t].warned||(r=void 0!==this._events.maxListeners?this._events.maxListeners:10)&&0<r&&this._events[t].length>r&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),console.trace()),this._events[t].push(e)):this._events[t]=[this._events[t],e]:this._events[t]=e,this},e.prototype.on=e.prototype.addListener,e.prototype.once=function(e,r){var i=this;return i.on(e,function t(){i.removeListener(e,t),r.apply(this,arguments)}),this},e.prototype.removeListener=function(t,e){if("function"!=typeof e)throw new Error("removeListener only takes instances of Function");if(this._events&&this._events[t]){var r=this._events[t];if(s(r)){var i=r.indexOf(e);if(i<0)return this;r.splice(i,1),0==r.length&&delete this._events[t]}else this._events[t]===e&&delete this._events[t]}return this},e.prototype.removeAllListeners=function(t){return t&&this._events&&this._events[t]&&(this._events[t]=null),this},e.prototype.listeners=function(t){return this._events||(this._events={}),this._events[t]||(this._events[t]=[]),s(this._events[t])||(this._events[t]=[this._events[t]]),this._events[t]}}),t.GIF=p("/gif.coffee")}.call(this,this),!function(t){"use strict";function e(t){this.data=t,this.len=this.data.length,this.pos=0}e.prototype.readByte=function(){if(this.pos>=this.data.length)throw new Error("Attempted to read past end of stream.");return 255&this.data.charCodeAt(this.pos++)},e.prototype.readBytes=function(t){for(var e=[],r=0;r<t;r++)e.push(this.readByte());return e},e.prototype.read=function(t){for(var e="",r=0;r<t;r++)e+=String.fromCharCode(this.readByte());return e},e.prototype.readUnsigned=function(){var t=this.readBytes(2);return(t[1]<<8)+t[0]},(t.SuperGIF=t.SuperGIF||{}).Stream=e}(window),!function(S){"use strict";function _(t){this.data=t,this.len=this.data.length,this.pos=0,this.readByte=function(){if(this.pos>=this.data.length)throw new Error("Attempted to read past end of stream.");return 255&t.charCodeAt(this.pos++)},this.readBytes=function(t){for(var e=[],r=0;r<t;r++)e.push(this.readByte());return e},this.read=function(t){for(var e="",r=0;r<t;r++)e+=String.fromCharCode(this.readByte());return e},this.readUnsigned=function(){var t=this.readBytes(2);return(t[1]<<8)+t[0]}}function b(n,s){function a(){for(var t,e="";t=n.readByte(),e+=n.read(t),0!==t;);return e}s=s||{};var i=function(t){for(var e=[],r=0;r<t;r++)e.push(n.readBytes(3));return e},e=function(t){function e(t){var e;n.readByte(),t.identifier=n.read(8),t.authCode=n.read(3),"NETSCAPE"===t.identifier?(e=t,n.readByte(),e.unknown=n.readByte(),e.iterations=n.readUnsigned(),e.terminator=n.readByte(),s.app&&s.app.NETSCAPE&&s.app.NETSCAPE(e)):((e=t).appData=a(),s.app&&s.app[e.identifier]&&s.app[e.identifier](e))}var r,i;switch(t.label=n.readByte(),t.label){case 249:t.extType="gce",o=t,n.readByte(),i=p(n.readByte()),o.reserved=i.splice(0,3),o.disposalMethod=c(i.splice(0,3)),o.userInput=i.shift(),o.transparencyGiven=i.shift(),o.delayTime=n.readUnsigned(),o.transparencyIndex=n.readByte(),o.terminator=n.readByte(),s.gce&&s.gce(o);break;case 254:t.extType="com",(i=t).comment=a(),s.com&&s.com(i);break;case 1:t.extType="pte";var o=t;n.readByte(),o.ptHeader=n.readBytes(12),o.ptData=a(),s.pte&&s.pte(o);break;case 255:t.extType="app",e(t);break;default:t.extType="unknown",(r=t).data=a(),s.unknown&&s.unknown(r)}},r=function(t){function e(t,e){for(var r=new Array(t.length),i=t.length/e,o=[0,4,2,1],n=[8,8,4,2],s=0,a=0;a<4;a++)for(var l=o[a];l<i;l+=n[a]){p=void 0;var c=l,p=s;p=t.slice(p*e,(p+1)*e),r.splice.apply(r,[c*e,e].concat(p)),s++}return r}t.leftPos=n.readUnsigned(),t.topPos=n.readUnsigned(),t.width=n.readUnsigned(),t.height=n.readUnsigned();var r=p(n.readByte()),r=(t.lctFlag=r.shift(),t.interlaced=r.shift(),t.sorted=r.shift(),t.reserved=r.splice(0,2),t.lctSize=c(r.splice(0,3)),t.lctFlag&&(t.lct=i(1<<t.lctSize+1)),t.lzwMinCodeSize=n.readByte(),a());t.pixels=h(t.lzwMinCodeSize,r),t.interlaced&&(t.pixels=e(t.pixels,t.width)),s.img&&s.img(t)},o=function(){var t={};switch(t.sentinel=n.readByte(),String.fromCharCode(t.sentinel)){case"!":t.type="ext",e(t);break;case",":t.type="img",r(t);break;case";":t.type="eof",s.eof&&s.eof(t);break;default:return s.onError(new Error("Unknown block: 0x"+t.sentinel.toString(16)))}"eof"!==t.type&&setTimeout(o,0)},t={};if(t.sig=n.read(3),t.ver=n.read(3),"GIF"!==t.sig)throw s.onError(),new Error("Not a GIF file.");t.width=n.readUnsigned(),t.height=n.readUnsigned();var l=p(n.readByte());t.gctFlag=l.shift(),t.colorRes=c(l.splice(0,3)),t.sorted=l.shift(),t.gctSize=c(l.splice(0,3)),t.bgColor=n.readByte(),t.pixelAspectRatio=n.readByte(),t.gctFlag&&(t.gct=i(1<<t.gctSize+1)),s.hdr&&s.hdr(t),setTimeout(o,0)}var c=function(t){return t.reduce(function(t,e){return 2*t+e},0)},p=function(t){for(var e=[],r=7;0<=r;r--)e.push(!!(t&1<<r));return e},h=function(t,i){for(var e,r,o=0,n=[],s=1<<t,a=1+s,l=t+1,c=[];;)if(r=e,(e=function(t){for(var e=0,r=0;r<t;r++)i.charCodeAt(o>>3)&1<<(7&o)&&(e|=1<<r),o++;return e}(l))===s){p=void 0,c=[],l=t+1;for(var p=0;p<s;p++)c[p]=[p];c[s]=[],c[a]=null}else{if(e===a)break;if(e<c.length)r!==s&&c.push(c[r].concat(c[e][0]));else{if(e!==c.length)throw new Error("Invalid LZW code.");c.push(c[r].concat(c[r][0]))}n.push.apply(n,c[e]),c.length===1<<l&&l<12&&l++}return n};S.SuperGif=function(t){var e,r,o,i={vp_l:0,vp_t:0,vp_w:null,vp_h:null,c_w:null,c_h:null};for(e in t)i[e]=t[e];i.vp_w&&i.vp_h&&(i.is_vp=!0);function n(){try{b(r,y)}catch(t){s("parse")}}function s(t){o={width:m.width,height:m.height},g=[]}function a(){d&&g.push({data:d.getImageData(0,0,o.width,o.height),delay:c})}var l=null,c=null,p=null,h=0,u=null,d=null,f=null,g=[],m=i.gif,y={hdr:function(t){var e;t=(o=t).width,e=o.height,C.width=t,C.height=e,C.getContext("2d").setTransform(1,0,0,1,0,0)},gce:function(t){a(),u=p,d=p=c=l=null,l=t.transparencyGiven?t.transparencyIndex:null,c=t.delayTime,p=t.disposalMethod},img:function(t){d=d||C.getContext("2d");var e=g.length,r=t.lctFlag?t.lct:o.gct,e=(0<e&&(3===u?d.putImageData(g[h].data,0,0):h=e-1,2===u&&d.clearRect(f.leftPos,f.topPos,f.width,f.height)),d.getImageData(t.leftPos,t.topPos,t.width,t.height)),i=e.data;t.pixels.forEach(function(t,e){t!==l&&(i[4*e+0]=r[t][0],i[4*e+1]=r[t][1],i[4*e+2]=r[t][2],i[4*e+3]=255)}),d.putImageData(e,t.leftPos,t.topPos),f=t},eof:function(t){a(),v&&v()},onError:function(t){x&&x()}},v=!1,x=!1,C=document.createElement("canvas");return{load:function(t){var e;v=t.success,t.step,x=t.error,-1!==m.src.indexOf("data:")?(t=m.src.substring(m.src.indexOf(",")+1),r=new _(S.atob(t)),n()):((e=new XMLHttpRequest).overrideMimeType("text/plain; charset=x-user-defined"),e.onload=function(t){r=new _(e.responseText),setTimeout(n,0)},e.onerror=function(){s("xhr")},e.open("GET",m.getAttribute("data-animated-src")||m.src,!0),e.send())},getFrames:function(){return g}}}}(window),!function(t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define(t):"undefined"!=typeof window?window.JSZip=t():"undefined"!=typeof global?global.JSZip=t():"undefined"!=typeof self&&(self.JSZip=t())}(function(){return function i(o,n,s){function a(r,t){if(!n[r]){if(!o[r]){var e="function"==typeof require&&require;if(!t&&e)return e(r,!0);if(l)return l(r,!0);throw new Error("Cannot find module '"+r+"'")}t=n[r]={exports:{}};o[r][0].call(t.exports,function(t){var e=o[r][1][t];return a(e||t)},t,t.exports,i,o,n,s)}return n[r].exports}for(var l="function"==typeof require&&require,t=0;t<s.length;t++)a(s[t]);return a}({1:[function(t,e,r){"use strict";var c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";r.encode=function(t){for(var e,r,i,o,n,s,a="",l=0;l<t.length;)i=(e=t.charCodeAt(l++))>>2,o=(3&e)<<4|(e=t.charCodeAt(l++))>>4,n=(15&e)<<2|(r=t.charCodeAt(l++))>>6,s=63&r,isNaN(e)?n=s=64:isNaN(r)&&(s=64),a=a+c.charAt(i)+c.charAt(o)+c.charAt(n)+c.charAt(s);return a},r.decode=function(t){var e,r,i,o,n,s,a="",l=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<t.length;)i=c.indexOf(t.charAt(l++)),e=(15&(o=c.indexOf(t.charAt(l++))))<<4|(n=c.indexOf(t.charAt(l++)))>>2,r=(3&n)<<6|(s=c.indexOf(t.charAt(l++))),a+=String.fromCharCode(i<<2|o>>4),64!=n&&(a+=String.fromCharCode(e)),64!=s&&(a+=String.fromCharCode(r));return a}},{}],2:[function(t,e){"use strict";function r(){this.compressedSize=0,this.uncompressedSize=0,this.crc32=0,this.compressionMethod=null,this.compressedContent=null}r.prototype={getContent:function(){return null},getCompressedContent:function(){return null}},e.exports=r},{}],3:[function(t,e,r){"use strict";r.STORE={magic:"\0\0",compress:function(t){return t},uncompress:function(t){return t},compressInputType:null,uncompressInputType:null},r.DEFLATE=t("./flate")},{"./flate":6}],4:[function(t,e){"use strict";function r(){this.data=null,this.length=0,this.index=0}var i=t("./utils");r.prototype={checkOffset:function(t){this.checkIndex(this.index+t)},checkIndex:function(t){if(this.length<t||t<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+t+"). Corrupted zip ?")},setIndex:function(t){this.checkIndex(t),this.index=t},skip:function(t){this.setIndex(this.index+t)},byteAt:function(){},readInt:function(t){var e,r=0;for(this.checkOffset(t),e=this.index+t-1;e>=this.index;e--)r=(r<<8)+this.byteAt(e);return this.index+=t,r},readString:function(t){return i.transformTo("string",this.readData(t))},readData:function(){},lastIndexOfSignature:function(){},readDate:function(){var t=this.readInt(4);return new Date(1980+(t>>25&127),(t>>21&15)-1,t>>16&31,t>>11&31,t>>5&63,(31&t)<<1)}},e.exports=r},{"./utils":14}],5:[function(t,e,r){"use strict";r.base64=!1,r.binary=!1,r.dir=!1,r.date=null,r.compression=null},{}],6:[function(t,e,r){"use strict";var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,o=t("zlibjs/bin/rawdeflate.min").Zlib,n=t("zlibjs/bin/rawinflate.min").Zlib;r.uncompressInputType=i?"uint8array":"array",r.compressInputType=i?"uint8array":"array",r.magic="\b\0",r.compress=function(t){return new o.RawDeflate(t).compress()},r.uncompress=function(t){return new n.RawInflate(t).decompress()}},{"zlibjs/bin/rawdeflate.min":19,"zlibjs/bin/rawinflate.min":20}],7:[function(t,e){"use strict";function r(t,e){return this instanceof r?(this.files={},this.root="",t&&this.load(t,e),void(this.clone=function(){var t,e=new r;for(t in this)"function"!=typeof this[t]&&(e[t]=this[t]);return e})):new r(t,e)}(r.prototype=t("./object")).load=t("./load"),r.support=t("./support"),r.defaults=t("./defaults"),r.utils=t("./utils"),r.base64=t("./base64"),r.compressions=t("./compressions"),e.exports=r},{"./base64":1,"./compressions":3,"./defaults":5,"./load":8,"./object":9,"./support":12,"./utils":14}],8:[function(t,e){"use strict";var n=t("./base64"),s=t("./zipEntries");e.exports=function(t,e){var r,i,o;for((e=e||{}).base64&&(t=n.decode(t)),r=new s(t,e).files,i=0;i<r.length;i++)o=r[i],this.file(o.fileName,o.decompressed,{binary:!0,optimizedBinaryString:!0,date:o.date,dir:o.dir});return this}},{"./base64":1,"./zipEntries":15}],9:[function(t,e){"use strict";function r(t){var e;return t._data instanceof h&&(t._data=t._data.getContent(),t.options.binary=!0,t.options.base64=!1,"uint8array"===v.getTypeOf(t._data)&&(e=t._data,t._data=new Uint8Array(e.length),0!==e.length&&t._data.set(e,0))),t._data}function o(t){var e=r(t);if("string"!==v.getTypeOf(e))return e;if(!t.options.binary){if(a)return a.encode(e);if(c.nodebuffer)return u(e,"utf-8")}return t.asBinary()}function i(t){var e=r(this);return null==e?"":(this.options.base64&&(e=C.decode(e)),e=t&&this.options.binary?E.utf8decode(e):v.transformTo("string",e),e=t||this.options.binary?e:E.utf8encode(e))}function n(t,e,r){this.name=t,this._data=e,this.options=r}function d(t,e){for(var r="",i=0;i<e;i++)r+=String.fromCharCode(255&t),t>>>=8;return r}function s(t){return"/"!=t.slice(-1)&&(t+="/"),this.files[t]||b.call(this,t,null,{dir:!0}),this.files[t]}function f(t,e){var r,i=new h;return t._data instanceof h?(i.uncompressedSize=t._data.uncompressedSize,i.crc32=t._data.crc32,0===i.uncompressedSize||t.options.dir?(e=S.STORE,i.compressedContent="",i.crc32=0):t._data.compressionMethod===e.magic?i.compressedContent=t._data.getCompressedContent():(r=t._data.getContent(),i.compressedContent=e.compress(v.transformTo(e.compressInputType,r)))):((r=o(t))&&0!==r.length&&!t.options.dir||(e=S.STORE,r=""),i.uncompressedSize=r.length,i.crc32=this.crc32(r),i.compressedContent=e.compress(v.transformTo(e.compressInputType,r))),i.compressedSize=i.compressedContent.length,i.compressionMethod=e.magic,i}function g(t,e,r,i){r.compressedContent;var o,n=this.utf8encode(e.name),s=n!==e.name,a=e.options,l="",c=a.date.getHours(),a=(c=(c=((c<<=6)|a.date.getMinutes())<<5)|a.date.getSeconds()/2,o=a.date.getFullYear()-1980,o=(o=((o<<=4)|a.date.getMonth()+1)<<5)|a.date.getDate(),s&&(a=d(1,1)+d(this.crc32(n),4)+n,l+="up"+d(a.length,2)+a),""),a=(a=(a=(a=(a=(a=(a=(a=(a+="\n\0")+(s?"\0\b":"\0\0")+r.compressionMethod)+d(c,2))+d(o,2))+d(r.crc32,4))+d(r.compressedSize,4))+d(r.uncompressedSize,4))+d(n.length,2))+d(l.length,2);return{fileRecord:x.LOCAL_FILE_HEADER+a+n+l,dirRecord:x.CENTRAL_FILE_HEADER+"\0"+a+"\0\0\0\0\0\0"+(!0===e.options.dir?"\0\0\0":"\0\0\0\0")+d(i,4)+n+l,compressedObject:r}}function m(){this.data=[]}function y(t){this.data=new Uint8Array(t),this.index=0}var a,l,c=t("./support"),v=t("./utils"),x=t("./signature"),p=t("./defaults"),C=t("./base64"),S=t("./compressions"),h=t("./compressedObject"),u=t("./nodeBuffer"),_=(c.uint8array&&"function"==typeof TextEncoder&&"function"==typeof TextDecoder&&(a=new TextEncoder("utf-8"),l=new TextDecoder("utf-8")),n.prototype={asText:function(){return i.call(this,!0)},asBinary:function(){return i.call(this,!1)},asNodeBuffer:function(){var t=o(this);return v.transformTo("nodebuffer",t)},asUint8Array:function(){var t=o(this);return v.transformTo("uint8array",t)},asArrayBuffer:function(){return this.asUint8Array().buffer}},function(){for(var t,e={},r=0;r<arguments.length;r++)for(t in arguments[r])arguments[r].hasOwnProperty(t)&&void 0===e[t]&&(e[t]=arguments[r][t]);return e}),b=function(t,e,r){var i=0<(o=(i="/"==(i=t).slice(-1)?i.substring(0,i.length-1):i).lastIndexOf("/"))?i.substring(0,o):"",o=v.getTypeOf(e);if(i&&s.call(this,i),!0!==(i=(i=r)||{}).base64||null!==i.binary&&void 0!==i.binary||(i.binary=!0),(i=_(i,p)).date=i.date||new Date,null!==i.compression&&(i.compression=i.compression.toUpperCase()),(r=i).dir||null==e)r.base64=!1,r.binary=!1,e=null;else if("string"===o)r.binary&&!r.base64&&!0!==r.optimizedBinaryString&&(e=v.string2binary(e));else{if(r.base64=!1,r.binary=!0,!(o||e instanceof h))throw new Error("The data of '"+t+"' is in an unsupported format !");"arraybuffer"===o&&(e=v.transformTo("uint8array",e))}i=new n(t,e,r);return this.files[t]=i},E=(m.prototype={append:function(t){t=v.transformTo("string",t),this.data.push(t)},finalize:function(){return this.data.join("")}},y.prototype={append:function(t){0!==t.length&&(t=v.transformTo("uint8array",t),this.data.set(t,this.index),this.index+=t.length)},finalize:function(){return this.data}},{load:function(){throw new Error("Load method is not defined. Is the file jszip-load.js included ?")},filter:function(t){var e,r,i,o=[];for(e in this.files)this.files.hasOwnProperty(e)&&(i=this.files[e],i=new n(i.name,i._data,_(i.options)),r=e.slice(this.root.length,e.length),e.slice(0,this.root.length)===this.root&&t(r,i)&&o.push(i));return o},file:function(r,t,e){var i;return 1===arguments.length?v.isRegExp(r)?(i=r,this.filter(function(t,e){return!e.options.dir&&i.test(t)})):this.filter(function(t,e){return!e.options.dir&&t===r})[0]||null:(r=this.root+r,b.call(this,r,t,e),this)},folder:function(r){var t,e;return r?v.isRegExp(r)?this.filter(function(t,e){return e.options.dir&&r.test(t)}):(t=this.root+r,t=s.call(this,t),(e=this.clone()).root=t.name,e):this},remove:function(r){r=this.root+r;var t=this.files[r];if(t||("/"!=r.slice(-1)&&(r+="/"),t=this.files[r]),t)if(t.options.dir)for(var e=this.filter(function(t,e){return e.name.slice(0,r.length)===r}),i=0;i<e.length;i++)delete this.files[e[i].name];else delete this.files[r];return this},generate:function(t){t=_(t||{},{base64:!0,compression:"STORE",type:"base64"}),v.checkSupport(t.type);var e,r=[],i=0,o=0;for(e in this.files)if(this.files.hasOwnProperty(e)){var n=this.files[e],s=n.options.compression||t.compression.toUpperCase(),a=S[s];if(!a)throw new Error(s+" is not a valid compression method !");s=f.call(this,n,a),a=g.call(this,e,n,s,i);i+=a.fileRecord.length+s.compressedSize,o+=a.dirRecord.length,r.push(a)}for(var l=x.CENTRAL_DIRECTORY_END+"\0\0\0\0"+d(r.length,2)+d(r.length,2)+d(o,4)+d(i,4)+"\0\0",c=t.type.toLowerCase(),p="uint8array"===c||"arraybuffer"===c||"blob"===c||"nodebuffer"===c?new y(i+o+l.length):new m,h=0;h<r.length;h++)p.append(r[h].fileRecord),p.append(r[h].compressedObject.compressedContent);for(h=0;h<r.length;h++)p.append(r[h].dirRecord);p.append(l);var u=p.finalize();switch(t.type.toLowerCase()){case"uint8array":case"arraybuffer":case"nodebuffer":return v.transformTo(t.type.toLowerCase(),u);case"blob":return v.arrayBuffer2Blob(v.transformTo("arraybuffer",u));case"base64":return t.base64?C.encode(u):u;default:return u}},crc32:function(t,e){if(void 0===t||!t.length)return 0;var r="string"!==v.getTypeOf(t),i=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];void 0===e&&(e=0);e^=-1;for(var o=0,n=t.length;o<n;o++)e=e>>>8^i[255&(e^(r?t[o]:t.charCodeAt(o)))];return-1^e},utf8encode:function(t){var e;if(a)return e=a.encode(t),v.transformTo("string",e);if(c.nodebuffer)return v.transformTo("string",u(t,"utf-8"));for(var r=[],i=0,o=0;o<t.length;o++){var n=t.charCodeAt(o);n<128?r[i++]=String.fromCharCode(n):(127<n&&n<2048?r[i++]=String.fromCharCode(n>>6|192):(r[i++]=String.fromCharCode(n>>12|224),r[i++]=String.fromCharCode(n>>6&63|128)),r[i++]=String.fromCharCode(63&n|128))}return r.join("")},utf8decode:function(t){var e,r,i=[],o=0,n="string"!==v.getTypeOf(t),s=0,a=0;if(l)return l.decode(v.transformTo("uint8array",t));if(c.nodebuffer)return v.transformTo("nodebuffer",t).toString("utf-8");for(;s<t.length;)(e=n?t[s]:t.charCodeAt(s))<128?(i[o++]=String.fromCharCode(e),s++):191<e&&e<224?(a=n?t[s+1]:t.charCodeAt(s+1),i[o++]=String.fromCharCode((31&e)<<6|63&a),s+=2):(a=n?t[s+1]:t.charCodeAt(s+1),r=n?t[s+2]:t.charCodeAt(s+2),i[o++]=String.fromCharCode((15&e)<<12|(63&a)<<6|63&r),s+=3);return i.join("")}});e.exports=E},{"./base64":1,"./compressedObject":2,"./compressions":3,"./defaults":5,"./nodeBuffer":17,"./signature":10,"./support":12,"./utils":14}],10:[function(t,e,r){"use strict";r.LOCAL_FILE_HEADER="PK",r.CENTRAL_FILE_HEADER="PK",r.CENTRAL_DIRECTORY_END="PK",r.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",r.ZIP64_CENTRAL_DIRECTORY_END="PK",r.DATA_DESCRIPTOR="PK\b"},{}],11:[function(t,e){"use strict";function r(t,e){this.data=t,e||(this.data=o.string2binary(this.data)),this.length=this.data.length,this.index=0}var i=t("./dataReader"),o=t("./utils");(r.prototype=new i).byteAt=function(t){return this.data.charCodeAt(t)},r.prototype.lastIndexOfSignature=function(t){return this.data.lastIndexOf(t)},r.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.index,this.index+t);return this.index+=t,e},e.exports=r},{"./dataReader":4,"./utils":14}],12:[function(e,t,r){e=e("__browserify_process");if(r.base64=!0,r.array=!0,r.string=!0,r.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,r.nodebuffer=!e.browser,r.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)r.blob=!1;else{e=new ArrayBuffer(0);try{r.blob=0===new Blob([e],{type:"application/zip"}).size}catch(t){try{var i=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);i.append(e),r.blob=0===i.getBlob("application/zip").size}catch(t){r.blob=!1}}}},{__browserify_process:18}],13:[function(t,e){"use strict";function r(t){t&&(this.data=t,this.length=this.data.length,this.index=0)}t=t("./dataReader");(r.prototype=new t).byteAt=function(t){return this.data[t]},r.prototype.lastIndexOfSignature=function(t){for(var e=t.charCodeAt(0),r=t.charCodeAt(1),i=t.charCodeAt(2),o=t.charCodeAt(3),n=this.length-4;0<=n;--n)if(this.data[n]===e&&this.data[n+1]===r&&this.data[n+2]===i&&this.data[n+3]===o)return n;return-1},r.prototype.readData=function(t){this.checkOffset(t);var e=this.data.subarray(this.index,this.index+t);return this.index+=t,e},e.exports=r},{"./dataReader":4}],14:[function(t,e,c){"use strict";function r(t){return t}function i(t,e){for(var r=0;r<t.length;++r)e[r]=255&t.charCodeAt(r);return e}function o(t){var e=65536,r=[],i=t.length,o=c.getTypeOf(t),n=0,s=!0;try{switch(o){case"uint8array":String.fromCharCode.apply(null,new Uint8Array(0));break;case"nodebuffer":String.fromCharCode.apply(null,p(0))}}catch(t){s=!1}if(!s){for(var a="",l=0;l<t.length;l++)a+=String.fromCharCode(t[l]);return a}for(;n<i&&1<e;)try{r.push("array"===o||"nodebuffer"===o?String.fromCharCode.apply(null,t.slice(n,Math.min(n+e,i))):String.fromCharCode.apply(null,t.subarray(n,Math.min(n+e,i)))),n+=e}catch(t){e=Math.floor(e/2)}return r.join("")}function n(t,e){for(var r=0;r<t.length;r++)e[r]=t[r];return e}var s=t("./support"),a=t("./compressions"),p=t("./nodeBuffer"),l=(c.string2binary=function(t){for(var e="",r=0;r<t.length;r++)e+=String.fromCharCode(255&t.charCodeAt(r));return e},c.string2Uint8Array=function(t){return c.transformTo("uint8array",t)},c.uint8Array2String=function(t){return c.transformTo("string",t)},c.string2Blob=function(t){t=c.transformTo("arraybuffer",t);return c.arrayBuffer2Blob(t)},c.arrayBuffer2Blob=function(e){c.checkSupport("blob");try{return new Blob([e],{type:"application/zip"})}catch(t){try{var r=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);return r.append(e),r.getBlob("application/zip")}catch(t){throw new Error("Bug : can't construct the Blob.")}}},{});l.string={string:r,array:function(t){return i(t,new Array(t.length))},arraybuffer:function(t){return l.string.uint8array(t).buffer},uint8array:function(t){return i(t,new Uint8Array(t.length))},nodebuffer:function(t){return i(t,p(t.length))}},l.array={string:o,array:r,arraybuffer:function(t){return new Uint8Array(t).buffer},uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return p(t)}},l.arraybuffer={string:function(t){return o(new Uint8Array(t))},array:function(t){return n(new Uint8Array(t),new Array(t.byteLength))},arraybuffer:r,uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return p(new Uint8Array(t))}},l.uint8array={string:o,array:function(t){return n(t,new Array(t.length))},arraybuffer:function(t){return t.buffer},uint8array:r,nodebuffer:function(t){return p(t)}},l.nodebuffer={string:o,array:function(t){return n(t,new Array(t.length))},arraybuffer:function(t){return l.nodebuffer.uint8array(t).buffer},uint8array:function(t){return n(t,new Uint8Array(t.length))},nodebuffer:r},c.transformTo=function(t,e){if(e=e||"",!t)return e;c.checkSupport(t);var r=c.getTypeOf(e);return l[r][t](e)},c.getTypeOf=function(t){return"string"==typeof t?"string":"[object Array]"===Object.prototype.toString.call(t)?"array":s.nodebuffer&&p.test(t)?"nodebuffer":s.uint8array&&t instanceof Uint8Array?"uint8array":s.arraybuffer&&t instanceof ArrayBuffer?"arraybuffer":void 0},c.checkSupport=function(t){if(!s[t.toLowerCase()])throw new Error(t+" is not supported by this browser")},c.MAX_VALUE_16BITS=65535,c.MAX_VALUE_32BITS=-1,c.pretty=function(t){for(var e,r="",i=0;i<(t||"").length;i++)r+="\\x"+((e=t.charCodeAt(i))<16?"0":"")+e.toString(16).toUpperCase();return r},c.findCompression=function(t){for(var e in a)if(a.hasOwnProperty(e)&&a[e].magic===t)return a[e];return null},c.isRegExp=function(t){return"[object RegExp]"===Object.prototype.toString.call(t)}},{"./compressions":3,"./nodeBuffer":17,"./support":12}],15:[function(t,e){"use strict";function r(t,e){this.files=[],this.loadOptions=e,t&&this.load(t)}var i=t("./stringReader"),o=t("./nodeBufferReader"),n=t("./uint8ArrayReader"),s=t("./utils"),a=t("./signature"),l=t("./zipEntry"),c=t("./support");r.prototype={checkSignature:function(t){var e=this.reader.readString(4);if(e!==t)throw new Error("Corrupted zip or bug : unexpected signature ("+s.pretty(e)+", expected "+s.pretty(t)+")")},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2),this.zipComment=this.reader.readString(this.zipCommentLength)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.versionMadeBy=this.reader.readString(2),this.versionNeeded=this.reader.readInt(2),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var t,e,r,i=this.zip64EndOfCentralSize-44;0<i;)t=this.reader.readInt(2),e=this.reader.readInt(4),r=this.reader.readString(e),this.zip64ExtensibleData[t]={id:t,length:e,value:r}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){for(var t,e=0;e<this.files.length;e++)t=this.files[e],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),t.readLocalPart(this.reader),t.handleUTF8()},readCentralDir:function(){var t;for(this.reader.setIndex(this.centralDirOffset);this.reader.readString(4)===a.CENTRAL_FILE_HEADER;)(t=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(t)},readEndOfCentral:function(){var t=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(-1===t)throw new Error("Corrupted zip : can't find end of central directory");if(this.reader.setIndex(t),this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===s.MAX_VALUE_16BITS||this.diskWithCentralDirStart===s.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===s.MAX_VALUE_16BITS||this.centralDirRecords===s.MAX_VALUE_16BITS||this.centralDirSize===s.MAX_VALUE_32BITS||this.centralDirOffset===s.MAX_VALUE_32BITS){if(this.zip64=!0,-1===(t=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR)))throw new Error("Corrupted zip : can't find the ZIP64 end of central directory locator");this.reader.setIndex(t),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}},prepareReader:function(t){var e=s.getTypeOf(t);this.reader="string"!==e||c.uint8array?"nodebuffer"===e?new o(t):new n(s.transformTo("uint8array",t)):new i(t,this.loadOptions.optimizedBinaryString)},load:function(t){this.prepareReader(t),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},e.exports=r},{"./nodeBufferReader":17,"./signature":10,"./stringReader":11,"./support":12,"./uint8ArrayReader":13,"./utils":14,"./zipEntry":16}],16:[function(t,e){"use strict";function r(t,e){this.options=t,this.loadOptions=e}var i=t("./stringReader"),n=t("./utils"),o=t("./compressedObject"),s=t("./object");r.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},prepareCompressedContent:function(r,i,o){return function(){var t=r.index,e=(r.setIndex(i),r.readData(o));return r.setIndex(t),e}},prepareContent:function(t,e,r,i,o){return function(){var t=n.transformTo(i.uncompressInputType,this.getCompressedContent()),t=i.uncompress(t);if(t.length!==o)throw new Error("Bug : uncompressed data size mismatch");return t}},readLocalPart:function(t){var e;if(t.skip(22),this.fileNameLength=t.readInt(2),e=t.readInt(2),this.fileName=t.readString(this.fileNameLength),t.skip(e),-1==this.compressedSize||-1==this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize == -1 || uncompressedSize == -1)");if(null===(e=n.findCompression(this.compressionMethod)))throw new Error("Corrupted zip : compression "+n.pretty(this.compressionMethod)+" unknown (inner file : "+this.fileName+")");if(this.decompressed=new o,this.decompressed.compressedSize=this.compressedSize,this.decompressed.uncompressedSize=this.uncompressedSize,this.decompressed.crc32=this.crc32,this.decompressed.compressionMethod=this.compressionMethod,this.decompressed.getCompressedContent=this.prepareCompressedContent(t,t.index,this.compressedSize,e),this.decompressed.getContent=this.prepareContent(t,t.index,this.compressedSize,e,this.uncompressedSize),this.loadOptions.checkCRC32&&(this.decompressed=n.transformTo("string",this.decompressed.getContent()),s.crc32(this.decompressed)!==this.crc32))throw new Error("Corrupted zip : CRC32 mismatch")},readCentralPart:function(t){if(this.versionMadeBy=t.readString(2),this.versionNeeded=t.readInt(2),this.bitFlag=t.readInt(2),this.compressionMethod=t.readString(2),this.date=t.readDate(),this.crc32=t.readInt(4),this.compressedSize=t.readInt(4),this.uncompressedSize=t.readInt(4),this.fileNameLength=t.readInt(2),this.extraFieldsLength=t.readInt(2),this.fileCommentLength=t.readInt(2),this.diskNumberStart=t.readInt(2),this.internalFileAttributes=t.readInt(2),this.externalFileAttributes=t.readInt(4),this.localHeaderOffset=t.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");this.fileName=t.readString(this.fileNameLength),this.readExtraFields(t),this.parseZIP64ExtraField(t),this.fileComment=t.readString(this.fileCommentLength),this.dir=!!(16&this.externalFileAttributes)},parseZIP64ExtraField:function(){var t;this.extraFields[1]&&(t=new i(this.extraFields[1].value),this.uncompressedSize===n.MAX_VALUE_32BITS&&(this.uncompressedSize=t.readInt(8)),this.compressedSize===n.MAX_VALUE_32BITS&&(this.compressedSize=t.readInt(8)),this.localHeaderOffset===n.MAX_VALUE_32BITS&&(this.localHeaderOffset=t.readInt(8)),this.diskNumberStart===n.MAX_VALUE_32BITS&&(this.diskNumberStart=t.readInt(4)))},readExtraFields:function(t){var e,r,i,o=t.index;for(this.extraFields=this.extraFields||{};t.index<o+this.extraFieldsLength;)e=t.readInt(2),r=t.readInt(2),i=t.readString(r),this.extraFields[e]={id:e,length:r,value:i}},handleUTF8:function(){var t;this.useUTF8()?(this.fileName=s.utf8decode(this.fileName),this.fileComment=s.utf8decode(this.fileComment)):null!==(t=this.findExtraFieldUnicodePath())&&(this.fileName=t)},findExtraFieldUnicodePath:function(){var t,e=this.extraFields[28789];return!e||1!==(t=new i(e.value)).readInt(1)||s.crc32(this.fileName)!==t.readInt(4)?null:s.utf8decode(t.readString(e.length-5))}},e.exports=r},{"./compressedObject":2,"./object":9,"./stringReader":11,"./utils":14}],17:[function(){},{}],18:[function(t,e){var r,i,o,e=e.exports={};e.nextTick=(i="undefined"!=typeof window&&window.setImmediate,o="undefined"!=typeof window&&window.postMessage&&window.addEventListener,i?function(t){return window.setImmediate(t)}:o?(r=[],window.addEventListener("message",function(t){var e=t.source;e!==window&&null!==e||"process-tick"!==t.data||(t.stopPropagation(),0<r.length&&r.shift()())},!0),function(t){r.push(t),window.postMessage("process-tick","*")}):function(t){setTimeout(t,0)}),e.title="browser",e.browser=!0,e.env={},e.argv=[],e.binding=function(){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(){throw new Error("process.chdir is not supported")}},{}],19:[function(){!function(){"use strict";function t(t,e){var r,i=t.split("."),o=n;i[0]in o||!o.execScript||o.execScript("var "+i[0]);for(;i.length&&(r=i.shift());)i.length||e===rt?o=o[r]||(o[r]={}):o[r]=e}function Q(t,e){if(this.index="number"==typeof e?e:0,this.d=0,this.buffer=t instanceof(ot?Uint8Array:Array)?t:new(ot?Uint8Array:Array)(32768),2*this.buffer.length<=this.index)throw Error("invalid index");this.buffer.length<=this.index&&l(this)}function l(t){var e,r=t.buffer,i=r.length,o=new(ot?Uint8Array:Array)(i<<1);if(ot)o.set(r);else for(e=0;e<i;++e)o[e]=r[e];return t.buffer=o}function p(t){this.buffer=new(ot?Uint16Array:Array)(2*t),this.length=0}function e(t,e){this.e=nt,this.f=0,this.input=ot&&t instanceof Array?new Uint8Array(t):t,this.c=0,e&&(e.lazy&&(this.f=e.lazy),"number"==typeof e.compressionType&&(this.e=e.compressionType),e.outputBuffer&&(this.b=ot&&e.outputBuffer instanceof Array?new Uint8Array(e.outputBuffer):e.outputBuffer),"number"==typeof e.outputIndex&&(this.c=e.outputIndex)),this.b||(this.b=new(ot?Uint8Array:Array)(32768))}function x(t,e){this.length=t,this.g=e}function J(t,e){function r(t,e){var r,i,o,n=t.g,s=[],a=0,l=C[t.length];switch(s[a++]=65535&l,s[a++]=l>>16&255,s[a++]=l>>24,it){case 1===n:r=[0,n-1,0];break;case 2===n:r=[1,n-2,0];break;case 3===n:r=[2,n-3,0];break;case 4===n:r=[3,n-4,0];break;case n<=6:r=[4,n-5,1];break;case n<=8:r=[5,n-7,1];break;case n<=12:r=[6,n-9,2];break;case n<=16:r=[7,n-13,2];break;case n<=24:r=[8,n-17,3];break;case n<=32:r=[9,n-25,3];break;case n<=48:r=[10,n-33,4];break;case n<=64:r=[11,n-49,4];break;case n<=96:r=[12,n-65,5];break;case n<=128:r=[13,n-97,5];break;case n<=192:r=[14,n-129,6];break;case n<=256:r=[15,n-193,6];break;case n<=384:r=[16,n-257,7];break;case n<=512:r=[17,n-385,7];break;case n<=768:r=[18,n-513,8];break;case n<=1024:r=[19,n-769,8];break;case n<=1536:r=[20,n-1025,9];break;case n<=2048:r=[21,n-1537,9];break;case n<=3072:r=[22,n-2049,10];break;case n<=4096:r=[23,n-3073,10];break;case n<=6144:r=[24,n-4097,11];break;case n<=8192:r=[25,n-6145,11];break;case n<=12288:r=[26,n-8193,12];break;case n<=16384:r=[27,n-12289,12];break;case n<=24576:r=[28,n-16385,13];break;case n<=32768:r=[29,n-24577,13];break;default:throw"invalid distance"}for(l=r,s[a++]=l[0],s[+a]=l[1],s[5]=l[2],i=0,o=s.length;i<o;++i)d[f++]=s[i];m[s[0]]++,y[s[3]]++,g=t.length+e-1,p=null}var i,o,n,s,a,l,c,p,h,u={},d=ot?new Uint16Array(2*e.length):[],f=0,g=0,m=new(ot?Uint32Array:Array)(286),y=new(ot?Uint32Array:Array)(30),v=t.f;if(!ot){for(n=0;n<=285;)m[n++]=0;for(n=0;n<=29;)y[n++]=0}for(m[256]=1,i=0,o=e.length;i<o;++i){for(n=a=0,s=3;n<s&&i+n!==o;++n)a=a<<8|e[i+n];if(u[a]===rt&&(u[a]=[]),l=u[a],!(0<g--)){for(;0<l.length&&32768<i-l[0];)l.shift();if(o<=i+3){for(p&&r(p,-1),n=0,s=o-i;n<s;++n)h=e[i+n],d[f++]=h,++m[h];break}0<l.length?(c=function(t,e,r){var i,o,n,s,a,l,c=0,p=t.length;s=0,l=r.length;t:for(;s<l;s++){if(i=r[l-s-1],(n=3)<c){for(a=c;3<a;a--)if(t[i+a-1]!==t[e+a-1])continue t;n=c}for(;n<258&&e+n<p&&t[i+n]===t[e+n];)++n;if(c<n&&(o=i,c=n),258===n)break}return new x(c,e-o)}(e,i,l),p?p.length<c.length?(h=e[i-1],d[f++]=h,++m[h],r(c,0)):r(p,-1):c.length<v?p=c:r(c,0)):p?r(p,-1):(h=e[i],d[f++]=h,++m[h])}l.push(i)}return d[f++]=256,m[256]++,t.j=m,t.i=y,ot?d.subarray(0,f):d}function tt(t,e){var r,i,o,n,s,a=t.length,l=new p(572),c=new(ot?Uint8Array:Array)(a);if(!ot)for(n=0;n<a;n++)c[n]=0;for(n=0;n<a;++n)0<t[n]&&l.push(n,t[n]);if(r=Array(l.length/2),i=new(ot?Uint32Array:Array)(l.length/2),1===r.length)c[l.pop().index]=1;else{for(n=0,s=l.length/2;n<s;++n)r[n]=l.pop(),i[n]=r[n].value;for(o=function(t,i,e){var r,o,n,s,a,l=new(ot?Uint16Array:Array)(e),c=new(ot?Uint8Array:Array)(e),p=new(ot?Uint8Array:Array)(i),h=Array(e),u=Array(e),d=Array(e),f=(1<<e)-i,g=1<<e-1;for(l[e-1]=i,o=0;o<e;++o)f<g?c[o]=0:(c[o]=1,f-=g),f<<=1,l[e-2-o]=(l[e-1-o]/2|0)+i;for(l[0]=c[0],h[0]=Array(l[0]),u[0]=Array(l[0]),o=1;o<e;++o)l[o]>2*l[o-1]+c[o]&&(l[o]=2*l[o-1]+c[o]),h[o]=Array(l[o]),u[o]=Array(l[o]);for(r=0;r<i;++r)p[r]=e;for(n=0;n<l[e-1];++n)h[e-1][n]=t[n],u[e-1][n]=n;for(r=0;r<e;++r)d[r]=0;for(1===c[e-1]&&(--p[0],++d[e-1]),o=e-2;0<=o;--o){for(s=r=0,a=d[o+1],n=0;n<l[o];n++)(s=h[o+1][a]+h[o+1][a+1])>t[r]?(h[o][n]=s,u[o][n]=i,a+=2):(h[o][n]=t[r],u[o][n]=r,++r);d[o]=0,1===c[o]&&function t(e){var r=u[e][d[e]];r===i?(t(e+1),t(e+1)):--p[r],++d[e]}(o)}return p}(i,i.length,e),n=0,s=r.length;n<s;++n)c[r[n].index]=o[n]}return c}function et(t){for(var e,r,i=new(ot?Uint16Array:Array)(t.length),o=[],n=[],s=0,a=0,l=t.length;a<l;a++)o[t[a]]=1+(0|o[t[a]]);for(a=1,l=16;a<=l;a++)s=(n[a]=s)+(0|o[a])<<1;for(a=0,l=t.length;a<l;a++)for(s=n[t[a]],n[t[a]]+=1,e=i[a]=0,r=t[a];e<r;e++)i[a]=i[a]<<1|1&s,s>>>=1;return i}var rt=void 0,it=!0,n=this,ot="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;Q.prototype.a=function(t,e,r){var i,o=this.buffer,n=this.index,s=this.d,a=o[n];if(r&&1<e&&(t=8<e?(c[255&t]<<24|c[t>>>8&255]<<16|c[t>>>16&255]<<8|c[t>>>24&255])>>32-e:c[t]>>8-e),e+s<8)a=a<<e|t,s+=e;else for(i=0;i<e;++i)a=a<<1|t>>e-i-1&1,8==++s&&(s=0,o[n++]=c[a],a=0,n===o.length&&(o=l(this)));o[n]=a,this.buffer=o,this.d=s,this.index=n},Q.prototype.finish=function(){var t=this.buffer,e=this.index;return 0<this.d&&(t[e]<<=8-this.d,t[e]=c[t[e]],e++),ot?t.subarray(0,e):(t.length=e,t)};for(var r=new(ot?Uint8Array:Array)(256),i=0;i<256;++i){for(var o=a=i,s=7,a=a>>>1;a;a>>>=1)o=o<<1|1&a,--s;r[i]=(o<<s&255)>>>0}var c=r;p.prototype.getParent=function(t){return 2*((t-2)/4|0)},p.prototype.push=function(t,e){var r,i,o=this.buffer,n=this.length;for(o[this.length++]=e,o[this.length++]=t;0<n&&(r=this.getParent(n),o[n]>o[r]);)i=o[n],o[n]=o[r],o[r]=i,i=o[n+1],o[n+1]=o[r+1],o[r+1]=i,n=r;return this.length},p.prototype.pop=function(){var t,e,r,i=this.buffer,o=i[0],n=i[1];for(this.length-=2,i[0]=i[this.length],i[1]=i[this.length+1],r=0;!((e=2*r+2)>=this.length)&&(e+2<this.length&&i[e+2]>i[e]&&(e+=2),i[e]>i[r]);)t=i[r],i[r]=i[e],i[e]=t,t=i[r+1],i[r+1]=i[e+1],i[e+1]=t,r=e;return{index:n,value:o,length:this.length}};for(var nt=2,st=[],h=0;h<288;h++)switch(it){case h<=143:st.push([h+48,8]);break;case h<=255:st.push([h-144+400,9]);break;case h<=279:st.push([h-256,7]);break;case h<=287:st.push([h-280+192,8]);break;default:throw"invalid literal: "+h}e.prototype.h=function(){var t,e,N,r=this.input;switch(this.e){case 0:for(e=0,N=r.length;e<N;){var M,U,i=o=ot?r.subarray(e,e+65535):r.slice(e,e+65535),o=(e+=o.length)===N,n=rt,s=this.b,a=this.c;if(ot){for(s=new Uint8Array(this.b.buffer);s.length<=a+i.length+5;)s=new Uint8Array(s.length<<1);s.set(this.b)}if(s[a++]=0|(o?1:0),M=65536+~(o=i.length)&65535,s[a++]=255&o,s[a++]=o>>>8&255,s[a++]=255&M,s[a++]=M>>>8&255,ot)s.set(i,a),a+=i.length,s=s.subarray(0,a);else{for(n=0,U=i.length;n<U;++n)s[a++]=i[n];s.length=a}this.c=a,this.b=s}break;case 1:var l=new Q(ot?new Uint8Array(this.b.buffer):this.b,this.c);l.a(1,1,it),l.a(1,2,it);for(var c,p=J(this,r),h=0,z=p.length;h<z;h++)if(c=p[h],Q.prototype.a.apply(l,st[c]),256<c)l.a(p[++h],p[++h],it),l.a(p[++h],5),l.a(p[++h],p[++h],it);else if(256===c)break;this.b=l.finish(),this.c=this.b.length;break;case nt:var u,d,f,g,m,y,v,B,x,C,S,H,_=new Q(ot?new Uint8Array(this.b.buffer):this.b,this.c),W=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],$=Array(19),b=nt;for(_.a(1,1,it),_.a(b,2,it),u=J(this,r),b=et(m=tt(this.j,15)),F=et(y=tt(this.i,7)),d=286;257<d&&0===m[d-1];d--);for(f=30;1<f&&0===y[f-1];f--);for(var E,w,T,P,I,G=d,j=f,A=new(ot?Uint32Array:Array)(G+j),L=new(ot?Uint32Array:Array)(316),R=new(ot?Uint8Array:Array)(19),O=E=0;O<G;O++)A[E++]=m[O];for(O=0;O<j;O++)A[E++]=y[O];if(!ot)for(O=0,T=R.length;O<T;++O)R[O]=0;for(O=P=0,T=A.length;O<T;O+=E){for(E=1;O+E<T&&A[O+E]===A[O];++E);if(w=E,0===A[O])if(w<3)for(;0<w--;)R[L[P++]=0]++;else for(;0<w;)(I=w-3<(I=w<138?w:138)&&I<w?w-3:I)<=10?(L[P++]=17,L[P++]=I-3,R[17]++):(L[P++]=18,L[P++]=I-11,R[18]++),w-=I;else if(L[P++]=A[O],R[A[O]]++,--w<3)for(;0<w--;)L[P++]=A[O],R[A[O]]++;else for(;0<w;)w-3<(I=w<6?w:6)&&I<w&&(I=w-3),L[P++]=16,L[P++]=I-3,R[16]++,w-=I}for(t=ot?L.subarray(0,P):L.slice(0,P),v=tt(R,7),S=0;S<19;S++)$[S]=v[W[S]];for(g=19;4<g&&0===$[g-1];g--);for(B=et(v),_.a(d-257,5,it),_.a(f-1,5,it),_.a(g-4,4,it),S=0;S<g;S++)_.a($[S],3,it);for(S=0,H=t.length;S<H;S++)if(x=t[S],_.a(B[x],v[x],it),16<=x){switch(S++,x){case 16:C=2;break;case 17:C=3;break;case 18:C=7;break;default:throw"invalid code: "+x}_.a(t[S],C,it)}for(var D,q,b=[b,m],F=[F,y],V=b[0],K=b[1],X=F[0],Z=F[1],k=0,Y=u.length;k<Y;++k)if(D=u[k],_.a(V[D],K[D],it),256<D)_.a(u[++k],u[++k],it),q=u[++k],_.a(X[q],Z[q],it),_.a(u[++k],u[++k],it);else if(256===D)break;this.b=_.finish(),this.c=this.b.length;break;default:throw"invalid compression type"}return this.b};var u=function(){for(var t,e=[],r=3;r<=258;r++)t=function(t){switch(it){case 3===t:return[257,t-3,0];case 4===t:return[258,t-4,0];case 5===t:return[259,t-5,0];case 6===t:return[260,t-6,0];case 7===t:return[261,t-7,0];case 8===t:return[262,t-8,0];case 9===t:return[263,t-9,0];case 10===t:return[264,t-10,0];case t<=12:return[265,t-11,1];case t<=14:return[266,t-13,1];case t<=16:return[267,t-15,1];case t<=18:return[268,t-17,1];case t<=22:return[269,t-19,2];case t<=26:return[270,t-23,2];case t<=30:return[271,t-27,2];case t<=34:return[272,t-31,2];case t<=42:return[273,t-35,3];case t<=50:return[274,t-43,3];case t<=58:return[275,t-51,3];case t<=66:return[276,t-59,3];case t<=82:return[277,t-67,4];case t<=98:return[278,t-83,4];case t<=114:return[279,t-99,4];case t<=130:return[280,t-115,4];case t<=162:return[281,t-131,5];case t<=194:return[282,t-163,5];case t<=226:return[283,t-195,5];case t<=257:return[284,t-227,5];case 258===t:return[285,t-258,0];default:throw"invalid length: "+t}}(r),e[r]=t[2]<<24|t[1]<<16|t[0];return e}(),C=ot?new Uint32Array(u):u;t("Zlib.RawDeflate",e),t("Zlib.RawDeflate.prototype.compress",e.prototype.h);var d,f,g,m,y={NONE:0,FIXED:1,DYNAMIC:nt};if(Object.keys)d=Object.keys(y);else for(f in d=[],g=0,y)d[g++]=f;for(g=0,m=d.length;g<m;++g)t("Zlib.RawDeflate.CompressionType."+(f=d[g]),y[f])}.call(this)},{}],20:[function(){!function(){"use strict";function t(t,e){var r,i=t.split("."),o=n;i[0]in o||!o.execScript||o.execScript("var "+i[0]);for(;i.length&&(r=i.shift());)i.length||void 0===e?o=o[r]||(o[r]={}):o[r]=e}function v(t){for(var e,r,i,o,n,s,a,l,c,p=t.length,h=0,u=Number.POSITIVE_INFINITY,d=0;d<p;++d)t[d]>h&&(h=t[d]),t[d]<u&&(u=t[d]);for(e=1<<h,r=new(S?Uint32Array:Array)(e),i=1,o=0,n=2;i<=h;){for(d=0;d<p;++d)if(t[d]===i){for(a=o,l=s=0;l<i;++l)s=s<<1|1&a,a>>=1;for(c=i<<16|d,l=s;l<e;l+=n)r[l]=c;++o}++i,o<<=1,n<<=1}return[r,h,u]}function e(t,e){switch(this.g=[],this.h=32768,this.c=this.f=this.d=this.k=0,this.input=S?new Uint8Array(t):t,this.l=!1,this.i=1,this.q=!1,e?(e.index&&(this.d=e.index),e.bufferSize&&(this.h=e.bufferSize),e.bufferType&&(this.i=e.bufferType),e.resize&&(this.q=e.resize)):e={},this.i){case 0:this.a=32768,this.b=new(S?Uint8Array:Array)(32768+this.h+258);break;case 1:this.a=0,this.b=new(S?Uint8Array:Array)(this.h),this.e=this.v,this.m=this.s,this.j=this.t;break;default:throw Error("invalid inflate mode")}}function x(t,e){for(var r,i=t.f,o=t.c,n=t.input,s=t.d,a=n.length;o<e;){if(a<=s)throw Error("input buffer is broken");i|=n[s++]<<o,o+=8}return r=i&(1<<e)-1,t.f=i>>>e,t.c=o-e,t.d=s,r}function C(t,e){for(var r=t.f,i=t.c,o=t.input,n=t.d,s=o.length,a=e[0],l=e[1];i<l&&!(s<=n);)r|=o[n++]<<i,i+=8;return e=a[r&(1<<l)-1],t.f=r>>(a=e>>>16),t.c=i-a,t.d=n,65535&e}var n=this,S="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;e.prototype.u=function(){for(;!this.l;){var t=x(this,3);switch(1&t&&(this.l=!0),t>>>=1){case 0:var e=this.input,r=this.d,i=this.b,o=this.a,n=e.length,s=void 0,a=i.length,l=void 0;if(this.c=this.f=0,n<=r+1)throw Error("invalid uncompressed block header: LEN");if(s=e[r++]|e[r++]<<8,n<=r+1)throw Error("invalid uncompressed block header: NLEN");if(s===~(e[r++]|e[r++]<<8))throw Error("invalid uncompressed block header: length verify");if(r+s>e.length)throw Error("input buffer is broken");switch(this.i){case 0:for(;o+s>i.length;){if(s-=l=a-o,S)i.set(e.subarray(r,r+l),o),o+=l,r+=l;else for(;l--;)i[o++]=e[r++];this.a=o,i=this.e(),o=this.a}break;case 1:for(;o+s>i.length;)i=this.e({o:2});break;default:throw Error("invalid inflate mode")}if(S)i.set(e.subarray(r,r+s),o),o+=s,r+=s;else for(;s--;)i[o++]=e[r++];this.d=r,this.a=o,this.b=i;break;case 1:this.j(b,E);break;case 2:m=g=f=d=y=p=c=n=h=void 0;for(var c,p,h=this,u=function(t,e,r){for(var i,o,n=this.p,s=0;s<t;)switch(i=C(this,e)){case 16:for(o=3+x(this,2);o--;)r[s++]=n;break;case 17:for(o=3+x(this,3);o--;)r[s++]=0;n=0;break;case 18:for(o=11+x(this,7);o--;)r[s++]=0;n=0;break;default:n=r[s++]=i}return this.p=n,r},d=x(h,5)+257,f=x(h,5)+1,g=x(h,4)+4,m=new(S?Uint8Array:Array)(_.length),y=0;y<g;++y)m[_[y]]=x(h,3);if(!S)for(y=g,g=m.length;y<g;++y)m[_[y]]=0;n=v(m),c=new(S?Uint8Array:Array)(d),p=new(S?Uint8Array:Array)(f),h.p=0,h.j(v(u.call(h,d,n,c)),v(u.call(h,f,n,p)));break;default:throw Error("unknown BTYPE: "+t)}}return this.m()};for(var r=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],_=S?new Uint16Array(r):r,r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],c=S?new Uint16Array(r):r,r=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],p=S?new Uint8Array(r):r,r=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],h=S?new Uint16Array(r):r,r=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],u=S?new Uint8Array(r):r,i=new(S?Uint8Array:Array)(288),o=0,s=i.length;o<s;++o)i[o]=o<=143?8:o<=255?9:o<=279?7:8;for(var b=v(i),a=new(S?Uint8Array:Array)(30),l=0,d=a.length;l<d;++l)a[l]=5;var E=v(a);e.prototype.j=function(t,e){var r=this.b,i=this.a;this.n=t;for(var o,n,s,a,l=r.length-258;256!==(o=C(this,t));)if(o<256)l<=i&&(this.a=i,r=this.e(),i=this.a),r[i++]=o;else for(a=c[n=o-257],0<p[n]&&(a+=x(this,p[n])),o=C(this,e),s=h[o],0<u[o]&&(s+=x(this,u[o])),l<=i&&(this.a=i,r=this.e(),i=this.a);a--;)r[i]=r[i++-s];for(;8<=this.c;)this.c-=8,this.d--;this.a=i},e.prototype.t=function(t,e){var r=this.b,i=this.a;this.n=t;for(var o,n,s,a,l=r.length;256!==(o=C(this,t));)if(o<256)l<=i&&(l=(r=this.e()).length),r[i++]=o;else for(a=c[n=o-257],0<p[n]&&(a+=x(this,p[n])),o=C(this,e),s=h[o],0<u[o]&&(s+=x(this,u[o])),l<i+a&&(l=(r=this.e()).length);a--;)r[i]=r[i++-s];for(;8<=this.c;)this.c-=8,this.d--;this.a=i},e.prototype.e=function(){var t,e,r=new(S?Uint8Array:Array)(this.a-32768),i=this.a-32768,o=this.b;if(S)r.set(o.subarray(32768,r.length));else for(t=0,e=r.length;t<e;++t)r[t]=o[t+32768];if(this.g.push(r),this.k+=r.length,S)o.set(o.subarray(i,32768+i));else for(t=0;t<32768;++t)o[t]=o[i+t];return this.a=32768,o},e.prototype.v=function(t){var e,r=this.input.length/this.d+1|0,i=this.input,o=this.b;return t&&("number"==typeof t.o&&(r=t.o),"number"==typeof t.r&&(r+=t.r)),i=r<2?(t=(i.length-this.d)/this.n[2]/2*258|0)<o.length?o.length+t:o.length<<1:o.length*r,S?(e=new Uint8Array(i)).set(o):e=o,this.b=e},e.prototype.m=function(){var t,e,r,i,o,n=0,s=this.b,a=this.g,l=new(S?Uint8Array:Array)(this.k+(this.a-32768));if(0===a.length)return S?this.b.subarray(32768,this.a):this.b.slice(32768,this.a);for(e=0,r=a.length;e<r;++e)for(i=0,o=(t=a[e]).length;i<o;++i)l[n++]=t[i];for(e=32768,r=this.a;e<r;++e)l[n++]=s[e];return this.g=[],this.buffer=l},e.prototype.s=function(){var t,e=this.a;return S?this.q?(t=new Uint8Array(e)).set(this.b.subarray(0,e)):t=this.b.subarray(0,e):(this.b.length>e&&(this.b.length=e),t=this.b),this.buffer=t},t("Zlib.RawInflate",e),t("Zlib.RawInflate.prototype.decompress",e.prototype.u);var f,g,m,y,w={ADAPTIVE:1,BLOCK:0};if(Object.keys)f=Object.keys(w);else for(g in f=[],m=0,w)f[m++]=g;for(m=0,y=f.length;m<y;++m)t("Zlib.RawInflate.BufferType."+(g=f[m]),w[g])}.call(this)},{}]},{},[7])(7)}),Element.prototype.scrollIntoViewIfNeeded||(Element.prototype.scrollIntoViewIfNeeded=function(t){t=0===arguments.length||!!t;var e=this.parentNode,r=window.getComputedStyle(e,null),i=parseInt(r.getPropertyValue("border-top-width")),r=parseInt(r.getPropertyValue("border-left-width")),o=this.offsetTop-e.offsetTop<e.scrollTop,n=this.offsetTop-e.offsetTop+this.clientHeight-i>e.scrollTop+e.clientHeight,s=this.offsetLeft-e.offsetLeft<e.scrollLeft,a=this.offsetLeft-e.offsetLeft+this.clientWidth-r>e.scrollLeft+e.clientWidth,l=o&&!n;(o||n)&&t&&(e.scrollTop=this.offsetTop-e.offsetTop-e.clientHeight/2-i+this.clientHeight/2),(s||a)&&t&&(e.scrollLeft=this.offsetLeft-e.offsetLeft-e.clientWidth/2-r+this.clientWidth/2),(o||n||s||a)&&!t&&this.scrollIntoView(l)}),!function(h,u){"use strict";function t(){var t,i,a,l;function c(t,e){this.scrollLeft=t,this.scrollTop=e}function o(t){if("object"!=typeof t||void 0===t.behavior||"auto"===t.behavior||"instant"===t.behavior)return 1;if("object"!=typeof t||"smooth"!==t.behavior)throw new TypeError("behavior not valid")}function p(t){t.frame=h.requestAnimationFrame(p.bind(h,t));var e=l(),e=1<(e=(e-t.startTime)/i)?1:e,e=.5*(1-Math.cos(Math.PI*e)),r=t.startX+(t.x-t.startX)*e,e=t.startY+(t.y-t.startY)*e;t.method.call(t.scrollable,r,e),r===t.x&&e===t.y&&h.cancelAnimationFrame(t.frame)}function n(t,e,r){var i,o,n,s=l(),t=t===u.body?(o=(i=h).scrollX||h.pageXOffset,n=h.scrollY||h.pageYOffset,a.scroll):(o=(i=t).scrollLeft,n=t.scrollTop,c);p({scrollable:i,method:t,startTime:s,startX:o,startY:n,x:e,y:r,frame:void 0})}"scrollBehavior"in u.documentElement.style||(t=h.HTMLElement||h.Element,i=468,a={scroll:h.scroll||h.scrollTo,scrollBy:h.scrollBy,scrollIntoView:t.prototype.scrollIntoView},l=h.performance&&h.performance.now?h.performance.now.bind(h.performance):Date.now,h.scroll=h.scrollTo=function(){o(arguments[0])?a.scroll.call(h,arguments[0].left||arguments[0],arguments[0].top||arguments[1]):n.call(h,u.body,~~arguments[0].left,~~arguments[0].top)},h.scrollBy=function(){o(arguments[0])?a.scrollBy.call(h,arguments[0].left||arguments[0],arguments[0].top||arguments[1]):n.call(h,u.body,~~arguments[0].left+(h.scrollX||h.pageXOffset),~~arguments[0].top+(h.scrollY||h.pageYOffset))},t.prototype.scrollIntoView=function(){var t,e,r;o(arguments[0])?a.scrollIntoView.call(this,arguments[0]||!0):(e=(t=function(t){for(;(t=t.parentNode)!==u.body&&!(t.clientHeight<t.scrollHeight||t.clientWidth<t.scrollWidth););return t}(this)).getBoundingClientRect(),r=this.getBoundingClientRect(),t!==u.body?(n.call(this,t,t.scrollLeft+r.left-e.left,t.scrollTop+r.top-e.top),h.scrollBy({left:e.left,top:e.top,behavior:"smooth"})):h.scrollBy({left:r.left,top:r.top,behavior:"smooth"}))})}"object"==typeof exports?module.exports={polyfill:t}:t()}(window,document),!function(bt,Et){var wt={beforeShow:e,move:e,change:e,show:e,hide:e,color:!1,flat:!1,showInput:!1,showButtons:!0,clickoutFiresChange:!1,showInitial:!1,showPalette:!1,showPaletteOnly:!1,showSelectionPalette:!0,localStorageKey:!1,appendTo:"body",maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",preferredFormat:!1,className:"",showAlpha:!1,theme:"sp-light",palette:["fff","000"],selectionPalette:[],disabled:!1},Tt=[],Pt=!!/msie/i.exec(bt.navigator.userAgent),It=((s=document.createElement("div").style).cssText="background-color:rgba(0,0,0,.5)",t(s.backgroundColor,"rgba")||t(s.backgroundColor,"hsla")),Dt=["<div class='sp-replacer'>","<div class='sp-preview'><div class='sp-preview-inner'></div></div>","<div class='sp-dd'>&#9660;</div>","</div>"].join(""),Ft=function(){var t="";if(Pt)for(var e=1;e<=6;e++)t+="<div class='sp-"+e+"'></div>";return["<div class='sp-container sp-hidden'>","<div class='sp-palette-container'>","<div class='sp-palette sp-thumb sp-cf'></div>","</div>","<div class='sp-picker-container'>","<div class='sp-top sp-cf'>","<div class='sp-fill'></div>","<div class='sp-top-inner'>","<div class='sp-color'>","<div class='sp-sat'>","<div class='sp-val'>","<div class='sp-dragger'></div>","</div>","</div>","</div>","<div class='sp-hue'>","<div class='sp-slider'></div>",t,"</div>","</div>","<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div>","</div>","<div class='sp-input-container sp-cf'>","<input class='sp-input' type='text' spellcheck='false'  />","</div>","<div class='sp-initial sp-thumb sp-cf'></div>","<div class='sp-button-container sp-cf'>","<a class='sp-cancel' href='#'></a>","<button class='sp-choose'></button>","</div>","</div>","</div>"].join("")}();function t(t,e){return!!~(""+t).indexOf(e)}function At(t,e,r){for(var i=[],o=0;o<t.length;o++){var n=Ot(t[o]),s=n.toHsl().l<.5?"sp-thumb-el sp-thumb-dark":"sp-thumb-el sp-thumb-light",a=(s+=Ot.equals(e,t[o])?" sp-thumb-active":"",It?"background-color:"+n.toRgbString():"filter:"+n.toFilter());i.push('<span title="'+n.toRgbString()+'" data-color="'+n.toRgbString()+'" class="'+s+'"><span class="sp-thumb-inner" style="'+a+';" /></span>')}return"<div class='sp-cf "+r+"'>"+i.join("")+"</div>"}function p(t,e){e=e,n=t,(e=Et.extend({},wt,e)).callbacks={move:Lt(e.move,n),change:Lt(e.change,n),show:Lt(e.show,n),hide:Lt(e.hide,n),beforeShow:Lt(e.beforeShow,n)};var N,M,U,r,s=e,i=s.flat,z=s.showSelectionPalette,o=s.localStorageKey,n=s.theme,a=s.callbacks,B=(N=F,function(){var t=this,e=arguments;U&&clearTimeout(r),!U&&r||(r=setTimeout(function(){r=null,N.apply(t,e)},M))}),l=!(M=10),c=0,p=0,h=0,u=0,H=0,W=0,$=0,d=0,f=0,g=0,m=1,e=s.palette.slice(0),y=Et.isArray(e[0])?e:[e],v=s.selectionPalette.slice(0),G=s.maxSelectionSize,j="sp-dragging",x=null,C=t.ownerDocument,S=(C.body,Et(t)),q=!1,_=Et(Ft,C).addClass(n),V=_.find(".sp-color"),K=_.find(".sp-dragger"),X=_.find(".sp-hue"),Z=_.find(".sp-slider"),b=_.find(".sp-alpha-inner"),Y=_.find(".sp-alpha"),Q=_.find(".sp-alpha-handle"),E=_.find(".sp-input"),J=_.find(".sp-palette"),tt=_.find(".sp-initial"),e=_.find(".sp-cancel"),t=_.find(".sp-choose"),et=S.is("input"),rt=et&&!i,w=rt?Et(Dt).addClass(n).addClass(s.className):Et([]),T=rt?w:S,it=w.find(".sp-preview-inner"),n=s.color||et&&S.val(),P=!1,ot=s.preferredFormat,I=ot,nt=!s.showButtons||s.clickoutFiresChange;function st(){s.showPaletteOnly&&(s.showPalette=!0),_.toggleClass("sp-flat",i),_.toggleClass("sp-input-disabled",!s.showInput),_.toggleClass("sp-alpha-enabled",s.showAlpha),_.toggleClass("sp-buttons-disabled",!s.showButtons),_.toggleClass("sp-palette-disabled",!s.showPalette),_.toggleClass("sp-palette-only",s.showPaletteOnly),_.toggleClass("sp-initial-disabled",!s.showInitial),_.addClass(s.className),F()}function at(t){if(z){t=Ot(t).toRgbString();if(-1===Et.inArray(t,v))for(v.push(t);v.length>G;)v.shift();if(o&&bt.localStorage)try{bt.localStorage[o]=v.join(";")}catch(t){}}}function lt(){var r=R(),t=Et.map(y,function(t,e){return At(t,r,"sp-palette-row sp-palette-row-"+e)});v&&t.push(At(function(){var t,e=[],r=v,i={};if(s.showPalette){for(var o=0;o<y.length;o++)for(var n=0;n<y[o].length;n++)i[t=Ot(y[o][n]).toRgbString()]=!0;for(o=0;o<r.length;o++)t=Ot(r[o]).toRgbString(),i.hasOwnProperty(t)||(e.push(r[o]),i[t]=!0)}return e.reverse().slice(0,s.maxSelectionSize)}(),r,"sp-palette-row sp-palette-row-selection")),J.html(t.join(""))}function ct(){var t,e;s.showInitial&&(t=P,e=R(),tt.html(At([t,e],e,"sp-palette-row-initial")))}function pt(){(p<=0||c<=0||u<=0)&&F(),_.addClass(j),x=null}function ht(){_.removeClass(j)}function ut(){var t=Ot(E.val());t.ok?L(t):E.addClass("sp-validation-error")}function dt(){(l?A:ft)()}function ft(){var t=Et.Event("beforeShow.spectrum");if(l)F();else if(P=R(),S.trigger(t,[P]),!1!==a.beforeShow(P)&&!t.isDefaultPrevented()){L(P);for(var e=0;e<Tt.length;e++)Tt[e]&&Tt[e].hide();l=!0,Et(C).bind("mousedown.spectrum",gt),i||Et(C).bind("mouseup.spectrum",mt),Et(bt).bind("resize.spectrum",B),w.addClass("sp-active"),_.removeClass("sp-hidden"),s.showPalette&&lt(),F(),D(),ct(),a.show(P),S.trigger("show.spectrum",[P])}}function gt(t){var e=Et(t.target);e.parents().is(_)||e.is(_)||A(t)}function mt(t){Ot.equals(R(),P)||(nt&&"cancel"!==t?vt(!0):L(P,!0))}function A(t){t&&"click"==t.type&&2==t.button||l&&!i&&(l=!1,Et(C).unbind("mousedown.spectrum",gt),Et(C).unbind("mouseup.spectrum",mt),Et(bt).unbind("resize.spectrum",B),w.removeClass("sp-active"),_.addClass("sp-hidden"),mt(t),at(R()),a.hide(R()),S.trigger("hide.spectrum",[R()]))}function L(t,e){var r;Ot.equals(t,R())||(r=(t=Ot(t)).toHsv(),d=r.h%360/360,f=r.s,g=r.v,m=r.a,D(),t.ok&&!e&&(I=ot||t.format))}function R(t){return t=t||{},Ot.fromRatio({h:d,s:f,v:g,a:Math.round(100*m)/100},{format:t.format||I})}function O(){D(),a.move(R()),S.trigger("move.spectrum",[R()])}function D(){E.removeClass("sp-validation-error"),yt();var t,e=Ot.fromRatio({h:d,s:1,v:1}),e=(V.css("background-color",e.toHexString()),I),e=(m<1&&("hex"!==I&&"hex3"!==I&&"hex6"!==I&&"name"!==I||(e="rgb")),R({format:e})),r=e.toHexString(),i=e.toRgbString();It||1===e.alpha?it.css("background-color",i):(it.css("background-color","transparent"),it.css("filter",e.toFilter())),s.showAlpha&&((i=e.toRgb()).a=0,t="linear-gradient(left, "+(i=Ot(i).toRgbString())+", "+r+")",Pt?b.css("filter",Ot(i).toFilter({gradientType:1},r)):(b.css("background","-webkit-"+t),b.css("background","-moz-"+t),b.css("background","-ms-"+t),b.css("background",t))),s.showInput&&(i=pxtr.UserSettings.get(pxtr.UserSettings.COLOR_FORMAT),E.val(e.toString(i))),s.showPalette&&lt(),ct()}function yt(){var t=f*c,e=p-g*p,t=Math.max(-h/2,Math.min(c-h/2,t-h/2)),e=Math.max(-h/2,Math.min(p-h/2,e-h/2)),e=(K.css({top:e,left:t}),m*H),t=(Q.css({left:e-W/2}),d*u);Z.css({top:t-$/2})}function vt(t){var e=R(),r=(et&&S.val(e.toString(I)),!Ot.equals(e,P));P=e,t&&r&&(a.change(e),S.trigger("change",[e]))}function F(){c=V.width(),p=V.height(),h=K.height()+4,X.width(),u=X.height(),$=Z.height()+4,H=Y.width(),W=Q.width(),i||(_.css("position","absolute"),_.offset(function(t,e){var r=t.outerWidth(),i=t.outerHeight(),o=e.outerHeight(),n=t[0].ownerDocument,s=n.documentElement,a=s.clientWidth+Et(n).scrollLeft(),s=s.clientHeight+Et(n).scrollTop(),n=e.offset();n.top+=o,Math.min(n.left,n.left+r>a&&r<a)?(n.left-=Math.abs(n.left+r-a),t.attr("data-x-position","right")):(n.left-=0,t.attr("data-x-position","left"));Math.min(n.top,n.top+i>s&&i<s)?(n.top-=Math.abs(+(i+o)),t.attr("data-y-position","top")):(n.top-=0,t.attr("data-y-position","bottom"));return n}(_,T))),yt()}function xt(){A(),q=!0,S.attr("disabled",!0),T.addClass("sp-disabled")}if(Pt&&_.find("*:not(input)").attr("unselectable","on"),st(),rt&&S.after(w).hide(),i?S.after(_).hide():(k=1!==(k="parent"===s.appendTo?S.parent():Et(s.appendTo)).length?Et("body"):k).append(_),o&&bt.localStorage){try{var Ct=bt.localStorage[o].split(",#");1<Ct.length&&(delete bt.localStorage[o],Et.each(Ct,function(t,e){at(e)}))}catch(t){}try{v=bt.localStorage[o].split(";")}catch(t){}}function St(t){return(t.data&&t.data.ignore?(L(Et(this).data("color")),O):(L(Et(this).data("color")),vt(!0),O(),A))(),!1}T.bind("click.spectrum touchstart.spectrum",function(t){q||dt(),t.stopPropagation(),Et(t.target).is("input")||t.preventDefault()}),!S.is(":disabled")&&!0!==s.disabled||xt(),_.click(kt),E.change(ut),E.bind("paste",function(){setTimeout(ut,1)}),E.keydown(function(t){13==t.keyCode&&ut()}),e.text(s.cancelText),e.bind("click.spectrum",function(t){t.stopPropagation(),t.preventDefault(),A("cancel")}),t.text(s.chooseText),t.bind("click.spectrum",function(t){t.stopPropagation(),t.preventDefault(),E.hasClass("sp-validation-error")||(vt(!0),A())}),Rt(Y,function(t,e,r){m=t/H,r.shiftKey&&(m=Math.round(10*m)/10),O()}),Rt(X,function(t,e){d=parseFloat(e/u),O()},pt,ht),Rt(V,function(t,e,r){r.shiftKey?x||(r=f*c,i=p-g*p,r=Math.abs(t-r)>Math.abs(e-i),x=r?"x":"y"):x=null;var i=!x||"x"===x,r=!x||"y"===x;i&&(f=parseFloat(t/c)),r&&(g=parseFloat((p-e)/p)),O()},pt,ht),n?(L(n),D(),I=ot||Ot(n).format,at(n)):D(),i&&ft();var k=Pt?"mousedown.spectrum":"click.spectrum touchstart.spectrum",_t=(J.delegate(".sp-thumb-el",k,St),tt.delegate(".sp-thumb-el:nth-child(1)",k,{ignore:!0},St),{show:ft,hide:A,toggle:dt,reflow:F,option:function(t,e){return void 0===t?Et.extend({},s):void 0===e?s[t]:(s[t]=e,void st())},enable:function(){q=!1,S.attr("disabled",!1),T.removeClass("sp-disabled")},disable:xt,set:function(t){L(t),vt()},get:R,destroy:function(){S.show(),T.unbind("click.spectrum touchstart.spectrum"),_.remove(),w.remove(),Tt[_t.id]=null},container:_});return _t.id=Tt.push(_t)-1,_t}function e(){}function kt(t){t.stopPropagation()}function Lt(t,e){var r=Array.prototype.slice,i=r.call(arguments,2);return function(){return t.apply(e,i.concat(r.call(arguments)))}}function Rt(i,o,r,t){o=o||function(){},r=r||function(){},t=t||function(){};var n=i.ownerDocument||document,s=!1,a={},l=0,c=0,p="ontouchstart"in bt,h={};function u(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault(),t.returnValue=!1}function d(t){if(s){if(Pt&&document.documentMode<9&&!t.button)return f();var e=t.originalEvent.touches,r=(e?e[0]:t).pageX,e=(e?e[0]:t).pageY,r=Math.max(0,Math.min(r-a.left,c)),e=Math.max(0,Math.min(e-a.top,l));p&&u(t),o.apply(i,[r,e,t])}}function f(){s&&(Et(n).unbind(h),Et(n.body).removeClass("sp-dragging"),t.apply(i,arguments)),s=!1}h.selectstart=u,h.dragstart=u,h["touchmove mousemove"]=d,h["touchend mouseup"]=f,Et(i).bind("touchstart mousedown",function(t){var e=t.which?3==t.which:2==t.button;t.originalEvent.touches,e||s||!1!==r.apply(i,arguments)&&(s=!0,l=Et(i).height(),c=Et(i).width(),a=Et(i).offset(),Et(n).bind(h),Et(n.body).addClass("sp-dragging"),p||d(t),u(t))})}var n,h,r,u,o,d,f,i,g,m,s,a,y,l="spectrum.id";function v(t,s){var a,l,c,p,i,e;return s=s||{},"object"==typeof(t=t||"")&&t.hasOwnProperty("_tc_id")?t:(t=function(t){var e={r:0,g:0,b:0},r=1,i=!1,o=!1;"string"==typeof t&&(t=function(t){t=t.replace(n,"").replace(h,"").toLowerCase();var e,r=!1;if(g[t])t=g[t],r=!0;else if("transparent"==t)return{r:0,g:0,b:0,a:0,format:"name"};if(e=y.rgb.exec(t))return{r:e[1],g:e[2],b:e[3]};if(e=y.rgba.exec(t))return{r:e[1],g:e[2],b:e[3],a:e[4]};if(e=y.hsl.exec(t))return{h:e[1],s:e[2],l:e[3]};if(e=y.hsla.exec(t))return{h:e[1],s:e[2],l:e[3],a:e[4]};if(e=y.hsv.exec(t))return{h:e[1],s:e[2],v:e[3]};if(e=y.hex6.exec(t))return{r:E(e[1]),g:E(e[2]),b:E(e[3]),format:r?"name":"hex"};if(e=y.hex3.exec(t))return{r:E(e[1]+""+e[1]),g:E(e[2]+""+e[2]),b:E(e[3]+""+e[3]),format:r?"name":"hex"};return!1}(t));"object"==typeof t&&(t.hasOwnProperty("r")&&t.hasOwnProperty("g")&&t.hasOwnProperty("b")?(e=function(t,e,r){return{r:255*b(t,255),g:255*b(e,255),b:255*b(r,255)}}(t.r,t.g,t.b),i=!0,o="%"===String(t.r).substr(-1)?"prgb":"rgb"):t.hasOwnProperty("h")&&t.hasOwnProperty("s")&&t.hasOwnProperty("v")?(t.s=T(t.s),t.v=T(t.v),e=function(t,e,r){t=6*b(t,360),e=b(e,100),r=b(r,100);var i=u.floor(t),t=t-i,o=r*(1-e),n=r*(1-t*e),t=r*(1-(1-t)*e),e=i%6;return{r:255*[r,n,o,o,t,r][e],g:255*[t,r,r,n,o,o][e],b:255*[o,o,t,r,r,n][e]}}(t.h,t.s,t.v),i=!0,o="hsv"):t.hasOwnProperty("h")&&t.hasOwnProperty("s")&&t.hasOwnProperty("l")&&(t.s=T(t.s),t.l=T(t.l),e=function(t,e,r){var i,o,n;function s(t,e,r){return r<0&&(r+=1),1<r&&--r,r<1/6?t+6*(e-t)*r:r<.5?e:r<2/3?t+(e-t)*(2/3-r)*6:t}t=b(t,360),e=b(e,100),r=b(r,100),0===e?i=o=n=r:(i=s(e=2*r-(r=r<.5?r*(1+e):r+e-r*e),r,t+1/3),o=s(e,r,t),n=s(e,r,t-1/3));return{r:255*i,g:255*o,b:255*n}}(t.h,t.s,t.l),i=!0,o="hsl"),t.hasOwnProperty("a")&&(r=t.a));return r=_(r),{ok:i,format:t.format||o,r:d(255,f(e.r,0)),g:d(255,f(e.g,0)),b:d(255,f(e.b,0)),a:r}}(t),a=t.r,l=t.g,c=t.b,p=t.a,i=o(100*p)/100,e=s.format||t.format,a<1&&(a=o(a)),l<1&&(l=o(l)),c<1&&(c=o(c)),{ok:t.ok,format:e,_tc_id:r++,alpha:p,getAlpha:function(){return p},setAlpha:function(t){p=_(t),i=o(100*p)/100},toHsv:function(){var t=C(a,l,c);return{h:360*t.h,s:t.s,v:t.v,a:p}},toHsvString:function(){var t=C(a,l,c),e=o(360*t.h),r=o(100*t.s),t=o(100*t.v);return 1==p?"hsv("+e+", "+r+"%, "+t+"%)":"hsva("+e+", "+r+"%, "+t+"%, "+i+")"},toHsl:function(){var t=x(a,l,c);return{h:360*t.h,s:t.s,l:t.l,a:p}},toHslString:function(){var t=x(a,l,c),e=o(360*t.h),r=o(100*t.s),t=o(100*t.l);return 1==p?"hsl("+e+", "+r+"%, "+t+"%)":"hsla("+e+", "+r+"%, "+t+"%, "+i+")"},toHex:function(t){return S(a,l,c,t)},toHexString:function(t){return"#"+S(a,l,c,t)},toRgb:function(){return{r:o(a),g:o(l),b:o(c),a:p}},toRgbString:function(){return 1==p?"rgb("+o(a)+", "+o(l)+", "+o(c)+")":"rgba("+o(a)+", "+o(l)+", "+o(c)+", "+i+")"},toPercentageRgb:function(){return{r:o(100*b(a,255))+"%",g:o(100*b(l,255))+"%",b:o(100*b(c,255))+"%",a:p}},toPercentageRgbString:function(){return 1==p?"rgb("+o(100*b(a,255))+"%, "+o(100*b(l,255))+"%, "+o(100*b(c,255))+"%)":"rgba("+o(100*b(a,255))+"%, "+o(100*b(l,255))+"%, "+o(100*b(c,255))+"%, "+i+")"},toName:function(){return 0===p?"transparent":m[S(a,l,c,!0)]||!1},toFilter:function(t){var e=S(a,l,c),r=e,i=Math.round(255*parseFloat(p)).toString(16),o=i,n=s&&s.gradientType?"GradientType = 1, ":"";return t&&(r=(t=v(t)).toHex(),o=Math.round(255*parseFloat(t.alpha)).toString(16)),"progid:DXImageTransform.Microsoft.gradient("+n+"startColorstr=#"+w(i)+e+",endColorstr=#"+w(o)+r+")"},toString:function(t){var e=!!t,r=(t=t||this.format,!1),e=!e&&p<1&&0<p&&("hex"===t||"hex6"===t||"hex3"===t||"name"===t);return"rgb"===t&&(r=this.toRgbString()),"prgb"===t&&(r=this.toPercentageRgbString()),"hex"!==t&&"hex6"!==t||(r=this.toHexString()),"hex3"===t&&(r=this.toHexString(!0)),"name"===t&&(r=this.toName()),"hsl"===t&&(r=this.toHslString()),"hsv"===t&&(r=this.toHsvString()),e?this.toRgbString():r||this.toHexString()}})}function x(t,e,r){t=b(t,255),e=b(e,255),r=b(r,255);var i,o=f(t,e,r),n=d(t,e,r),s=(o+n)/2;if(o==n)i=l=0;else{var a=o-n,l=.5<s?a/(2-o-n):a/(o+n);switch(o){case t:i=(e-r)/a+(e<r?6:0);break;case e:i=(r-t)/a+2;break;case r:i=(t-e)/a+4}i/=6}return{h:i,s:l,l:s}}function C(t,e,r){t=b(t,255),e=b(e,255),r=b(r,255);var i,o=f(t,e,r),n=d(t,e,r),s=o,a=o-n,l=0===o?0:a/o;if(o==n)i=0;else{switch(o){case t:i=(e-r)/a+(e<r?6:0);break;case e:i=(r-t)/a+2;break;case r:i=(t-e)/a+4}i/=6}return{h:i,s:l,v:s}}function S(t,e,r,i){t=[w(o(t).toString(16)),w(o(e).toString(16)),w(o(r).toString(16))];return i&&t[0].charAt(0)==t[0].charAt(1)&&t[1].charAt(0)==t[1].charAt(1)&&t[2].charAt(0)==t[2].charAt(1)?t[0].charAt(0)+t[1].charAt(0)+t[2].charAt(0):t.join("")}function _(t){return t=parseFloat(t),t=isNaN(t)||t<0||1<t?1:t}function b(t,e){"string"==typeof(r=t)&&-1!=r.indexOf(".")&&1===parseFloat(r)&&(t="100%");var r="string"==typeof(r=t)&&-1!=r.indexOf("%");return t=d(e,f(0,parseFloat(t))),r&&(t=parseInt(t*e,10)/100),u.abs(t-e)<1e-6?1:t%e/parseFloat(e)}function c(t){return d(1,f(0,t))}function E(t){return parseInt(t,16)}function w(t){return 1==t.length?"0"+t:""+t}function T(t){return t=t<=1?100*t+"%":t}Et.fn.spectrum=function(r,t){var i,o;return"string"==typeof r?(i=this,o=Array.prototype.slice.call(arguments,1),this.each(function(){var t=Tt[Et(this).data(l)];if(t){var e=t[r];if(!e)throw new Error("Spectrum: no such method: '"+r+"'");"get"==r?i=t.get():"container"==r?i=t.container:"option"==r?i=t.option.apply(t,o):"destroy"==r?(t.destroy(),Et(this).removeData(l)):e.apply(t,o)}}),i):this.spectrum("destroy").each(function(){var t=p(this,r);Et(this).data(l,t.id)})},Et.fn.spectrum.load=!0,Et.fn.spectrum.loadOpts={},Et.fn.spectrum.draggable=Rt,Et.fn.spectrum.defaults=wt,Et.spectrum={},Et.spectrum.localization={},Et.spectrum.palettes={},Et.fn.spectrum.processNativeColorInputs=function(){var t=Et("<input type='color' value='!' />")[0];"color"===t.type&&"!"!=t.value||Et("input[type=color]").spectrum({preferredFormat:"hex6"})},n=/^[\s,#]+/,h=/\s+$/,r=0,u=Math,o=u.round,d=u.min,f=u.max,i=u.random,v.fromRatio=function(t,e){if("object"==typeof t){var r,i={};for(r in t)t.hasOwnProperty(r)&&(i[r]="a"===r?t[r]:T(t[r]));t=i}return v(t,e)},v.equals=function(t,e){return!(!t||!e)&&v(t).toRgbString()==v(e).toRgbString()},v.random=function(){return v.fromRatio({r:i(),g:i(),b:i()})},v.desaturate=function(t,e){e=0===e?0:e||10;t=v(t).toHsl();return t.s-=e/100,t.s=c(t.s),v(t)},v.saturate=function(t,e){e=0===e?0:e||10;t=v(t).toHsl();return t.s+=e/100,t.s=c(t.s),v(t)},v.greyscale=function(t){return v.desaturate(t,100)},v.lighten=function(t,e){e=0===e?0:e||10;t=v(t).toHsl();return t.l+=e/100,t.l=c(t.l),v(t)},v.darken=function(t,e){e=0===e?0:e||10;t=v(t).toHsl();return t.l-=e/100,t.l=c(t.l),v(t)},v.complement=function(t){t=v(t).toHsl();return t.h=(t.h+180)%360,v(t)},v.triad=function(t){var e=v(t).toHsl(),r=e.h;return[v(t),v({h:(r+120)%360,s:e.s,l:e.l}),v({h:(r+240)%360,s:e.s,l:e.l})]},v.tetrad=function(t){var e=v(t).toHsl(),r=e.h;return[v(t),v({h:(r+90)%360,s:e.s,l:e.l}),v({h:(r+180)%360,s:e.s,l:e.l}),v({h:(r+270)%360,s:e.s,l:e.l})]},v.splitcomplement=function(t){var e=v(t).toHsl(),r=e.h;return[v(t),v({h:(r+72)%360,s:e.s,l:e.l}),v({h:(r+216)%360,s:e.s,l:e.l})]},v.analogous=function(t,e,r){e=e||6,r=r||30;var i=v(t).toHsl(),o=360/r,n=[v(t)];for(i.h=(i.h-(o*e>>1)+720)%360;--e;)i.h=(i.h+o)%360,n.push(v(i));return n},v.monochromatic=function(t,e){e=e||6;for(var t=v(t).toHsv(),r=t.h,i=t.s,o=t.v,n=[],s=1/e;e--;)n.push(v({h:r,s:i,v:o})),o=(o+s)%1;return n},v.readability=function(t,e){var t=v(t).toRgb(),e=v(e).toRgb(),r=(299*t.r+587*t.g+114*t.b)/1e3,i=(299*e.r+587*e.g+114*e.b)/1e3,t=Math.max(t.r,e.r)-Math.min(t.r,e.r)+Math.max(t.g,e.g)-Math.min(t.g,e.g)+Math.max(t.b,e.b)-Math.min(t.b,e.b);return{brightness:Math.abs(r-i),color:t}},v.readable=function(t,e){t=v.readability(t,e);return 125<t.brightness&&500<t.color},v.mostReadable=function(t,e){for(var r=null,i=0,o=!1,n=0;n<e.length;n++){var s=v.readability(t,e[n]),a=125<s.brightness&&500<s.color,s=s.brightness/125*3+s.color/500;(a&&!o||a&&o&&i<s||!a&&!o&&i<s)&&(o=a,i=s,r=v(e[n]))}return r},g=v.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},m=v.hexNames=function(t){var e,r={};for(e in t)t.hasOwnProperty(e)&&(r[t[e]]=e);return r}(g),a="[\\s|\\(]+("+(s="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)")+")[,|\\s]+("+s+")[,|\\s]+("+s+")\\s*\\)?",s="[\\s|\\(]+("+s+")[,|\\s]+("+s+")[,|\\s]+("+s+")[,|\\s]+("+s+")\\s*\\)?",y={rgb:new RegExp("rgb"+a),rgba:new RegExp("rgba"+s),hsl:new RegExp("hsl"+a),hsla:new RegExp("hsla"+s),hsv:new RegExp("hsv"+a),hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/},bt.tinycolor=v;var Ot=bt.tinycolor;Et(function(){Et.fn.spectrum.load&&Et.fn.spectrum.processNativeColorInputs()})}(window,jQuery),!function(t){"use strict";if("function"==typeof bootstrap)bootstrap("promise",t);else if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else if("undefined"!=typeof ses)ses.ok()&&(ses.makeQ=t);else{if("undefined"==typeof self)throw new Error("This environment was not anticipated by Q. Please file a bug.");self.Q=t()}}(function(){"use strict";var a=!1;try{throw new Error}catch(t){a=!!t.stack}function e(){}var n,t,r,i,o,s,l,c,p,N=S();s=o={task:void 0,next:null},c=void 0,p=l=!1,t=function(t){s=s.next={task:t,domain:p&&process.domain,next:null},l||(l=!0,c())},c="undefined"!=typeof process&&process.nextTick?(p=!0,function(){process.nextTick(h)}):"function"==typeof setImmediate?"undefined"!=typeof window?setImmediate.bind(window,h):function(){setImmediate(h)}:"undefined"!=typeof MessageChannel?((r=new MessageChannel).port1.onmessage=function(){c=i,(r.port1.onmessage=h)()},i=function(){r.port2.postMessage(0)},function(){setTimeout(h,0),i()}):function(){setTimeout(h,0)};function h(){for(;o.next;){var t=(o=o.next).task,e=(o.task=void 0,o.domain);e&&(o.domain=void 0,e.enter());try{t()}catch(t){if(p)throw e&&e.exit(),setTimeout(h,0),e&&e.enter(),t;setTimeout(function(){throw t},0)}e&&e.exit()}l=!1}var M=Function.call;function u(t){return function(){return M.apply(t,arguments)}}var d=u(Array.prototype.slice),f=u(Array.prototype.reduce||function(t,e){var r=0,i=this.length;if(1===arguments.length)for(;;){if(r in this){e=this[r++];break}if(++r>=i)throw new TypeError}for(;r<i;r++)r in this&&(e=t(e,this[r],r));return e}),U=u(Array.prototype.indexOf||function(t){for(var e=0;e<this.length;e++)if(this[e]===t)return e;return-1}),g=u(Array.prototype.map||function(i,o){var n=this,s=[];return f(n,function(t,e,r){s.push(i.call(o,e,r,n))},void 0),s}),m=Object.create||function(t){function e(){}return e.prototype=t,new e},z=u(Object.prototype.hasOwnProperty),B=Object.keys||function(t){var e,r=[];for(e in t)z(t,e)&&r.push(e);return r},H=u(Object.prototype.toString);var y="undefined"!=typeof ReturnValue?ReturnValue:function(t){this.value=t},v="From previous event:";function x(t,e){if(a&&e.stack&&"object"==typeof t&&null!==t&&t.stack&&-1===t.stack.indexOf(v)){for(var r=[],i=e;i;i=i.source)i.stack&&r.unshift(i.stack);r.unshift(t.stack);e=r.join("\n"+v+"\n");t.stack=function(t){for(var e=t.split("\n"),r=[],i=0;i<e.length;++i){var o=e[i];!function(t){var e,t=C(t);return t&&(e=t[0],t=t[1],e===n&&N<=t&&t<=Y)}(o)&&!function(t){return-1!==t.indexOf("(module.js:")||-1!==t.indexOf("(node.js:")}(o)&&o&&r.push(o)}return r.join("\n")}(e)}}function C(t){var e=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(t);return(e=e||/at ([^ ]+):(\d+):(?:\d+)$/.exec(t))?[e[1],Number(e[2])]:(e=/.*@(.+):(\d+)$/.exec(t))?[e[1],Number(e[2])]:void 0}function S(){if(a)try{throw new Error}catch(t){var e=t.stack.split("\n"),e=C(0<e[0].indexOf("@")?e[1]:e[2]);if(e)return n=e[0],e[1]}}function _(t){return t instanceof w?t:G(t)?(e=t,r=b(),_.nextTick(function(){try{e.then(r.resolve,r.reject,r.notify)}catch(t){r.reject(t)}}),r.promise):F(t);var e,r}function b(){var o,n=[],s=[],t=m(b.prototype),e=m(w.prototype);if(e.promiseDispatch=function(t,e,r){var i=d(arguments);n?(n.push(i),"when"===e&&r[1]&&s.push(r[1])):_.nextTick(function(){o.promiseDispatch.apply(o,i)})},e.valueOf=function(){var t;return n?e:(P(t=$(o))&&(o=t),t)},e.inspect=function(){return o?o.inspect():{state:"pending"}},_.longStackSupport&&a)try{throw new Error}catch(t){e.stack=t.stack.substring(t.stack.indexOf("\n")+1)}function r(r){o=r,e.source=r,f(n,function(t,e){_.nextTick(function(){r.promiseDispatch.apply(r,e)})},void 0),s=n=void 0}return t.promise=e,t.resolve=function(t){o||r(_(t))},t.fulfill=function(t){o||r(F(t))},t.reject=function(t){o||r(D(t))},t.notify=function(r){o||f(s,function(t,e){_.nextTick(function(){e(r)})},void 0)},t}function E(t){if("function"!=typeof t)throw new TypeError("resolver must be a function.");var e=b();try{t(e.resolve,e.reject,e.notify)}catch(t){e.reject(t)}return e.promise}function W(o){return E(function(t,e){for(var r=0,i=o.length;r<i;r++)_(o[r]).then(t,e)})}function w(o,n,e){void 0===n&&(n=function(t){return D(new Error("Promise does not support operation: "+t))}),void 0===e&&(e=function(){return{state:"unknown"}});var t,s=m(w.prototype);return s.promiseDispatch=function(t,e,r){var i;try{i=o[e]?o[e].apply(s,r):n.call(s,e,r)}catch(t){i=D(t)}t&&t(i)},(s.inspect=e)&&("rejected"===(t=e()).state&&(s.exception=t.reason),s.valueOf=function(){var t=e();return"pending"===t.state||"rejected"===t.state?s:t.value}),s}function T(t,e,r,i){return _(t).then(e,r,i)}function $(t){if(P(t)){var e=t.inspect();if("fulfilled"===e.state)return e.value}return t}function P(t){return t instanceof w}function G(t){return t===Object(t)&&"function"==typeof t.then}(_.resolve=_).nextTick=t,_.longStackSupport=!1,"object"==typeof process&&process&&process.env&&process.env.Q_DEBUG&&(_.longStackSupport=!0),(_.defer=b).prototype.makeNodeResolver=function(){var r=this;return function(t,e){t?r.reject(t):2<arguments.length?r.resolve(d(arguments,1)):r.resolve(e)}},_.Promise=E,(_.promise=E).race=W,E.all=k,E.reject=D,(E.resolve=_).passByCopy=function(t){return t},w.prototype.passByCopy=function(){return this},_.join=function(t,e){return _(t).join(e)},w.prototype.join=function(t){return _([this,t]).spread(function(t,e){if(t===e)return t;throw new Error("Can't join: not the same: "+t+" "+e)})},_.race=W,w.prototype.race=function(){return this.then(_.race)},(_.makePromise=w).prototype.toString=function(){return"[object Promise]"},w.prototype.then=function(e,r,o){var i=this,n=b(),s=!1;return _.nextTick(function(){i.promiseDispatch(function(t){s||(s=!0,n.resolve(function(t){try{return"function"==typeof e?e(t):t}catch(t){return D(t)}}(t)))},"when",[function(t){s||(s=!0,n.resolve(function(t){if("function"==typeof r){x(t,i);try{return r(t)}catch(t){return D(t)}}return D(t)}(t)))}])}),i.promiseDispatch(void 0,"when",[void 0,function(t){var e,r,i=!1;try{r=t,e="function"==typeof o?o(r):r}catch(t){if(i=!0,!_.onerror)throw t;_.onerror(t)}i||n.notify(e)}]),n.promise},_.tap=function(t,e){return _(t).tap(e)},w.prototype.tap=function(e){return e=_(e),this.then(function(t){return e.fcall(t).thenResolve(t)})},_.when=T,w.prototype.thenResolve=function(t){return this.then(function(){return t})},_.thenResolve=function(t,e){return _(t).thenResolve(e)},w.prototype.thenReject=function(t){return this.then(function(){throw t})},_.thenReject=function(t,e){return _(t).thenReject(e)},_.nearer=$,_.isPromise=P,_.isPromiseAlike=G,_.isPending=function(t){return P(t)&&"pending"===t.inspect().state},w.prototype.isPending=function(){return"pending"===this.inspect().state},_.isFulfilled=function(t){return!P(t)||"fulfilled"===t.inspect().state},w.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},_.isRejected=function(t){return P(t)&&"rejected"===t.inspect().state},w.prototype.isRejected=function(){return"rejected"===this.inspect().state};var I,j,q,A=[],L=[],R=!0;function O(){A.length=0,L.length=0,R=R||!0}function D(r){var t,e,i=w({when:function(t){var e;return t&&(e=this,R&&-1!==(e=U(L,e))&&(L.splice(e,1),A.splice(e,1))),t?t(r):this}},function(){return this},function(){return{state:"rejected",reason:r}});return t=i,e=r,R&&(L.push(t),e&&void 0!==e.stack?A.push(e.stack):A.push("(no stack) "+e)),i}function F(r){return w({when:function(){return r},get:function(t){return r[t]},set:function(t,e){r[t]=e},delete:function(t){delete r[t]},post:function(t,e){return null==t?r.apply(void 0,e):r[t].apply(r,e)},apply:function(t,e){return r.apply(t,e)},keys:function(){return B(r)}},void 0,function(){return{state:"fulfilled",value:r}})}function V(t,e,r){return _(t).spread(e,r)}function K(t,e,r){return _(t).dispatch(e,r)}function k(t){return T(t,function(o){var n=0,s=b();return f(o,function(t,e,r){var i;P(e)&&"fulfilled"===(i=e.inspect()).state?o[r]=i.value:(++n,T(e,function(t){o[r]=t,0==--n&&s.resolve(o)},s.reject,function(t){s.notify({index:r,value:t})}))},void 0),0===n&&s.resolve(o),s.promise})}function X(o){var n,s;return 0===o.length?_.resolve():(n=_.defer(),f(o,function(t,e,r){var i=o[r];s++,T(i,function(t){n.resolve(t)},function(){0==--s&&n.reject(new Error("Can't get fulfillment value from any promise, all promises were rejected."))},function(t){n.notify({index:r,value:t})})},void(s=0)),n.promise)}function Z(t){return T(t,function(t){return t=g(t,_),T(k(g(t,function(t){return T(t,e,e)})),function(){return t})})}_.resetUnhandledRejections=O,_.getUnhandledReasons=function(){return A.slice()},_.stopUnhandledRejectionTracking=function(){O(),R=!1},O(),_.reject=D,_.fulfill=F,_.master=function(r){return w({isDef:function(){}},function(t,e){return K(r,t,e)},function(){return _(r).inspect()})},_.spread=V,w.prototype.spread=function(e,t){return this.all().then(function(t){return e.apply(void 0,t)},t)},_.async=function(e){return function(){function t(e,t){var r;if("undefined"==typeof StopIteration){try{r=i[e](t)}catch(t){return D(t)}return r.done?_(r.value):T(r.value,o,n)}try{r=i[e](t)}catch(t){return"[object StopIteration]"===H(e=t)||e instanceof y?_(t.value):D(t)}return T(r,o,n)}var i=e.apply(this,arguments),o=t.bind(t,"next"),n=t.bind(t,"throw");return o()}},_.spawn=function(t){_.done(_.async(t)())},_.return=function(t){throw new y(t)},_.promised=function(r){return function(){return V([this,k(arguments)],function(t,e){return r.apply(t,e)})}},_.dispatch=K,w.prototype.dispatch=function(t,e){var r=this,i=b();return _.nextTick(function(){r.promiseDispatch(i.resolve,t,e)}),i.promise},_.get=function(t,e){return _(t).dispatch("get",[e])},w.prototype.get=function(t){return this.dispatch("get",[t])},_.set=function(t,e,r){return _(t).dispatch("set",[e,r])},w.prototype.set=function(t,e){return this.dispatch("set",[t,e])},_.del=_.delete=function(t,e){return _(t).dispatch("delete",[e])},w.prototype.del=w.prototype.delete=function(t){return this.dispatch("delete",[t])},_.mapply=_.post=function(t,e,r){return _(t).dispatch("post",[e,r])},w.prototype.mapply=w.prototype.post=function(t,e){return this.dispatch("post",[t,e])},_.send=_.mcall=_.invoke=function(t,e){return _(t).dispatch("post",[e,d(arguments,2)])},w.prototype.send=w.prototype.mcall=w.prototype.invoke=function(t){return this.dispatch("post",[t,d(arguments,1)])},_.fapply=function(t,e){return _(t).dispatch("apply",[void 0,e])},w.prototype.fapply=function(t){return this.dispatch("apply",[void 0,t])},_.try=_.fcall=function(t){return _(t).dispatch("apply",[void 0,d(arguments,1)])},w.prototype.fcall=function(){return this.dispatch("apply",[void 0,d(arguments)])},_.fbind=function(t){var e=_(t),r=d(arguments,1);return function(){return e.dispatch("apply",[this,r.concat(d(arguments))])}},w.prototype.fbind=function(){var t=this,e=d(arguments);return function(){return t.dispatch("apply",[this,e.concat(d(arguments))])}},_.keys=function(t){return _(t).dispatch("keys",[])},w.prototype.keys=function(){return this.dispatch("keys",[])},_.all=k,w.prototype.all=function(){return k(this)},_.any=X,w.prototype.any=function(){return X(this)},_.allResolved=(I=Z,j="allResolved",q="allSettled",function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(j+" is deprecated, use "+q+" instead.",new Error("").stack),I.apply(I,arguments)}),w.prototype.allResolved=function(){return Z(this)},_.allSettled=function(t){return _(t).allSettled()},w.prototype.allSettled=function(){return this.then(function(t){return k(g(t,function(t){function e(){return t.inspect()}return(t=_(t)).then(e,e)}))})},_.fail=_.catch=function(t,e){return _(t).then(void 0,e)},w.prototype.fail=w.prototype.catch=function(t){return this.then(void 0,t)},_.progress=function(t,e){return _(t).then(void 0,void 0,e)},w.prototype.progress=function(t){return this.then(void 0,void 0,t)},_.fin=_.finally=function(t,e){return _(t).finally(e)},w.prototype.fin=w.prototype.finally=function(e){return e=_(e),this.then(function(t){return e.fcall().then(function(){return t})},function(t){return e.fcall().then(function(){throw t})})},_.done=function(t,e,r,i){return _(t).done(e,r,i)},w.prototype.done=function(t,e,r){var i=function(t){_.nextTick(function(){if(x(t,o),!_.onerror)throw t;_.onerror(t)})},o=t||e||r?this.then(t,e,r):this;"object"==typeof process&&process&&process.domain&&(i=process.domain.bind(i)),o.then(void 0,i)},_.timeout=function(t,e,r){return _(t).timeout(e,r)},w.prototype.timeout=function(t,e){var r=b(),i=setTimeout(function(){e&&"string"!=typeof e||((e=new Error(e||"Timed out after "+t+" ms")).code="ETIMEDOUT"),r.reject(e)},t);return this.then(function(t){clearTimeout(i),r.resolve(t)},function(t){clearTimeout(i),r.reject(t)},r.notify),r.promise},_.delay=function(t,e){return void 0===e&&(e=t,t=void 0),_(t).delay(e)},w.prototype.delay=function(r){return this.then(function(t){var e=b();return setTimeout(function(){e.resolve(t)},r),e.promise})},_.nfapply=function(t,e){return _(t).nfapply(e)},w.prototype.nfapply=function(t){var e=b(),t=d(t);return t.push(e.makeNodeResolver()),this.fapply(t).fail(e.reject),e.promise},_.nfcall=function(t){var e=d(arguments,1);return _(t).nfapply(e)},w.prototype.nfcall=function(){var t=d(arguments),e=b();return t.push(e.makeNodeResolver()),this.fapply(t).fail(e.reject),e.promise},_.nfbind=_.denodeify=function(r){var i=d(arguments,1);return function(){var t=i.concat(d(arguments)),e=b();return t.push(e.makeNodeResolver()),_(r).fapply(t).fail(e.reject),e.promise}},w.prototype.nfbind=w.prototype.denodeify=function(){var t=d(arguments);return t.unshift(this),_.denodeify.apply(void 0,t)},_.nbind=function(r,i){var o=d(arguments,2);return function(){var t=o.concat(d(arguments)),e=b();return t.push(e.makeNodeResolver()),_(function(){return r.apply(i,arguments)}).fapply(t).fail(e.reject),e.promise}},w.prototype.nbind=function(){var t=d(arguments,0);return t.unshift(this),_.nbind.apply(void 0,t)},_.nmapply=_.npost=function(t,e,r){return _(t).npost(e,r)},w.prototype.nmapply=w.prototype.npost=function(t,e){var e=d(e||[]),r=b();return e.push(r.makeNodeResolver()),this.dispatch("post",[t,e]).fail(r.reject),r.promise},_.nsend=_.nmcall=_.ninvoke=function(t,e){var r=d(arguments,2),i=b();return r.push(i.makeNodeResolver()),_(t).dispatch("post",[e,r]).fail(i.reject),i.promise},w.prototype.nsend=w.prototype.nmcall=w.prototype.ninvoke=function(t){var e=d(arguments,1),r=b();return e.push(r.makeNodeResolver()),this.dispatch("post",[t,e]).fail(r.reject),r.promise},_.nodeify=function(t,e){return _(t).nodeify(e)},w.prototype.nodeify=function(e){if(!e)return this;this.then(function(t){_.nextTick(function(){e(null,t)})},function(t){_.nextTick(function(){e(t)})})};var Y=S();return _}),!function(){var t=$.namespace("pxtr.rendering");t.DrawingLoop=function(){this.requestAnimationFrame=this.getRequestAnimationFrameShim_(),this.isRunning=!1,this.previousTime=0,this.callbacks=[],this.loop_=this.loop_.bind(this)},t.DrawingLoop.prototype.addCallback=function(t,e,r){t={fn:t,scope:e,args:r};return this.callbacks.push(t),t},t.DrawingLoop.prototype.removeCallback=function(t){t=this.callbacks.indexOf(t);-1!=t&&this.callbacks.splice(t,1)},t.DrawingLoop.prototype.start=function(){this.isRunning=!0,this.loop_()},t.DrawingLoop.prototype.loop_=function(){var t=Date.now(),e=t-this.previousTime;this.executeCallbacks_(e),this.previousTime=t,this.requestAnimationFrame.call(window,this.loop_)},t.DrawingLoop.prototype.executeCallbacks_=function(t){for(var e=0;e<this.callbacks.length;e++){var r=this.callbacks[e];r.fn.call(r.scope,t,r.args)}},t.DrawingLoop.prototype.stop=function(){this.isRunning=!1},t.DrawingLoop.prototype.getRequestAnimationFrameShim_=function(){return window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}}(),!function(){var r=$.namespace("pxtr.model"),i=0,o=(r.Frame=function(t,e){if(!t||!e)throw"Bad arguments in pxtr.model.Frame constructor : "+t+", "+e;this.width=t,this.height=e,this.id=i++,this.version=0,this.pixels=r.Frame.createEmptyPixelGrid_(t,e),this.stateIndex=0},r.Frame.fromPixelGrid=function(t,e,r){if(t.length){if(t[0].length)for(var i=t.length,o=t[0].length,n=[],s=0;s<o;s++)for(var a=0;a<i;a++)"string"==typeof t[a][s]?n[s*i+a]=pxtr.utils.colorToInt(t[a][s]):n[s*i+a]=t[a][s];else{if(!e||!r)throw"Bad arguments in pxtr.model.frame.fromPixelGrid, missing width and height";i=e,o=r,n=t}e=new pxtr.model.Frame(i,o);return e.setPixels(n),e}throw"Bad arguments in pxtr.model.Frame.fromPixelGrid"},{});r.Frame.createEmptyPixelGrid_=function(t,e){var r,i=t+"-"+e;return o[i]?r=o[i]:(r=o[i]=new Uint32Array(t*e),i=pxtr.utils.colorToInt(Constants.TRANSPARENT_COLOR),r.fill(i)),new Uint32Array(r)},r.Frame.createEmptyFromFrame=function(t){return new r.Frame(t.getWidth(),t.getHeight())},r.Frame.prototype.clone=function(){var t=new r.Frame(this.width,this.height);return t.setPixels(this.pixels),t},r.Frame.prototype.getPixels=function(){return this.clonePixels_(this.pixels)},r.Frame.prototype.setPixels=function(t){this.pixels=this.clonePixels_(t),this.version++},r.Frame.prototype.clear=function(){this.pixels=r.Frame.createEmptyPixelGrid_(this.getWidth(),this.getHeight()),this.version++},r.Frame.prototype.clonePixels_=function(t){return new Uint32Array(t)},r.Frame.prototype.getHash=function(){return[this.id,this.version].join("-")},r.Frame.prototype.setPixel=function(t,e,r){this.containsPixel(t,e)&&(e=e*this.width+t,this.pixels[e]!==(r=pxtr.utils.colorToInt(r))&&(this.pixels[e]=r||pxtr.utils.colorToInt(Constants.TRANSPARENT_COLOR),this.version++))},r.Frame.prototype.getPixel=function(t,e){return this.containsPixel(t,e)?this.pixels[e*this.width+t]:null},r.Frame.prototype.forEachPixel=function(t){for(var e=this.getWidth(),r=e*this.getHeight(),i=0;i<r;i++)t(this.pixels[i],i%e,Math.floor(i/e),this)},r.Frame.prototype.getWidth=function(){return this.width},r.Frame.prototype.getHeight=function(){return this.height},r.Frame.prototype.containsPixel=function(t,e){return 0<=t&&0<=e&&t<this.width&&e<this.height},r.Frame.prototype.isSameSize=function(t){return this.getHeight()==t.getHeight()&&this.getWidth()==t.getWidth()}}(),!function(){var r=$.namespace("pxtr.model");r.Layer=function(t){if(!t)throw"Invalid arguments in Layer constructor : 'name' is mandatory";this.name=t,this.frames=[],this.opacity=1},r.Layer.fromFrames=function(t,e){t=new r.Layer(t);return e.forEach(t.addFrame.bind(t)),t},r.Layer.prototype.getName=function(){return this.name},r.Layer.prototype.setName=function(t){this.name=t},r.Layer.prototype.getOpacity=function(){return this.opacity},r.Layer.prototype.setOpacity=function(t){null===(t="string"==typeof t?parseFloat(t):t)||isNaN(t)||t<0||1<t||(this.opacity=+t.toFixed(3))},r.Layer.prototype.isTransparent=function(){return this.opacity<1},r.Layer.prototype.getFrames=function(){return this.frames},r.Layer.prototype.getFrameAt=function(t){return this.frames[t]},r.Layer.prototype.addFrame=function(t){this.frames.push(t)},r.Layer.prototype.addFrameAt=function(t,e){this.frames.splice(e,0,t)},r.Layer.prototype.removeFrame=function(t){t=this.frames.indexOf(t);this.removeFrameAt(t)},r.Layer.prototype.removeFrameAt=function(t){this.frames[t]?this.frames.splice(t,1):console.error("Invalid index in removeFrameAt : %s (size : %s)",t,this.size())},r.Layer.prototype.moveFrame=function(t,e){t=this.frames.splice(t,1)[0];this.frames.splice(e,0,t)},r.Layer.prototype.swapFramesAt=function(t,e){var r=this.frames[t],i=this.frames[e];r&&i?(this.frames[e]=r,this.frames[t]=i):console.error("Frame not found in moveFrameAt (from %s, to %s)",t,e)},r.Layer.prototype.duplicateFrame=function(t){t=this.frames.indexOf(t);this.duplicateFrameAt(t)},r.Layer.prototype.duplicateFrameAt=function(t){var e=this.frames[t];e?(e=e.clone(),this.addFrameAt(e,t)):console.error("Frame not found in duplicateFrameAt (at %s)",t)},r.Layer.prototype.size=function(){return this.frames.length},r.Layer.prototype.getHash=function(){return this.frames.map(function(t){return t.getHash()}).join("-")}}(),$.namespace("pxtr.model.pixetor").Descriptor=function(t,e,r){this.name=t,this.description=e,this.isPublic=r},!function(){function t(t){return pxtr.utils.FrameUtils.toImage(t)}function e(t){return t}var r=$.namespace("pxtr.model.frame"),n="__cache_default__";r.CachedFrameProcessor=function(){this.cache_={},this.cacheQueue_=[],this.frameProcessor=t,this.outputCloner=e,this.defaultNamespace=n},r.CachedFrameProcessor.prototype.clear=function(){this.cache_={}},r.CachedFrameProcessor.prototype.setFrameProcessor=function(t){this.frameProcessor=t},r.CachedFrameProcessor.prototype.setOutputCloner=function(t){this.outputCloner=t},r.CachedFrameProcessor.prototype.get=function(t,e){var r=null,i=(this.cache_[e=e||n]||(this.cache_[e]={}),this.cache_[e]),o=t.getHash();return i[o]?r=i[o]:(r=this.frameProcessor(t),i[o]=r,this.cacheQueue_.unshift([e,o]),100<this.cacheQueue_.length&&(t=this.cacheQueue_.pop(),this.cache_[t[0]][t[1]]=null)),r}}(),!function(){var e=$.namespace("pxtr.model.frame");e.AsyncCachedFrameProcessor=function(t){e.CachedFrameProcessor.call(this,t)},pxtr.utils.inherit(e.AsyncCachedFrameProcessor,e.CachedFrameProcessor),e.AsyncCachedFrameProcessor.prototype.get=function(t,e){var r=null,i=(e=e||this.defaultNamespace,this.cache_[e]||(this.cache_[e]={}),Q.defer()),e=this.cache_[e],o=t.getHash();return e[o]?r=e[o]:(e=this.onProcessorComplete_.bind(this,i,e,o),this.frameProcessor(t,e)),r&&i.resolve(r),i.promise},e.AsyncCachedFrameProcessor.prototype.onProcessorComplete_=function(t,e,r,i){e[r]=i,t.resolve(i)}}(),!function(){var t=$.namespace("pxtr.model.frame");t.RenderedFrame=function(t,e,r,i){this.width=e,this.height=r,this.id=i,this.renderFn=t},t.RenderedFrame.prototype.getRenderedFrame=function(){return this.renderFn()},t.RenderedFrame.prototype.getHash=function(){return this.id},t.RenderedFrame.prototype.getWidth=function(){return this.width},t.RenderedFrame.prototype.getHeight=function(){return this.height},t.RenderedFrame.prototype.getPixels=Constants.ABSTRACT_FUNCTION,t.RenderedFrame.prototype.containsPixel=Constants.ABSTRACT_FUNCTION,t.RenderedFrame.prototype.isSameSize=Constants.ABSTRACT_FUNCTION,t.RenderedFrame.prototype.clone=Constants.ABSTRACT_FUNCTION,t.RenderedFrame.prototype.setPixels=Constants.ABSTRACT_FUNCTION,t.RenderedFrame.prototype.clear=Constants.ABSTRACT_FUNCTION,t.RenderedFrame.prototype.setPixel=Constants.ABSTRACT_FUNCTION,t.RenderedFrame.prototype.getPixel=Constants.ABSTRACT_FUNCTION,t.RenderedFrame.prototype.forEachPixel=Constants.ABSTRACT_FUNCTION}(),!function(){var r=$.namespace("pxtr.model");r.Palette=function(t,e,r){this.id=t,this.name=e,this.colors=r},r.Palette.fromObject=function(t){var e=t.colors.slice(0,t.colors.length);return new r.Palette(t.id,t.name,e)},r.Palette.prototype.getColors=function(){return this.colors},r.Palette.prototype.setColors=function(t){this.colors=t},r.Palette.prototype.get=function(t){return this.colors[t]},r.Palette.prototype.set=function(t,e){this.colors[t]=e},r.Palette.prototype.add=function(t){this.colors.push(t)},r.Palette.prototype.size=function(){return this.colors.length},r.Palette.prototype.removeAt=function(t){this.colors.splice(t,1)},r.Palette.prototype.move=function(t,e){this.colors.splice(e,0,this.colors.splice(t,1)[0])}}(),!function(){var t=$.namespace("pxtr.model");t.Pixetor=function(t,e,r,i){if(!(t&&e&&i))throw"Missing arguments in Pixetor constructor : "+Array.prototype.join.call(arguments,",");this.layers=[],this.width=t,this.height=e,this.descriptor=i,this.savePath=null,this.fps=r,this.hiddenFrames=[]},t.Pixetor.fromLayers=function(t,e,r){var i,o=null;if(0<t.length&&0<t[0].size())return i=t[0].getFrameAt(0),o=new pxtr.model.Pixetor(i.getWidth(),i.getHeight(),e,r),t.forEach(o.addLayer.bind(o)),o;throw"Pixetor.fromLayers expects array of non empty pxtr.model.Layer as first argument"},t.Pixetor.prototype.getLayers=function(){return this.layers},t.Pixetor.prototype.getHeight=function(){return this.height},t.Pixetor.prototype.getWidth=function(){return this.width},t.Pixetor.prototype.getFPS=function(){return this.fps},t.Pixetor.prototype.getLayers=function(){return this.layers},t.Pixetor.prototype.getLayerAt=function(t){return this.layers[t]},t.Pixetor.prototype.getLayersByName=function(e){return this.layers.filter(function(t){return t.getName()==e})},t.Pixetor.prototype.getFrameCount=function(){return this.getLayerAt(0).size()},t.Pixetor.prototype.addLayer=function(t){this.layers.push(t)},t.Pixetor.prototype.addLayerAt=function(t,e){this.layers.splice(e,0,t)},t.Pixetor.prototype.moveLayerUp=function(t,e){t=this.layers.indexOf(t),e=e?this.layers.length-1:t+1;this.moveLayer_(t,e)},t.Pixetor.prototype.moveLayerDown=function(t,e){t=this.layers.indexOf(t);this.moveLayer_(t,e?0:t-1)},t.Pixetor.prototype.moveLayer_=function(t,e){-1!=t&&-1!=e&&t!=e&&(e=pxtr.utils.Math.minmax(e,0,this.layers.length-1),t=this.layers.splice(t,1)[0],this.layers.splice(e,0,t))},t.Pixetor.prototype.removeLayer=function(t){t=this.layers.indexOf(t);-1!=t&&this.layers.splice(t,1)},t.Pixetor.prototype.removeLayerAt=function(t){this.layers.splice(t,1)},t.Pixetor.prototype.getDescriptor=function(){return this.descriptor},t.Pixetor.prototype.setDescriptor=function(t){this.descriptor=t,$.publish(Events.PIXETOR_DESCRIPTOR_UPDATED)},t.Pixetor.prototype.setName=function(t){this.descriptor.name=t,$.publish(Events.PIXETOR_DESCRIPTOR_UPDATED)},t.Pixetor.prototype.getHash=function(){return this.layers.map(function(t){return t.getHash()}).join("-")}}(),!function(){function e(t){var e=Q.defer();return t.onsuccess=e.resolve.bind(e),t.onerror=e.reject.bind(e),e.promise}var t=$.namespace("pxtr.database"),r="PixetorSessionsDatabase";t.BackupDatabase=function(){this.db=null},t.BackupDatabase.DB_NAME=r,t.BackupDatabase.prototype.init=function(){var t=window.indexedDB.open(r,1);return t.onupgradeneeded=this.onUpgradeNeeded_.bind(this),e(t).then(function(t){return this.db=t.target.result,this.db}.bind(this)).catch(function(t){console.log("Could not initialize the pixetor backup database")})},t.BackupDatabase.prototype.onUpgradeNeeded_=function(t){this.db=t.target.result;t=this.db.createObjectStore("snapshots",{keyPath:"id",autoIncrement:!0});t.createIndex("session_id","session_id",{unique:!1}),t.createIndex("date","date",{unique:!1}),t.createIndex("session_id, date",["session_id","date"],{unique:!1}),t.transaction.oncomplete=function(t){}.bind(this)},t.BackupDatabase.prototype.openObjectStore_=function(){return this.db.transaction(["snapshots"],"readwrite").objectStore("snapshots")},t.BackupDatabase.prototype.createSnapshot=function(t){t=this.openObjectStore_().add(t);return e(t)},t.BackupDatabase.prototype.updateSnapshot=function(t){t=this.openObjectStore_().put(t);return e(t)},t.BackupDatabase.prototype.deleteSnapshot=function(t){t=this.openObjectStore_().delete(t.id);return e(t)},t.BackupDatabase.prototype.getSnapshot=function(t){t=this.openObjectStore_().get(t);return e(t).then(function(t){return t.target.result})},t.BackupDatabase.prototype.findLastSnapshot=function(r){var i=Q.defer(),t=this.db.transaction(["snapshots"]).objectStore("snapshots").index("date"),e=IDBKeyRange.upperBound(1/0);return t.openCursor(e,"prev").onsuccess=function(t){var t=t.target.result,e=t&&t.value;e?r(e)?i.resolve(e):t.continue():i.resolve(null)},i.promise},t.BackupDatabase.prototype.getSnapshotsBySessionId=function(t){var e=Q.defer(),r=this.db.transaction(["snapshots"]).objectStore("snapshots").index("session_id, date"),t=IDBKeyRange.bound([t,0],[t,1/0]),i=[];return r.openCursor(t,"prev").onsuccess=function(t){t=t.target.result;t?(i.push(t.value),t.continue()):e.resolve(i)},e.promise},t.BackupDatabase.prototype.getSessions=function(){var o=Q.defer(),t=this.db.transaction(["snapshots"]).objectStore("snapshots"),n={},t=t.index("date"),e=IDBKeyRange.upperBound(1/0);return t.openCursor(e,"prev").onsuccess=function(t){var e,r,t=t.target.result,i=t&&t.value;i?(n[i.session_id]?((r=n[(e=i).session_id]).startDate=Math.min(r.startDate,e.date),r.endDate=Math.max(r.endDate,e.date),r.count++,r.endDate===e.date&&(r.name=e.name,r.description=e.description)):n[i.session_id]={startDate:i.date,endDate:i.date,name:i.name,description:i.description,id:i.session_id,count:1},t.continue()):o.resolve(n)},o.promise.then(function(e){return Object.keys(e).map(function(t){return e[t]})})},t.BackupDatabase.prototype.deleteSnapshotsForSession=function(t){var e=Q.defer(),r=this.openObjectStore_().index("session_id"),t=IDBKeyRange.only(t);return r.openCursor(t).onsuccess=function(t){t=t.target.result;t?(t.delete(),t.continue()):e.resolve()},e.promise}}(),!function(){function n(t){var e=Q.defer();return t.onsuccess=e.resolve.bind(e),t.onerror=e.reject.bind(e),e.promise}var t=$.namespace("pxtr.database"),e="PixetorDatabase";t.PixetorDatabase=function(t){this.db=null},t.PixetorDatabase.DB_NAME=e,t.PixetorDatabase.prototype.init=function(){var t=window.indexedDB.open(e,1);return t.onupgradeneeded=this.onUpgradeNeeded_.bind(this),n(t).then(function(t){return this.db=t.target.result,this.db}.bind(this))},t.PixetorDatabase.prototype.onUpgradeNeeded_=function(t){this.db=t.target.result,this.db.createObjectStore("pixetors",{keyPath:"name"}).transaction.oncomplete=function(t){pxtr.database.migrate.MigrateLocalStorageToIndexedDb.migrate(this)}.bind(this)},t.PixetorDatabase.prototype.openObjectStore_=function(){return this.db.transaction(["pixetors"],"readwrite").objectStore("pixetors")},t.PixetorDatabase.prototype.get=function(t){var e=this.openObjectStore_();return n(e.get(t)).then(function(t){return t.target.result})},t.PixetorDatabase.prototype.list=function(){var e=Q.defer(),r=[],t=this.openObjectStore_().openCursor();return t.onsuccess=function(t){t=t.target.result;t?(r.push({name:t.value.name,date:t.value.date,description:t.value.description}),t.continue()):e.resolve(r)},t.onerror=function(){e.reject()},e.promise},t.PixetorDatabase.prototype.update=function(t,e,r,i){var o={},t=(o.name=t,o.serialized=i,o.date=r,o.description=e,this.openObjectStore_());return n(t.put(o))},t.PixetorDatabase.prototype.create=function(t,e,r,i){var o={},t=(o.name=t,o.serialized=i,o.date=r,o.description=e,this.openObjectStore_());return n(t.add(o))},t.PixetorDatabase.prototype.delete=function(t){var e=this.openObjectStore_();return n(e.delete(t))}}(),!function(){var s=$.namespace("pxtr.database.migrate");s.MigrateLocalStorageToIndexedDb={},s.MigrateLocalStorageToIndexedDb.migrate=function(t){function i(e){var r=n[e];r?s.MigrateLocalStorageToIndexedDb.save_(t,r).then(function(){i(e+1)}).catch(function(t){console.error("Failed to migrate local storage sprite for name: "+r.name),i(e+1)}):(console.log("Data migration from local storage to indexed db finished."),console.log("Local storage pixetors successfully migrated. Old copies will be deleted."),s.MigrateLocalStorageToIndexedDb.deleteLocalStoragePixetors(),o.resolve())}var o=Q.defer(),e=pxtr.app.localStorageService,n=e.getKeys().map(function(t){return{name:t.name,description:t.description,date:t.date,serialized:e.getPixetor(t.name)}});return i(0),o.promise},s.MigrateLocalStorageToIndexedDb.save_=function(e,r){return e.get(r.name).then(function(t){return void 0!==t?e.update(r.name,r.description,r.date,r.serialized):e.create(r.name,r.description,r.date,r.serialized)})},s.MigrateLocalStorageToIndexedDb.deleteLocalStoragePixetors=function(){pxtr.app.localStorageService.getKeys().forEach(function(t){window.localStorage.removeItem("pixetor."+t.name)}),window.localStorage.removeItem("pixetor.keys")}}(),!function(){var t=$.namespace("pxtr.selection"),r="REPLAY_PASTE",o="REPLAY_ERASE";t.SelectionManager=function(t){this.pixetorController=t,this.currentSelection=null},t.SelectionManager.prototype.init=function(){$.subscribe(Events.SELECTION_CREATED,this.onSelectionCreated_.bind(this)),$.subscribe(Events.SELECTION_DISMISSED,this.onSelectionDismissed_.bind(this)),$.subscribe(Events.SELECTION_MOVE_REQUEST,this.onSelectionMoved_.bind(this)),$.subscribe(Events.CLIPBOARD_COPY,this.copy.bind(this)),$.subscribe(Events.CLIPBOARD_CUT,this.copy.bind(this)),$.subscribe(Events.CLIPBOARD_PASTE,this.paste.bind(this));var t=pxtr.service.keyboard.Shortcuts;pxtr.app.shortcutService.registerShortcut(t.SELECTION.DELETE,this.onDeleteShortcut_.bind(this)),pxtr.app.shortcutService.registerShortcut(t.SELECTION.COMMIT,this.commit.bind(this)),$.subscribe(Events.TOOL_SELECTED,this.onToolSelected_.bind(this))},t.SelectionManager.prototype.cleanSelection_=function(){this.currentSelection&&(this.currentSelection.reset(),this.currentSelection=null)},t.SelectionManager.prototype.onToolSelected_=function(t,e){e instanceof pxtr.tools.drawing.selection.BaseSelect||this.cleanSelection_()},t.SelectionManager.prototype.onSelectionDismissed_=function(t){this.cleanSelection_()},t.SelectionManager.prototype.onDeleteShortcut_=function(t){if(!this.currentSelection)return!0;this.erase()},t.SelectionManager.prototype.erase=function(){for(var t=this.currentSelection.pixels,e=this.pixetorController.getCurrentFrame(),r=0,i=t.length;r<i;r++)e.setPixel(t[r].col,t[r].row,Constants.TRANSPARENT_COLOR);$.publish(Events.PIXETOR_SAVE_STATE,{type:pxtr.service.HistoryService.REPLAY,scope:this,replay:{type:o,pixels:JSON.parse(JSON.stringify(t))}})},t.SelectionManager.prototype.copy=function(t,e){this.currentSelection&&this.pixetorController.getCurrentFrame()&&(this.currentSelection.fillSelectionFromFrame(this.pixetorController.getCurrentFrame()),e&&(e.clipboardData.setData("text/plain",this.currentSelection.stringify()),e.preventDefault()),t.type===Events.CLIPBOARD_CUT&&this.erase())},t.SelectionManager.prototype.paste=function(t,e){var r=e?e.clipboardData.items:[];try{for(var i=0;i<r.length;i++){var o=r[i];if(/^image/i.test(o.type))return this.pasteImage_(o),void t.stopPropagation();if(/^text\/plain/i.test(o.type))return this.pasteText_(o),void t.stopPropagation()}}catch(t){}this.currentSelection&&this.currentSelection.hasPastedContent&&this.pastePixelsOnCurrentFrame_(this.currentSelection.pixels)},t.SelectionManager.prototype.pasteImage_=function(t){var e=t.getAsFile();pxtr.utils.FileUtils.readImageFile(e,function(t){pxtr.app.fileDropperService.dropPosition_={x:0,y:0},pxtr.app.fileDropperService.onImageLoaded_(t,e)}.bind(this))},t.SelectionManager.prototype.pasteText_=function(t){t.getAsString(function(t){var t=JSON.parse(t),e=t.time,t=t.pixels;(t=this.currentSelection&&this.currentSelection.time>=e?this.currentSelection.pixels:t)&&this.pastePixelsOnCurrentFrame_(t)}.bind(this))},t.SelectionManager.prototype.pastePixelsOnCurrentFrame_=function(t){var e=this.pixetorController.getCurrentFrame();this.pastePixels_(e,t),$.publish(Events.PIXETOR_SAVE_STATE,{type:pxtr.service.HistoryService.REPLAY,scope:this,replay:{type:r,pixels:JSON.parse(JSON.stringify(t.slice(0)))}})},t.SelectionManager.prototype.commit=function(){var t=pxtr.app.drawingController.currentToolBehavior;t instanceof pxtr.tools.drawing.selection.BaseSelect&&t.commitSelection()},t.SelectionManager.prototype.replay=function(e,t){t.type===r?this.pastePixels_(e,t.pixels):t.type===o&&t.pixels.forEach(function(t){e.setPixel(t.col,t.row,Constants.TRANSPARENT_COLOR)})},t.SelectionManager.prototype.pastePixels_=function(e,t){t.forEach(function(t){t.color!==Constants.TRANSPARENT_COLOR&&null!==t.color&&e.setPixel(t.col,t.row,t.color)})},t.SelectionManager.prototype.onSelectionCreated_=function(t,e){e?this.currentSelection=e:console.error("No selection provided to SelectionManager")},t.SelectionManager.prototype.onSelectionMoved_=function(t,e,r){this.currentSelection?this.currentSelection.move(e,r):console.error("Bad state: No currentSelection set when trying to move it in SelectionManager")}}(),!function(){var t=$.namespace("pxtr.selection");t.BaseSelection=function(){this.reset()},t.BaseSelection.prototype.stringify=function(){return JSON.stringify({pixels:this.pixels,time:this.time})},t.BaseSelection.prototype.parse=function(t){t=JSON.parse(t);this.pixels=t.pixels,this.time=t.time},t.BaseSelection.prototype.reset=function(){this.pixels=[],this.hasPastedContent=!1,this.time=-1},t.BaseSelection.prototype.move=function(t,e){for(var r=[],i=0,o=this.pixels.length;i<o;i++){var n=this.pixels[i];n.col+=t,n.row+=e,r.push(n)}this.pixels=r},t.BaseSelection.prototype.fillSelectionFromFrame=function(r){this.pixels.forEach(function(t){var e=r.getPixel(t.col,t.row);t.color=e||Constants.TRANSPARENT_COLOR}),this.hasPastedContent=!0,this.time=Date.now()}}(),!function(){var t=$.namespace("pxtr.selection");t.LassoSelection=function(t,e){this.pixelsMap={},t.forEach(function(t){this.setPixelInMap_(t,1)}.bind(this)),this.pixels=this.getLassoPixels_(e)},pxtr.utils.inherit(t.LassoSelection,t.BaseSelection),t.LassoSelection.prototype.getLassoPixels_=function(i){var o=[];return i.forEachPixel(function(t,e,r){e={col:e,row:r};this.isInSelection_(e,i)&&o.push(e)}.bind(this)),o},t.LassoSelection.prototype.isInSelection_=function(t,e){return this.getPixelInMap_(t)||this.visitPixel_(t,e),1==this.getPixelInMap_(t)},t.LassoSelection.prototype.visitPixel_=function(t,e){var r=!1;pxtr.PixelUtils.visitConnectedPixels(t,e,function(t){return!this.getPixelInMap_(t)&&(e.containsPixel(t.col,t.row)?(this.setPixelInMap_(t,2),!0):!(r=!0))}.bind(this)).forEach(function(t){this.setPixelInMap_(t,r?-1:1)}.bind(this))},t.LassoSelection.prototype.setPixelInMap_=function(t,e){this.pixelsMap[t.col]=this.pixelsMap[t.col]||{},this.pixelsMap[t.col][t.row]=e},t.LassoSelection.prototype.getPixelInMap_=function(t){return this.pixelsMap[t.col]&&this.pixelsMap[t.col][t.row]}}(),!function(){var t=$.namespace("pxtr.selection");t.RectangularSelection=function(t,e,r,i){this.pixels=pxtr.PixelUtils.getRectanglePixels(t,e,r,i)},pxtr.utils.inherit(t.RectangularSelection,t.BaseSelection)}(),!function(){var t=$.namespace("pxtr.selection");t.ShapeSelection=function(t){this.pixels=t},pxtr.utils.inherit(t.ShapeSelection,t.BaseSelection)}(),!function(){var t=$.namespace("pxtr.rendering");t.AbstractRenderer=function(){},t.AbstractRenderer.prototype.clear=Constants.ABSTRACT_FUNCTION,t.AbstractRenderer.prototype.render=Constants.ABSTRACT_FUNCTION,t.AbstractRenderer.prototype.getCoordinates=Constants.ABSTRACT_FUNCTION,t.AbstractRenderer.prototype.setGridWidth=Constants.ABSTRACT_FUNCTION,t.AbstractRenderer.prototype.getGridWidth=Constants.ABSTRACT_FUNCTION,t.AbstractRenderer.prototype.setZoom=Constants.ABSTRACT_FUNCTION,t.AbstractRenderer.prototype.getZoom=Constants.ABSTRACT_FUNCTION,t.AbstractRenderer.prototype.setOffset=Constants.ABSTRACT_FUNCTION,t.AbstractRenderer.prototype.getOffset=Constants.ABSTRACT_FUNCTION,t.AbstractRenderer.prototype.setDisplaySize=Constants.ABSTRACT_FUNCTION,t.AbstractRenderer.prototype.getDisplaySize=Constants.ABSTRACT_FUNCTION}(),!function(){var t=$.namespace("pxtr.rendering");t.CompositeRenderer=function(){this.renderers=[]},pxtr.utils.inherit(pxtr.rendering.CompositeRenderer,pxtr.rendering.AbstractRenderer),t.CompositeRenderer.prototype.add=function(t){return this.renderers.push(t),this},t.CompositeRenderer.prototype.clear=function(){this.renderers.forEach(function(t){t.clear()})},t.CompositeRenderer.prototype.setZoom=function(e){this.renderers.forEach(function(t){t.setZoom(e)})},t.CompositeRenderer.prototype.getZoom=function(){return this.getSampleRenderer_().getZoom()},t.CompositeRenderer.prototype.setDisplaySize=function(e,r){this.renderers.forEach(function(t){t.setDisplaySize(e,r)})},t.CompositeRenderer.prototype.getDisplaySize=function(){return this.getSampleRenderer_().getDisplaySize()},t.CompositeRenderer.prototype.setOffset=function(e,r){this.renderers.forEach(function(t){t.setOffset(e,r)})},t.CompositeRenderer.prototype.getOffset=function(){return this.getSampleRenderer_().getOffset()},t.CompositeRenderer.prototype.setGridWidth=function(e){this.renderers.forEach(function(t){t.setGridWidth(e)})},t.CompositeRenderer.prototype.getGridWidth=function(){return this.getSampleRenderer_().getGridWidth()},t.CompositeRenderer.prototype.getSampleRenderer_=function(){if(0<this.renderers.length)return this.renderers[0];throw"Renderer manager is empty"}}(),!function(){var t=$.namespace("pxtr.rendering.layer");t.LayersRenderer=function(t,e,r){pxtr.rendering.CompositeRenderer.call(this),this.pixetorController=r,this.belowRenderer=new pxtr.rendering.frame.FrameRenderer(t,e,["layers-canvas","layers-below-canvas"]),this.aboveRenderer=new pxtr.rendering.frame.FrameRenderer(t,e,["layers-canvas","layers-above-canvas"]),this.add(this.belowRenderer),this.add(this.aboveRenderer),this.serializedRendering="",this.stylesheet_=document.createElement("style"),document.head.appendChild(this.stylesheet_),this.updateLayersCanvasOpacity_(pxtr.UserSettings.get(pxtr.UserSettings.LAYER_OPACITY)),$.subscribe(Events.PIXETOR_RESET,this.flush.bind(this)),$.subscribe(Events.USER_SETTINGS_CHANGED,this.onUserSettingsChange_.bind(this))},pxtr.utils.inherit(pxtr.rendering.layer.LayersRenderer,pxtr.rendering.CompositeRenderer),t.LayersRenderer.prototype.render=function(){var t=this.getOffset(),e=this.getDisplaySize(),r=this.pixetorController.getLayers(),i=this.pixetorController.getCurrentFrameIndex(),o=this.pixetorController.getCurrentLayerIndex(),n=r.slice(0,o),o=r.slice(o+1,r.length),t=[this.getZoom(),this.getGridWidth(),t.x,t.y,e.width,e.height,pxtr.utils.LayerUtils.getFrameHashAt(n,i),pxtr.utils.LayerUtils.getFrameHashAt(o,i),r.length].join("-");this.serializedRendering!=t&&(this.serializedRendering=t,this.clear(),0<n.length&&(e=pxtr.utils.LayerUtils.mergeFrameAt(n,i),this.belowRenderer.render(e)),0<o.length&&(r=pxtr.utils.LayerUtils.mergeFrameAt(o,i),this.aboveRenderer.render(r)))},t.LayersRenderer.prototype.setDisplaySize=function(t,e){var r=this.getDisplaySize();r.width===t&&r.height===e||this.superclass.setDisplaySize.call(this,t,e)},t.LayersRenderer.prototype.onUserSettingsChange_=function(t,e,r){e==pxtr.UserSettings.LAYER_OPACITY&&this.updateLayersCanvasOpacity_(r)},t.LayersRenderer.prototype.updateLayersCanvasOpacity_=function(t){this.stylesheet_.innerHTML=".layers-canvas { opacity : "+t+"}"},t.LayersRenderer.prototype.flush=function(){this.serializedRendering=""}}(),!function(){var t=$.namespace("pxtr.rendering.frame");t.FrameRenderer=function(t,e,r){if(this.defaultRenderingOptions={supportGridRendering:!1,zoom:1},e=$.extend(!0,{},this.defaultRenderingOptions,e),void 0===t)throw"Bad FrameRenderer initialization. <container> undefined.";if(isNaN(e.zoom))throw"Bad FrameRenderer initialization. <zoom> not well defined.";this.container=t,this.zoom=e.zoom,this.offset={x:0,y:0},this.margin={x:0,y:0},this.supportGridRendering=e.supportGridRendering,this.classList=r||[],this.classList.push("canvas"),this.canvas=null,this.displayCanvas=null,this.setDisplaySize(e.width,e.height),this.setGridWidth(this.getUserGridWidth_()),this.setGridSpacing(this.getUserGridSpacing_()),$.subscribe(Events.USER_SETTINGS_CHANGED,this.onUserSettingsChange_.bind(this))},pxtr.utils.inherit(pxtr.rendering.frame.FrameRenderer,pxtr.rendering.AbstractRenderer),t.FrameRenderer.prototype.render=function(t){t&&(this.clear(),this.renderFrame_(t))},t.FrameRenderer.prototype.clear=function(){pxtr.utils.CanvasUtils.clear(this.canvas),pxtr.utils.CanvasUtils.clear(this.displayCanvas)},t.FrameRenderer.prototype.setZoom=function(t){var e,r=Math.min(this.displayWidth,this.displayHeight)/10;(t=pxtr.utils.Math.minmax(t,1,r))!=this.zoom&&(r=this.offset.x+this.displayWidth/(2*this.zoom),e=this.offset.y+this.displayHeight/(2*this.zoom),this.zoom=t,this.setOffset(r-this.displayWidth/(2*this.zoom),e-this.displayHeight/(2*this.zoom)))},t.FrameRenderer.prototype.getZoom=function(){return this.zoom},t.FrameRenderer.prototype.setDisplaySize=function(t,e){this.displayWidth=t,this.displayHeight=e,this.displayCanvas&&(this.displayCanvas.parentNode.removeChild(this.displayCanvas),this.displayCanvas=null),this.createDisplayCanvas_()},t.FrameRenderer.prototype.getDisplaySize=function(){return{height:this.displayHeight,width:this.displayWidth}},t.FrameRenderer.prototype.getOffset=function(){return{x:this.offset.x,y:this.offset.y}},t.FrameRenderer.prototype.setOffset=function(t,e){var r=pxtr.app.pixetorController.getWidth(),i=pxtr.app.pixetorController.getHeight(),r=r-this.displayWidth/this.zoom,r=(t=pxtr.utils.Math.minmax(t,0,r),i-this.displayHeight/this.zoom);e=pxtr.utils.Math.minmax(e,0,r),this.offset.x=t,this.offset.y=e},t.FrameRenderer.prototype.getGridColor=function(){return pxtr.UserSettings.get(pxtr.UserSettings.GRID_COLOR)},t.FrameRenderer.prototype.setGridWidth=function(t){this.gridWidth_=t},t.FrameRenderer.prototype.setGridSpacing=function(t){this.gridSpacing_=t},t.FrameRenderer.prototype.getGridWidth=function(){return this.supportGridRendering?this.gridWidth_:0},t.FrameRenderer.prototype.getGridSpacing=function(){return this.supportGridRendering?this.gridSpacing_:0},t.FrameRenderer.prototype.computeGridWidthForDisplay_=function(){var t=this.getGridSpacing();if(this.zoom*t<6)return 0;for(var e=this.getGridWidth();1<e&&this.zoom<6*e;)e--;return e},t.FrameRenderer.prototype.updateMargins_=function(t){var e=this.displayWidth-this.zoom*t.getWidth(),e=(this.margin.x=Math.max(0,e)/2,this.displayHeight-this.zoom*t.getHeight());this.margin.y=Math.max(0,e)/2},t.FrameRenderer.prototype.createDisplayCanvas_=function(){var t=this.displayHeight,e=this.displayWidth;this.displayCanvas=pxtr.utils.CanvasUtils.createCanvas(e,t,this.classList),pxtr.utils.CanvasUtils.disableImageSmoothing(this.displayCanvas),this.container.appendChild(this.displayCanvas)},t.FrameRenderer.prototype.onUserSettingsChange_=function(t,e,r){var i=pxtr.UserSettings;e!=i.GRID_WIDTH&&e!=i.GRID_SPACING&&e!=i.GRID_ENABLED||(this.setGridWidth(this.getUserGridWidth_()),this.setGridSpacing(this.getUserGridSpacing_()))},t.FrameRenderer.prototype.getUserGridWidth_=function(){var t=pxtr.UserSettings.get(pxtr.UserSettings.GRID_ENABLED),e=pxtr.UserSettings.get(pxtr.UserSettings.GRID_WIDTH);return t?e:0},t.FrameRenderer.prototype.getUserGridSpacing_=function(){var t=pxtr.UserSettings.get(pxtr.UserSettings.GRID_ENABLED),e=pxtr.UserSettings.get(pxtr.UserSettings.GRID_SPACING);return t?e:0},t.FrameRenderer.prototype.getCoordinates=function(t,e){var r=this.container.getBoundingClientRect(),r=(t-=r.left,e-=r.top,t-=this.margin.x,e-=this.margin.y,this.zoom);return t+=this.offset.x*r,e+=this.offset.y*r,{x:Math.floor(t/r),y:Math.floor(e/r)}},t.FrameRenderer.prototype.reverseCoordinates=function(t,e){var r=this.zoom,i=(t=t*r-this.offset.x*r,e=e*r-this.offset.y*r,t+=this.margin.x,e+=this.margin.y,this.container.getBoundingClientRect());return{x:(t+=i.left)+r/2,y:(e+=i.top)+r/2}},t.FrameRenderer.prototype.renderFrame_=function(t){this.canvas&&t.getWidth()==this.canvas.width&&t.getHeight()==this.canvas.height||(this.canvas=pxtr.utils.CanvasUtils.createCanvas(t.getWidth(),t.getHeight()));var e=this.canvas.width,r=this.canvas.height,i=this.zoom,o=(pxtr.utils.FrameUtils.drawToCanvas(t,this.canvas),this.updateMargins_(t),this.displayCanvas.getContext("2d")),n=(o.save(),this.margin.x-this.offset.x*i),s=this.margin.y-this.offset.y*i,a=((0<n||0<s)&&(o.fillStyle=Constants.ZOOMED_OUT_BACKGROUND_COLOR,o.fillRect(0,0,this.displayCanvas.width-1,this.displayCanvas.height-1)),o.translate(n,s),o.scale(i,i),pxtr.UserSettings.get("SEAMLESS_MODE")?o.clearRect(-1*e,-1*r,3*e,3*r):o.clearRect(0,0,e,r),pxtr.UserSettings.get("SEAMLESS_MODE")&&this.drawTiledFrames_(o,this.canvas,e,r,1),o.drawImage(this.canvas,0,0),this.computeGridWidthForDisplay_()),l=this.getGridSpacing();if(0<a){n=this.getGridColor();o.scale(1/i,1/i);for(var c=(n===Constants.TRANSPARENT_COLOR?o.clearRect:(o.fillStyle=n,o.fillRect)).bind(o),p=1;p<t.getWidth();p++)p%l==0&&c(p*i-a/2,0,a,r*i);for(var h=1;h<t.getHeight();h++)h%l==0&&c(0,h*i-a/2,e*i,a)}o.restore()},t.FrameRenderer.prototype.drawTiledFrames_=function(e,r,i,o,n){var t=pxtr.UserSettings.get("SEAMLESS_OPACITY"),t=pxtr.utils.Math.minmax(t,0,1);e.fillStyle="rgba(255, 255, 255, "+t+")",[[0,-1],[0,1],[-1,-1],[-1,0],[-1,1],[1,-1],[1,0],[1,1]].forEach(function(t){e.drawImage(r,t[0]*i*n,t[1]*o*n),e.fillRect(t[0]*i*n,t[1]*o*n,i*n,o*n)})}}(),!function(){var i=$.namespace("pxtr.rendering");i.OnionSkinRenderer=function(t,e){pxtr.rendering.CompositeRenderer.call(this),this.pixetorController=e,this.renderer=t,this.add(this.renderer),this.hash=""},i.OnionSkinRenderer.createInContainer=function(t,e,r){t=new pxtr.rendering.frame.FrameRenderer(t,e,["onion-skin-canvas"]);return new i.OnionSkinRenderer(t,r)},pxtr.utils.inherit(pxtr.rendering.OnionSkinRenderer,pxtr.rendering.CompositeRenderer),i.OnionSkinRenderer.prototype.render=function(){var t=this.getOnionFrames_(),e=this.computeHash_(t);this.hash!=e&&(this.hash=e,this.clear(),0<t.length&&(e=pxtr.utils.FrameUtils.merge(t),this.renderer.render(e)))},i.OnionSkinRenderer.prototype.getOnionFrames_=function(){var t=[],e=this.pixetorController.getCurrentFrameIndex(),r=this.pixetorController.getCurrentLayer(),i=r.getFrameAt(e-1);i&&t.push(i);i=r.getFrameAt(e+1);return i&&t.push(i),t},i.OnionSkinRenderer.prototype.computeHash_=function(t){var e=this.getOffset(),r=this.getDisplaySize(),i=this.pixetorController.getLayers();return[this.getZoom(),this.getGridWidth(),e.x,e.y,r.width,r.height,t.map(function(t){return t.getHash()}).join("-"),i.length].join("-")},i.OnionSkinRenderer.prototype.setDisplaySize=function(t,e){var r=this.getDisplaySize();r.width===t&&r.height===e||this.superclass.setDisplaySize.call(this,t,e)},i.OnionSkinRenderer.prototype.flush=function(){this.hash=""}}(),!function(){var t=$.namespace("pxtr.rendering.frame");t.BackgroundImageFrameRenderer=function(t,e){this.container=t,this.setZoom(e);e=t.ownerDocument;this.frameContainer=e.createElement("div"),this.frameContainer.classList.add("background-image-frame-container"),t.appendChild(this.frameContainer),this.cachedFrameProcessor=new pxtr.model.frame.CachedFrameProcessor,this.cachedFrameProcessor.setFrameProcessor(this.frameToDataUrl_.bind(this))},t.BackgroundImageFrameRenderer.prototype.frameToDataUrl_=function(t){t=t instanceof pxtr.model.frame.RenderedFrame?pxtr.utils.ImageResizer.scale(t.getRenderedFrame(),this.zoom):pxtr.utils.FrameUtils.toImage(t,this.zoom);return t.toDataURL("image/png")},t.BackgroundImageFrameRenderer.prototype.render=function(t){t=this.cachedFrameProcessor.get(t,this.zoom);this.frameContainer.style.backgroundImage="url("+t+")"},t.BackgroundImageFrameRenderer.prototype.show=function(){this.frameContainer&&(this.frameContainer.style.display="block")},t.BackgroundImageFrameRenderer.prototype.setZoom=function(t){this.zoom=t},t.BackgroundImageFrameRenderer.prototype.getZoom=function(){return this.zoom},t.BackgroundImageFrameRenderer.prototype.setRepeated=function(t){t=t?"repeat":"no-repeat";this.frameContainer.style.backgroundRepeat=t}}(),!function(){var t=$.namespace("pxtr.rendering.frame");t.CachedFrameRenderer=function(t,e,r){pxtr.rendering.frame.FrameRenderer.call(this,t,e,r),this.serializedFrame=""},pxtr.utils.inherit(pxtr.rendering.frame.CachedFrameRenderer,pxtr.rendering.frame.FrameRenderer),t.CachedFrameRenderer.prototype.setDisplaySize=function(t,e){this.displayWidth===t&&this.displayHeight===e||this.superclass.setDisplaySize.call(this,t,e)},t.CachedFrameRenderer.prototype.render=function(t){var e=this.getOffset(),r=this.getDisplaySize(),e=[this.getZoom(),this.getGridWidth(),this.getGridSpacing(),this.getGridColor(),pxtr.UserSettings.get("SEAMLESS_MODE"),pxtr.UserSettings.get("SEAMLESS_OPACITY"),e.x,e.y,r.width,r.height,t.getHash()].join("-");this.serializedFrame!=e&&(this.serializedFrame=e,this.superclass.render.call(this,t))}}(),!function(){var t=$.namespace("pxtr.rendering");t.CanvasRenderer=function(t,e){this.frame=t,this.zoom=e,this.opacity_=1,this.transparentColor_="white"},t.CanvasRenderer.prototype.drawTransparentAs=function(t){this.transparentColor_=t},t.CanvasRenderer.prototype.setOpacity=function(t){this.opacity_=t},t.CanvasRenderer.prototype.render=function(){var t=this.createCanvas_(),e=(pxtr.utils.FrameUtils.drawToCanvas(this.frame,t,this.transparentColor_,this.opacity_),this.createCanvas_(this.zoom)),r=e.getContext("2d");return pxtr.utils.CanvasUtils.disableImageSmoothing(e),r.scale(this.zoom,this.zoom),r.drawImage(t,0,0),e},t.CanvasRenderer.prototype.createCanvas_=function(t){t=t||1;var e=this.frame.getWidth()*t,t=this.frame.getHeight()*t;return pxtr.utils.CanvasUtils.createCanvas(e,t)}}(),!function(){var t=$.namespace("pxtr.rendering");t.FramesheetRenderer=function(t){if(!(0<t.length))throw"FramesheetRenderer : Invalid argument : frames is empty";this.frames=t},t.FramesheetRenderer.prototype.renderAsCanvas=function(t){t=t||this.frames.length;for(var e=Math.ceil(this.frames.length/t),r=this.createCanvas_(t,e),i=0;i<this.frames.length;i++){var o=this.frames[i],n=i%t*o.getWidth(),s=Math.floor(i/t)*o.getHeight();this.drawFrameInCanvas_(o,r,n,s)}return r},t.FramesheetRenderer.prototype.drawFrameInCanvas_=function(t,e,r,i){var e=e.getContext("2d"),o=e.createImageData(t.getWidth(),t.getHeight()),t=t.getPixels(),t=new Uint8ClampedArray(t.buffer);o.data.set(t),e.putImageData(o,r,i)},t.FramesheetRenderer.prototype.createCanvas_=function(t,e){var r=this.frames[0],t=t*r.getWidth(),e=e*r.getHeight();return pxtr.utils.CanvasUtils.createCanvas(t,e)}}(),!function(){var t=$.namespace("pxtr.rendering");t.PixetorRenderer=function(t){for(var e=[],r=0;r<t.getFrameCount();r++)e.push(t.renderFrameAt(r,!0));this.pixetorController=t,this.frames=e},t.PixetorRenderer.prototype.renderAsCanvas=function(t){t=t||this.frames.length;for(var e=Math.ceil(this.frames.length/t),r=this.createCanvas_(t,e),i=0;i<this.frames.length;i++){var o=this.frames[i],n=i%t*this.pixetorController.getWidth(),s=Math.floor(i/t)*this.pixetorController.getHeight();this.drawFrameInCanvas_(o,r,n,s)}return r},t.PixetorRenderer.prototype.drawFrameInCanvas_=function(t,e,r,i){e.getContext("2d").drawImage(t,r,i,t.width,t.height)},t.PixetorRenderer.prototype.createCanvas_=function(t,e){t*=this.pixetorController.getWidth(),e*=this.pixetorController.getHeight();return pxtr.utils.CanvasUtils.createCanvas(t,e)}}(),!function(){var t=$.namespace("pxtr.controller.pixetor");t.PixetorController=function(t){if(!t)throw"A pixetor instance is mandatory for instanciating PixetorController";this.setPixetor(t)},t.PixetorController.prototype.setPixetor=function(t,e){this.pixetor=t,(e=e||{}).preserveState||(this.currentLayerIndex=0,this.currentFrameIndex=0),this.layerIdCounter=1},t.PixetorController.prototype.init=function(){},t.PixetorController.prototype.getHeight=function(){return this.pixetor.getHeight()},t.PixetorController.prototype.getWidth=function(){return this.pixetor.getWidth()},t.PixetorController.prototype.getFPS=function(){return this.pixetor.fps},t.PixetorController.prototype.setFPS=function(t){"number"==typeof t&&(this.pixetor.fps=t,$.publish(Events.FPS_CHANGED))},t.PixetorController.prototype.getLayers=function(){return this.pixetor.getLayers()},t.PixetorController.prototype.getCurrentLayer=function(){return this.getLayerAt(this.currentLayerIndex)},t.PixetorController.prototype.getLayerAt=function(t){return this.pixetor.getLayerAt(t)},t.PixetorController.prototype.hasLayerAt=function(t){return!!this.getLayerAt(t)},t.PixetorController.prototype.getLayerByIndex=function(t){var e=this.getLayers();return e[t]||null},t.PixetorController.prototype.getCurrentFrame=function(){return this.getCurrentLayer().getFrameAt(this.currentFrameIndex)},t.PixetorController.prototype.getCurrentLayerIndex=function(){return this.currentLayerIndex},t.PixetorController.prototype.getCurrentFrameIndex=function(){return this.currentFrameIndex},t.PixetorController.prototype.getPixetor=function(){return this.pixetor},t.PixetorController.prototype.isTransparent=function(){return this.getLayers().some(function(t){return t.isTransparent()})},t.PixetorController.prototype.renderFrameAt=function(t,e){return pxtr.utils.LayerUtils.flattenFrameAt(this.getLayers(),t,e)},t.PixetorController.prototype.hasFrameAt=function(t){return!!this.getCurrentLayer().getFrameAt(t)},t.PixetorController.prototype.addFrame=function(){this.addFrameAt(this.getFrameCount())},t.PixetorController.prototype.addFrameAtCurrentIndex=function(){this.addFrameAt(this.currentFrameIndex+1)},t.PixetorController.prototype.addFrameAt=function(e){this.getLayers().forEach(function(t){t.addFrameAt(this.createEmptyFrame_(),e)}.bind(this)),this.onFrameAddedAt_(e)},t.PixetorController.prototype.onFrameAddedAt_=function(e){this.pixetor.hiddenFrames=this.pixetor.hiddenFrames.map(function(t){return e<=t?t+1:t}),this.setCurrentFrameIndex(e)},t.PixetorController.prototype.createEmptyFrame_=function(){var t=this.pixetor.getWidth(),e=this.pixetor.getHeight();return new pxtr.model.Frame(t,e)},t.PixetorController.prototype.removeFrameAt=function(e){this.getLayers().forEach(function(t){t.removeFrameAt(e)}),this.pixetor.hiddenFrames=this.pixetor.hiddenFrames.map(function(t){return e<t?t-1:t}),this.currentFrameIndex>=e&&0<this.currentFrameIndex&&this.setCurrentFrameIndex(this.currentFrameIndex-1)},t.PixetorController.prototype.duplicateCurrentFrame=function(){this.duplicateFrameAt(this.currentFrameIndex)},t.PixetorController.prototype.duplicateFrameAt=function(e){this.getLayers().forEach(function(t){t.duplicateFrameAt(e)}),this.onFrameAddedAt_(e+1)},t.PixetorController.prototype.toggleFrameVisibilityAt=function(e){var t=this.pixetor.hiddenFrames;-1===t.indexOf(e)?t.push(e):t=t.filter(function(t){return t!==e}),this.pixetor.hiddenFrames=t.sort()},t.PixetorController.prototype.moveFrame=function(e,r){this.getLayers().forEach(function(t){t.moveFrame(e,r)}),this.pixetor.hiddenFrames=this.pixetor.hiddenFrames.map(function(t){return t===e?r:t>=Math.min(e,r)&&t<=Math.max(e,r)?e<r?t-1:t+1:void 0})},t.PixetorController.prototype.hasVisibleFrameAt=function(t){return-1===this.pixetor.hiddenFrames.indexOf(t)},t.PixetorController.prototype.getVisibleFrameIndexes=function(){return this.getCurrentLayer().getFrames().map(function(t,e){return e}).filter(function(t){return-1===this.pixetor.hiddenFrames.indexOf(t)}.bind(this))},t.PixetorController.prototype.getFrameCount=function(){return this.pixetor.getFrameCount()},t.PixetorController.prototype.setCurrentFrameIndex=function(t){this.hasFrameAt(t)?this.currentFrameIndex=t:window.console.error("Could not set current frame index to "+t)},t.PixetorController.prototype.selectNextFrame=function(){var t=this.currentFrameIndex+1;t<this.getFrameCount()&&this.setCurrentFrameIndex(t)},t.PixetorController.prototype.selectPreviousFrame=function(){var t=this.currentFrameIndex-1;0<=t&&this.setCurrentFrameIndex(t)},t.PixetorController.prototype.setCurrentLayerIndex=function(t){this.hasLayerAt(t)?this.currentLayerIndex=t:window.console.error("Could not set current layer index to "+t)},t.PixetorController.prototype.selectLayer=function(t){t=this.getLayers().indexOf(t);-1!=t&&this.setCurrentLayerIndex(t)},t.PixetorController.prototype.renameLayerAt=function(t,e){t=this.getLayerByIndex(t);t&&t.setName(e)},t.PixetorController.prototype.setLayerOpacityAt=function(t,e){t=this.getLayerByIndex(t);t&&t.setOpacity(e)},t.PixetorController.prototype.mergeDownLayerAt=function(t){var e=this.getLayerByIndex(t),r=this.getLayerByIndex(t-1);e&&r&&(e=pxtr.utils.LayerUtils.mergeLayers(e,r),this.removeLayerAt(t),this.pixetor.addLayerAt(e,t),this.removeLayerAt(t-1),this.selectLayer(e))},t.PixetorController.prototype.generateLayerName_=function(){for(var t="Layer "+this.layerIdCounter;this.hasLayerForName_(t);)this.layerIdCounter++,t="Layer "+this.layerIdCounter;return t},t.PixetorController.prototype.duplicateCurrentLayer=function(){var t=this.getCurrentLayer(),t=pxtr.utils.LayerUtils.clone(t),e=this.getCurrentLayerIndex();this.pixetor.addLayerAt(t,e+1),this.setCurrentLayerIndex(e+1)},t.PixetorController.prototype.createLayer=function(t){if(t=t||this.generateLayerName_(),this.hasLayerForName_(t))throw"Layer name should be unique";for(var e=new pxtr.model.Layer(t),r=0;r<this.getFrameCount();r++)e.addFrame(this.createEmptyFrame_());t=this.getCurrentLayerIndex();this.pixetor.addLayerAt(e,t+1),this.setCurrentLayerIndex(t+1)},t.PixetorController.prototype.hasLayerForName_=function(t){return 0<this.pixetor.getLayersByName(t).length},t.PixetorController.prototype.moveLayerUp=function(t){var e=this.getCurrentLayer();this.pixetor.moveLayerUp(e,t),this.selectLayer(e)},t.PixetorController.prototype.moveLayerDown=function(t){var e=this.getCurrentLayer();this.pixetor.moveLayerDown(e,t),this.selectLayer(e)},t.PixetorController.prototype.removeCurrentLayer=function(){var t=this.getCurrentLayerIndex();this.removeLayerAt(t)},t.PixetorController.prototype.removeLayerAt=function(t){var e;this.hasLayerAt(t)&&(e=this.getLayerAt(t),this.pixetor.removeLayer(e),this.getCurrentLayerIndex()===t&&this.setCurrentLayerIndex(Math.max(0,t-1)))},t.PixetorController.prototype.serialize=function(){return pxtr.utils.serialization.Serializer.serialize(this.pixetor)},t.PixetorController.prototype.isEmpty=function(){return 0===pxtr.app.currentColorsService.getCurrentColors().length}}(),!function(){var t=$.namespace("pxtr.controller.pixetor");t.PublicPixetorController=function(t){this.pixetorController=t,pxtr.utils.wrap(this,this.pixetorController)},t.PublicPixetorController.prototype.init=function(){this.resetWrap_("setCurrentFrameIndex"),this.resetWrap_("selectNextFrame"),this.resetWrap_("selectPreviousFrame"),this.resetWrap_("setCurrentLayerIndex"),this.resetWrap_("selectLayer"),this.saveWrap_("renameLayerAt",!1),this.saveWrap_("removeCurrentLayer",!0),this.saveWrap_("addFrame",!0),this.saveWrap_("addFrameAtCurrentIndex",!0),this.saveWrap_("addFrameAt",!0),this.saveWrap_("removeFrameAt",!0),this.saveWrap_("duplicateCurrentFrame",!0),this.saveWrap_("duplicateFrameAt",!0),this.saveWrap_("moveFrame",!0),this.saveWrap_("createLayer",!0),this.saveWrap_("duplicateCurrentLayer",!0),this.saveWrap_("mergeDownLayerAt",!0),this.saveWrap_("moveLayerUp",!0),this.saveWrap_("moveLayerDown",!0),this.saveWrap_("removeCurrentLayer",!0),this.saveWrap_("setLayerOpacityAt",!0),this.saveWrap_("toggleFrameVisibilityAt",!0);var t=pxtr.service.keyboard.Shortcuts;pxtr.app.shortcutService.registerShortcut(t.MISC.PREVIOUS_FRAME,this.selectPreviousFrame.bind(this)),pxtr.app.shortcutService.registerShortcut(t.MISC.NEXT_FRAME,this.selectNextFrame.bind(this)),pxtr.app.shortcutService.registerShortcut(t.MISC.NEW_FRAME,this.addFrameAtCurrentIndex.bind(this)),pxtr.app.shortcutService.registerShortcut(t.MISC.DUPLICATE_FRAME,this.duplicateCurrentFrame.bind(this))},t.PublicPixetorController.prototype.getWrappedPixetorController=function(){return this.pixetorController},t.PublicPixetorController.prototype.setPixetor=function(t,e){this.pixetorController.setPixetor(t,e),$.publish(Events.FRAME_SIZE_CHANGED),$.publish(Events.PIXETOR_RESET),e&&e.noSnapshot||$.publish(Events.PIXETOR_SAVE_STATE,{type:pxtr.service.HistoryService.SNAPSHOT})},t.PublicPixetorController.prototype.resetWrap_=function(t){this[t]=function(){this.pixetorController[t].apply(this.pixetorController,arguments),$.publish(Events.PIXETOR_RESET)}},t.PublicPixetorController.prototype.saveWrap_=function(e,t){this[e]=t?function(){var t=this.getStateInfo_();this.pixetorController[e].apply(this.pixetorController,arguments),this.raiseSaveStateEvent_(this.pixetorController[e],arguments,t),$.publish(Events.PIXETOR_RESET)}:function(){var t=this.getStateInfo_();this.pixetorController[e].apply(this.pixetorController,arguments),this.raiseSaveStateEvent_(this.pixetorController[e],arguments,t)}},t.PublicPixetorController.prototype.getStateInfo_=function(){return{frameIndex:this.pixetorController.currentFrameIndex,layerIndex:this.pixetorController.currentLayerIndex}},t.PublicPixetorController.prototype.raiseSaveStateEvent_=function(t,e,r){$.publish(Events.PIXETOR_SAVE_STATE,{type:pxtr.service.HistoryService.REPLAY,scope:this,replay:{fn:t,args:e},state:r})},t.PublicPixetorController.prototype.replay=function(t,e){e.fn.apply(this.pixetorController,e.args)}}(),!function(){var t=$.namespace("pxtr.controller");t.CursorCoordinatesController=function(t){this.pixetorController=t,this.origin=null,this.coordinates={x:-1,y:-1}},t.CursorCoordinatesController.prototype.init=function(){this.coordinatesContainer=document.querySelector(".cursor-coordinates"),$.subscribe(Events.CURSOR_MOVED,this.onCursorMoved_.bind(this)),$.subscribe(Events.DRAG_START,this.onDragStart_.bind(this)),$.subscribe(Events.DRAG_END,this.onDragEnd_.bind(this)),$.subscribe(Events.FRAME_SIZE_CHANGED,this.redraw.bind(this)),$.subscribe(Events.ZOOM_CHANGED,this.redraw.bind(this)),$.subscribe(Events.PIXETOR_RESET,this.redraw.bind(this)),this.redraw()},t.CursorCoordinatesController.prototype.redraw=function(){var t="",e=(this.origin&&(t+=this.origin.x+":"+this.origin.y+" to "),this.coordinates.x),r=this.coordinates.y;this.pixetorController.getCurrentFrame().containsPixel(e,r)&&(t+=e+":"+r,this.origin&&(t+=" ("+(Math.abs(e-this.origin.x)+1)+"x"+(Math.abs(r-this.origin.y)+1)+")")),pxtr.app.drawingController&&(t+='<div class="drawing-zoom">x'+pxtr.app.drawingController.compositeRenderer.getZoom().toFixed(2)+"</div>"),this.coordinatesContainer.innerHTML=this.getFrameSizeHTML_()+t+this.getCurrentFrameIndexHTML_()},t.CursorCoordinatesController.prototype.getCurrentFrameIndexHTML_=function(){return'<div class="frame-info">'+(this.pixetorController.getCurrentFrameIndex()+1)+"/"+this.pixetorController.getFrameCount()+"</div>"},t.CursorCoordinatesController.prototype.getFrameSizeHTML_=function(){return"["+this.pixetorController.getWidth()+"x"+this.pixetorController.getHeight()+"] "},t.CursorCoordinatesController.prototype.onCursorMoved_=function(t,e,r){this.coordinates={x:e,y:r},this.redraw()},t.CursorCoordinatesController.prototype.onDragStart_=function(t,e,r){this.origin={x:e,y:r},this.redraw()},t.CursorCoordinatesController.prototype.onDragEnd_=function(t){this.origin=null,this.redraw()}}(),!function(){var r=$.namespace("pxtr.controller");r.DrawingController=function(t,e){this.pixetorController=t,this.dragHandler=new r.drawing.DragHandler(this),this.overlayFrame=pxtr.model.Frame.createEmptyFromFrame(t.getCurrentFrame()),this.container=e;e={zoom:this.calculateZoom_(),supportGridRendering:!1,height:this.getContainerHeight_(),width:this.getContainerWidth_(),xOffset:0,yOffset:0};this.overlayRenderer=new pxtr.rendering.frame.CachedFrameRenderer(this.container,e,["canvas-overlay"]),this.onionSkinRenderer=pxtr.rendering.OnionSkinRenderer.createInContainer(this.container,e,t),this.layersRenderer=new pxtr.rendering.layer.LayersRenderer(this.container,e,t),e.supportGridRendering=!0,this.renderer=new pxtr.rendering.frame.CachedFrameRenderer(this.container,e,["drawing-canvas"]),this.compositeRenderer=new pxtr.rendering.CompositeRenderer,this.compositeRenderer.add(this.overlayRenderer).add(this.renderer).add(this.layersRenderer).add(this.onionSkinRenderer),this.isClicked=!1,this.previousMousemoveTime=0,this.currentToolBehavior=null},r.DrawingController.prototype.init=function(){this.initMouseBehavior(),$.subscribe(Events.TOOL_SELECTED,function(t,e){this.currentToolBehavior=e,this.overlayFrame.clear()}.bind(this)),window.addEventListener("resize",this.startResizeTimer_.bind(this)),$.subscribe(Events.USER_SETTINGS_CHANGED,this.onUserSettingsChange_.bind(this)),$.subscribe(Events.FRAME_SIZE_CHANGED,this.onFrameSizeChange_.bind(this));var t=pxtr.service.keyboard.Shortcuts;pxtr.app.shortcutService.registerShortcut(t.MISC.RESET_ZOOM,this.resetZoom_.bind(this)),pxtr.app.shortcutService.registerShortcut(t.MISC.INCREASE_ZOOM,this.updateZoom_.bind(this,1)),pxtr.app.shortcutService.registerShortcut(t.MISC.DECREASE_ZOOM,this.updateZoom_.bind(this,-1)),pxtr.app.shortcutService.registerShortcut(t.MISC.OFFSET_UP,this.updateOffset_.bind(this,"up")),pxtr.app.shortcutService.registerShortcut(t.MISC.OFFSET_RIGHT,this.updateOffset_.bind(this,"right")),pxtr.app.shortcutService.registerShortcut(t.MISC.OFFSET_DOWN,this.updateOffset_.bind(this,"down")),pxtr.app.shortcutService.registerShortcut(t.MISC.OFFSET_LEFT,this.updateOffset_.bind(this,"left")),window.setTimeout(function(){this.afterWindowResize_(),this.resetZoom_()}.bind(this),100)},r.DrawingController.prototype.initMouseBehavior=function(){this.container.addEventListener("mousedown",this.onMousedown_.bind(this)),pxtr.utils.UserAgent.isChrome||pxtr.utils.UserAgent.isIE11?this.container.addEventListener("mousewheel",this.onMousewheel_.bind(this)):this.container.addEventListener("wheel",this.onMousewheel_.bind(this)),window.addEventListener("mouseup",this.onMouseup_.bind(this)),window.addEventListener("mousemove",this.onMousemove_.bind(this)),window.addEventListener("keyup",this.onKeyup_.bind(this)),window.addEventListener("touchstart",this.onTouchstart_.bind(this)),window.addEventListener("touchmove",this.onTouchmove_.bind(this)),window.addEventListener("touchend",this.onTouchend_.bind(this)),document.body.addEventListener("contextmenu",this.onCanvasContextMenu_.bind(this))},r.DrawingController.prototype.startResizeTimer_=function(){this.resizeTimer&&window.clearInterval(this.resizeTimer),this.resizeTimer=window.setTimeout(this.afterWindowResize_.bind(this),200)},r.DrawingController.prototype.afterWindowResize_=function(){var t=this.compositeRenderer.getDisplaySize().width;this.compositeRenderer.setDisplaySize(this.getContainerWidth_(),this.getContainerHeight_());t=this.compositeRenderer.getDisplaySize().width/t*this.compositeRenderer.getZoom();this.compositeRenderer.setZoom(t),$.publish(Events.ZOOM_CHANGED)},r.DrawingController.prototype.onUserSettingsChange_=function(t,e,r){e==pxtr.UserSettings.SHOW_GRID?console.warn("DrawingController:onUserSettingsChange_ not implemented !"):e!=pxtr.UserSettings.ONION_SKIN&&e!=pxtr.UserSettings.LAYER_PREVIEW||(this.onionSkinRenderer.clear(),this.onionSkinRenderer.flush(),this.layersRenderer.clear(),this.layersRenderer.flush(),this.render())},r.DrawingController.prototype.onFrameSizeChange_=function(){this.compositeRenderer.setDisplaySize(this.getContainerWidth_(),this.getContainerHeight_()),this.compositeRenderer.setZoom(this.calculateZoom_()),this.compositeRenderer.setOffset(0,0),$.publish(Events.ZOOM_CHANGED)},r.DrawingController.prototype.onTouchstart_=function(t){this.onMousedown_(t)},r.DrawingController.prototype.onTouchmove_=function(t){this.onMousemove_(t),t.preventDefault()},r.DrawingController.prototype.onTouchend_=function(t){this.onMouseup_(t)},r.DrawingController.prototype.onMousedown_=function(t){$.publish(Events.MOUSE_EVENT,[t,this]);var e=this.pixetorController.getCurrentFrame(),r=this.getSpriteCoordinates(t.clientX,t.clientY);t.changedTouches&&t.changedTouches[0]&&(r=this.getSpriteCoordinates(t.changedTouches[0].clientX,t.changedTouches[0].clientY)),this.isClicked=!0,t.button===Constants.MIDDLE_BUTTON?this.dragHandler.startDrag(t.clientX,t.clientY):t.altKey&&!this.currentToolBehavior.supportsAlt()?(this.currentToolBehavior.hideHighlightedPixel(this.overlayFrame),this.isPickingColor=!0):(this.currentToolBehavior.hideHighlightedPixel(this.overlayFrame),$.publish(Events.TOOL_PRESSED),this.currentToolBehavior.applyToolAt(r.x,r.y,e,this.overlayFrame,t))},r.DrawingController.prototype.onMousemove_=function(t){this._clientX=t.clientX,this._clientY=t.clientY,t.changedTouches&&t.changedTouches[0]&&(this._clientX=t.changedTouches[0].clientX,this._clientY=t.changedTouches[0].clientY);var e=(new Date).getTime();e-this.previousMousemoveTime>Constants.MOUSEMOVE_THROTTLING&&(this.moveTool_(this._clientX,this._clientY,t),this.previousMousemoveTime=e)},r.DrawingController.prototype.onKeyup_=function(t){this.moveTool_(this._clientX,this._clientY,t)},r.DrawingController.prototype.moveTool_=function(t,e,r){var i=this.getSpriteCoordinates(t,e),o=this.pixetorController.getCurrentFrame();this.isClicked?pxtr.app.mouseStateService.isMiddleButtonPressed()?this.dragHandler.updateDrag(t,e):this.isPickingColor||($.publish(Events.MOUSE_EVENT,[r,this]),this.currentToolBehavior.moveToolAt(0|i.x,0|i.y,o,this.overlayFrame,r)):this.currentToolBehavior.moveUnactiveToolAt(i.x,i.y,o,this.overlayFrame,r),$.publish(Events.CURSOR_MOVED,[i.x,i.y])},r.DrawingController.prototype.onMousewheel_=function(t){var e=pxtr.utils.UserAgent.isIE11?t.wheelDelta:pxtr.utils.UserAgent.isFirefox?-40*t.deltaY:t.wheelDeltaY,e=(e=e||0)/120,t=((pxtr.utils.UserAgent.isMac?t.metaKey:t.ctrlKey)&&(e*=5,t.preventDefault()),this.getSpriteCoordinates(t.clientX,t.clientY));this.updateZoom_(e,t)},r.DrawingController.prototype.updateOffset_=function(t){var e=this.getOffset();"up"===t?--e.y:"right"===t?e.x+=1:"down"===t?e.y+=1:"left"===t&&--e.x,this.setOffset(e.x,e.y)},r.DrawingController.prototype.updateZoom_=function(t,e){var r,i,o,n,s;0!==t&&(r=this.getOffset(),i=this.getContainerWidth_()/this.renderer.getZoom(),o=this.getContainerHeight_()/this.renderer.getZoom(),t=t*this.getZoomStep_(),this.setZoom_(this.renderer.getZoom()+t),"object"==typeof e&&(t=(e.x-r.x)/i,e=(e.y-r.y)/o,n=this.getContainerWidth_()/this.renderer.getZoom(),s=this.getContainerHeight_()/this.renderer.getZoom(),this.setOffset(r.x-(n-i)*t,r.y-(s-o)*e)))},r.DrawingController.prototype.onMouseup_=function(t){var e,r,i;this.isClicked&&(e=this.getSpriteCoordinates(t.clientX,t.clientY),t.changedTouches&&t.changedTouches[0]&&(e=this.getSpriteCoordinates(t.changedTouches[0].clientX,t.changedTouches[0].clientY)),this.isClicked=!1,r=(i=pxtr.app.mouseStateService.isMiddleButtonPressed())&&!this.dragHandler.isDragging(),i=i&&this.dragHandler.isDragging(),this.isPickingColor||r?(this.pickColorAt_(e),this.isPickingColor=!1,this.flashColorPicker_()):i?this.dragHandler.stopDrag():(this.currentToolBehavior.releaseToolAt(e.x,e.y,this.pixetorController.getCurrentFrame(),this.overlayFrame,t),$.publish(Events.TOOL_RELEASED)),$.publish(Events.MOUSE_EVENT,[t,this]))},r.DrawingController.prototype.pickColorAt_=function(t){var e=this.pixetorController.getCurrentFrame();e.containsPixel(t.x,t.y)&&(e=pxtr.utils.intToColor(e.getPixel(t.x,t.y)),t=pxtr.app.mouseStateService.isRightButtonPressed()?Events.SELECT_SECONDARY_COLOR:Events.SELECT_PRIMARY_COLOR,$.publish(t,[e]))},r.DrawingController.prototype.flashColorPicker_=function(){document.body.classList.add("tool-colorpicker"),document.body.classList.remove(this.currentToolBehavior.toolId),window.clearTimeout(this.flashColorPickerTimer),this.flashColorPickerTimer=window.setTimeout(function(){document.body.classList.remove("tool-colorpicker"),document.body.classList.add(this.currentToolBehavior.toolId)}.bind(this),200)},r.DrawingController.prototype.getSpriteCoordinates=function(t,e){return this.renderer.getCoordinates(t,e)},r.DrawingController.prototype.getScreenCoordinates=function(t,e){return this.renderer.reverseCoordinates(t,e)},r.DrawingController.prototype.onCanvasContextMenu_=function(t){if(t.target.closest&&t.target.closest("#drawing-canvas-container"))return t.preventDefault(),t.stopPropagation(),!(t.cancelBubble=!0)},r.DrawingController.prototype.render=function(){var t=this.pixetorController.getCurrentFrame();t.isSameSize(this.overlayFrame)||(this.overlayFrame=pxtr.model.Frame.createEmptyFromFrame(t)),pxtr.UserSettings.get(pxtr.UserSettings.ONION_SKIN)&&this.onionSkinRenderer.render(),pxtr.UserSettings.get(pxtr.UserSettings.LAYER_PREVIEW)&&this.layersRenderer.render(),this.renderer.render(t),this.overlayRenderer.render(this.overlayFrame)},r.DrawingController.prototype.calculateZoom_=function(){var t=this.pixetorController.getCurrentFrame().getHeight(),e=this.pixetorController.getCurrentFrame().getWidth();return Math.min(this.getAvailableWidth_()/e,this.getAvailableHeight_()/t)},r.DrawingController.prototype.getAvailableHeight_=function(){return document.querySelector("#main-wrapper").getBoundingClientRect().height},r.DrawingController.prototype.getSelectorWidth_=function(t){return document.querySelector(t).getBoundingClientRect().width},r.DrawingController.prototype.getAvailableWidth_=function(){var t=this.getSelectorWidth_(".left-column")+this.getSelectorWidth_(".right-column")+this.getSelectorWidth_("#tool-section")+this.getSelectorWidth_("#application-action-section");return this.getSelectorWidth_("#main-wrapper")-t-10},r.DrawingController.prototype.getContainerHeight_=function(){return this.getAvailableHeight_()},r.DrawingController.prototype.getContainerWidth_=function(){return this.getAvailableWidth_()},r.DrawingController.prototype.getRenderer=function(){return this.compositeRenderer},r.DrawingController.prototype.getOffset=function(){return this.compositeRenderer.getOffset()},r.DrawingController.prototype.setOffset=function(t,e){this.compositeRenderer.setOffset(t,e),$.publish(Events.ZOOM_CHANGED)},r.DrawingController.prototype.resetZoom_=function(){this.setZoom_(this.calculateZoom_())},r.DrawingController.prototype.getZoomStep_=function(){return Math.max(.1,this.renderer.getZoom()/15)},r.DrawingController.prototype.setZoom_=function(t){this.compositeRenderer.setZoom(t),$.publish(Events.ZOOM_CHANGED)}}(),!function(){var t=$.namespace("pxtr.controller.drawing");t.DragHandler=function(t){this.drawingController=t,this.isDragging_=!1,this.updateOrigin_(-1,-1)},t.DragHandler.prototype.startDrag=function(t,e){t=this.drawingController.getSpriteCoordinates(t,e);this.updateOrigin_(t.x,t.y)},t.DragHandler.prototype.updateDrag=function(t,e){var r=this.drawingController.getOffset(),i=this.calculateOffset_(t,e);r.y===i.y&&r.x===i.x||(this.isDragging_=!0,this.drawingController.setOffset(i.x,i.y),r=this.drawingController.getSpriteCoordinates(t,e),this.updateOrigin_(r.x,r.y))},t.DragHandler.prototype.stopDrag=function(){this.isDragging_=!1,this.origin=null},t.DragHandler.prototype.isDragging=function(){return this.isDragging_},t.DragHandler.prototype.calculateOffset_=function(t,e){t=this.drawingController.getSpriteCoordinates(t,e),e=this.drawingController.getOffset();return{x:e.x-2*(t.x-this.origin.x),y:e.y-2*(t.y-this.origin.y)}},t.DragHandler.prototype.updateOrigin_=function(t,e){this.origin=this.origin||{},this.origin.x=t,this.origin.y=e}}(),!function(){var t=$.namespace("pxtr.controller"),n="select",s="clone",a="delete",o="newframe",l="toggle";t.FramesListController=function(t,e){this.pixetorController=t,this.container=e,this.previewList=e.querySelector("#preview-list"),this.refreshZoom_(),this.redrawFlag=!0,this.regenerateDomFlag=!0,this.justDropped=!1,this.cachedFrameProcessor=new pxtr.model.frame.CachedFrameProcessor,this.cachedFrameProcessor.setFrameProcessor(this.frameToPreviewCanvas_.bind(this)),this.cachedFrameProcessor.setOutputCloner(this.clonePreviewCanvas_.bind(this)),this.initDragndropBehavior_()},t.FramesListController.prototype.init=function(){$.subscribe(Events.TOOL_RELEASED,this.flagForRedraw_.bind(this)),$.subscribe(Events.PIXETOR_RESET,this.flagForRedraw_.bind(this,!0)),$.subscribe(Events.USER_SETTINGS_CHANGED,this.flagForRedraw_.bind(this)),$.subscribe(Events.PIXETOR_RESET,this.refreshZoom_.bind(this)),this.previewListScroller=document.querySelector("#preview-list-scroller"),this.previewListScroller.addEventListener("scroll",this.updateScrollerOverflows.bind(this)),this.container.addEventListener("click",this.onContainerClick_.bind(this)),this.updateScrollerOverflows()},t.FramesListController.prototype.flagForRedraw_=function(t){this.redrawFlag=!0,t&&(this.regenerateDomFlag=!0)},t.FramesListController.prototype.refreshZoom_=function(){this.zoom=this.calculateZoom_()},t.FramesListController.prototype.render=function(){this.redrawFlag&&(this.regenerateDomFlag&&(this.tiles=[],this.addFrameTile=null,this.createPreviews_(),this.regenerateDomFlag=!1),this.updatePreviews_(),this.redrawFlag=!1)},t.FramesListController.prototype.updateScrollerOverflows=function(){var t=this.previewListScroller,e=t.offsetHeight,t=t.scrollTop,r=this.previewList.offsetHeight,i=this.container.querySelector(".top-overflow").offsetHeight,o=!1,n=!1;e<r&&(i<t&&(o=!0),i<r-t-e&&(n=!0)),this.container.classList.toggle("top-overflow-visible",o),this.container.classList.toggle("bottom-overflow-visible",n)},t.FramesListController.prototype.onContainerClick_=function(t){var e,r,t=pxtr.utils.Dom.getParentWithData(t.target,"tileAction");t&&(e=t.dataset.tileAction,t=parseInt(t.dataset.tileNumber,10),e===s?(this.pixetorController.duplicateFrameAt(t),r=this.createPreviewTile_(t+1),this.previewList.insertBefore(r,this.tiles[t].nextSibling),this.tiles.splice(t,0,r),this.updateScrollerOverflows()):e===a?(this.pixetorController.removeFrameAt(t),this.previewList.removeChild(this.tiles[t]),this.tiles.splice(t,1),this.updateScrollerOverflows()):e!==n||this.justDropped?e===o?(this.pixetorController.addFrame(),r=this.createPreviewTile_(this.tiles.length),this.tiles.push(r),this.previewList.insertBefore(r,this.addFrameTile),this.updateScrollerOverflows()):e==l&&this.pixetorController.toggleFrameVisibilityAt(t):this.pixetorController.setCurrentFrameIndex(t),this.flagForRedraw_())},t.FramesListController.prototype.updatePreviews_=function(){for(var t=0,e=this.tiles.length;t<e;t++){this.tiles[t].classList.remove("selected"),this.tiles[t].querySelector(".tile-count").classList.remove("toggled"),this.tiles[t].setAttribute("data-tile-number",t),this.tiles[t].querySelector(".tile-count").innerHTML=t+1,this.pixetorController.hasVisibleFrameAt(t)&&this.tiles[t].querySelector(".tile-count").classList.add("toggled");var r=this.pixetorController.getCurrentLayer().getFrameAt(t).getHash();this.tiles[t].getAttribute("data-tile-hash")!==r&&(this.tiles[t].querySelector("canvas")?this.tiles[t].querySelector(".canvas-container").replaceChild(this.getCanvasForFrame(this.pixetorController.getCurrentLayer().getFrameAt(t)),this.tiles[t].querySelector("canvas")):this.tiles[t].querySelector(".canvas-container").appendChild(this.getCanvasForFrame(this.pixetorController.getCurrentLayer().getFrameAt(t))))}var i=this.container.querySelectorAll(".delete-frame-action, .dnd-action"),o=1<this.pixetorController.getFrameCount()?"block":"none";for(t=0,e=i.length;t<e;t++)i[t].style.display=o;this.tiles[this.pixetorController.getCurrentFrameIndex()].classList.add("selected")},t.FramesListController.prototype.createPreviews_=function(){this.previewList.innerHTML="";for(var t=document.querySelectorAll(".tooltip"),e=(Array.prototype.forEach.call(t,function(t){t.parentNode.removeChild(t)}),this.pixetorController.getFrameCount()),r=0;r<e;r++){var i=this.createPreviewTile_(r);this.previewList.appendChild(i),this.tiles[r]=i}t=document.createElement("div");t.id="add-frame-action",t.className="add-frame-action",t.setAttribute("data-tile-action",o),t.innerHTML='<div class="add-frame-action-icon icon-frame-plus-white"></div><div class="label">Add new frame</div>',this.previewList.appendChild(t),this.addFrameTile=t,this.updateScrollerOverflows()},t.FramesListController.prototype.initDragndropBehavior_=function(){$(this.previewList).sortable({placeholder:"preview-tile preview-tile-drop-proxy",update:this.onUpdate_.bind(this),stop:this.onSortableStop_.bind(this),items:".preview-tile",axis:"y",tolerance:"pointer"}),$(this.previewList).disableSelection()},t.FramesListController.prototype.onUpdate_=function(t,e){var e=e.item.get(0),r=parseInt(e.dataset.tileNumber,10),i=document.querySelectorAll(".preview-tile"),i=Array.prototype.indexOf.call(i,e),e=(this.pixetorController.moveFrame(r,i),this.pixetorController.setCurrentFrameIndex(i),this.tiles.splice(r,1)[0]);this.tiles.splice(i,0,e),this.flagForRedraw_()},t.FramesListController.prototype.onSortableStop_=function(t,e){this.justDropped=!0,this.resizeTimer=window.setTimeout(function(){this.justDropped=!1}.bind(this),200)},t.FramesListController.prototype.createPreviewTile_=function(t){var e=this.pixetorController.getCurrentLayer().getFrameAt(t),r=document.createElement("li"),i=(r.setAttribute("data-tile-number",t),r.setAttribute("data-tile-hash",e.getHash()),r.setAttribute("data-tile-action",n),r.classList.add("preview-tile"),this.pixetorController.getCurrentFrame()==e&&r.classList.add("selected"),document.createElement("div")),o=(i.classList.add("canvas-container",pxtr.UserSettings.get(pxtr.UserSettings.CANVAS_BACKGROUND)),this.zoom*this.pixetorController.getCurrentFrame().getHeight()),o=(Constants.PREVIEW_FILM_SIZE-o)/2,o=(i.style.marginTop=o+"px",this.zoom*this.pixetorController.getCurrentFrame().getWidth()),o=(Constants.PREVIEW_FILM_SIZE-o)/2,o=(i.style.marginLeft=o+"px",i.style.marginRight=o+"px",document.createElement("div")),o=(o.className="canvas-background",i.appendChild(o),i.appendChild(this.getCanvasForFrame(e)),r.appendChild(i),document.createElement("button")),e=(o.setAttribute("rel","tooltip"),o.setAttribute("data-placement","right"),o.setAttribute("data-tile-number",t),o.setAttribute("data-tile-action",s),o.setAttribute("title","Duplicate this frame"),o.className="tile-overlay duplicate-frame-action icon-frame-duplicate-white",r.appendChild(o),document.createElement("button")),i=(e.setAttribute("rel","tooltip"),e.setAttribute("data-placement","right"),e.setAttribute("title","Delete this frame"),e.setAttribute("data-tile-number",t),e.setAttribute("data-tile-action",a),e.className="tile-overlay delete-frame-action icon-frame-recyclebin-white",r.appendChild(e),document.createElement("div")),o=(i.className="tile-overlay dnd-action icon-frame-dragndrop-white",r.appendChild(i),document.createElement("button"));return o.setAttribute("rel","tooltip"),o.setAttribute("title","Toggle for preview"),o.setAttribute("data-tile-number",t),o.setAttribute("data-tile-action",l),o.className="tile-overlay tile-count toggle-frame-action",o.innerHTML=t+1,r.appendChild(o),r},t.FramesListController.prototype.getCanvasForFrame=function(t){return this.cachedFrameProcessor.get(t,this.zoom)},t.FramesListController.prototype.frameToPreviewCanvas_=function(t){t=new pxtr.rendering.CanvasRenderer(t,this.zoom),t.drawTransparentAs(Constants.TRANSPARENT_COLOR),t=t.render();return t.classList.add("tile-view","canvas"),t},t.FramesListController.prototype.clonePreviewCanvas_=function(t){t=pxtr.utils.CanvasUtils.clone(t);return t.classList.add("tile-view","canvas"),t},t.FramesListController.prototype.calculateZoom_=function(){var t=this.pixetorController.getCurrentFrame(),t=Math.max(t.getHeight(),t.getWidth());return Constants.PREVIEW_FILM_SIZE/t}}(),!function(){var t=$.namespace("pxtr.controller");t.HeaderController=function(t,e){this.pixetorController=t,this.savedStatusService=e},t.HeaderController.prototype.init=function(){this.pixetorName_=document.querySelector(".pixetor-name"),$.subscribe(Events.BEFORE_SAVING_PIXETOR,this.onBeforeSavingPixetorEvent_.bind(this)),$.subscribe(Events.AFTER_SAVING_PIXETOR,this.onAfterSavingPixetorEvent_.bind(this)),$.subscribe(Events.PIXETOR_DESCRIPTOR_UPDATED,this.updateHeader_.bind(this)),$.subscribe(Events.PIXETOR_RESET,this.updateHeader_.bind(this)),$.subscribe(Events.PIXETOR_SAVED_STATUS_UPDATE,this.updateHeader_.bind(this)),this.updateHeader_()},t.HeaderController.prototype.updateHeader_=function(){try{var t=this.pixetorController.getPixetor().getDescriptor().name;this.savedStatusService.isDirty()&&(t+=" *"),this.pixetorName_&&(this.pixetorName_.textContent=t)}catch(t){console.warn("Could not update header : "+t.message)}},t.HeaderController.prototype.onBeforeSavingPixetorEvent_=function(){this.pixetorName_&&this.pixetorName_.classList.add("pixetor-name-saving")},t.HeaderController.prototype.onAfterSavingPixetorEvent_=function(){this.pixetorName_&&this.pixetorName_.classList.remove("pixetor-name-saving")}}(),!function(){var t=$.namespace("pxtr.controller");t.LayersListController=function(t){this.pixetorController=t,this.layerPreviewShortcut=pxtr.service.keyboard.Shortcuts.MISC.LAYER_PREVIEW,this.startRenamingCurrentLayer_=this.startRenamingCurrentLayer_.bind(this),this.onRenameInput_=this.onRenameInput_.bind(this)},t.LayersListController.prototype.init=function(){this.isRenaming=!1,this.layerItemTemplate_=pxtr.utils.Template.get("layer-item-template"),this.layerNameInputTemplate_=pxtr.utils.Template.get("layer-name-input-template"),this.rootEl=document.querySelector(".layers-list-container"),this.layersListEl=document.querySelector(".layers-list"),this.toggleLayerPreviewEl=document.querySelector(".layers-toggle-preview"),this.rootEl.addEventListener("click",this.onClick_.bind(this)),this.toggleLayerPreviewEl.addEventListener("click",this.toggleLayerPreview_.bind(this)),this.createButtonTooltips_(),this.initToggleLayerPreview_(),this.renderLayerList_(),this.updateToggleLayerPreview_(),$.subscribe(Events.PIXETOR_RESET,this.renderLayerList_.bind(this)),$.subscribe(Events.USER_SETTINGS_CHANGED,this.onUserSettingsChange_.bind(this))},t.LayersListController.prototype.renderLayerList_=function(){var t=this.layersListEl.scrollTop;this.layersListEl.innerHTML="";this.pixetorController.getLayers().forEach(this.addLayerItem.bind(this)),this.updateButtonStatus_(),this.layersListEl.scrollTop=t;t=this.layersListEl.querySelector(".current-layer-item");t&&t.scrollIntoViewIfNeeded(!1)},t.LayersListController.prototype.createButtonTooltips_=function(){var t=pxtr.utils.TooltipFormatter.format("Create a layer",null,[{key:"shift",description:"Clone current layer"}]),t=(this.rootEl.querySelector('[data-action="add"]').setAttribute("title",t),pxtr.utils.TooltipFormatter.format("Move layer down",null,[{key:"shift",description:"Move to the bottom"}])),t=(this.rootEl.querySelector('[data-action="down"]').setAttribute("title",t),pxtr.utils.TooltipFormatter.format("Move layer up",null,[{key:"shift",description:"Move to the top"}]));this.rootEl.querySelector('[data-action="up"]').setAttribute("title",t)},t.LayersListController.prototype.initToggleLayerPreview_=function(){pxtr.app.shortcutService.registerShortcut(this.layerPreviewShortcut,this.toggleLayerPreview_.bind(this));var t=pxtr.utils.TooltipFormatter.format("Preview all layers",this.layerPreviewShortcut,[{description:"Opacity defined in PREFERENCES"}]);this.toggleLayerPreviewEl.setAttribute("title",t)},t.LayersListController.prototype.updateButtonStatus_=function(){var t=this.pixetorController.getLayers(),e=this.pixetorController.getCurrentLayerIndex(),r=0===e,i=1===t.length,e=e===t.length-1;this.toggleButtonDisabledState_("up",e),this.toggleButtonDisabledState_("down",r),this.toggleButtonDisabledState_("merge",r),this.toggleButtonDisabledState_("delete",i)},t.LayersListController.prototype.toggleButtonDisabledState_=function(t,e){t=document.querySelector('.layers-button[data-action="'+t+'"]');e?(t.setAttribute("disabled","disabled"),t.blur()):t.removeAttribute("disabled")},t.LayersListController.prototype.updateToggleLayerPreview_=function(){var t="layers-toggle-preview-enabled";pxtr.UserSettings.get(pxtr.UserSettings.LAYER_PREVIEW)?this.toggleLayerPreviewEl.classList.add(t):this.toggleLayerPreviewEl.classList.remove(t)},t.LayersListController.prototype.onUserSettingsChange_=function(t,e,r){e==pxtr.UserSettings.LAYER_PREVIEW&&this.updateToggleLayerPreview_()},t.LayersListController.prototype.addLayerItem=function(t,e){var r,i=this.pixetorController.getCurrentLayer()===t,o=i&&this.isRenaming,e=pxtr.utils.Template.replace(this.layerItemTemplate_,{layername:t.getName(),layerindex:e,"isselected:current-layer-item":i,opacity:t.getOpacity()}),e=pxtr.utils.Template.createFromHTML(e),i=(this.layersListEl.insertBefore(e,this.layersListEl.firstChild),e.offsetWidth<e.scrollWidth&&((r=e.querySelector(".layer-name")).classList.add("overflowing-name"),r.setAttribute("title",t.getName()),r.setAttribute("rel","tooltip")),i&&(e.removeEventListener("dblclick",this.startRenamingCurrentLayer_),e.addEventListener("dblclick",this.startRenamingCurrentLayer_)),o&&(i=pxtr.utils.Template.replace(this.layerNameInputTemplate_,{layername:t.getName()}),o=pxtr.utils.Template.createFromHTML(i),r=e.querySelector(".layer-name"),e.replaceChild(o,r),o.removeEventListener("blur",this.onRenameInput_),o.removeEventListener("keydown",this.onRenameInput_),o.addEventListener("blur",this.onRenameInput_),o.addEventListener("keydown",this.onRenameInput_),o.focus(),o.select()),t.getOpacity());e.querySelector(".layer-item-opacity").style.color=1==i?"#ffd700":0==i?"#969696":"#ffffff"},t.LayersListController.prototype.onClick_=function(t){var e,r=t.target||t.srcElement;r.classList.contains("button")?this.onButtonClick_(r,t):r.classList.contains("layer-name")?(t=this.pixetorController.getCurrentLayerIndex(),(e=pxtr.utils.Dom.getData(r,"layerIndex"))!=t&&(r.parentElement.parentElement.querySelector(".current-layer-item").removeEventListener("dblclick",this.startRenamingCurrentLayer_),this.pixetorController.setCurrentLayerIndex(parseInt(e,10)))):r.classList.contains("layer-item-opacity")&&(e=pxtr.utils.Dom.getData(r,"layerIndex"),t=this.pixetorController.getLayerAt(parseInt(e,10)),r=window.prompt("Set layer opacity (value between 0 and 1)",t.getOpacity()),this.pixetorController.setLayerOpacityAt(e,r))},t.LayersListController.prototype.startRenamingCurrentLayer_=function(){this.isRenaming=!0,this.renderLayerList_()},t.LayersListController.prototype.onRenameInput_=function(t){var e=t.target||t.srcElement;"Enter"===t.key?this.finishRenamingCurrentLayer_(e,e.value):t.key&&"Escape"!==t.key||this.finishRenamingCurrentLayer_(e)},t.LayersListController.prototype.finishRenamingCurrentLayer_=function(t,e){var r;e&&(r=this.pixetorController.getCurrentLayerIndex(),this.pixetorController.renameLayerAt(r,e)),t.removeEventListener("blur",this.onRenameInput_),t.removeEventListener("keydown",this.onRenameInput_),this.isRenaming=!1,this.renderLayerList_()},t.LayersListController.prototype.mergeDownCurrentLayer_=function(){var t=this.pixetorController.getCurrentLayerIndex();this.pixetorController.mergeDownLayerAt(t),this.renderLayerList_()},t.LayersListController.prototype.onButtonClick_=function(t,e){t=t.getAttribute("data-action");"up"==t?this.pixetorController.moveLayerUp(e.shiftKey):"down"==t?this.pixetorController.moveLayerDown(e.shiftKey):"add"==t?e.shiftKey?this.pixetorController.duplicateCurrentLayer():this.pixetorController.createLayer():"delete"==t?this.pixetorController.removeCurrentLayer():"merge"==t?this.mergeDownCurrentLayer_():"edit"==t&&this.startRenamingCurrentLayer_()},t.LayersListController.prototype.toggleLayerPreview_=function(){var t=pxtr.UserSettings.get(pxtr.UserSettings.LAYER_PREVIEW),e=pxtr.UserSettings.get(pxtr.UserSettings.LAYER_OPACITY),t=!t;pxtr.UserSettings.set(pxtr.UserSettings.LAYER_PREVIEW,t),t&&0===e&&pxtr.UserSettings.set(pxtr.UserSettings.LAYER_OPACITY,Constants.DEFAULT.LAYER_OPACITY)}}(),!function(){var t=$.namespace("pxtr.controller.preview");t.PopupPreviewController=function(t){this.pixetorController=t,this.popup=null,this.renderer=null,this.renderFlag=!1},t.PopupPreviewController.prototype.init=function(){pxtr.utils.Event.addEventListener(window,"unload",this.onMainWindowUnload_,this)},t.PopupPreviewController.prototype.isOpen=function(){return!!this.popup},t.PopupPreviewController.prototype.open=function(){this.isOpen()?this.popup.focus():(this.popup=window.open("about:blank","","width=320,height=320"),window.setTimeout(this.onPopupLoaded.bind(this),500))},t.PopupPreviewController.prototype.onPopupLoaded=function(){this.popup.document.title="Pixetor - preview",this.popup.document.body.innerHTML=pxtr.utils.Template.get("popup-preview-partial"),pxtr.utils.Event.addEventListener(this.popup,"resize",this.onWindowResize_,this),pxtr.utils.Event.addEventListener(this.popup,"unload",this.onPopupClosed_,this);var t=this.popup.document.querySelector(".preview-container");this.renderer=new pxtr.rendering.frame.BackgroundImageFrameRenderer(t),this.updateZoom_(),this.renderFlag=!0},t.PopupPreviewController.prototype.render=function(t){this.isOpen()&&this.renderer&&(this.renderer.render(t),this.renderFlag=!1)},t.PopupPreviewController.prototype.onWindowResize_=function(t){this.updateZoom_(),this.renderFlag=!0},t.PopupPreviewController.prototype.updateZoom_=function(){var t=this.popup.document.documentElement,e=t.clientWidth/this.pixetorController.getWidth(),r=t.clientHeight/this.pixetorController.getHeight(),e=Math.min(e,r),r=(this.renderer.setZoom(e),this.pixetorController.getHeight()*e),e=this.pixetorController.getWidth()*e,i=this.popup.document.querySelector(".preview-container"),r=(i.style.height=r+"px",i.style.width=e+"px",(t.clientHeight-r)/2),r=(i.style.marginTop=r+"px",i.style.marginBottom=r+"px",(t.clientWidth-e)/2);i.style.marginLeft=r+"px",i.style.marginRight=r+"px"},t.PopupPreviewController.prototype.onPopupClosed_=function(){this.popup;this.popup=null},t.PopupPreviewController.prototype.onMainWindowUnload_=function(){this.isOpen()&&this.popup.close()}}(),!function(){var t=$.namespace("pxtr.controller.preview");t.PreviewActionsController=function(t,e){this.previewController=t,this.pixetorController=t.pixetorController,this.container=e,this.onionSkinShortcut=pxtr.service.keyboard.Shortcuts.MISC.ONION_SKIN,this.toggleGridShortcut=pxtr.service.keyboard.Shortcuts.MISC.TOGGLE_GRID,this.fpsRangeInput=document.querySelector("#preview-fps"),this.fpsCounterDisplay=document.querySelector("#display-fps"),this.openPopupPreview=document.querySelector(".open-popup-preview-button"),this.toggleGridButton=document.querySelector(".toggle-grid-button"),this.previewSizeDropdown=document.querySelector(".preview-drop-down"),this.previewSizes={original:{button:document.querySelector(".original-size-button"),shortcut:pxtr.service.keyboard.Shortcuts.MISC.X1_PREVIEW,tooltip:"Original size preview"},best:{button:document.querySelector(".best-size-button"),shortcut:pxtr.service.keyboard.Shortcuts.MISC.BEST_PREVIEW,tooltip:"Best size preview"},full:{button:document.querySelector(".full-size-button"),shortcut:pxtr.service.keyboard.Shortcuts.MISC.FULL_PREVIEW,tooltip:"Full size preview"}},this.toggleOnionSkinButton=document.querySelector(".preview-toggle-onion-skin")},t.PreviewActionsController.prototype.init=function(){this.fpsRangeInput.addEventListener("change",this.onFpsRangeInputUpdate_.bind(this)),this.fpsRangeInput.addEventListener("input",this.onFpsRangeInputUpdate_.bind(this));var t,e,r,i=pxtr.utils.Event.addEventListener,o=(i(this.toggleOnionSkinButton,"click",this.toggleOnionSkin_,this),i(this.openPopupPreview,"click",this.onOpenPopupPreviewClick_,this),i(this.toggleGridButton,"click",this.toggleGrid_,this),pxtr.app.shortcutService.registerShortcut.bind(pxtr.app.shortcutService)),n=(o(this.onionSkinShortcut,this.toggleOnionSkin_.bind(this)),o(this.toggleGridShortcut,this.toggleGrid_.bind(this)),pxtr.utils.TooltipFormatter.format("Toggle onion skin",this.onionSkinShortcut));for(t in this.toggleOnionSkinButton.setAttribute("title",n),this.previewSizes)this.previewSizes.hasOwnProperty(t)&&(i((e=this.previewSizes[t]).button,"click",this.onChangePreviewSize_,this,t),o(e.shortcut,this.onChangePreviewSize_.bind(this,t)),r=pxtr.utils.TooltipFormatter.format(e.tooltip,e.shortcut),e.button.setAttribute("title",r));$.subscribe(Events.FRAME_SIZE_CHANGED,this.updatePreviewSizeButtons_.bind(this)),$.subscribe(Events.USER_SETTINGS_CHANGED,this.onUserSettingsChange_.bind(this)),$.subscribe(Events.FPS_CHANGED,this.updateFPS_.bind(this)),$.subscribe(Events.PIXETOR_RESET,this.updateFPS_.bind(this)),this.updatePreviewSizeButtons_(),this.updateOnionSkinPreview_(),this.selectPreviewSizeButton_(),this.updateFPS_(),this.updateMaxFPS_(),this.updateToggleGridButton_()},t.PreviewActionsController.prototype.updateToggleGridButton_=function(){var t=pxtr.UserSettings.get(pxtr.UserSettings.GRID_ENABLED);this.toggleGridButton.classList.toggle("icon-minimap-grid-white",!t),this.toggleGridButton.classList.toggle("icon-minimap-grid-gold",t),this.toggleGridButton.classList.toggle("preview-contextual-action-enabled",t)},t.PreviewActionsController.prototype.toggleGrid_=function(){var t=pxtr.UserSettings.get(pxtr.UserSettings.GRID_ENABLED);pxtr.UserSettings.set(pxtr.UserSettings.GRID_ENABLED,!t)},t.PreviewActionsController.prototype.updatePreviewSizeButtons_=function(){var t,e,r=this.previewController.getZoom(),i=Math.floor(r),o=pxtr.UserSettings.get(pxtr.UserSettings.SEAMLESS_MODE),n=r<1?(this.disablePreviewSizeWidget_("No other option available"),["full"]):1===r?(this.disablePreviewSizeWidget_("No other option available"),["original"]):o?(this.disablePreviewSizeWidget_("Disabled in tile mode"),["original"]):(this.enablePreviewSizeWidget_(),r===i?["original","best"]:1===i?["full","original"]:["full","original","best"]);for(t in this.previewSizes.best.button.textContent=Math.floor(r)+"x",this.previewSizes)this.previewSizes.hasOwnProperty(t)&&(e=this.previewSizes[t],-1!=n.indexOf(t)?e.button.classList.remove("preview-contextual-action-hidden"):e.button.classList.add("preview-contextual-action-hidden"));o=pxtr.UserSettings.get(pxtr.UserSettings.PREVIEW_SIZE);-1===n.indexOf(o)&&this.onChangePreviewSize_(n[0])},t.PreviewActionsController.prototype.enablePreviewSizeWidget_=function(){this.previewSizeDropdown.classList.remove("preview-drop-down-disabled")},t.PreviewActionsController.prototype.disablePreviewSizeWidget_=function(t){document.querySelector(".preview-disable-overlay").setAttribute("data-original-title",t),this.previewSizeDropdown.classList.add("preview-drop-down-disabled")},t.PreviewActionsController.prototype.onOpenPopupPreviewClick_=function(){this.previewController.openPopupPreview()},t.PreviewActionsController.prototype.onChangePreviewSize_=function(t){this.previewSizes[t].button.classList.contains("preview-contextual-action-hidden")||pxtr.UserSettings.set(pxtr.UserSettings.PREVIEW_SIZE,t)},t.PreviewActionsController.prototype.onUserSettingsChange_=function(t,e,r){e==pxtr.UserSettings.ONION_SKIN?this.updateOnionSkinPreview_():e==pxtr.UserSettings.MAX_FPS?this.updateMaxFPS_():e===pxtr.UserSettings.SEAMLESS_MODE?this.updatePreviewSizeButtons_():e===pxtr.UserSettings.GRID_ENABLED?this.updateToggleGridButton_():this.selectPreviewSizeButton_()},t.PreviewActionsController.prototype.updateOnionSkinPreview_=function(){var t="preview-toggle-onion-skin-enabled";pxtr.UserSettings.get(pxtr.UserSettings.ONION_SKIN)?this.toggleOnionSkinButton.classList.add(t):this.toggleOnionSkinButton.classList.remove(t)},t.PreviewActionsController.prototype.selectPreviewSizeButton_=function(){var t=document.querySelector(".size-button-selected"),t=(t&&t.classList.remove("size-button-selected"),pxtr.UserSettings.get(pxtr.UserSettings.PREVIEW_SIZE));this.previewSizes[t].button.classList.add("size-button-selected")},t.PreviewActionsController.prototype.updateMaxFPS_=function(){var t=pxtr.UserSettings.get(pxtr.UserSettings.MAX_FPS);this.fpsRangeInput.setAttribute("max",t),this.pixetorController.setFPS(Math.min(t,this.pixetorController.getFPS()))},t.PreviewActionsController.prototype.onFpsRangeInputUpdate_=function(t){var e=parseInt(this.fpsRangeInput.value,10);this.pixetorController.setFPS(e),"change"===t.type&&this.fpsRangeInput.blur()},t.PreviewActionsController.prototype.updateFPS_=function(){var t=this.pixetorController.getFPS();t!==this.fpsRangeInput.value&&(this.fpsRangeInput.value=0,this.fpsRangeInput.value=t,this.fpsCounterDisplay.innerHTML=t+" FPS")},t.PreviewActionsController.prototype.toggleOnionSkin_=function(){var t=pxtr.UserSettings.get(pxtr.UserSettings.ONION_SKIN);pxtr.UserSettings.set(pxtr.UserSettings.ONION_SKIN,!t)}}(),!function(){var r=$.namespace("pxtr.controller.preview");r.PreviewController=function(t,e){this.pixetorController=t,this.container=e,this.elapsedTime=0,this.currentIndex=0,this.lastRenderTime=0,this.renderFlag=!0,this.renderer=new pxtr.rendering.frame.BackgroundImageFrameRenderer(this.container),this.popupPreviewController=new r.PopupPreviewController(t),this.previewActionsController=new r.PreviewActionsController(this,e)},r.PreviewController.prototype.init=function(){var t=Constants.ANIMATED_PREVIEW_WIDTH+Constants.RIGHT_COLUMN_PADDING_LEFT;document.querySelector(".right-column").style.width=t+"px",$.subscribe(Events.FRAME_SIZE_CHANGED,this.onFrameSizeChange_.bind(this)),$.subscribe(Events.USER_SETTINGS_CHANGED,this.onUserSettingsChange_.bind(this)),$.subscribe(Events.PIXETOR_SAVE_STATE,this.setRenderFlag_.bind(this,!0)),$.subscribe(Events.PIXETOR_RESET,this.setRenderFlag_.bind(this,!0)),this.popupPreviewController.init(),this.previewActionsController.init(),this.updateZoom_(),this.updateContainerDimensions_()},r.PreviewController.prototype.openPopupPreview=function(){this.popupPreviewController.open()},r.PreviewController.prototype.onUserSettingsChange_=function(t,e,r){e===pxtr.UserSettings.SEAMLESS_MODE?this.onFrameSizeChange_():(this.updateZoom_(),this.updateContainerDimensions_())},r.PreviewController.prototype.updateZoom_=function(){var t,e=pxtr.UserSettings.get(pxtr.UserSettings.PREVIEW_SIZE);"original"===e?t=1:"best"===e?t=Math.floor(this.calculateZoom_()):"full"===e&&(t=this.calculateZoom_()),this.renderer.setZoom(t),this.setRenderFlag_(!0)},r.PreviewController.prototype.getZoom=function(){return this.calculateZoom_()},r.PreviewController.prototype.getCoordinates=function(t,e){var r=this.container.getBoundingClientRect(),r=(t-=r.left,e-=r.top,this.getZoom());return{x:Math.floor(t/r),y:Math.floor(e/r)}},r.PreviewController.prototype.render=function(t){this.elapsedTime+=t;var t=this.getNextIndex_(t);!this.shouldRender_()&&this.currentIndex==t||(this.currentIndex=t,t=pxtr.utils.LayerUtils.mergeFrameAt(this.pixetorController.getLayers(),t),this.renderer.render(t),this.renderFlag=!1,this.lastRenderTime=Date.now(),this.popupPreviewController.render(t))},r.PreviewController.prototype.getNextIndex_=function(t){var e,r=this.pixetorController.getFPS();return 0===r?this.pixetorController.getCurrentFrameIndex():(r=Math.floor(this.elapsedTime/(1e3/r)),(e=this.pixetorController.getVisibleFrameIndexes()).length<=r?(this.elapsedTime=0,e.length?e[0]:this.pixetorController.getCurrentFrameIndex()):e[r])},r.PreviewController.prototype.calculateZoom_=function(){var t=this.pixetorController.getCurrentFrame(),e=200/t.getHeight(),t=200/t.getWidth();return Math.min(e,t)},r.PreviewController.prototype.onFrameSizeChange_=function(){this.updateZoom_(),this.updateContainerDimensions_()},r.PreviewController.prototype.updateContainerDimensions_=function(){var t,e=pxtr.UserSettings.get(pxtr.UserSettings.SEAMLESS_MODE),e=(this.renderer.setRepeated(e),t=e?r=200:(e=this.getZoom(),r=(t=this.pixetorController.getCurrentFrame()).getHeight()*e,t.getWidth()*e),this.container),r=(e.style.height=r+"px",e.style.width=t+"px",(200-r)/2),r=(e.style.marginTop=r+"px",e.style.marginBottom=r+"px",(200-t)/2);e.style.marginLeft=r+"px",e.style.marginRight=r+"px"},r.PreviewController.prototype.setRenderFlag_=function(t){this.renderFlag=t},r.PreviewController.prototype.shouldRender_=function(){return(this.renderFlag||this.popupPreviewController.renderFlag)&&300<Date.now()-this.lastRenderTime}}(),!function(){var t=$.namespace("pxtr.controller");t.MinimapController=function(t,e,r,i){this.pixetorController=t,this.previewController=e,this.drawingController=r,this.container=i,this.isClicked=!1,this.isVisible=!1},t.MinimapController.prototype.init=function(){this.minimapEl=document.createElement("DIV"),this.minimapEl.className="minimap-crop-frame",this.minimapEl.style.display="none",this.container.appendChild(this.minimapEl),this.container.addEventListener("mousedown",this.onMinimapMousedown_.bind(this)),document.body.addEventListener("mousemove",this.onMinimapMousemove_.bind(this)),document.body.addEventListener("mouseup",this.onMinimapMouseup_.bind(this)),$.subscribe(Events.ZOOM_CHANGED,this.renderMinimap_.bind(this))},t.MinimapController.prototype.renderMinimap_=function(){var t=this.getVerticalRatio_(),e=this.getHorizontalRatio_();1<t||1<e?this.displayMinimap_():this.hideMinimap_()},t.MinimapController.prototype.displayMinimap_=function(){var t=this.getMinimapSize_(),e=this.getPreviewSize_(),r=this.container.getBoundingClientRect(),i=r.height,r=r.width,o=this.drawingController.getRenderer().getOffset(),n=(r-Math.max(t.width,e.width))/2+o.x*this.previewController.getZoom(),e=(i-Math.max(t.height,e.height))/2+o.y*this.previewController.getZoom();this.minimapEl.style.display="block",this.minimapEl.style.width=Math.min(t.width,r)+"px",this.minimapEl.style.height=Math.min(t.height,i)+"px",this.minimapEl.style.left=Math.max(0,n)+Constants.RIGHT_COLUMN_PADDING_LEFT+"px",this.minimapEl.style.top=Math.max(0,e)+"px",this.isVisible=!0},t.MinimapController.prototype.getMinimapSize_=function(){var t=this.drawingController.getRenderer().getZoom()/this.previewController.getZoom(),e=this.drawingController.getRenderer().getDisplaySize();return{width:e.width/t,height:e.height/t}},t.MinimapController.prototype.getPreviewSize_=function(){var t=this.pixetorController.getCurrentFrame();return{width:t.getWidth()*this.previewController.getZoom(),height:t.getHeight()*this.previewController.getZoom()}},t.MinimapController.prototype.hideMinimap_=function(){this.minimapEl.style.display="none",this.isVisible=!1},t.MinimapController.prototype.onMinimapMousemove_=function(t){this.isVisible&&this.isClicked&&(t=this.getCoordinatesCenteredAround_(t.clientX,t.clientY),this.drawingController.setOffset(t.x,t.y))},t.MinimapController.prototype.onMinimapMousedown_=function(t){this.isClicked=!0},t.MinimapController.prototype.onMinimapMouseup_=function(t){this.isClicked=!1},t.MinimapController.prototype.getCoordinatesCenteredAround_=function(t,e){var t=this.previewController.getCoordinates(t,e),e=this.pixetorController.getCurrentFrame().getWidth(),r=this.pixetorController.getCurrentFrame().getHeight(),e=e/this.getHorizontalRatio_(),r=r/this.getVerticalRatio_();return{x:t.x-e/2,y:t.y-r/2}},t.MinimapController.prototype.getVerticalRatio_=function(){var t=this.drawingController.getRenderer().getZoom();return this.pixetorController.getCurrentFrame().getHeight()*t/this.drawingController.getRenderer().getDisplaySize().height},t.MinimapController.prototype.getHorizontalRatio_=function(){var t=this.drawingController.getRenderer().getZoom();return this.pixetorController.getCurrentFrame().getWidth()*t/this.drawingController.getRenderer().getDisplaySize().width}}(),!function(){var t=$.namespace("pxtr.controller");t.ToolController=function(){this.tools=[new pxtr.tools.drawing.SimplePen,new pxtr.tools.drawing.VerticalMirrorPen,new pxtr.tools.drawing.PaintBucket,new pxtr.tools.drawing.ColorSwap,new pxtr.tools.drawing.Eraser,new pxtr.tools.drawing.Stroke,new pxtr.tools.drawing.Rectangle,new pxtr.tools.drawing.Circle,new pxtr.tools.drawing.Move,new pxtr.tools.drawing.selection.ShapeSelect,new pxtr.tools.drawing.selection.RectangleSelect,new pxtr.tools.drawing.selection.LassoSelect,new pxtr.tools.drawing.Lighten,new pxtr.tools.drawing.DitheringTool,new pxtr.tools.drawing.ColorPicker],this.toolIconBuilder=new pxtr.tools.ToolIconBuilder},t.ToolController.prototype.init=function(){this.createToolsDom_(),this.addKeyboardShortcuts_(),this.selectTool_(this.tools[0]),document.querySelector("#tool-section").addEventListener("mousedown",this.onToolIconClicked_.bind(this)),$.subscribe(Events.SELECT_TOOL,this.onSelectToolEvent_.bind(this)),$.subscribe(Events.SHORTCUTS_CHANGED,this.createToolsDom_.bind(this))},t.ToolController.prototype.activateToolOnStage_=function(t){var e=document.body,r=e.dataset.selectedToolClass;r&&(e.classList.remove(r),e.classList.remove(pxtr.tools.drawing.Move.TOOL_ID)),e.classList.add(t.toolId),e.dataset.selectedToolClass=t.toolId},t.ToolController.prototype.onSelectToolEvent_=function(t,e){e=this.getToolById_(e);e&&this.selectTool_(e)},t.ToolController.prototype.selectTool_=function(t){this.currentSelectedTool=t,this.activateToolOnStage_(this.currentSelectedTool);var e=document.querySelector("#tool-section .tool-icon.selected");e&&e.classList.remove("selected"),document.querySelector("[data-tool-id="+t.toolId+"]").classList.add("selected"),$.publish(Events.TOOL_SELECTED,[t])},t.ToolController.prototype.onToolIconClicked_=function(t){var t=t.target,t=pxtr.utils.Dom.getParentWithData(t,"toolId");t&&(t=t.dataset.toolId,(t=this.getToolById_(t))&&this.selectTool_(t))},t.ToolController.prototype.onKeyboardShortcut_=function(t,e){t=this.getToolById_(t);null!==t&&this.selectTool_(t)},t.ToolController.prototype.getToolById_=function(e){return pxtr.utils.Array.find(this.tools,function(t){return t.toolId==e})},t.ToolController.prototype.createToolsDom_=function(){for(var t="",e=0;e<this.tools.length;e++){var r=this.tools[e];t+=this.toolIconBuilder.createIcon(r)}document.querySelector("#tools-container").innerHTML=t},t.ToolController.prototype.addKeyboardShortcuts_=function(){for(var t=0;t<this.tools.length;t++){var e=this.tools[t];pxtr.app.shortcutService.registerShortcut(e.shortcut,this.onKeyboardShortcut_.bind(this,e.toolId))}}}(),!function(){var t=$.namespace("pxtr.controller");t.PaletteController=function(){},t.PaletteController.prototype.init=function(){$.subscribe(Events.SELECT_PRIMARY_COLOR,this.onColorSelected_.bind(this,{isPrimary:!0})),$.subscribe(Events.SELECT_SECONDARY_COLOR,this.onColorSelected_.bind(this,{isPrimary:!1}));var t=pxtr.service.keyboard.Shortcuts,t=(pxtr.app.shortcutService.registerShortcut(t.COLOR.SWAP,this.swapColors.bind(this)),pxtr.app.shortcutService.registerShortcut(t.COLOR.RESET,this.resetColors.bind(this)),{showPalette:!0,showButtons:!1,showInput:!0,palette:[["rgba(0,0,0,0)"]],clickoutFiresChange:!0,beforeShow:function(t){t.setAlpha(1)}}),e=$("#color-picker"),e=(e.spectrum($.extend({color:Constants.DEFAULT_PEN_COLOR},t)),e.change({isPrimary:!0},this.onPickerChange_.bind(this)),this.setTitleOnPicker_(Constants.DEFAULT_PEN_COLOR,e.get(0)),$("#secondary-color-picker"));e.spectrum($.extend({color:Constants.TRANSPARENT_COLOR},t)),e.change({isPrimary:!1},this.onPickerChange_.bind(this)),this.setTitleOnPicker_(Constants.TRANSPARENT_COLOR,e.get(0)),document.querySelector(".swap-colors-button").addEventListener("click",this.swapColors.bind(this))},t.PaletteController.prototype.onPickerChange_=function(t){var e=t.target.value;e!=Constants.TRANSPARENT_COLOR&&(e=window.tinycolor(e).toHexString()),t.data.isPrimary?this.setPrimaryColor_(e):this.setSecondaryColor_(e)},t.PaletteController.prototype.onColorSelected_=function(t,e,r){t.isPrimary?this.setPrimaryColor_(r):this.setSecondaryColor_(r)},t.PaletteController.prototype.setPrimaryColor_=function(t){this.updateColorPicker_(t,document.querySelector("#color-picker")),$.publish(Events.PRIMARY_COLOR_SELECTED,[t])},t.PaletteController.prototype.setSecondaryColor_=function(t){this.updateColorPicker_(t,document.querySelector("#secondary-color-picker")),$.publish(Events.SECONDARY_COLOR_SELECTED,[t])},t.PaletteController.prototype.swapColors=function(){var t=pxtr.app.selectedColorsService.getPrimaryColor();this.setPrimaryColor_(pxtr.app.selectedColorsService.getSecondaryColor()),this.setSecondaryColor_(t)},t.PaletteController.prototype.resetColors=function(){this.setPrimaryColor_(Constants.DEFAULT_PEN_COLOR),this.setSecondaryColor_(Constants.TRANSPARENT_COLOR)},t.PaletteController.prototype.updateColorPicker_=function(t,e){var r=$(e);t==Constants.TRANSPARENT_COLOR?(r.spectrum("set",Constants.TRANSPARENT_COLOR),e.value=Constants.TRANSPARENT_COLOR):r.spectrum("set",t),this.setTitleOnPicker_(t,e)},t.PaletteController.prototype.setTitleOnPicker_=function(t,e){e=e.parentNode;t=e.dataset.initialTitle+"<br/>"+t,e.dataset.originalTitle=t}}(),!function(){var t=$.namespace("pxtr.controller"),r="palettes-list-primary-color",e="palettes-list-secondary-color";t.PalettesListController=function(t){this.usedColorService=t,this.paletteService=pxtr.app.paletteService},t.PalettesListController.prototype.init=function(){this.paletteColorTemplate_=pxtr.utils.Template.get("palette-color-template"),this.colorListContainer_=document.querySelector(".palettes-list-colors"),this.colorPaletteSelect_=document.querySelector(".palettes-list-select");var t=document.querySelector(".create-palette-button"),e=document.querySelector(".edit-palette-button"),t=(this.colorPaletteSelect_.addEventListener("change",this.onPaletteSelected_.bind(this)),this.colorListContainer_.addEventListener("mouseup",this.onColorContainerMouseup.bind(this)),this.colorListContainer_.addEventListener("contextmenu",this.onColorContainerContextMenu.bind(this)),t.addEventListener("click",this.onCreatePaletteClick_.bind(this)),e.addEventListener("click",this.onEditPaletteClick_.bind(this)),$.subscribe(Events.PALETTE_LIST_UPDATED,this.onPaletteListUpdated.bind(this)),$.subscribe(Events.CURRENT_COLORS_UPDATED,this.fillColorListContainer.bind(this)),$.subscribe(Events.PRIMARY_COLOR_SELECTED,this.highlightSelectedColors.bind(this)),$.subscribe(Events.SECONDARY_COLOR_SELECTED,this.highlightSelectedColors.bind(this)),$.subscribe(Events.USER_SETTINGS_CHANGED,this.onUserSettingsChange_.bind(this)),pxtr.service.keyboard.Shortcuts);pxtr.app.shortcutService.registerShortcut(t.COLOR.PREVIOUS_COLOR,this.selectPreviousColor_.bind(this)),pxtr.app.shortcutService.registerShortcut(t.COLOR.NEXT_COLOR,this.selectNextColor_.bind(this)),pxtr.app.shortcutService.registerShortcut(t.COLOR.SELECT_COLOR,this.selectColorForKey_.bind(this)),this.fillPaletteList(),this.updateFromUserSettings(),this.fillColorListContainer()},t.PalettesListController.prototype.fillPaletteList=function(){var t=this.paletteService.getPalettes().map(function(t){return pxtr.utils.Template.replace('<option value="{{id}}">{{name}}</option>',t)}).join("");this.colorPaletteSelect_.innerHTML=t},t.PalettesListController.prototype.fillColorListContainer=function(){var t,e=this.getSelectedPaletteColors_();0<e.length?(t=e.filter(function(t){return!!t}).map(function(t,e){return pxtr.utils.Template.replace(this.paletteColorTemplate_,{color:t,index:e+1,title:t.toUpperCase()})}.bind(this)).join(""),this.colorListContainer_.innerHTML=t,this.highlightSelectedColors()):this.colorListContainer_.innerHTML=pxtr.utils.Template.get("palettes-list-no-colors-partial"),this.colorListContainer_.classList.toggle("tiny",10<e.length)},t.PalettesListController.prototype.selectPalette=function(t){pxtr.UserSettings.set(pxtr.UserSettings.SELECTED_PALETTE,t)},t.PalettesListController.prototype.getSelectedPaletteColors_=function(){var t=[],e=this.getSelectedPalette_();return t=(t=e?e.getColors():t).length>Constants.MAX_PALETTE_COLORS?t.slice(0,Constants.MAX_PALETTE_COLORS):t},t.PalettesListController.prototype.getSelectedPalette_=function(){var t=pxtr.UserSettings.get(pxtr.UserSettings.SELECTED_PALETTE);return this.paletteService.getPaletteById(t)},t.PalettesListController.prototype.selectNextColor_=function(){this.selectColor_(this.getCurrentColorIndex_()+1)},t.PalettesListController.prototype.selectPreviousColor_=function(){this.selectColor_(this.getCurrentColorIndex_()-1)},t.PalettesListController.prototype.getCurrentColorIndex_=function(){var t=0,e=document.querySelector("."+r);return t=e?parseInt(e.dataset.colorIndex,10)-1:t},t.PalettesListController.prototype.selectColorForKey_=function(t){t=parseInt(t,10);this.selectColor_((t+9)%10)},t.PalettesListController.prototype.selectColor_=function(t){t=this.getSelectedPaletteColors_()[t];t&&$.publish(Events.SELECT_PRIMARY_COLOR,[t])},t.PalettesListController.prototype.onUserSettingsChange_=function(t,e,r){e==pxtr.UserSettings.SELECTED_PALETTE&&this.updateFromUserSettings()},t.PalettesListController.prototype.updateFromUserSettings=function(){var t=pxtr.UserSettings.get(pxtr.UserSettings.SELECTED_PALETTE);this.fillColorListContainer(),this.colorPaletteSelect_.value=t},t.PalettesListController.prototype.onPaletteSelected_=function(t){var e=this.colorPaletteSelect_.value;this.selectPalette(e),this.colorPaletteSelect_.blur()},t.PalettesListController.prototype.onCreatePaletteClick_=function(t){$.publish(Events.DIALOG_SHOW,{dialogId:"create-palette"})},t.PalettesListController.prototype.onEditPaletteClick_=function(t){var e=this.colorPaletteSelect_.value;$.publish(Events.DIALOG_SHOW,{dialogId:"create-palette",initArgs:e})},t.PalettesListController.prototype.onColorContainerContextMenu=function(t){t.preventDefault()},t.PalettesListController.prototype.onColorContainerMouseup=function(t){var e=t.target.dataset.color;e&&(t.button==Constants.LEFT_BUTTON?$.publish(Events.SELECT_PRIMARY_COLOR,[e]):t.button==Constants.RIGHT_BUTTON&&$.publish(Events.SELECT_SECONDARY_COLOR,[e]))},t.PalettesListController.prototype.highlightSelectedColors=function(){this.removeClass_(r),this.removeClass_(e);var t=this.getColorContainer_(pxtr.app.selectedColorsService.getSecondaryColor());t&&(t.classList.remove(r),t.classList.add(e)),(t=this.getColorContainer_(pxtr.app.selectedColorsService.getPrimaryColor()))&&(t.classList.remove(e),t.classList.add(r))},t.PalettesListController.prototype.getColorContainer_=function(t){return this.colorListContainer_.querySelector('.palettes-list-color[data-color="'+t+'"]')},t.PalettesListController.prototype.removeClass_=function(t){var e=document.querySelector("."+t);e&&e.classList.remove(t)},t.PalettesListController.prototype.onPaletteListUpdated=function(){this.fillPaletteList(),this.updateFromUserSettings()}}(),!function(){var t=$.namespace("pxtr.controller");t.PenSizeController=function(){this.sizePicker=new pxtr.widgets.SizePicker(this.onSizePickerChanged_.bind(this))},t.PenSizeController.prototype.init=function(){this.sizePicker.init(document.querySelector(".pen-size-container")),$.subscribe(Events.PEN_SIZE_CHANGED,this.onPenSizeChanged_.bind(this)),this.updateSelectedOption_()},t.PenSizeController.prototype.onSizePickerChanged_=function(t){pxtr.app.penSizeService.setPenSize(t)},t.PenSizeController.prototype.onPenSizeChanged_=function(t){this.updateSelectedOption_()},t.PenSizeController.prototype.updateSelectedOption_=function(){var t=pxtr.app.penSizeService.getPenSize();this.sizePicker.setSize(t)}}(),!function(){var t=$.namespace("pxtr.controller");t.ProgressBarController=function(){this.template=pxtr.utils.Template.get("progress-bar-template"),this.progressBar=null,this.progressBarStatus=null,this.showProgressTimer_=0},t.ProgressBarController.prototype.init=function(){$.subscribe(Events.SHOW_PROGRESS,this.showProgress_.bind(this)),$.subscribe(Events.UPDATE_PROGRESS,this.updateProgress_.bind(this)),$.subscribe(Events.HIDE_PROGRESS,this.hideProgress_.bind(this))},t.ProgressBarController.prototype.showProgress_=function(t,e){this.removeProgressBar_(),this.showProgressTimer_=window.setTimeout(this.onTimerExpired_.bind(this,e),300)},t.ProgressBarController.prototype.onTimerExpired_=function(t){t=pxtr.utils.Template.replace(this.template,{name:t.name,status:0}),t=pxtr.utils.Template.createFromHTML(t);document.body.appendChild(t),this.progressBar=document.querySelector(".progress-bar"),this.progressBarStatus=document.querySelector(".progress-bar-status")},t.ProgressBarController.prototype.updateProgress_=function(t,e){var r;this.progressBar&&this.progressBarStatus&&(e=e.progress,r=this.progressBar.offsetWidth,this.progressBar.style.backgroundPosition=-(r-e*r/100)+"px 0",this.progressBarStatus.innerHTML=e+"%")},t.ProgressBarController.prototype.hideProgress_=function(t,e){this.showProgressTimer_&&window.clearTimeout(this.showProgressTimer_),this.removeProgressBar_()},t.ProgressBarController.prototype.removeProgressBar_=function(){var t=document.querySelector(".progress-bar-container");t&&(t.parentNode.removeChild(t),this.progressBar=null,this.progressBarStatus=null)}}(),!function(){var t=$.namespace("pxtr.controller");t.NotificationController=function(){},t.NotificationController.prototype.init=function(){$.subscribe(Events.SHOW_NOTIFICATION,this.displayMessage_.bind(this)),$.subscribe(Events.HIDE_NOTIFICATION,this.removeMessage_.bind(this))},t.NotificationController.prototype.displayMessage_=function(t,e){this.removeMessage_();var r=document.createElement("div");r.id="user-message",r.className="user-message",r.innerHTML=e.content,r.innerHTML=r.innerHTML+'<div title="Close message" class="close">x</div>',document.body.appendChild(r),r.querySelector(".close").addEventListener("click",this.removeMessage_.bind(this)),e.hideDelay&&window.setTimeout(this.removeMessage_.bind(this),e.hideDelay)},t.NotificationController.prototype.removeMessage_=function(t){var e=document.querySelector("#user-message");e&&e.parentNode.removeChild(e)}}(),!function(){var t=$.namespace("pxtr.controller");t.TransformationsController=function(){this.tools=[new pxtr.tools.transform.Flip,new pxtr.tools.transform.Rotate,new pxtr.tools.transform.Clone,new pxtr.tools.transform.Center,new pxtr.tools.transform.Crop],this.toolIconBuilder=new pxtr.tools.ToolIconBuilder},t.TransformationsController.prototype.init=function(){this.container=document.querySelector(".transformations-container"),this.container.addEventListener("click",this.onTransformationClick_.bind(this)),this.showMoreLink=this.container.querySelector(".transformations-show-more-link"),this.showMoreLink.addEventListener("click",this.toggleShowMoreTools_.bind(this)),this.createToolsDom_(),this.updateShowMoreLink_(),$.subscribe(Events.USER_SETTINGS_CHANGED,this.onUserSettingsChange_.bind(this))},t.TransformationsController.prototype.applyTool=function(e,r){this.tools.forEach(function(t){t.toolId===e&&($.publish(Events.TRANSFORMATION_EVENT,[e,r]),t.applyTransformation(r))}.bind(this))},t.TransformationsController.prototype.onTransformationClick_=function(t){var e=t.target.dataset.toolId;e&&this.applyTool(e,t)},t.TransformationsController.prototype.toggleShowMoreTools_=function(t){var e=pxtr.UserSettings.get(pxtr.UserSettings.TRANSFORM_SHOW_MORE);pxtr.UserSettings.set(pxtr.UserSettings.TRANSFORM_SHOW_MORE,!e)},t.TransformationsController.prototype.onUserSettingsChange_=function(t,e){e==pxtr.UserSettings.TRANSFORM_SHOW_MORE&&this.updateShowMoreLink_()},t.TransformationsController.prototype.updateShowMoreLink_=function(){var t=pxtr.UserSettings.get(pxtr.UserSettings.TRANSFORM_SHOW_MORE);this.container.classList.toggle("show-more",t),this.showMoreLink.classList.toggle("hidden",this.tools.length<5)},t.TransformationsController.prototype.createToolsDom_=function(){var t=this.tools.reduce(function(t,e){return t+this.toolIconBuilder.createIcon(e,"left")}.bind(this),"");this.container.querySelector(".tools-wrapper").innerHTML=t}}(),!function(){var t=$.namespace("pxtr.controller");t.CanvasBackgroundController=function(){this.body=document.body},t.CanvasBackgroundController.prototype.init=function(){$.subscribe(Events.USER_SETTINGS_CHANGED,this.onUserSettingsChange_.bind(this)),this.updateBackgroundClass_(pxtr.UserSettings.get(pxtr.UserSettings.CANVAS_BACKGROUND))},t.CanvasBackgroundController.prototype.onUserSettingsChange_=function(t,e,r){e==pxtr.UserSettings.CANVAS_BACKGROUND&&this.updateBackgroundClass_(r)},t.CanvasBackgroundController.prototype.updateBackgroundClass_=function(t){var e=this.body.dataset.currentBackgroundClass;e&&this.body.classList.remove(e),this.body.classList.add(t),this.body.dataset.currentBackgroundClass=t}}(),!function(){var t=$.namespace("pxtr.controller");t.UserWarningController=function(t,e){this.pixetorController=t,this.currentColorsService=e},t.UserWarningController.showPerformanceInfoDialog=function(){$.publish(Events.DIALOG_SHOW,{dialogId:"performance-info"})},t.UserWarningController.prototype.init=function(){$.subscribe(Events.PERFORMANCE_REPORT_CHANGED,this.onPerformanceReportChanged_.bind(this)),this.performanceLinkEl=document.querySelector(".performance-link"),pxtr.utils.Event.addEventListener(this.performanceLinkEl,"click",t.UserWarningController.showPerformanceInfoDialog,this)},t.UserWarningController.prototype.destroy=function(){pxtr.utils.Event.removeAllEventListeners(this),this.performanceLinkEl=null},t.UserWarningController.prototype.onPerformanceReportChanged_=function(t,e){var e=e.hasProblem(),r=this.performanceLinkEl.classList.contains("visible");e?this.performanceLinkEl.classList.add("visible"):this.performanceLinkEl.classList.remove("visible"),e&&!r&&$.publish(Events.SHOW_NOTIFICATION,[{content:'Performance problem detected, <a href="#" style="color:red;"onclick="pxtr.controller.UserWarningController.showPerformanceInfoDialog()">learn more?</a>',hideDelay:5e3}])}}(),!function(){var t=$.namespace("pxtr.controller.settings");t.AbstractSettingController=function(){},t.AbstractSettingController.prototype.addEventListener=function(t,e,r){pxtr.utils.Event.addEventListener(t,e,r,this)},t.AbstractSettingController.prototype.destroy=function(){pxtr.utils.Event.removeAllEventListeners(this),this.nullifyDomReferences_()},t.AbstractSettingController.prototype.nullifyDomReferences_=function(){for(var t in this)this.hasOwnProperty(t)&&this[t]&&this[t].nodeName&&(this[t]=null)}}(),!function(){var t=$.namespace("pxtr.controller.settings.preferences"),s={transparent:Constants.TRANSPARENT_COLOR,white:"#FFF1E8","light-gray":"#C2C3C7","dark-gray":"#5F574F",black:"#000000",blue:"#29ADFF","dark-blue":"#1D2B53",green:"#00E436","dark-green":"#008751",peach:"#FFCCAA",pink:"#FF77A8",yellow:"#FFEC27",orange:"#FFA300",red:"#FF004D"};t.GridPreferencesController=function(t,e){this.pixetorController=t,this.preferencesController=e,this.sizePicker=new pxtr.widgets.SizePicker(this.onSizePickerChanged_.bind(this)),this.spacingPicker=new pxtr.widgets.SizePicker(this.onSpacingPickerChanged_.bind(this))},pxtr.utils.inherit(t.GridPreferencesController,pxtr.controller.settings.AbstractSettingController),t.GridPreferencesController.prototype.init=function(){var t=pxtr.UserSettings.get(pxtr.UserSettings.GRID_ENABLED),e=document.querySelector(".enable-grid-checkbox"),t=(t&&e.setAttribute("checked","true"),this.addEventListener(e,"change",this.onEnableGridChange_),pxtr.UserSettings.get(pxtr.UserSettings.GRID_WIDTH)),e=(this.sizePicker.init(document.querySelector(".grid-size-container")),this.sizePicker.setSize(t),pxtr.UserSettings.get(pxtr.UserSettings.GRID_SPACING)),i=(this.spacingPicker.init(document.querySelector(".grid-spacing-container")),this.spacingPicker.setSize(e),pxtr.utils.Template.get("color-list-item-template")),o=pxtr.UserSettings.get(pxtr.UserSettings.GRID_COLOR),n=(document.querySelector("#grid-color"),"");Object.keys(s).forEach(function(t,e){var r="transparent"===t?"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAIAAADZF8uwAAAAGUlEQVQYV2M4gwH+YwCGIasIUwhT25BVBADtzYNYrHvv4gAAAABJRU5ErkJggg==)":s[t];n+=pxtr.utils.Template.replace(i,{color:s[t],title:t,background:r,":selected":o===s[t]})}),this.gridColorList=document.querySelector(".grid-colors-list"),this.gridColorList.innerHTML=n,this.addEventListener(this.gridColorList,"click",this.onGridColorClicked_.bind(this))},t.GridPreferencesController.prototype.destroy=function(){this.sizePicker.destroy(),this.spacingPicker.destroy(),this.superclass.destroy.call(this)},t.GridPreferencesController.prototype.onSizePickerChanged_=function(t){pxtr.UserSettings.set(pxtr.UserSettings.GRID_WIDTH,t)},t.GridPreferencesController.prototype.onSpacingPickerChanged_=function(t){pxtr.UserSettings.set(pxtr.UserSettings.GRID_SPACING,t)},t.GridPreferencesController.prototype.onEnableGridChange_=function(t){pxtr.UserSettings.set(pxtr.UserSettings.GRID_ENABLED,t.currentTarget.checked)},t.GridPreferencesController.prototype.onGridColorClicked_=function(t){var e=t.target.dataset.color;e&&(pxtr.UserSettings.set(pxtr.UserSettings.GRID_COLOR,e),this.gridColorList.querySelector(".selected").classList.remove("selected"),t.target.classList.add("selected"))}}(),!function(){var t=$.namespace("pxtr.controller.settings.preferences");t.MiscPreferencesController=function(t,e){this.pixetorController=t,this.preferencesController=e},pxtr.utils.inherit(t.MiscPreferencesController,pxtr.controller.settings.AbstractSettingController),t.MiscPreferencesController.prototype.init=function(){this.backgroundContainer=document.querySelector(".background-picker-wrapper"),this.addEventListener(this.backgroundContainer,"click",this.onBackgroundClick_);var t=pxtr.UserSettings.get(pxtr.UserSettings.CANVAS_BACKGROUND),t=this.backgroundContainer.querySelector("[data-background="+t+"]"),t=(t&&t.classList.add("selected"),document.querySelector(".max-fps-input")),t=(t.value=pxtr.UserSettings.get(pxtr.UserSettings.MAX_FPS),this.addEventListener(t,"change",this.onMaxFpsChange_),pxtr.UserSettings.get(pxtr.UserSettings.COLOR_FORMAT)),e=document.querySelector(".color-format-select"),t=e.querySelector('option[value="'+t+'"]'),t=(t&&t.setAttribute("selected","selected"),this.addEventListener(e,"change",this.onColorFormatChange_),document.querySelector(".layer-opacity-input"));t.value=pxtr.UserSettings.get(pxtr.UserSettings.LAYER_OPACITY),this.addEventListener(t,"change",this.onLayerOpacityChange_),this.addEventListener(t,"input",this.onLayerOpacityChange_),this.updateLayerOpacityText_(t.value)},t.MiscPreferencesController.prototype.onBackgroundClick_=function(t){var t=t.target,e=t.dataset.background;e&&(pxtr.UserSettings.set(pxtr.UserSettings.CANVAS_BACKGROUND,e),(e=this.backgroundContainer.querySelector(".selected"))&&e.classList.remove("selected"),t.classList.add("selected"))},t.MiscPreferencesController.prototype.onColorFormatChange_=function(t){pxtr.UserSettings.set(pxtr.UserSettings.COLOR_FORMAT,t.target.value)},t.MiscPreferencesController.prototype.onMaxFpsChange_=function(t){var t=t.target,e=parseInt(t.value,10);e&&!isNaN(e)?pxtr.UserSettings.set(pxtr.UserSettings.MAX_FPS,e):t.value=pxtr.UserSettings.get(pxtr.UserSettings.MAX_FPS)},t.MiscPreferencesController.prototype.onLayerOpacityChange_=function(t){var t=t.target,e=parseFloat(t.value);isNaN(e)?t.value=pxtr.UserSettings.get(pxtr.UserSettings.LAYER_OPACITY):(pxtr.UserSettings.set(pxtr.UserSettings.LAYER_OPACITY,e),pxtr.UserSettings.set(pxtr.UserSettings.LAYER_PREVIEW,0!==e),this.updateLayerOpacityText_(e))},t.MiscPreferencesController.prototype.updateLayerOpacityText_=function(t){document.querySelector(".layer-opacity-text").innerHTML=(+t).toFixed(2)}}(),!function(){var t=$.namespace("pxtr.controller.settings.preferences");t.TilePreferencesController=function(t,e){this.pixetorController=t,this.preferencesController=e},pxtr.utils.inherit(t.TilePreferencesController,pxtr.controller.settings.AbstractSettingController),t.TilePreferencesController.prototype.init=function(){var t=pxtr.UserSettings.get(pxtr.UserSettings.SEAMLESS_MODE),e=document.querySelector(".tile-mode-checkbox"),t=(t&&e.setAttribute("checked",t),this.addEventListener(e,"change",this.onTileModeChange_),document.querySelector(".tile-mask-opacity-input"));t.value=pxtr.UserSettings.get(pxtr.UserSettings.SEAMLESS_OPACITY),this.addEventListener(t,"change",this.onTileMaskOpacityChange_),this.addEventListener(t,"input",this.onTileMaskOpacityChange_),this.updateTileMaskOpacityText_(t.value)},t.TilePreferencesController.prototype.onTileModeChange_=function(t){pxtr.UserSettings.set(pxtr.UserSettings.SEAMLESS_MODE,t.currentTarget.checked)},t.TilePreferencesController.prototype.onTileMaskOpacityChange_=function(t){var t=t.target,e=parseFloat(t.value);isNaN(e)?t.value=pxtr.UserSettings.get(pxtr.UserSettings.SEAMLESS_OPACITY):(pxtr.UserSettings.set(pxtr.UserSettings.SEAMLESS_OPACITY,e),this.updateTileMaskOpacityText_(e))},t.TilePreferencesController.prototype.updateTileMaskOpacityText_=function(t){document.querySelector(".tile-mask-opacity-text").innerHTML=(+t).toFixed(2)}}(),!function(){var t=$.namespace("pxtr.controller.settings"),e={misc:{template:"templates/settings/preferences/misc.html",controller:t.preferences.MiscPreferencesController},grid:{template:"templates/settings/preferences/grid.html",controller:t.preferences.GridPreferencesController},tile:{template:"templates/settings/preferences/tile.html",controller:t.preferences.TilePreferencesController}};t.PreferencesController=function(){this.tabsWidget=new pxtr.widgets.Tabs(e,this,pxtr.UserSettings.PREFERENCES_TAB)},pxtr.utils.inherit(t.PreferencesController,pxtr.controller.settings.AbstractSettingController),t.PreferencesController.prototype.init=function(){var t=document.querySelector(".settings-section-preferences");this.tabsWidget.init(t)},t.PreferencesController.prototype.destroy=function(){this.tabsWidget.destroy(),this.superclass.destroy.call(this)}}(),!function(){var t=$.namespace("pxtr.controller.settings.exportimage");t.GifExportController=function(t,e){this.pixetorController=t,this.exportController=e},pxtr.utils.inherit(t.GifExportController,pxtr.controller.settings.AbstractSettingController),t.GifExportController.prototype.init=function(){this.uploadStatusContainerEl=document.querySelector(".gif-upload-status"),this.previewContainerEl=document.querySelector(".gif-export-preview"),this.uploadButton=document.querySelector(".gif-upload-button"),this.downloadButton=document.querySelector(".gif-download-button"),this.repeatCheckbox=document.querySelector(".gif-repeat-checkbox"),this.repeatCheckbox.checked=this.getRepeatSetting_(),this.addEventListener(this.uploadButton,"click",this.onUploadButtonClick_),this.addEventListener(this.downloadButton,"click",this.onDownloadButtonClick_),this.addEventListener(this.repeatCheckbox,"change",this.onRepeatCheckboxChange_);var t=256<=pxtr.app.currentColorsService.getCurrentColors().length;document.querySelector(".gif-export-warning").classList.toggle("visible",t)},t.GifExportController.prototype.getZoom_=function(){return this.exportController.getExportZoom()},t.GifExportController.prototype.onUploadButtonClick_=function(t){t.preventDefault();var t=this.getZoom_(),e=this.pixetorController.getFPS();this.renderAsImageDataAnimatedGIF(t,e,this.uploadImageData_.bind(this))},t.GifExportController.prototype.onDownloadButtonClick_=function(t){var e=this.getZoom_(),r=this.pixetorController.getFPS();this.renderAsImageDataAnimatedGIF(e,r,this.downloadImageData_.bind(this))},t.GifExportController.prototype.downloadImageData_=function(t){var e=this.pixetorController.getPixetor().getDescriptor().name+".gif";pxtr.utils.BlobUtils.dataToBlob(t,"image/gif",function(t){pxtr.utils.FileUtils.downloadAsFile(t,e)})},t.GifExportController.prototype.uploadImageData_=function(t){this.updatePreview_(t),this.previewContainerEl.classList.add("preview-upload-ongoing"),pxtr.app.imageUploadService.upload(t,this.onImageUploadCompleted_.bind(this),this.onImageUploadFailed_.bind(this))},t.GifExportController.prototype.onImageUploadCompleted_=function(t){this.updatePreview_(t),this.updateStatus_(t),this.previewContainerEl.classList.remove("preview-upload-ongoing")},t.GifExportController.prototype.onImageUploadFailed_=function(t,e){500===e.status&&$.publish(Events.SHOW_NOTIFICATION,[{content:"Upload failed : "+e.responseText,hideDelay:5e3}])},t.GifExportController.prototype.updatePreview_=function(t){this.previewContainerEl.innerHTML='<div><img style="max-width:32px;" src="'+t+'"/></div>'},t.GifExportController.prototype.renderAsImageDataAnimatedGIF=function(t,e,r){var i,o=pxtr.app.currentColorsService.getCurrentColors(),n=!this.pixetorController.getLayers().some(function(t){return t.isTransparent()})&&o.length<256,o=n?(i=this.getTransparentColor(o),parseInt(i.substring(1),16)):(i="#FFFFFF",null),s=this.pixetorController.getWidth(),a=this.pixetorController.getHeight(),l=new window.GIF({workers:5,quality:1,width:s*t,height:a*t,preserveColors:n,repeat:this.getRepeatSetting_()?0:-1,transparent:o}),c=pxtr.utils.CanvasUtils.createCanvas(s,a),p=c.getContext("2d");p.fillStyle=i;for(var h=0;h<this.pixetorController.getFrameCount();h++){var u=this.pixetorController.renderFrameAt(h,!0),u=(p.clearRect(0,0,s,a),p.fillRect(0,0,s,a),p.drawImage(u,0,0,s,a),pxtr.utils.ImageResizer.scale(c,t));l.addFrame(u.getContext("2d"),{delay:1e3/e})}$.publish(Events.SHOW_PROGRESS,[{name:"Building animated GIF ..."}]),l.on("progress",function(t){$.publish(Events.UPDATE_PROGRESS,[{progress:(100*t).toFixed(1)}])}.bind(this)),l.on("finished",function(t){$.publish(Events.HIDE_PROGRESS),pxtr.utils.FileUtils.readFile(t,r)}.bind(this)),l.render()},t.GifExportController.prototype.getTransparentColor=function(t){t=pxtr.utils.ColorUtils.getUnusedColor(t);return t||(console.error("Unable to find unused color to use as transparent color in the current sprite"),t="#FF00FF"),t},t.GifExportController.prototype.onRepeatCheckboxChange_=function(){var t=this.repeatCheckbox.checked;pxtr.UserSettings.set(pxtr.UserSettings.EXPORT_GIF_REPEAT,t)},t.GifExportController.prototype.getRepeatSetting_=function(){return pxtr.UserSettings.get(pxtr.UserSettings.EXPORT_GIF_REPEAT)},t.GifExportController.prototype.updateStatus_=function(t,e){t&&(t=pxtr.utils.Template.replace('<a class="highlight" href="{{link}}" target="_blank">{{shortLink}}</a>',{link:t,shortLink:this.shorten_(t,30,"...")}),this.uploadStatusContainerEl.innerHTML="Your image is now available at : "+t)},t.GifExportController.prototype.shorten_=function(t,e,r){return t.length>e&&(e=Math.round((e-r.length)/2),t=t.substring(0,e)+r+t.substring(t.length-e,t.length)),t}}(),!function(){function n(t,e){return 1===e?"1 "+t:e+" "+t+"s"}var t=$.namespace("pxtr.controller.settings.exportimage"),s=pxtr.utils.Template.replace;t.PngExportController=function(t,e){this.pixetorController=t,this.exportController=e,this.onScaleChanged_=this.onScaleChanged_.bind(this)},pxtr.utils.inherit(t.PngExportController,pxtr.controller.settings.AbstractSettingController),t.PngExportController.prototype.init=function(){this.layoutContainer=document.querySelector(".png-export-layout-section"),this.dimensionInfo=document.querySelector(".png-export-dimension-info"),this.rowsInput=document.querySelector("#png-export-rows"),this.columnsInput=document.querySelector("#png-export-columns");var t=document.querySelector(".png-download-button"),e=document.querySelector(".png-pixi-download-button"),r=document.querySelector(".datauri-open-button"),i=document.querySelector(".selected-frame-download-button");this.pixiInlineImageCheckbox=document.querySelector(".png-pixi-inline-image-checkbox"),this.initLayoutSection_(),this.updateDimensionLabel_(),this.addEventListener(this.columnsInput,"input",this.onColumnsInput_),this.addEventListener(t,"click",this.onDownloadClick_),this.addEventListener(e,"click",this.onPixiDownloadClick_),this.addEventListener(r,"click",this.onDataUriClick_),this.addEventListener(i,"click",this.onDownloadSelectedFrameClick_),$.subscribe(Events.EXPORT_SCALE_CHANGED,this.onScaleChanged_)},t.PngExportController.prototype.destroy=function(){$.unsubscribe(Events.EXPORT_SCALE_CHANGED,this.onScaleChanged_),this.superclass.destroy.call(this)},t.PngExportController.prototype.initLayoutSection_=function(){var t=this.pixetorController.getFrameCount();1===t?this.layoutContainer.style.display="none":(this.columnsInput.setAttribute("max",t),this.columnsInput.value=this.getBestFit_(),this.onColumnsInput_())},t.PngExportController.prototype.updateDimensionLabel_=function(){var t=this.exportController.getExportZoom(),e=this.pixetorController.getFrameCount(),r=this.pixetorController.getWidth()*t,t=this.pixetorController.getHeight()*t,i=this.getColumns_(),o=this.getRows_();this.dimensionInfo.innerHTML=s("{{width}} x {{height}} px, {{frames}}<br/>{{columns}}, {{rows}}.",{width:r*=i,height:t*=o,rows:n("row",o),columns:n("column",i),frames:n("frame",e)})},t.PngExportController.prototype.getColumns_=function(){return parseInt(this.columnsInput.value||1,10)},t.PngExportController.prototype.getRows_=function(){return parseInt(this.rowsInput.value||1,10)},t.PngExportController.prototype.getBestFit_=function(){var t=this.pixetorController.getWidth()/this.pixetorController.getHeight(),e=this.pixetorController.getFrameCount(),t=Math.round(Math.sqrt(e/t));return pxtr.utils.Math.minmax(t,1,e)},t.PngExportController.prototype.onScaleChanged_=function(){this.updateDimensionLabel_()},t.PngExportController.prototype.onColumnsInput_=function(){var t=this.columnsInput.value;""!==t&&(t=parseInt(t,10),isNaN(t)&&(t=1),t=pxtr.utils.Math.minmax(t,1,this.pixetorController.getFrameCount()),this.columnsInput.value=t,this.rowsInput.value=Math.ceil(this.pixetorController.getFrameCount()/t),this.updateDimensionLabel_())},t.PngExportController.prototype.createPngSpritesheet_=function(){var t=new pxtr.rendering.PixetorRenderer(this.pixetorController).renderAsCanvas(this.getColumns_(),this.getRows_()),e=t.width,r=t.height,i=this.exportController.getExportZoom();return t=1!=i?pxtr.utils.ImageResizer.resize(t,e*i,r*i,!1):t},t.PngExportController.prototype.onDownloadClick_=function(t){var e=this.createPngSpritesheet_();this.downloadCanvas_(e)},t.PngExportController.prototype.downloadCanvas_=function(t,e){var r=(e=e||this.pixetorController.getPixetor().getDescriptor().name)+".png";pxtr.utils.BlobUtils.canvasToBlob(t,function(t){pxtr.utils.FileUtils.downloadAsFile(t,r)})},t.PngExportController.prototype.onPixiDownloadClick_=function(){for(var t=new window.JSZip,e=this.createPngSpritesheet_(),r=this.pixetorController.getPixetor().getDescriptor().name,i=(this.pixiInlineImageCheckbox.checked?p=e.toDataURL("image/png"):t.file(p=r+".png",pxtr.utils.CanvasUtils.getBase64FromCanvas(e)+"\n",{base64:!0}),e.width/this.getColumns_()),o=e.height/this.getRows_(),n=this.pixetorController.getFrameCount(),s={},a=0;a<n;a++){var l=a%this.getColumns_(),c=(a-l)/this.getColumns_();s[r+a+".png"]={frame:{x:i*l,y:o*c,w:i,h:o},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:i,h:o},sourceSize:{w:i,h:o}}}var p={frames:s,meta:{app:"https://github.com/pixetorapp/pixetor/",version:"1.0",image:p,format:"RGBA8888",size:{w:e.width,h:e.height}}},e=(t.file(r+".json",JSON.stringify(p)),t.generate({type:"blob"}));pxtr.utils.FileUtils.downloadAsFile(e,r+".zip")},t.PngExportController.prototype.onDataUriClick_=function(t){var e=window.open("about:blank"),r=this.createPngSpritesheet_().toDataURL("image/png");window.setTimeout(function(){var t=pxtr.utils.Template.getAndReplace("data-uri-export-partial",{src:r});e.document.title=r,e.document.body.innerHTML=t}.bind(this),500)},t.PngExportController.prototype.onDownloadSelectedFrameClick_=function(t){var e=this.pixetorController.getCurrentFrameIndex(),r=this.pixetorController.getPixetor().getDescriptor().name,i=this.pixetorController.renderFrameAt(e,!0),o=this.exportController.getExportZoom(),o=(1!=o&&(i=pxtr.utils.ImageResizer.resize(i,i.width*o,i.height*o,!1)),r+"-"+(e+1)+".png");this.downloadCanvas_(i,o)}}(),!function(){var t=$.namespace("pxtr.controller.settings.exportimage");t.ZipExportController=function(t,e){this.pixetorController=t,this.exportController=e},pxtr.utils.inherit(t.ZipExportController,pxtr.controller.settings.AbstractSettingController),t.ZipExportController.prototype.init=function(){this.pngFilePrefixInput=document.querySelector(".zip-prefix-name"),this.pngFilePrefixInput.value="sprite_",this.splitByLayersCheckbox=document.querySelector(".zip-split-layers-checkbox"),this.addEventListener(this.splitByLayersCheckbox,"change",this.onSplitLayersClick_),this.useLayerNamesContainer=document.querySelector(".use-layer-names-container"),this.useLayerNamesCheckbox=document.querySelector(".zip-use-layer-names-checkbox"),this.toggleHideUseLayerNamesCheckbox();var t=document.querySelector(".zip-generate-button");this.addEventListener(t,"click",this.onZipButtonClick_)},t.ZipExportController.prototype.toggleHideUseLayerNamesCheckbox=function(){this.useLayerNamesContainer.style.display=this.splitByLayersCheckbox.checked?"block":"none"},t.ZipExportController.prototype.onSplitLayersClick_=function(){this.toggleHideUseLayerNamesCheckbox()},t.ZipExportController.prototype.onZipButtonClick_=function(){var t=new window.JSZip,e=(this.splitByLayersCheckbox.checked?this.splittedExport_(t):this.mergedExport_(t),this.getPixetorName_()+".zip"),t=t.generate({type:"blob"});pxtr.utils.FileUtils.downloadAsFile(t,e)},t.ZipExportController.prototype.mergedExport_=function(t){for(var e=(""+this.pixetorController.getFrameCount()).length,r=this.exportController.getExportZoom(),i=0;i<this.pixetorController.getFrameCount();i++){var o=this.pixetorController.renderFrameAt(i,!0),o=pxtr.utils.ImageResizer.scale(o,r),n=this.pngFilePrefixInput.value,s=pxtr.utils.StringUtils.leftPad(i,e,"0");t.file(n+s+".png",pxtr.utils.CanvasUtils.getBase64FromCanvas(o)+"\n",{base64:!0})}},t.ZipExportController.prototype.splittedExport_=function(t){for(var e=this.pixetorController.getLayers(),r=(""+this.pixetorController.getFrameCount()).length,i=(""+e.length).length,o=this.exportController.getExportZoom(),n=0;this.pixetorController.hasLayerAt(n);n++)for(var s=this.pixetorController.getLayerAt(n),a=pxtr.utils.StringUtils.leftPad(n,i,"0"),l=0;l<this.pixetorController.getFrameCount();l++){var c=pxtr.utils.LayerUtils.renderFrameAt(s,l,!0),c=pxtr.utils.ImageResizer.scale(c,o),p=this.pngFilePrefixInput.value,h=pxtr.utils.StringUtils.leftPad(l+1,r,"0"),u="l"+a+"_"+p+h+".png";this.useLayerNamesCheckbox.checked&&(u=s.getName()+"_"+p+h+".png"),t.file(u,pxtr.utils.CanvasUtils.getBase64FromCanvas(c)+"\n",{base64:!0})}},t.ZipExportController.prototype.getPixetorName_=function(){return this.pixetorController.getPixetor().getDescriptor().name}}(),!function(){var t=$.namespace("pxtr.controller.settings.exportimage");t.MiscExportController=function(t){this.pixetorController=t},pxtr.utils.inherit(t.MiscExportController,pxtr.controller.settings.AbstractSettingController),t.MiscExportController.prototype.init=function(){var t=document.querySelector(".c-download-button");this.addEventListener(t,"click",this.onDownloadCFileClick_)},t.MiscExportController.prototype.onDownloadCFileClick_=function(t){for(var e=this.getPixetorName_()+".c",r=this.getPixetorName_().replace(" ","_"),i=this.pixetorController.getWidth(),o=this.pixetorController.getHeight(),n=this.pixetorController.getFrameCount(),s="#include <stdint.h>\n\n",s=(s=(s=(s=(s+="#define "+r.toUpperCase()+"_FRAME_COUNT "+this.pixetorController.getFrameCount()+"\n")+("#define "+r.toUpperCase()+"_FRAME_WIDTH "+i+"\n"))+("#define "+r.toUpperCase()+"_FRAME_HEIGHT "+o+"\n\n"))+('/* Pixetor data for "'+this.getPixetorName_()+'" */\n\n'))+("static const uint32_t "+r.toLowerCase())+("_data["+n+"]["+i*o+"] = {\n"),a=0;a<n;a++){var l=this.pixetorController.renderFrameAt(a,!0).getContext("2d").getImageData(0,0,i,o).data;s+="{\n";for(var c=0;c<l.length;c+=4)s+=this.rgbToCHex(l[c],l[c+1],l[c+2],l[c+3]),c!=l.length-4&&(s+=", "),(c+4)%(4*i)==0&&(s+="\n");s+=a!=n-1?"},\n":"}\n"}s+="};\n",pxtr.utils.BlobUtils.stringToBlob(s,function(t){pxtr.utils.FileUtils.downloadAsFile(t,e)}.bind(this),"application/text")},t.MiscExportController.prototype.getPixetorName_=function(){return this.pixetorController.getPixetor().getDescriptor().name},t.MiscExportController.prototype.rgbToCHex=function(t,e,r,i){var o="0x";return(o+=("00"+i.toString(16)).substr(-2))+("00"+r.toString(16)).substr(-2)+("00"+e.toString(16)).substr(-2)+("00"+t.toString(16)).substr(-2)}}(),!function(){var t=$.namespace("pxtr.controller.settings.exportimage"),e={png:{template:"templates/settings/export/png.html",controller:t.PngExportController},gif:{template:"templates/settings/export/gif.html",controller:t.GifExportController},zip:{template:"templates/settings/export/zip.html",controller:t.ZipExportController},misc:{template:"templates/settings/export/misc.html",controller:t.MiscExportController}};t.ExportController=function(t){this.pixetorController=t,this.tabsWidget=new pxtr.widgets.Tabs(e,this,pxtr.UserSettings.EXPORT_TAB),this.onSizeInputChange_=this.onSizeInputChange_.bind(this)},pxtr.utils.inherit(t.ExportController,pxtr.controller.settings.AbstractSettingController),t.ExportController.prototype.init=function(){this.scaleInput=document.querySelector(".export-scale .scale-input"),this.addEventListener(this.scaleInput,"change",this.onScaleChange_),this.addEventListener(this.scaleInput,"input",this.onScaleChange_),this.widthInput=document.querySelector(".export-resize .resize-width"),this.heightInput=document.querySelector(".export-resize .resize-height");var t=pxtr.UserSettings.get(pxtr.UserSettings.EXPORT_SCALE),t=(this.sizeInputWidget=new pxtr.widgets.SizeInput({widthInput:this.widthInput,heightInput:this.heightInput,initWidth:this.pixetorController.getWidth()*t,initHeight:this.pixetorController.getHeight()*t,onChange:this.onSizeInputChange_}),this.onSizeInputChange_(),document.querySelector(".settings-section-export"));this.tabsWidget.init(t)},t.ExportController.prototype.destroy=function(){this.sizeInputWidget.destroy(),this.tabsWidget.destroy(),this.superclass.destroy.call(this)},t.ExportController.prototype.onScaleChange_=function(){var t=parseFloat(this.scaleInput.value);isNaN(t)||(Math.round(this.getExportZoom())!=t&&this.sizeInputWidget.setWidth(this.pixetorController.getWidth()*t),pxtr.UserSettings.set(pxtr.UserSettings.EXPORT_SCALE,t))},t.ExportController.prototype.updateScaleText_=function(t){t=t.toFixed(1),document.querySelector(".export-scale .scale-text").innerHTML=t+"x"},t.ExportController.prototype.onSizeInputChange_=function(){var t=this.getExportZoom();isNaN(t)||(this.updateScaleText_(t),$.publish(Events.EXPORT_SCALE_CHANGED),this.scaleInput.value=Math.round(t),1<=t&&t<=32&&this.onScaleChange_())},t.ExportController.prototype.getExportZoom=function(){return parseInt(this.widthInput.value,10)/this.pixetorController.getWidth()}}(),!function(){var r=$.namespace("pxtr.controller.settings.resize");r.ResizeController=function(t){this.pixetorController=t,this.container=document.querySelector(".resize-canvas");var e=this.container.querySelector(".resize-anchor-container");this.anchorWidget=new pxtr.widgets.AnchorWidget(e),this.defaultSizeController=new r.DefaultSizeController(t)},pxtr.utils.inherit(r.ResizeController,pxtr.controller.settings.AbstractSettingController),r.ResizeController.prototype.init=function(){this.widthInput=this.container.querySelector('[name="resize-width"]'),this.heightInput=this.container.querySelector('[name="resize-height"]'),this.resizeForm=this.container.querySelector("form"),this.resizeContentCheckbox=this.container.querySelector(".resize-content-checkbox"),this.maintainRatioCheckbox=this.container.querySelector(".resize-ratio-checkbox"),this.sizeInputWidget=new pxtr.widgets.SizeInput({widthInput:this.widthInput,heightInput:this.heightInput,initWidth:this.pixetorController.getWidth(),initHeight:this.pixetorController.getHeight()});var t=pxtr.UserSettings.get("RESIZE_SETTINGS"),e=pxtr.widgets.AnchorWidget.ORIGIN[t.origin]||"TOPLEFT";this.anchorWidget.setOrigin(e),t.resizeContent&&(this.resizeContentCheckbox.checked=!0,this.anchorWidget.disable()),t.maintainRatio?this.maintainRatioCheckbox.checked=!0:this.sizeInputWidget.disableSync(),this.addEventListener(this.resizeForm,"submit",this.onResizeFormSubmit_),this.addEventListener(this.resizeContentCheckbox,"change",this.onResizeContentChange_),this.addEventListener(this.maintainRatioCheckbox,"change",this.onMaintainRatioChange_),this.defaultSizeController.init()},r.ResizeController.prototype.destroy=function(){this.updateUserPreferences_(),this.anchorWidget.destroy(),this.sizeInputWidget.destroy(),this.superclass.destroy.call(this)},r.ResizeController.prototype.onResizeFormSubmit_=function(t){t.preventDefault();t=this.pixetorController.getPixetor(),t=pxtr.utils.ResizeUtils.resizePixetor(t,{width:parseInt(this.widthInput.value,10),height:parseInt(this.heightInput.value,10),origin:this.anchorWidget.getOrigin(),resizeContent:this.resizeContentCheckbox.checked});pxtr.app.pixetorController.setPixetor(t,{preserveState:!0}),$.publish(Events.CLOSE_SETTINGS_DRAWER)},r.ResizeController.prototype.onResizeContentChange_=function(t){t.target.checked?this.anchorWidget.disable():this.anchorWidget.enable()},r.ResizeController.prototype.onMaintainRatioChange_=function(t){t.target.checked?this.sizeInputWidget.enableSync():this.sizeInputWidget.disableSync()},r.ResizeController.prototype.updateUserPreferences_=function(){pxtr.UserSettings.set("RESIZE_SETTINGS",{origin:this.anchorWidget.getOrigin(),resizeContent:!!this.resizeContentCheckbox.checked,maintainRatio:!!this.maintainRatioCheckbox.checked})}}(),!function(){var t=$.namespace("pxtr.controller.settings.resize");t.DefaultSizeController=function(t){this.pixetorController=t},pxtr.utils.inherit(t.DefaultSizeController,pxtr.controller.settings.AbstractSettingController),t.DefaultSizeController.prototype.init=function(){this.container=document.querySelector(".settings-default-size");var t=pxtr.UserSettings.get(pxtr.UserSettings.DEFAULT_SIZE);this.widthInput=this.container.querySelector('[name="default-width"]'),this.heightInput=this.container.querySelector('[name="default-height"]'),this.widthInput.value=t.width,this.heightInput.value=t.height,this.defaultSizeForm=this.container.querySelector("form"),this.addEventListener(this.defaultSizeForm,"submit",this.onFormSubmit_)},t.DefaultSizeController.prototype.onFormSubmit_=function(t){t.preventDefault();var t=pxtr.UserSettings.get(pxtr.UserSettings.DEFAULT_SIZE),e=this.toNumber_(this.widthInput.value,t.width),t=this.toNumber_(this.heightInput.value,t.height);pxtr.UserSettings.set(pxtr.UserSettings.DEFAULT_SIZE,{width:e,height:t}),$.publish(Events.CLOSE_SETTINGS_DRAWER)},t.DefaultSizeController.prototype.toNumber_=function(t,e){t=parseInt(t,10);return t=0!==t&&!isNaN(t)?t:e}}(),!function(){var t=$.namespace("pxtr.controller.settings"),e="save-desktop-partial",r="save-gallery-partial",i="save-gallery-unavailable-partial",o="save-localstorage-partial",n="save-file-download-partial";t.SaveController=function(t){this.pixetorController=t},pxtr.utils.inherit(t.SaveController,pxtr.controller.settings.AbstractSettingController),t.SaveController.prototype.init=function(){this.saveForm=document.querySelector(".save-form"),this.insertSavePartials_(),this.pixetorName=document.querySelector(".pixetor-name"),this.descriptionInput=document.querySelector("#save-description"),this.nameInput=document.querySelector("#save-name"),this.isPublicCheckbox=document.querySelector("input[name=save-public-checkbox]"),this.updateDescriptorInputs_(),this.saveLocalStorageButton=document.querySelector("#save-localstorage-button"),this.saveGalleryButton=document.querySelector("#save-gallery-button"),this.saveDesktopButton=document.querySelector("#save-desktop-button"),this.saveDesktopAsNewButton=document.querySelector("#save-desktop-as-new-button"),this.saveFileDownloadButton=document.querySelector("#save-file-download-button"),this.safeAddEventListener_(this.saveLocalStorageButton,"click",this.saveToIndexedDb_),this.safeAddEventListener_(this.saveGalleryButton,"click",this.saveToGallery_),this.safeAddEventListener_(this.saveDesktopButton,"click",this.saveToDesktop_),this.safeAddEventListener_(this.saveDesktopAsNewButton,"click",this.saveToDesktopAsNew_),this.safeAddEventListener_(this.saveFileDownloadButton,"click",this.saveToFileDownload_),this.addEventListener(this.saveForm,"submit",this.onSaveFormSubmit_),pxtr.app.storageService.isSaving()&&this.disableSaveButtons_(),this.updateSaveToGalleryMessage_(),$.subscribe(Events.BEFORE_SAVING_PIXETOR,this.disableSaveButtons_.bind(this)),$.subscribe(Events.AFTER_SAVING_PIXETOR,this.enableSaveButtons_.bind(this))},t.SaveController.prototype.updateSaveToGalleryMessage_=function(t){var e,r=document.querySelector(".save-online-status");r&&pxtr.app.performanceReportService.hasProblem()&&(e=pxtr.utils.Template.get("save-gallery-warning-partial"),r.innerHTML=e)},t.SaveController.prototype.insertSavePartials_=function(){this.getPartials_().forEach(function(t){this.saveForm.insertAdjacentHTML("beforeend",pxtr.utils.Template.get(t))}.bind(this))},t.SaveController.prototype.getPartials_=function(){return pxtr.utils.Environment.detectNodeWebkit()?[e,o,i]:pxtr.app.isLoggedIn()?[r,o,n]:[n,o,i]},t.SaveController.prototype.updateDescriptorInputs_=function(t){var e=this.pixetorController.getPixetor().getDescriptor();this.descriptionInput.value=e.description,this.nameInput.value=e.name,e.isPublic&&this.isPublicCheckbox.setAttribute("checked",!0),pxtr.app.isLoggedIn()||(document.querySelector(".save-public-section").style.display="none")},t.SaveController.prototype.onSaveFormSubmit_=function(t){t.preventDefault(),t.stopPropagation(),pxtr.app.isLoggedIn()?this.saveToGallery_():this.saveToIndexedDb_()},t.SaveController.prototype.saveToFileDownload_=function(){this.saveTo_("saveToFileDownload",!1)},t.SaveController.prototype.saveToGallery_=function(){this.saveTo_("saveToGallery",!1)},t.SaveController.prototype.saveToIndexedDb_=function(){this.saveTo_("saveToIndexedDb",!1)},t.SaveController.prototype.saveToDesktop_=function(){this.saveTo_("saveToDesktop",!1)},t.SaveController.prototype.saveToDesktopAsNew_=function(){this.saveTo_("saveToDesktop",!0)},t.SaveController.prototype.saveTo_=function(t,e){var r=this.pixetorController.getPixetor();r.setDescriptor(this.getDescriptor_()),pxtr.app.storageService[t](r,!!e).then(this.onSaveSuccess_)},t.SaveController.prototype.getDescriptor_=function(){var t=this.nameInput.value,e=this.descriptionInput.value;return new pxtr.model.pixetor.Descriptor(t,e,this.isPublic_())},t.SaveController.prototype.isPublic_=function(){return!this.isPublicCheckbox||!!this.isPublicCheckbox.checked},t.SaveController.prototype.onSaveSuccess_=function(){$.publish(Events.CLOSE_SETTINGS_DRAWER)},t.SaveController.prototype.disableSaveButtons_=function(){this.setDisabled_(this.saveLocalStorageButton,!0),this.setDisabled_(this.saveGalleryButton,!0),this.setDisabled_(this.saveDesktopButton,!0),this.setDisabled_(this.saveDesktopAsNewButton,!0),this.setDisabled_(this.saveFileDownloadButton,!0)},t.SaveController.prototype.enableSaveButtons_=function(){this.setDisabled_(this.saveLocalStorageButton,!1),this.setDisabled_(this.saveGalleryButton,!1),this.setDisabled_(this.saveDesktopButton,!1),this.setDisabled_(this.saveDesktopAsNewButton,!1),this.setDisabled_(this.saveFileDownloadButton,!1)},t.SaveController.prototype.setDisabled_=function(t,e){t&&(e?t.setAttribute("disabled","disabled"):t.removeAttribute("disabled"))},t.SaveController.prototype.safeAddEventListener_=function(t,e,r){t&&this.addEventListener(t,e,r)}}(),!function(){var t=$.namespace("pxtr.controller.settings");t.ImportController=function(t){this.pixetorController=t},pxtr.utils.inherit(t.ImportController,pxtr.controller.settings.AbstractSettingController),t.ImportController.prototype.init=function(){this.hiddenFileInput=document.querySelector('[name="file-upload-input"]'),this.addEventListener(this.hiddenFileInput,"change",this.onFileUploadChange_),this.hiddenOpenPixetorInput=document.querySelector('[name="open-pixetor-input"]'),this.addEventListener(".browse-local-button","click",this.onBrowseLocalClick_),this.addEventListener(".browse-backups-button","click",this.onBrowseBackupsClick_),this.addEventListener(".file-input-button","click",this.onFileInputClick_),pxtr.utils.Environment.detectNodeWebkit()?this.addEventListener(".open-pixetor-button","click",this.openPixetorDesktop_):(this.addEventListener(this.hiddenOpenPixetorInput,"change",this.onOpenPixetorChange_),this.addEventListener(".open-pixetor-button","click",this.onOpenPixetorClick_))},t.ImportController.prototype.closeDrawer_=function(){$.publish(Events.CLOSE_SETTINGS_DRAWER)},t.ImportController.prototype.onFileUploadChange_=function(t){this.importPictureFromFile_()},t.ImportController.prototype.onFileInputClick_=function(t){this.hiddenFileInput.click()},t.ImportController.prototype.onOpenPixetorChange_=function(t){var e=this.hiddenOpenPixetorInput.files;1==e.length&&this.openPixetorFile_(e[0])},t.ImportController.prototype.openPixetorDesktop_=function(t){this.closeDrawer_(),pxtr.app.desktopStorageService.openPixetor()},t.ImportController.prototype.onOpenPixetorClick_=function(t){this.hiddenOpenPixetorInput.click()},t.ImportController.prototype.onBrowseLocalClick_=function(t){$.publish(Events.DIALOG_SHOW,{dialogId:"browse-local"}),this.closeDrawer_()},t.ImportController.prototype.onBrowseBackupsClick_=function(t){$.publish(Events.DIALOG_SHOW,{dialogId:"browse-backups"}),this.closeDrawer_()},t.ImportController.prototype.openPixetorFile_=function(t){this.isPixetor_(t)?($.publish(Events.DIALOG_SHOW,{dialogId:"import",initArgs:{rawFiles:[t]}}),this.closeDrawer_()):(this.closeDrawer_(),console.error("The selected file is not a pixetor file"))},t.ImportController.prototype.importPictureFromFile_=function(){var t=this.hiddenFileInput.files;Array.prototype.every.call(t,function(t){return 0===t.type.indexOf("image")})?($.publish(Events.DIALOG_SHOW,{dialogId:"import",initArgs:{rawFiles:t}}),this.closeDrawer_()):(this.closeDrawer_(),console.error("Some files are not images"))},t.ImportController.prototype.isPixetor_=function(t){return/\.pixetor$/.test(t.name)},t.ImportController.prototype.onRestorePreviousSessionClick_=function(){window.confirm("This will erase your current workspace. Continue ?")&&(pxtr.app.backupService.load(),$.publish(Events.CLOSE_SETTINGS_DRAWER))}}(),!function(){var t=$.namespace("pxtr.controller.settings"),e={user:{template:"templates/settings/preferences.html",controller:t.PreferencesController},resize:{template:"templates/settings/resize.html",controller:t.resize.ResizeController},export:{template:"templates/settings/export.html",controller:t.exportimage.ExportController},import:{template:"templates/settings/import.html",controller:t.ImportController},localstorage:{template:"templates/settings/localstorage.html",controller:t.LocalStorageController},save:{template:"templates/settings/save.html",controller:t.SaveController}},r="has-expanded-drawer";t.SettingsController=function(t){this.pixetorController=t,this.closeDrawerShortcut=pxtr.service.keyboard.Shortcuts.MISC.CLOSE_POPUP,this.settingsContainer=document.querySelector("[data-pxtr-controller=settings]"),this.drawerContainer=document.getElementById("drawer-container"),this.isExpanded=!1,this.currentSetting=null},t.SettingsController.prototype.init=function(){pxtr.utils.Event.addEventListener(this.settingsContainer,"click",this.onSettingsContainerClick_,this),pxtr.utils.Event.addEventListener(document.body,"click",this.onBodyClick_,this),$.subscribe(Events.CLOSE_SETTINGS_DRAWER,this.closeDrawer_.bind(this))},t.SettingsController.prototype.onSettingsContainerClick_=function(t){var e=pxtr.utils.Dom.getData(t.target,"setting");e&&(this.currentSetting!=e?this.loadSetting_(e):this.closeDrawer_(),t.stopPropagation(),t.preventDefault())},t.SettingsController.prototype.onBodyClick_=function(t){var t=t.target,e=pxtr.utils.Dom.isParent(t,this.drawerContainer),t=t.dataset.setting;this.isExpanded&&!(e||t)&&this.closeDrawer_()},t.SettingsController.prototype.loadSetting_=function(t){this.drawerContainer.innerHTML=pxtr.utils.Template.get(e[t].template),this.destroyCurrentController_(),this.currentSetting=t,this.currentController=new e[t].controller(this.pixetorController),this.currentController.init(),pxtr.app.shortcutService.registerShortcut(this.closeDrawerShortcut,this.closeDrawer_.bind(this)),pxtr.utils.Dom.removeClass(r);t=document.querySelector("[data-setting="+t+"]");t&&t.classList.add(r),this.settingsContainer.classList.add("expanded"),this.isExpanded=!0},t.SettingsController.prototype.closeDrawer_=function(){pxtr.utils.Dom.removeClass(r),this.settingsContainer.classList.remove("expanded"),this.isExpanded=!1,this.currentSetting=null,document.activeElement.blur(),this.destroyCurrentController_()},t.SettingsController.prototype.destroyCurrentController_=function(){this.currentController&&(pxtr.app.shortcutService.unregisterShortcut(this.closeDrawerShortcut),this.currentController.destroy&&(this.currentController.destroy(),this.currentController=null))}}(),!function(){var t=$.namespace("pxtr.controller.dialogs");t.AbstractDialogController=function(){},t.AbstractDialogController.prototype.init=function(){var t=document.querySelector(".dialog-close");this.addEventListener(t,"click",this.closeDialog)},t.AbstractDialogController.prototype.addEventListener=function(t,e,r){pxtr.utils.Event.addEventListener(t,e,r,this)},t.AbstractDialogController.prototype.destroy=function(){pxtr.utils.Event.removeAllEventListeners(this)},t.AbstractDialogController.prototype.closeDialog=function(){$.publish(Events.DIALOG_HIDE)},t.AbstractDialogController.prototype.setTitle=function(t){var e=document.querySelector(".dialog-title");e&&(e.innerText=t)}}(),!function(){var t=$.namespace("pxtr.controller.dialogs");t.CreatePaletteController=function(t){this.paletteService=pxtr.app.paletteService,this.paletteImportService=pxtr.app.paletteImportService},pxtr.utils.inherit(t.CreatePaletteController,t.AbstractDialogController),t.CreatePaletteController.prototype.init=function(t){this.superclass.init.call(this),this.hiddenFileInput=document.querySelector(".create-palette-import-input"),this.nameInput=document.querySelector('input[name="palette-name"]');var e=document.querySelector(".create-palette-actions"),r=document.querySelector(".create-palette-delete"),i=document.querySelector(".create-palette-download-button"),o=document.querySelector(".create-palette-import-button"),e=(this.addEventListener(this.nameInput,"input",this.onNameInputChange_),this.addEventListener(this.hiddenFileInput,"change",this.onFileInputChange_),this.addEventListener(e,"click",this.onButtonClick_),this.addEventListener(i,"click",this.onDownloadButtonClick_),this.addEventListener(o,"click",this.onImportFileButtonClick_),document.querySelector(".colors-container")),e=(this.colorsListWidget=new pxtr.widgets.ColorsList(e),t==Constants.CURRENT_COLORS_PALETTE_ID);o=t&&!e?(o.style.display="none",this.setTitle("Edit Palette"),o=this.paletteService.getPaletteById(t),pxtr.model.Palette.fromObject(o)):(i.style.display="none",r.style.display="none",this.setTitle("Create Palette"),t=pxtr.utils.Uuid.generate(),e?new pxtr.model.Palette(t,"Current colors clone",this.getCurrentColors_()):new pxtr.model.Palette(t,"New palette",[])),this.setPalette_(o)},t.CreatePaletteController.prototype.getCurrentColors_=function(){return this.paletteService.getPaletteById(Constants.CURRENT_COLORS_PALETTE_ID).getColors()},t.CreatePaletteController.prototype.setPalette_=function(t){this.palette=t,this.nameInput.value=pxtr.utils.unescapeHtml(t.name),this.colorsListWidget.setColors(t.getColors())},t.CreatePaletteController.prototype.destroy=function(){this.colorsListWidget.destroy(),this.superclass.destroy.call(this),this.nameInput=null,this.hiddenFileInput=null},t.CreatePaletteController.prototype.onButtonClick_=function(t){t=t.target;"submit"===t.dataset.action?this.saveAndSelectPalette_():"cancel"===t.dataset.action?this.closeDialog():"delete"===t.dataset.action&&this.deletePalette_()},t.CreatePaletteController.prototype.saveAndSelectPalette_=function(){this.palette.setColors(this.colorsListWidget.getColors()),this.paletteService.savePalette(this.palette),pxtr.UserSettings.set(pxtr.UserSettings.SELECTED_PALETTE,this.palette.id),this.closeDialog()},t.CreatePaletteController.prototype.deletePalette_=function(){window.confirm("Are you sure you want to delete palette "+this.palette.name)&&(this.paletteService.deletePaletteById(this.palette.id),pxtr.UserSettings.set(pxtr.UserSettings.SELECTED_PALETTE,Constants.CURRENT_COLORS_PALETTE_ID),this.closeDialog())},t.CreatePaletteController.prototype.onDownloadButtonClick_=function(){var t=new pxtr.service.palette.PaletteGplWriter(this.palette).write();pxtr.utils.BlobUtils.stringToBlob(t,function(t){pxtr.utils.FileUtils.downloadAsFile(t,this.palette.name+".gpl")}.bind(this),"application/json")},t.CreatePaletteController.prototype.onImportFileButtonClick_=function(){this.hiddenFileInput.click()},t.CreatePaletteController.prototype.onFileInputChange_=function(t){var e=this.hiddenFileInput.files;1==e.length&&this.paletteImportService.read(e[0],this.setPalette_.bind(this),this.displayErrorMessage_.bind(this))},t.CreatePaletteController.prototype.displayErrorMessage_=function(t){t="Could not import palette : "+t,$.publish(Events.SHOW_NOTIFICATION,[{content:t}]),window.setTimeout($.publish.bind($,Events.HIDE_NOTIFICATION),2e3)},t.CreatePaletteController.prototype.onNameInputChange_=function(t){this.palette.name=pxtr.utils.escapeHtml(this.nameInput.value)}}(),!function(){var t=$.namespace("pxtr.controller.dialogs");t.BrowseLocalController=function(t){},pxtr.utils.inherit(t.BrowseLocalController,t.AbstractDialogController),t.BrowseLocalController.prototype.init=function(){this.superclass.init.call(this),this.localStorageItemTemplate_=pxtr.utils.Template.get("local-storage-item-template"),this.service_=pxtr.app.indexedDbStorageService,this.pixetorList=document.querySelector(".local-pixetor-list"),this.fillLocalPixetorsList_(),this.pixetorList.addEventListener("click",this.onPixetorsListClick_.bind(this))},t.BrowseLocalController.prototype.onPixetorsListClick_=function(t){var e=t.target.getAttribute("data-action"),t=t.target.getAttribute("data-name");"load"===e?window.confirm("This will erase your current pixetor. Continue ?")&&(this.service_.load(t),this.closeDialog()):"delete"===e&&window.confirm("This will permanently DELETE this pixetor from your computer. Continue ?")&&(this.service_.remove(t),this.fillLocalPixetorsList_())},t.BrowseLocalController.prototype.fillLocalPixetorsList_=function(){this.service_.getKeys().then(function(t){var r="";t.sort(function(t,e){return t.date<e.date?1:t.date>e.date?-1:0}),t.forEach(function(t){var e=pxtr.utils.DateUtils.format(t.date,"{{Y}}/{{M}}/{{D}} {{H}}:{{m}}");r+=pxtr.utils.Template.replace(this.localStorageItemTemplate_,{name:t.name,date:e})}.bind(this)),this.pixetorList.tBodies[0].innerHTML=r}.bind(this))}}(),!function(){var t=$.namespace("pxtr.controller.dialogs"),o="cheatsheet-shortcut-editing";t.CheatsheetController=function(){},pxtr.utils.inherit(t.CheatsheetController,t.AbstractDialogController),t.CheatsheetController.prototype.init=function(){this.superclass.init.call(this),this.cheatsheetEl=document.getElementById("cheatsheetContainer"),this.eventTrapInput=document.getElementById("cheatsheetEventTrap"),this.addEventListener(".cheatsheet-restore-defaults","click",this.onRestoreDefaultsClick_),this.addEventListener(this.cheatsheetEl,"click",this.onCheatsheetClick_),this.addEventListener(this.eventTrapInput,"keydown",this.onEventTrapKeydown_),this.onShortcutsChanged_=this.onShortcutsChanged_.bind(this),$.subscribe(Events.SHORTCUTS_CHANGED,this.onShortcutsChanged_),this.initMarkup_(),document.querySelector(".cheatsheet-helptext").setAttribute("title",this.getHelptextTitle_())},t.CheatsheetController.prototype.destroy=function(){this.eventTrapInput.blur(),$.unsubscribe(Events.SHORTCUTS_CHANGED,this.onShortcutsChanged_),this.cheatsheetEl=null,this.superclass.destroy.call(this)},t.CheatsheetController.prototype.onRestoreDefaultsClick_=function(){window.confirm("Replace all custom shortcuts by the default Pixetor shortcuts ?")&&pxtr.app.shortcutService.restoreDefaultShortcuts()},t.CheatsheetController.prototype.onShortcutsChanged_=function(){this.initMarkup_()},t.CheatsheetController.prototype.onCheatsheetClick_=function(t){var e,t=pxtr.utils.Dom.getParentWithData(t.target,"shortcutId");t?(e=t.dataset.shortcutId,e=pxtr.app.shortcutService.getShortcutById(e),t.classList.contains(o)?(pxtr.utils.Dom.removeClass(o),this.eventTrapInput.blur()):e.isEditable()&&(pxtr.utils.Dom.removeClass(o),t.classList.add(o),this.eventTrapInput.focus())):pxtr.utils.Dom.removeClass(o)},t.CheatsheetController.prototype.onEventTrapKeydown_=function(t){var e,r,i=document.querySelector("."+o);!i||(e=pxtr.service.keyboard.KeyUtils.createKeyFromEvent(t))&&(e=pxtr.service.keyboard.KeyUtils.stringify(e),r=i.dataset.shortcutId,r=pxtr.app.shortcutService.getShortcutById(r),pxtr.app.shortcutService.updateShortcut(r,e),i.classList.remove(o),this.eventTrapInput.blur(),t.preventDefault())},t.CheatsheetController.prototype.initMarkup_=function(){this.initMarkupForCategory_("TOOL",".cheatsheet-tool-shortcuts",this.getToolIconClass_),this.initMarkupForCategory_("MISC",".cheatsheet-misc-shortcuts"),this.initMarkupForCategory_("COLOR",".cheatsheet-color-shortcuts"),this.initMarkupForCategory_("SELECTION",".cheatsheet-selection-shortcuts"),this.initMarkupForCategory_("STORAGE",".cheatsheet-storage-shortcuts")},t.CheatsheetController.prototype.getToolIconClass_=function(t){return"tool-icon cheatsheet-icon-"+t.getId()},t.CheatsheetController.prototype.initMarkupForCategory_=function(t,e,r){var i=pxtr.service.keyboard.Shortcuts[t],t=Object.keys(i).map(function(t){return this.toDescriptor_(i[t],r)}.bind(this));this.initMarkupForDescriptors_(t,e)},t.CheatsheetController.prototype.toDescriptor_=function(t,e){return{shortcut:t,iconClass:"function"==typeof e?e(t):""}},t.CheatsheetController.prototype.initMarkupForDescriptors_=function(t,e){e=document.querySelector(e);e&&(t=t.map(this.getMarkupForDescriptor_.bind(this)),e.innerHTML=t.join(""))},t.CheatsheetController.prototype.getMarkupForDescriptor_=function(t){var e=pxtr.utils.Template.get("cheatsheet-shortcut-template"),r=t.shortcut,i=r.isCustom()?r.getDescription()+" *":r.getDescription(),o=[],n=(r.isUndefined()&&o.push("cheatsheet-shortcut-undefined"),r.isEditable()&&o.push("cheatsheet-shortcut-editable"),r.isEditable()?"Click to edit the key":"Shortcut cannot be remapped");return pxtr.utils.Template.replace(e,{id:r.getId(),title:n,icon:t.iconClass,description:i,"!key!":this.formatKey_(r.getDisplayKey()),className:o.join(" ")})},t.CheatsheetController.prototype.formatKey_=function(t){return t=(t=(t=(t=(t=(t=(t=(t=pxtr.utils.UserAgent.isMac?(t=t.replace("ctrl","cmd")).replace("alt","option"):t).replace(/left/i,"&larr;")).replace(/up/i,"&uarr;")).replace(/right/i,"&rarr;")).replace(/down/i,"&darr;")).replace(/>/g,"&gt;")).replace(/</g,"&lt;")).replace(/([^ ])\+([^ ])/g,"$1 + $2")},t.CheatsheetController.prototype.getHelptextTitle_=function(){return'<div class="cheatsheet-helptext-tooltip">'+["Click on a shortcut to change the key.","When the shortcut blinks, press the key on your keyboard to assign it.","White shortcuts can not be edited.","Click on 'Restore default shortcuts' to erase all custom shortcuts."].reduce(function(t,e){return t+'<div class="cheatsheet-helptext-tooltip-item">'+e+"</div>"},"")+"</div>"}}(),!function(){var t=$.namespace("pxtr.controller.dialogs.backups.steps");t.SelectSession=function(t,e,r){this.pixetorController=t,this.backupsController=e,this.container=r},t.SelectSession.prototype.addEventListener=function(t,e,r){pxtr.utils.Event.addEventListener(t,e,r,this)},t.SelectSession.prototype.init=function(){this.addEventListener(this.container,"click",this.onContainerClick_)},t.SelectSession.prototype.onShow=function(){this.update()},t.SelectSession.prototype.update=function(){pxtr.app.backupService.list().then(function(t){t=this.getMarkupForSessions_(t);this.container.querySelector(".session-list").innerHTML=t}.bind(this)).catch(function(){var t=pxtr.utils.Template.get("session-list-error");this.container.querySelector(".session-list").innerHTML=t}.bind(this))},t.SelectSession.prototype.getMarkupForSessions_=function(t){var r;return 0===t.length?pxtr.utils.Template.get("session-list-empty"):(r=pxtr.utils.Template.get("session-list-item"),t.reduce(function(t,e){return e.id===pxtr.app.sessionId?t:(e={id:e.id,name:e.name,description:e.description?"- "+e.description:"",date:pxtr.utils.DateUtils.format(e.endDate,"the {{Y}}/{{M}}/{{D}} at {{H}}:{{m}}"),count:1===e.count?"1 snapshot":e.count+" snapshots"},t+pxtr.utils.Template.replace(r,e))},""))},t.SelectSession.prototype.destroy=function(){pxtr.utils.Event.removeAllEventListeners(this)},t.SelectSession.prototype.onContainerClick_=function(t){var e,r,i=t.target.dataset.sessionId;i&&("view"==(e=t.target.dataset.action)?(this.backupsController.backupsData.selectedSession=i,this.backupsController.next()):"delete"==e&&window.confirm("Are you sure you want to delete this session?")&&(t.target.closest(".session-item").classList.add("deleting"),Q.all([pxtr.app.backupService.deleteSession(i),(e=500,r=Q.defer(),setTimeout(function(){r.resolve()},e),r.promise)]).then(function(){this.update()}.bind(this))))}}(),!function(){var t=$.namespace("pxtr.controller.dialogs.backups.steps");t.SessionDetails=function(t,e,r){this.pixetorController=t,this.backupsController=e,this.container=r},t.SessionDetails.prototype.init=function(){this.backButton=this.container.querySelector(".back-button"),this.addEventListener(this.backButton,"click",this.onBackClick_),this.addEventListener(this.container,"click",this.onContainerClick_)},t.SessionDetails.prototype.destroy=function(){pxtr.utils.Event.removeAllEventListeners(this)},t.SessionDetails.prototype.addEventListener=function(t,e,r){pxtr.utils.Event.addEventListener(t,e,r,this)},t.SessionDetails.prototype.onShow=function(){var t=this.backupsController.backupsData.selectedSession;pxtr.app.backupService.getSnapshotsBySessionId(t).then(function(t){var e=this.getMarkupForSnapshots_(t);this.container.querySelector(".snapshot-list").innerHTML=e,t.forEach(function(t){this.updateSnapshotPreview_(t)}.bind(this))}.bind(this)).catch(function(){var t=pxtr.utils.Template.get("snapshot-list-error");this.container.querySelector(".snapshot-list").innerHTML=t}.bind(this))},t.SessionDetails.prototype.getMarkupForSnapshots_=function(t){var r;return 0===t.length?(console.warn("Could not retrieve snapshots for a session"),pxtr.utils.Template.get("snapshot-list-empty")):(r=pxtr.utils.Template.get("snapshot-list-item"),t.reduce(function(t,e){e={id:e.id,name:e.name,description:e.description?"- "+e.description:"",date:pxtr.utils.DateUtils.format(e.date,"the {{Y}}/{{M}}/{{D}} at {{H}}:{{m}}"),frames:1===e.frames?"1 frame":e.frames+" frames",resolution:pxtr.utils.StringUtils.formatSize(e.width,e.height),fps:e.fps};return t+pxtr.utils.Template.replace(r,e)},""))},t.SessionDetails.prototype.updateSnapshotPreview_=function(r){pxtr.utils.serialization.Deserializer.deserialize(JSON.parse(r.serialized),function(t){var e='.snapshot-item[data-snapshot-id="'+r.id+'"] .snapshot-preview',e=this.container.querySelector(e);e&&(t=this.getFirstFrameAsImage_(t),e.appendChild(t))}.bind(this))},t.SessionDetails.prototype.getFirstFrameAsImage_=function(t){var e=pxtr.utils.LayerUtils.mergeFrameAt(t.getLayers(),0),r=60/t.width,t=60/t.height,t=Math.min(t,r);return pxtr.utils.FrameUtils.toImage(e,t)},t.SessionDetails.prototype.onBackClick_=function(){this.backupsController.back(this)},t.SessionDetails.prototype.onContainerClick_=function(t){"load"==t.target.dataset.action&&window.confirm(Constants.CONFIRM_OVERWRITE)&&(t=+t.target.dataset.snapshotId,pxtr.app.backupService.loadSnapshotById(t).then(function(){$.publish(Events.DIALOG_HIDE)}))}}(),!function(){var t=$.namespace("pxtr.controller.dialogs.backups"),o={SELECT_SESSION:{controller:t.steps.SelectSession,template:"backups-select-session"},SESSION_DETAILS:{controller:t.steps.SessionDetails,template:"backups-session-details"}};t.BrowseBackups=function(t,e){this.pixetorController=t,this.backupsData={sessions:[],selectedSession:null}},pxtr.utils.inherit(t.BrowseBackups,pxtr.controller.dialogs.AbstractDialogController),t.BrowseBackups.prototype.init=function(){this.superclass.init.call(this),this.steps=this.createSteps_();var t=document.querySelector(".backups-wizard-container");this.wizard=new pxtr.widgets.Wizard(this.steps,t),this.wizard.init(),this.wizard.goTo("SELECT_SESSION")},t.BrowseBackups.prototype.back=function(){this.wizard.back(),this.wizard.getCurrentStep().instance.onShow()},t.BrowseBackups.prototype.next=function(){"SELECT_SESSION"===this.wizard.getCurrentStep().name&&this.wizard.goTo("SESSION_DETAILS")},t.BrowseBackups.prototype.destroy=function(t){Object.keys(this.steps).forEach(function(t){t=this.steps[t];t.instance.destroy(),t.instance=null,t.el=null}.bind(this)),this.superclass.destroy.call(this)},t.BrowseBackups.prototype.createSteps_=function(){var i={};return Object.keys(o).forEach(function(t){var e=o[t],r=pxtr.utils.Template.getAsHTML(e.template),e=new e.controller(this.pixetorController,this,r);e.init(),i[t]={name:t,el:r,instance:e}}.bind(this)),i}}(),!function(){var t=$.namespace("pxtr.controller.dialogs.importwizard.steps");t.AbstractImportStep=function(t,e,r){this.pixetorController=t,this.container=r,this.importController=e,this.mergeData=this.importController.mergeData},t.AbstractImportStep.prototype.init=function(){this.nextButton=this.container.querySelector(".import-next-button"),this.backButton=this.container.querySelector(".import-back-button"),this.addEventListener(this.nextButton,"click",this.onNextClick),this.addEventListener(this.backButton,"click",this.onBackClick)},t.AbstractImportStep.prototype.addEventListener=function(t,e,r){pxtr.utils.Event.addEventListener(t,e,r,this)},t.AbstractImportStep.prototype.destroy=function(){this.framePickerWidget&&this.framePickerWidget.destroy(),pxtr.utils.Event.removeAllEventListeners(this)},t.AbstractImportStep.prototype.onNextClick=function(){this.importController.next(this)},t.AbstractImportStep.prototype.onBackClick=function(){this.importController.back(this)},t.AbstractImportStep.prototype.onShow=function(){var t,e=this.mergeData.mergePixetor;e&&(this.framePickerWidget?this.framePickerWidget.pixetor!=e&&(this.framePickerWidget.pixetor=e,this.framePickerWidget.setFrameIndex(1)):(t=this.container.querySelector(".import-preview"),this.framePickerWidget=new pxtr.widgets.FramePicker(e,t),this.framePickerWidget.init()),t=pxtr.utils.Template.getAndReplace("import-meta-content",{name:e.getDescriptor().name,dimensions:pxtr.utils.StringUtils.formatSize(e.getWidth(),e.getHeight()),frames:e.getFrameCount(),layers:e.getLayers().length}),this.container.querySelector(".import-meta").innerHTML=t)}}(),!function(){var o=$.namespace("pxtr.controller.dialogs.importwizard.steps");o.AdjustSize=function(t,e,r){this.superclass.constructor.apply(this,arguments)},o.AdjustSize.OPTIONS={KEEP:"keep",EXPAND:"expand"},pxtr.utils.inherit(o.AdjustSize,o.AbstractImportStep),o.AdjustSize.prototype.init=function(){this.superclass.init.call(this);var t=this.container.querySelector(".import-resize-anchor-container");this.anchorWidget=new pxtr.widgets.AnchorWidget(t,this.onAnchorChange_.bind(this)),this.anchorWidget.setOrigin("TOPLEFT"),this.resizeInfoContainer=this.container.querySelector(".import-resize-info"),this.addEventListener(this.resizeInfoContainer,"change",this.onResizeOptionChange_),this.mergeData.resize=o.AdjustSize.OPTIONS.EXPAND},o.AdjustSize.prototype.destroy=function(){this.anchorWidget.destroy(),this.superclass.destroy.call(this)},o.AdjustSize.prototype.onShow=function(){this.refresh_(),this.superclass.onShow.call(this)},o.AdjustSize.prototype.refresh_=function(){var t=this.isImportedPixetorBigger_(),e=this.mergeData.resize===o.AdjustSize.OPTIONS.KEEP,r=this.formatPixetorSize_(this.pixetorController.getPixetor()),i=this.formatPixetorSize_(this.mergeData.mergePixetor),r=t?pxtr.utils.Template.getAndReplace("import-resize-bigger-partial",{size:r,newSize:i,keepChecked:e?'checked="checked"':"",expandChecked:e?"":'checked="checked"'}):pxtr.utils.Template.getAndReplace("import-resize-smaller-partial",{size:r,newSize:i}),i=(this.resizeInfoContainer.innerHTML=r,this.mergeData.origin&&this.anchorWidget.setOrigin(this.mergeData.origin),this.container.querySelector(".import-resize-anchor-info"));i.innerHTML=t&&e?['<div class="import-resize-warning">',"  Imported content will be cropped!","</div>","Select crop anchor:"].join(""):t?"Select resize anchor:":"Select position anchor:"},o.AdjustSize.prototype.onAnchorChange_=function(t){this.mergeData.origin=t},o.AdjustSize.prototype.onResizeOptionChange_=function(){var t=this.resizeInfoContainer.querySelector(":checked").value;this.mergeData.resize!=t&&(this.mergeData.resize=t,this.refresh_())},o.AdjustSize.prototype.isImportedPixetorBigger_=function(){var t=this.mergeData.mergePixetor;return!!t&&(t.width>this.pixetorController.getWidth()||t.height>this.pixetorController.getHeight())},o.AdjustSize.prototype.formatPixetorSize_=function(t){return pxtr.utils.StringUtils.formatSize(t.width,t.height)}}(),!function(){var t=$.namespace("pxtr.controller.dialogs.importwizard.steps");t.ImageImport=function(t,e,r){this.superclass.constructor.apply(this,arguments),this.importedImage_=null,this.file_=null},pxtr.utils.inherit(t.ImageImport,t.AbstractImportStep),t.ImageImport.prototype.init=function(t){this.superclass.init.call(this),this.file_=this.mergeData.rawFiles[0],this.importPreview=this.container.querySelector(".import-section-preview"),this.fileNameContainer=this.container.querySelector(".import-image-file-name"),this.singleImportType=this.container.querySelector("[name=import-type][value=single]"),this.sheetImportType=this.container.querySelector("[name=import-type][value=sheet]"),this.resizeWidth=this.container.querySelector("[name=resize-width]"),this.resizeHeight=this.container.querySelector("[name=resize-height]"),this.smoothResize=this.container.querySelector("[name=smooth-resize-checkbox]"),this.frameSizeX=this.container.querySelector("[name=frame-size-x]"),this.frameSizeY=this.container.querySelector("[name=frame-size-y]"),this.frameOffsetX=this.container.querySelector("[name=frame-offset-x]"),this.frameOffsetY=this.container.querySelector("[name=frame-offset-y]"),this.addEventListener(this.singleImportType,"change",this.onImportTypeChange_),this.addEventListener(this.sheetImportType,"change",this.onImportTypeChange_),this.addEventListener(this.resizeWidth,"keyup",this.onResizeInputKeyUp_),this.addEventListener(this.resizeHeight,"keyup",this.onResizeInputKeyUp_),this.addEventListener(this.frameSizeX,"keyup",this.onFrameInputKeyUp_),this.addEventListener(this.frameSizeY,"keyup",this.onFrameInputKeyUp_),this.addEventListener(this.frameOffsetX,"keyup",this.onFrameInputKeyUp_),this.addEventListener(this.frameOffsetY,"keyup",this.onFrameInputKeyUp_),pxtr.utils.FileUtils.readImageFile(this.file_,this.onImageLoaded_.bind(this)),this.pixetorController.isEmpty()&&(this.nextButton.textContent="import")},t.ImageImport.prototype.onNextClick=function(){this.container.classList.add("import-image-loading"),this.createPixetorFromImage().then(function(t){this.mergeData.mergePixetor=t,this.container.classList.remove("import-image-loading"),this.superclass.onNextClick.call(this)}.bind(this)).catch(function(t){console.error(t)})},t.ImageImport.prototype.onShow=function(){this.container.classList.remove("import-image-loading")},t.ImageImport.prototype.createPixetorFromImage=function(){var t=(t=this.extractFileNameFromPath_(this.file_.name)).replace(/\.[a-zA-Z]+$/,""),e=Q.defer();return pxtr.app.importService.newPixetorFromImage(this.importedImage_,{importType:this.getImportType_(),frameSizeX:"single"===this.getImportType_()?this.resizeWidth.value:this.sanitizeInputValue_(this.frameSizeX,1),frameSizeY:"single"===this.getImportType_()?this.resizeHeight.value:this.sanitizeInputValue_(this.frameSizeY,1),frameOffsetX:this.sanitizeInputValue_(this.frameOffsetX,0),frameOffsetY:this.sanitizeInputValue_(this.frameOffsetY,0),smoothing:!!this.smoothResize.checked,name:t},e.resolve),e.promise},t.ImageImport.prototype.onImportTypeChange_=function(t){var e,r,i,o;"single"===this.getImportType_()?this.hideFrameGrid_():(e=this.sanitizeInputValue_(this.frameOffsetX,0),r=this.sanitizeInputValue_(this.frameOffsetY,0),i=this.sanitizeInputValue_(this.frameSizeX,1),o=this.sanitizeInputValue_(this.frameSizeY,1),this.drawFrameGrid_(e,r,i,o))},t.ImageImport.prototype.onResizeInputKeyUp_=function(t){var e=t.target.getAttribute("name");this.importedImage_&&this.synchronizeResizeFields_(t.target.value,e)},t.ImageImport.prototype.onFrameInputKeyUp_=function(t){this.importedImage_&&this.synchronizeFrameFields_(t.target.value)},t.ImageImport.prototype.synchronizeResizeFields_=function(t,e){t=parseInt(t,10),isNaN(t)&&(t=0);var r=this.importedImage_.height,i=this.importedImage_.width;this.singleImportType.checked=!0,"resize-width"===e?this.resizeHeight.value=Math.round(t*r/i):this.resizeWidth.value=Math.round(t*i/r)},t.ImageImport.prototype.synchronizeFrameFields_=function(t){t=parseInt(t,10),isNaN(t)&&(t=0);var t=this.sanitizeInputValue_(this.frameSizeX,1),e=this.sanitizeInputValue_(this.frameSizeY,1),r=this.sanitizeInputValue_(this.frameOffsetX,0),i=this.sanitizeInputValue_(this.frameOffsetY,0);this.sheetImportType.checked=!0,this.drawFrameGrid_(r,i,t,e)},t.ImageImport.prototype.sanitizeInputValue_=function(t,e){var r=parseInt(t.value,10);return r=r<=e||isNaN(r)?t.value=e:r},t.ImageImport.prototype.getImportType_=function(){if(this.singleImportType.checked)return this.singleImportType.value;if(this.sheetImportType.checked)return this.sheetImportType.value;throw"Could not find the currently selected import type"},t.ImageImport.prototype.onImageLoaded_=function(t){this.importedImage_=t;var t=this.importedImage_.width,e=this.importedImage_.height,r=(this.importedImage_.onload=function(){},this.extractFileNameFromPath_(this.file_.name));this.fileNameContainer.textContent=r,this.fileNameContainer.setAttribute("title",r),this.resizeWidth.value=t,this.resizeHeight.value=e,this.frameSizeX.value=t,this.frameSizeY.value=e,this.frameOffsetX.value=0,this.frameOffsetY.value=0,this.importPreview.innerHTML="",this.importPreview.appendChild(this.createImagePreview_())},t.ImageImport.prototype.createImagePreview_=function(){var t=document.createElement("IMG");return t.src=this.importedImage_.src,t},t.ImageImport.prototype.extractFileNameFromPath_=function(t){var e=[];return(e=-1!==t.indexOf("/")?t.split("/"):-1!==t.indexOf("\\")?t.split("\\"):[t])[e.length-1]},t.ImageImport.prototype.drawFrameGrid_=function(t,e,r,i){if(this.importedImage_){var o=this.importedImage_.width,n=this.importedImage_.height,s=this.importPreview.querySelector("img"),a=s.offsetWidth,s=s.offsetHeight,l=this.importPreview.querySelector("canvas"),c=(l||(l=pxtr.utils.CanvasUtils.createCanvas(a+1,s+1),this.importPreview.appendChild(l)),l.getContext("2d")),p=(c.clearRect(0,0,l.width,l.height),c.beginPath(),Math.floor((o-t)/r)),h=Math.floor((n-e)/i);if(0<p&&0<h){for(var u=a/o,d=s/n,f=p*r+t,g=h*i+e,m=t+.5;m<f+1&&m<o+1;m+=r)c.moveTo(m*u,e*d),c.lineTo(m*u,g*d);for(var y=e+.5;y<g+1&&y<n+1;y+=i)c.moveTo(t*u,y*d),c.lineTo(f*u,y*d);c.lineWidth=1,c.strokeStyle="gold",c.stroke(),l.style.display="block"}else this.hideFrameGrid_()}},t.ImageImport.prototype.hideFrameGrid_=function(){var t=this.importPreview.querySelector("canvas");t&&(t.style.display="none")}}(),!function(){var e=$.namespace("pxtr.controller.dialogs.importwizard.steps");e.InsertLocation=function(){this.superclass.constructor.apply(this,arguments)},e.InsertLocation.MODES={ADD:"add",INSERT:"insert"},pxtr.utils.inherit(e.InsertLocation,e.AbstractImportStep),e.InsertLocation.prototype.init=function(){this.superclass.init.call(this),this.framePreview=this.container.querySelector(".insert-frame-preview"),this.currentPixetorFramePickerWidget=new pxtr.widgets.FramePicker(this.pixetorController.getPixetor(),this.framePreview),this.insertModeContainer=this.container.querySelector(".insert-mode-container"),this.addEventListener(this.insertModeContainer,"change",this.onInsertModeChange_),this.mergeData.insertMode=e.InsertLocation.MODES.ADD},e.InsertLocation.prototype.onInsertModeChange_=function(){var t=this.insertModeContainer.querySelector(":checked").value;this.mergeData.insertMode=t,this.mergeData.insertMode===e.InsertLocation.MODES.ADD?this.currentPixetorFramePickerWidget.setFirstFrameIndex(0):this.currentPixetorFramePickerWidget.setFirstFrameIndex(1)},e.InsertLocation.prototype.onShow=function(){this.currentPixetorFramePickerWidget.init();var t=this.pixetorController.getCurrentFrameIndex();this.currentPixetorFramePickerWidget.setFrameIndex(t+1),this.currentPixetorFramePickerWidget.setFirstFrameIndex(0),this.superclass.onShow.call(this)},e.InsertLocation.prototype.onNextClick=function(){var t=this.currentPixetorFramePickerWidget.getFrameIndex();this.mergeData.insertIndex=t,this.superclass.onNextClick.call(this)},e.InsertLocation.prototype.destroy=function(){this.currentPixetorFramePickerWidget.destroy(),this.superclass.destroy.call(this)}}(),!function(){var t=$.namespace("pxtr.controller.dialogs.importwizard.steps");t.SelectMode=function(t,e,r){this.superclass.constructor.apply(this,arguments)},t.SelectMode.MODES={REPLACE:"replace",MERGE:"merge"},pxtr.utils.inherit(t.SelectMode,t.AbstractImportStep),t.SelectMode.prototype.init=function(){this.superclass.init.call(this);var t=this.container.querySelector(".import-mode-replace-button"),e=this.container.querySelector(".import-mode-merge-button");this.addEventListener(t,"click",this.onReplaceButtonClick_),this.addEventListener(e,"click",this.onMergeButtonClick_)},t.SelectMode.prototype.onShow=function(){this.superclass.onShow.call(this)},t.SelectMode.prototype.destroy=function(){this.superclass.destroy.call(this)},t.SelectMode.prototype.onReplaceButtonClick_=function(){this.mergeData.importMode=t.SelectMode.MODES.REPLACE,this.onNextClick()},t.SelectMode.prototype.onMergeButtonClick_=function(){this.mergeData.importMode=t.SelectMode.MODES.MERGE,this.onNextClick()}}(),!function(){var r=$.namespace("pxtr.controller.dialogs.importwizard"),n={IMAGE_IMPORT:{controller:r.steps.ImageImport,template:"import-image-import"},ADJUST_SIZE:{controller:r.steps.AdjustSize,template:"import-adjust-size"},INSERT_LOCATION:{controller:r.steps.InsertLocation,template:"import-insert-location"},SELECT_MODE:{controller:r.steps.SelectMode,template:"import-select-mode"}};r.ImportWizard=function(t,e){this.pixetorController=t,this.mergeData={rawFiles:[],mergePixetor:null,origin:null,resize:null,insertIndex:null,insertMode:null}},pxtr.utils.inherit(r.ImportWizard,pxtr.controller.dialogs.AbstractDialogController),r.ImportWizard.prototype.init=function(t){this.superclass.init.call(this),this.mergeData.rawFiles=t.rawFiles,this.steps=this.createSteps_();t=document.querySelector(".import-wizard-container");this.wizard=new pxtr.widgets.Wizard(this.steps,t),this.wizard.init(),this.hasSingleImage_()?this.wizard.goTo("IMAGE_IMPORT"):this.hasSinglePixetorFile_()?pxtr.utils.PixetorFileUtils.loadFromFile(this.mergeData.rawFiles[0],function(t){this.mergeData.mergePixetor=t,this.wizard.goTo("SELECT_MODE")}.bind(this),function(t){this.closeDialog(),$.publish(Events.PIXETOR_FILE_IMPORT_FAILED,[t])}.bind(this)):(console.error("Unsupported import. Only single pixetor or single image are supported at the moment."),this.closeDialog())},r.ImportWizard.prototype.back=function(){this.wizard.back(),this.wizard.getCurrentStep().instance.onShow()},r.ImportWizard.prototype.next=function(){var t=this.wizard.getCurrentStep();"IMAGE_IMPORT"===t.name?this.pixetorController.isEmpty()?(this.mergeData.importMode=r.steps.SelectMode.MODES.REPLACE,this.finalizeImport_()):this.wizard.goTo("SELECT_MODE"):"SELECT_MODE"===t.name?this.mergeData.importMode===r.steps.SelectMode.MODES.REPLACE?this.finalizeImport_():this.hasSameSize_()?this.wizard.goTo("INSERT_LOCATION"):this.wizard.goTo("ADJUST_SIZE"):"ADJUST_SIZE"===t.name?this.wizard.goTo("INSERT_LOCATION"):"INSERT_LOCATION"===t.name&&this.finalizeImport_()},r.ImportWizard.prototype.destroy=function(t){Object.keys(this.steps).forEach(function(t){t=this.steps[t];t.instance.destroy(),t.instance=null,t.el=null}.bind(this)),this.superclass.destroy.call(this)},r.ImportWizard.prototype.createSteps_=function(){var i=this.hasSingleImage_(),o={};return Object.keys(n).forEach(function(t){var e,r;"IMAGE_IMPORT"===t&&!i||(r=n[t],e=pxtr.utils.Template.getAsHTML(r.template),(r=new r.controller(this.pixetorController,this,e)).init(),o[t]={name:t,el:e,instance:r})}.bind(this)),(i?o.IMAGE_IMPORT:o.SELECT_MODE).el.classList.add("import-first-step"),o},r.ImportWizard.prototype.finalizeImport_=function(){var t=this.mergeData.mergePixetor,e=this.mergeData.importMode;e===r.steps.SelectMode.MODES.REPLACE?window.confirm(Constants.CONFIRM_OVERWRITE)&&(this.pixetorController.setPixetor(t),this.closeDialog()):e===r.steps.SelectMode.MODES.MERGE&&(e=pxtr.utils.MergeUtils.merge(this.pixetorController.getPixetor(),t,{insertIndex:this.mergeData.insertIndex,insertMode:this.mergeData.insertMode,origin:this.mergeData.origin,resize:this.mergeData.resize}),this.pixetorController.setPixetor(e),e=t.getLayers().length,t=this.pixetorController.getLayers().length,this.pixetorController.setCurrentLayerIndex(t-e),this.closeDialog())},r.ImportWizard.prototype.hasSameSize_=function(){var t=this.mergeData.mergePixetor;return!!t&&(t.width===this.pixetorController.getWidth()&&t.height===this.pixetorController.getHeight())},r.ImportWizard.prototype.hasSingleImage_=function(){return 1===this.mergeData.rawFiles.length&&0===this.mergeData.rawFiles[0].type.indexOf("image")},r.ImportWizard.prototype.hasSinglePixetorFile_=function(){var t;return 1===this.mergeData.rawFiles.length&&(t=this.mergeData.rawFiles[0],/\.pixetor$/.test(t.name))}}(),!function(){var t=$.namespace("pxtr.controller.dialogs");t.PerformanceInfoController=function(){},pxtr.utils.inherit(t.PerformanceInfoController,t.AbstractDialogController),t.PerformanceInfoController.prototype.init=function(){this.superclass.init.call(this)}}(),!function(){var t=$.namespace("pxtr.controller.dialogs");t.UnsupportedBrowserController=function(){},pxtr.utils.inherit(t.UnsupportedBrowserController,t.AbstractDialogController),t.UnsupportedBrowserController.prototype.init=function(){this.superclass.init.call(this),document.querySelector("#current-user-agent").innerText=pxtr.utils.UserAgent.getDisplayName()}}(),!function(){var t=$.namespace("pxtr.controller.dialogs"),i={cheatsheet:{template:"templates/dialogs/cheatsheet.html",controller:t.CheatsheetController},"create-palette":{template:"templates/dialogs/create-palette.html",controller:t.CreatePaletteController},"browse-local":{template:"templates/dialogs/browse-local.html",controller:t.BrowseLocalController},import:{template:"templates/dialogs/import.html",controller:t.importwizard.ImportWizard},"performance-info":{template:"templates/dialogs/performance-info.html",controller:t.PerformanceInfoController},"unsupported-browser":{template:"templates/dialogs/unsupported-browser.html",controller:t.UnsupportedBrowserController},"browse-backups":{template:"templates/dialogs/browse-backups.html",controller:t.backups.BrowseBackups}};t.DialogsController=function(t){this.pixetorController=t,this.closePopupShortcut=pxtr.service.keyboard.Shortcuts.MISC.CLOSE_POPUP,this.currentDialog_=null},t.DialogsController.prototype.init=function(){this.dialogContainer_=document.getElementById("dialog-container"),this.dialogWrapper_=document.getElementById("dialog-container-wrapper"),$.subscribe(Events.DIALOG_SHOW,this.onDialogDisplayEvent_.bind(this)),$.subscribe(Events.DIALOG_HIDE,this.hideDialog.bind(this));var t=pxtr.service.keyboard.Shortcuts.COLOR.CREATE_PALETTE,t=(pxtr.app.shortcutService.registerShortcut(t,this.onCreatePaletteShortcut_.bind(this)),pxtr.service.keyboard.Shortcuts.MISC.CHEATSHEET);pxtr.app.shortcutService.registerShortcut(t,this.onCheatsheetShortcut_.bind(this)),pxtr.utils.Event.addEventListener(".cheatsheet-link","click",this.onCheatsheetShortcut_,this),this.dialogWrapper_.classList.add("animated"),pxtr.utils.Event.addEventListener(this.dialogWrapper_,"click",this.onWrapperClicked_,this)},t.DialogsController.prototype.onCreatePaletteShortcut_=function(){this.toggleDialog_("create-palette")},t.DialogsController.prototype.onCheatsheetShortcut_=function(){this.toggleDialog_("cheatsheet")},t.DialogsController.prototype.toggleDialog_=function(t){this.isDisplayingDialog_()?this.getCurrentDialogId_()===t&&this.hideDialog():this.showDialog(t)},t.DialogsController.prototype.onDialogDisplayEvent_=function(t,e){this.showDialog(e.dialogId,e.initArgs)},t.DialogsController.prototype.onWrapperClicked_=function(t){t.target===this.dialogWrapper_&&this.hideDialog()},t.DialogsController.prototype.showDialog=function(t,e){var r;this.isDisplayingDialog_()||((r=i[t])?(this.dialogContainer_.classList.add(t),this.dialogContainer_.innerHTML=pxtr.utils.Template.get(r.template),(r=new r.controller(this.pixetorController)).init(e),this.currentDialog_={id:t,controller:r},pxtr.app.shortcutService.registerShortcut(this.closePopupShortcut,this.hideDialog.bind(this)),this.dialogWrapper_.classList.add("show")):console.error("Could not find dialog configuration for dialogId : "+t))},t.DialogsController.prototype.hideDialog=function(){!this.isHiding_&&this.isDisplayingDialog_()&&(pxtr.app.shortcutService.unregisterShortcut(this.closePopupShortcut),this.dialogWrapper_.classList.remove("show"),window.setTimeout(this.cleanupDialogContainer_.bind(this),500),this.isHiding_=!0)},t.DialogsController.prototype.cleanupDialogContainer_=function(){this.dialogContainer_.classList.remove(this.currentDialog_.id),this.currentDialog_.controller.destroy(),this.currentDialog_=null,this.dialogContainer_.innerHTML="",this.isHiding_=!1},t.DialogsController.prototype.isDisplayingDialog_=function(){return null!==this.currentDialog_},t.DialogsController.prototype.getCurrentDialogId_=function(){return this.currentDialog_?this.currentDialog_.id:null}}(),!function(){var e=$.namespace("pxtr.widgets"),i="anchor-option";e.AnchorWidget=function(t,e){this.onChangeCallback=e,this.wrapper=document.createElement("div"),this.wrapper.classList.add("anchor-wrapper"),this.wrapper.innerHTML='<div class="anchor-option"  title="top left"      data-origin="TOPLEFT"></div><div class="anchor-option"  title="top"           data-origin="TOP"></div><div class="anchor-option"  title="top right"     data-origin="TOPRIGHT"></div><div class="anchor-option"  title="middle left"   data-origin="MIDDLELEFT"></div><div class="anchor-option"  title="middle"        data-origin="MIDDLE"></div><div class="anchor-option"  title="middle right"  data-origin="MIDDLERIGHT"></div><div class="anchor-option"  title="bottom left"   data-origin="BOTTOMLEFT"></div><div class="anchor-option"  title="bottom"        data-origin="BOTTOM"></div><div class="anchor-option"  title="bottom right"  data-origin="BOTTOMRIGHT"></div>',t.innerHTML="",t.appendChild(this.wrapper),this.disabled=!1,pxtr.utils.Event.addEventListener(this.wrapper,"click",this.onResizeOriginClick_,this)},e.AnchorWidget.ORIGIN={TOPLEFT:"TOPLEFT",TOP:"TOP",TOPRIGHT:"TOPRIGHT",MIDDLELEFT:"MIDDLELEFT",MIDDLE:"MIDDLE",MIDDLERIGHT:"MIDDLERIGHT",BOTTOMLEFT:"BOTTOMLEFT",BOTTOM:"BOTTOM",BOTTOMRIGHT:"BOTTOMRIGHT"},e.AnchorWidget.prototype.destroy=function(t){pxtr.utils.Event.removeAllEventListeners(this),this.wrapper=null},e.AnchorWidget.prototype.onResizeOriginClick_=function(t){t=t.target.dataset.origin;t&&e.AnchorWidget.ORIGIN[t]&&!this.disabled&&this.setOrigin(t)},e.AnchorWidget.prototype.setOrigin=function(t){this.origin=t;var e=this.wrapper.querySelector("."+i+".selected"),e=(e&&e.classList.remove("selected"),this.wrapper.querySelector("."+i+'[data-origin="'+t+'"]'));e&&(e.classList.add("selected"),this.refreshNeighbors_(e)),"function"==typeof this.onChangeCallback&&this.onChangeCallback(t)},e.AnchorWidget.prototype.getOrigin=function(){return this.origin},e.AnchorWidget.prototype.disable=function(){this.disabled=!0,this.wrapper.classList.add("transition"),this.wrapper.classList.add("disabled")},e.AnchorWidget.prototype.enable=function(){this.disabled=!1,this.wrapper.classList.remove("disabled"),window.setTimeout(this.wrapper.classList.remove.bind(this.wrapper.classList,"transition"),250)},e.AnchorWidget.prototype.refreshNeighbors_=function(t){for(var e=this.wrapper.querySelectorAll("."+i),r=0;r<e.length;r++)e[r].removeAttribute("data-neighbor");t=Array.prototype.indexOf.call(e,t);this.setNeighborhood_(e[t-1],"left"),this.setNeighborhood_(e[t+1],"right"),this.setNeighborhood_(e[t-3],"top"),this.setNeighborhood_(e[t+3],"bottom")},e.AnchorWidget.prototype.setNeighborhood_=function(t,e){-1===this.origin.toLowerCase().indexOf(e)&&t.setAttribute("data-neighbor",e)}}(),!function(){var t=$.namespace("pxtr.widgets");t.ColorsList=function(t){this.selectedIndex=-1,this.palette=new pxtr.model.Palette("tmp","tmp",[]),this.container=t,this.colorsList=this.container.querySelector(".colors-list"),this.colorPreviewEl=this.container.querySelector(".color-preview"),$(t).sortable({placeholder:"colors-list-drop-proxy",update:this.onColorDrop_.bind(this),items:".create-palette-color"}),pxtr.utils.Event.addEventListener(this.colorsList,"click",this.onColorContainerClick_,this);t=t.querySelector(".color-picker-container");this.hslRgbColorPicker=new pxtr.widgets.HslRgbColorPicker(t,this.onColorUpdated_.bind(this)),this.hslRgbColorPicker.init()},t.ColorsList.prototype.setColors=function(t){0===t.length&&t.push("#000000"),this.palette.setColors(t),this.selectColor_(0),this.refresh_()},t.ColorsList.prototype.getColors=function(){return this.palette.getColors()},t.ColorsList.prototype.destroy=function(){pxtr.utils.Event.removeAllEventListeners(this),$(this.container).sortable("destroy"),this.hslRgbColorPicker.destroy(),this.container=null,this.colorsList=null,this.colorPreviewEl=null},t.ColorsList.prototype.refreshColorElement_=function(t){var e=this.palette.get(this.selectedIndex),t=document.querySelector('[data-palette-index="'+t+'"]');t&&(t.style.background=e,t.classList.toggle("light-color",this.isLight_(e)))},t.ColorsList.prototype.onColorContainerClick_=function(t){var e=t.target;e.classList.contains("create-palette-color")?this.onPaletteColorClick_(t,e):e.classList.contains("create-palette-new-color")?this.onNewColorClick_(t,e):e.classList.contains("create-palette-remove-color")&&this.onRemoveColorClick_(t,e),this.refresh_()},t.ColorsList.prototype.onColorUpdated_=function(t){t=t.toHexString();this.colorPreviewEl.style.background=t,this.palette&&(this.palette.set(this.selectedIndex,t),this.refreshColorElement_(this.selectedIndex))},t.ColorsList.prototype.onPaletteColorClick_=function(t,e){e=parseInt(e.dataset.paletteIndex,10);this.selectColor_(e)},t.ColorsList.prototype.onRemoveColorClick_=function(t,e){e=e.parentNode,e=parseInt(e.dataset.paletteIndex,10);this.removeColor_(e)},t.ColorsList.prototype.onNewColorClick_=function(t,e){var r=this.palette.get(this.selectedIndex)||"#000000";this.palette.add(r),this.selectColor_(this.palette.size()-1)},t.ColorsList.prototype.refresh_=function(){var i="",o=pxtr.utils.Template.get("create-palette-color-template");this.palette.getColors().forEach(function(t,e){var r=e===this.selectedIndex;i+=pxtr.utils.Template.replace(o,{color:t,index:e,":selected":r,":light-color":this.isLight_(t)})}.bind(this)),i+='<li class="create-palette-new-color">+</li>',this.colorsList.innerHTML=i},t.ColorsList.prototype.selectColor_=function(t){this.selectedIndex=t,this.hslRgbColorPicker.setColor(this.palette.get(t))},t.ColorsList.prototype.removeColor_=function(t){this.palette.removeAt(t),this.refresh_()},t.ColorsList.prototype.isLight_=function(t){t=window.tinycolor(t).toRgb();return 384<t.r+t.b+t.g},t.ColorsList.prototype.onColorDrop_=function(t,e){var e=e.item.get(0),r=parseInt(e.dataset.paletteIndex,10),i=document.querySelectorAll(".create-palette-color"),i=Array.prototype.indexOf.call(i,e);this.palette.move(r,i),this.selectedIndex=i,this.refresh_()}}(),!function(){var t=$.namespace("pxtr.widgets");t.FramePicker=function(t,e){this.pixetor=t,this.container=e,this.firstFrameIndex=1,this.wrapper=document.createElement("div"),this.wrapper.innerHTML='<div class="frame-viewer"></div><div class="frame-nav"><button class="button frame-nav-first">&lt;&lt;</button><button class="button frame-nav-previous">&lt;</button><input class="textfield frame-nav-input" type="text"><button class="button frame-nav-next">&gt;</button><button class="button frame-nav-last">&gt;&gt;</button></div>',this.wrapper.classList.add("frame-picker-wrapper"),this.frameViewer=this.wrapper.querySelector(".frame-viewer"),this.firstButton=this.wrapper.querySelector(".frame-nav-first"),this.previousButton=this.wrapper.querySelector(".frame-nav-previous"),this.nextButton=this.wrapper.querySelector(".frame-nav-next"),this.lastButton=this.wrapper.querySelector(".frame-nav-last"),this.input=this.wrapper.querySelector(".frame-nav-input")},t.FramePicker.prototype.init=function(){this.container.appendChild(this.wrapper),this.addEventListener(this.firstButton,"click",this.onFirstClicked_),this.addEventListener(this.previousButton,"click",this.onPreviousClicked_),this.addEventListener(this.nextButton,"click",this.onNextClicked_),this.addEventListener(this.lastButton,"click",this.onLastClicked_),this.addEventListener(this.input,"change",this.onInputChange_),this.setFrameIndex(1)},t.FramePicker.prototype.setFirstFrameIndex=function(t){this.firstFrameIndex=t,this.setFrameIndex(this.currentFrameIndex)},t.FramePicker.prototype.destroy=function(){this.wrapper.parentNode&&this.wrapper.parentNode.removeChild(this.wrapper),pxtr.utils.Event.removeAllEventListeners(this)},t.FramePicker.prototype.onFirstClicked_=function(){this.setFrameIndex(this.firstFrameIndex)},t.FramePicker.prototype.onPreviousClicked_=function(){this.setFrameIndex(this.currentFrameIndex-1)},t.FramePicker.prototype.onNextClicked_=function(){this.setFrameIndex(this.currentFrameIndex+1)},t.FramePicker.prototype.onLastClicked_=function(){this.setFrameIndex(this.pixetor.getFrameCount())},t.FramePicker.prototype.onInputChange_=function(){var t=parseInt(this.input.value,10);isNaN(t)?this.input.value=1:(t=Math.max(this.firstFrameIndex,t),(t=Math.min(this.getFrameCount_(),t))!==this.currentFrameIndex&&this.setFrameIndex(t))},t.FramePicker.prototype.getFrameCount_=function(){return this.pixetor.getLayerAt(0).getFrames().length},t.FramePicker.prototype.addEventListener=function(t,e,r){pxtr.utils.Event.addEventListener(t,e,r,this)},t.FramePicker.prototype.getFrameIndex=function(){return this.currentFrameIndex},t.FramePicker.prototype.setFrameIndex=function(t){t=Math.max(this.firstFrameIndex,t),t=Math.min(this.getFrameCount_(),t),this.currentFrameIndex=t,this.input.value=t;var e=this.getFrameAsImage_(t),e=(e.classList.add("canvas-background"),this.frameViewer.innerHTML="",this.frameViewer.appendChild(e),this.getFrameCount_());this.setEnabled_(this.firstButton,t!==this.firstFrameIndex),this.setEnabled_(this.previousButton,t!==this.firstFrameIndex),this.setEnabled_(this.nextButton,t!==e),this.setEnabled_(this.lastButton,t!==e),0===t&&(this.previousButton.setAttribute("disabled",!0),this.firstButton.setAttribute("disabled",!0))},t.FramePicker.prototype.getFrameAsImage_=function(t){var e;return 0===t?new Image:(t=pxtr.utils.LayerUtils.mergeFrameAt(this.pixetor.getLayers(),t-1),e=this.getZoomLevel_(),pxtr.utils.FrameUtils.toImage(t,e))},t.FramePicker.prototype.getZoomLevel_=function(){var t=this.frameViewer.offsetWidth,e=this.frameViewer.offsetHeight,t=t/this.pixetor.width,e=e/this.pixetor.height;return Math.min(e,t)},t.FramePicker.prototype.setEnabled_=function(t,e){e?t.removeAttribute("disabled"):t.setAttribute("disabled",!0)}}(),!function(){var t=$.namespace("pxtr.widgets");t.HslRgbColorPicker=function(t,e){this.container=t,this.colorUpdatedCallback=e,this.tinyColor=null,this.hsvColor=null,this.rgbColor=null,this.lastInputTimestamp_=0},t.HslRgbColorPicker.prototype.init=function(){var t=pxtr.utils.UserAgent.isFirefox,e=pxtr.utils.UserAgent.isChrome;pxtr.utils.Event.addEventListener(this.container,e||t?"input":"change",this.onPickerChange_,this),pxtr.utils.Event.addEventListener(this.container,"keydown",this.onPickerChange_,this),this.onBlur_=this.onBlur_.bind(this),this.container.addEventListener("blur",this.onBlur_,!0),this.spectrumEl=this.container.querySelector(".color-picker-spectrum"),$(this.spectrumEl).spectrum({flat:!0,showButtons:!1,move:this.setColor.bind(this),change:this.setColor.bind(this)}),this.setColor("#000000")},t.HslRgbColorPicker.prototype.destroy=function(){pxtr.utils.Event.removeAllEventListeners(this),this.container.removeEventListener("blur",this.onBlur_,!0),$(this.spectrumEl).spectrum("destroy"),this.container=null,this.spectrumEl=null},t.HslRgbColorPicker.prototype.onPickerChange_=function(t){var e,r,t=t.target;t.dataset.dimension&&(e=t.dataset.model,r=t.dataset.dimension,t=t.value,this.updateColor_(t,e,r))},t.HslRgbColorPicker.prototype.onKeydown_=function(t){var e,r,i=t.target;"text"!==i.getAttribute("type").toLowerCase()||!i.dataset.dimension||"rgb"!==(e=i.dataset.model)&&"hsv"!==e||(t=this.getIncrement_(t))&&(r=i.dataset.dimension,i=parseInt(i.value,10),this.updateColor_(i+t,e,r))},t.HslRgbColorPicker.prototype.getIncrement_=function(t){var e=0,r=pxtr.service.keyboard.KeycodeTranslator.toChar(t.keyCode);return"up"===r?e=1:"down"===r&&(e=-1),t.shiftKey&&(e*=5),e},t.HslRgbColorPicker.prototype.updateColor_=function(t,e,r){var i,t=this.toModelValue_(t,e,r);"hsv"===e||"rgb"===e?isNaN(t)||((i=this.getColor_(e))[r]=this.normalizeDimension_(t,r),this.setColor(i)):"hex"===e&&/^#([a-f0-9]{3}){1,2}$/i.test(t)&&this.setColor(t)},t.HslRgbColorPicker.prototype.onBlur_=function(t){var e,r,t=t.target;"text"===t.getAttribute("type").toLowerCase()&&t.dataset.dimension&&(e=t.dataset.model,r=t.dataset.dimension,t.value=this.toInputValue_(e,r))},t.HslRgbColorPicker.prototype.setColor=function(t){this.unplugged||(this.unplugged=!0,this.hsvColor=this.toHsvColor_(t),this.tinyColor=this.toTinyColor_(t),this.rgbColor=this.tinyColor.toRgb(),this.updateInputs(),$(".color-picker-spectrum").spectrum("set",this.tinyColor),this.colorUpdatedCallback(this.tinyColor),this.unplugged=!1)},t.HslRgbColorPicker.prototype.updateInputs=function(){for(var t=this.container.querySelectorAll("input"),e=0;e<t.length;e++){var r=t[e],i=r.dataset.dimension,o=r.dataset.model,o=this.toInputValue_(o,i);r.value!=o&&(r.value=o),"range"===r.getAttribute("type")&&this.updateSliderBackground(r)}},t.HslRgbColorPicker.prototype.toInputValue_=function(t,e){var r;return"rgb"===t||"hsv"===t?(r=this.getColor_(t)[e],"v"!==e&&"s"!==e||(r*=100),r=Math.round(r)):"hex"===t&&(r=this.tinyColor.toHexString(!0)),r},t.HslRgbColorPicker.prototype.toModelValue_=function(t,e,r){var i;return"rgb"===e||"hsv"===e?(i=parseInt(t,10),"v"!==r&&"s"!==r||(i/=100)):"hex"===e&&(i=t),i},t.HslRgbColorPicker.prototype.toTinyColor_=function(t){return"object"==typeof t&&t.hasOwnProperty("_tc_id")?t:window.tinycolor(pxtr.utils.copy(t))},t.HslRgbColorPicker.prototype.toHsvColor_=function(t){return["h","s","v"].every(t.hasOwnProperty.bind(t))?{h:this.normalizeDimension_(t.h,"h"),s:this.normalizeDimension_(t.s,"s"),v:this.normalizeDimension_(t.v,"v")}:this.toTinyColor_(t).toHsv()},t.HslRgbColorPicker.prototype.normalizeDimension_=function(t,e){e=this.getDimensionRange_(e);return Math.max(e[0],Math.min(e[1],t))},t.HslRgbColorPicker.prototype.updateSliderBackground=function(t){var e=t.dataset.dimension,r=t.dataset.model;"h"!==e&&(r=this.getSliderBackgroundColors_(r,e),t.style.backgroundImage="linear-gradient(to right, "+r.start+" 0, "+r.end+" 100%)")},t.HslRgbColorPicker.prototype.getSliderBackgroundColors_=function(t,e){var t=this.getColor_(t),r=pxtr.utils.copy(t),t=pxtr.utils.copy(t),i=this.getDimensionRange_(e);return r[e]=i[0],t[e]=i[1],{start:window.tinycolor(r).toRgbString(),end:window.tinycolor(t).toRgbString()}},t.HslRgbColorPicker.prototype.getDimensionRange_=function(t){return"h"===t?[0,359]:"s"===t||"v"===t?[0,1]:"r"===t||"g"===t||"b"===t?[0,255]:void 0},t.HslRgbColorPicker.prototype.getColor_=function(t){var e;return"hsv"===t?e=this.hsvColor:"rgb"===t&&(e=this.rgbColor),e}}(),!function(){var e=$.namespace("pxtr.widgets");e.SizeInput=function(t){this.widthInput=t.widthInput,this.heightInput=t.heightInput,this.initWidth=t.initWidth,this.initHeight=t.initHeight,this.onChange=t.onChange,this.synchronizedInputs=new e.SynchronizedInputs({leftInput:this.widthInput,rightInput:this.heightInput,synchronize:this.synchronize_.bind(this)}),this.disableSync=this.synchronizedInputs.disableSync.bind(this.synchronizedInputs),this.enableSync=this.synchronizedInputs.enableSync.bind(this.synchronizedInputs),this.widthInput.value=this.initWidth,this.heightInput.value=this.initHeight},e.SizeInput.prototype.destroy=function(){this.synchronizedInputs.destroy(),this.widthInput=null,this.heightInput=null},e.SizeInput.prototype.setWidth=function(t){this.widthInput.value=t,this.synchronize_(this.widthInput)},e.SizeInput.prototype.setHeight=function(t){this.heightInput.value=t,this.synchronize_(this.heightInput)},e.SizeInput.prototype.synchronize_=function(t){var e=parseInt(t.value,10);isNaN(e)&&(e=0),t===this.widthInput?this.heightInput.value=Math.round(e*this.initHeight/this.initWidth):t===this.heightInput&&(this.widthInput.value=Math.round(e*this.initWidth/this.initHeight)),this.onChange&&this.onChange()}}(),!function(){var t=$.namespace("pxtr.widgets");t.SizePicker=function(t){this.onChange=t},t.SizePicker.prototype.init=function(t){this.container=t,pxtr.utils.Event.addEventListener(this.container,"click",this.onSizeOptionClick_,this)},t.SizePicker.prototype.destroy=function(){pxtr.utils.Event.removeAllEventListeners(this)},t.SizePicker.prototype.getSize=function(){var t=this.container.querySelector(".selected");return t?t.dataset.size:null},t.SizePicker.prototype.setSize=function(t){var e;this.getSize()!==t&&(pxtr.utils.Dom.removeClass("labeled",this.container),pxtr.utils.Dom.removeClass("selected",this.container),(e=this.container.querySelector('[data-size="'+t+'"]'))||((e=this.container.querySelector("[data-size]:last-child")).classList.add("labeled"),e.setAttribute("real-size",t)),e&&e.classList.add("selected"))},t.SizePicker.prototype.onSizeOptionClick_=function(t){t=t.target.dataset.size;isNaN(t)||(t=parseInt(t,10),this.onChange(t),this.setSize(t))}}(),!function(){var t=$.namespace("pxtr.widgets");t.SynchronizedInputs=function(t){this.leftInput=t.leftInput,this.rightInput=t.rightInput,this.synchronize=t.synchronize,this.syncEnabled=!0,this.lastInput=this.leftInput,pxtr.utils.Event.addEventListener(this.leftInput,"input",this.onInput_,this),pxtr.utils.Event.addEventListener(this.rightInput,"input",this.onInput_,this)},t.SynchronizedInputs.prototype.destroy=function(){pxtr.utils.Event.removeAllEventListeners(this),this.leftInput=null,this.rightInput=null,this.lastInput=null},t.SynchronizedInputs.prototype.enableSync=function(){this.syncEnabled=!0,this.synchronize(this.lastInput)},t.SynchronizedInputs.prototype.disableSync=function(){this.syncEnabled=!1},t.SynchronizedInputs.prototype.onInput_=function(t){t=t.target;this.syncEnabled&&this.synchronize(t),this.lastInput=t}}(),!function(){var t=$.namespace("pxtr.widgets");t.Tabs=function(t,e,r){this.tabs=t,this.parentController=e,this.settingsName=r,this.currentTab=null,this.currentController=null},t.Tabs.prototype.init=function(t){this.tabListEl=t.querySelector(".tab-list"),this.tabContentlEl=t.querySelector(".tab-content"),pxtr.utils.Event.addEventListener(this.tabListEl,"click",this.onTabsClicked_,this);t=pxtr.UserSettings.get(this.settingsName);t&&this.selectTab(t)},t.Tabs.prototype.destroy=function(){this.currentController&&this.currentController.destroy(),pxtr.utils.Event.removeAllEventListeners(this)},t.Tabs.prototype.selectTab=function(t){var e;this.tabs[t]&&this.currentTab!=t&&(this.currentController&&this.currentController.destroy(),this.tabContentlEl.innerHTML=pxtr.utils.Template.get(this.tabs[t].template),this.currentController=new this.tabs[t].controller(pxtr.app.pixetorController,this.parentController),this.currentController.init(),this.currentTab=t,pxtr.UserSettings.set(this.settingsName,t),(e=this.tabListEl.querySelector(".selected"))&&e.classList.remove("selected"),this.tabListEl.querySelector('[data-tab-id="'+t+'"]').classList.add("selected"))},t.Tabs.prototype.onTabsClicked_=function(t){t=pxtr.utils.Dom.getData(t.target,"tabId");this.selectTab(t)}}(),!function(){var t=$.namespace("pxtr.widgets");t.Wizard=function(t,e){this.steps=t,this.container=e,this.wrapper=document.createElement("div"),this.wrapper.classList.add("wizard-wrapper"),this.currentStep=null,this.previousSteps=[]},t.Wizard.prototype.init=function(){Object.keys(this.steps).forEach(function(t){t=this.steps[t];t.el.classList.add("wizard-step"),this.wrapper.appendChild(t.el)}.bind(this)),this.container.appendChild(this.wrapper)},t.Wizard.prototype.getStep=function(t){return this.steps[t]},t.Wizard.prototype.getCurrentStep=function(){return this.currentStep},t.Wizard.prototype.goTo=function(t){var e,r=this.steps[t];r?(e=this.currentStep,this.currentStep=r,this.currentStep.instance.onShow(),e?(this.previousSteps.push(e),this.currentStep.el.classList.add("current-step-in"),window.setTimeout(function(){this.currentStep.el.classList.remove("current-step-in"),e.el.classList.remove("current-step"),this.currentStep.el.classList.add("current-step")}.bind(this),200)):this.currentStep.el.classList.add("current-step")):console.error("Wizard could not go to unknown step: "+t)},t.Wizard.prototype.back=function(){var t,e=this.previousSteps.pop();e?((t=this.currentStep)||console.error("Wizard is in an invalid state"),this.currentStep=e,t.el.classList.add("current-step-out"),t.el.classList.remove("current-step"),this.currentStep.el.classList.add("current-step"),window.setTimeout(function(){t.el.classList.remove("current-step-out")}.bind(this),200)):console.error("Wizard has no previous step to go to.")}}(),!function(){var t=$.namespace("pxtr.service.storage");t.StorageService=function(t){this.pixetorController=t,this.savingFlag_=!1,this.onSaveSuccess_=this.onSaveSuccess_.bind(this),this.onSaveError_=this.onSaveError_.bind(this)},t.StorageService.prototype.init=function(){var t=pxtr.service.keyboard.Shortcuts;pxtr.app.shortcutService.registerShortcut(t.STORAGE.OPEN,this.onOpenKey_.bind(this)),pxtr.app.shortcutService.registerShortcut(t.STORAGE.SAVE,this.onSaveKey_.bind(this)),pxtr.app.shortcutService.registerShortcut(t.STORAGE.SAVE_AS,this.onSaveAsKey_.bind(this)),$.subscribe(Events.BEFORE_SAVING_PIXETOR,this.setSavingFlag_.bind(this,!0)),$.subscribe(Events.AFTER_SAVING_PIXETOR,this.setSavingFlag_.bind(this,!1))},t.StorageService.prototype.isSaving=function(){return this.savingFlag_},t.StorageService.prototype.saveToGallery=function(t){return this.delegateSave_(pxtr.app.galleryStorageService,t)},t.StorageService.prototype.saveToLocalStorage=function(t){return this.delegateSave_(pxtr.app.localStorageService,t)},t.StorageService.prototype.saveToIndexedDb=function(t){return this.delegateSave_(pxtr.app.indexedDbStorageService,t)},t.StorageService.prototype.saveToFileDownload=function(t){return this.delegateSave_(pxtr.app.fileDownloadStorageService,t)},t.StorageService.prototype.saveToDesktop=function(t,e){return this.delegateSave_(pxtr.app.desktopStorageService,t,e)},t.StorageService.prototype.delegateSave_=function(t,e,r){return this.savingFlag_?Q.reject("Already saving"):($.publish(Events.BEFORE_SAVING_PIXETOR),t.save(e,r).then(this.onSaveSuccess_,this.onSaveError_))},t.StorageService.prototype.onOpenKey_=function(){pxtr.utils.Environment.detectNodeWebkit()&&pxtr.app.desktopStorageService.openPixetor()},t.StorageService.prototype.onSaveKey_=function(t){this.pixetorController.getPixetor();pxtr.app.isLoggedIn()?this.saveToGallery(this.pixetorController.getPixetor()):pxtr.utils.Environment.detectNodeWebkit()?this.saveToDesktop(this.pixetorController.getPixetor()):window.setTimeout(function(){this.saveToIndexedDb(this.pixetorController.getPixetor())}.bind(this),0)},t.StorageService.prototype.onSaveAsKey_=function(){pxtr.utils.Environment.detectNodeWebkit()&&this.saveToDesktop(this.pixetorController.getPixetor(),!0)},t.StorageService.prototype.onSaveSuccess_=function(){$.publish(Events.SHOW_NOTIFICATION,[{content:"Successfully saved !",hideDelay:3e3}]),$.publish(Events.PIXETOR_SAVED),this.afterSaving_()},t.StorageService.prototype.onSaveError_=function(t){var e="Saving failed";return t&&(e+=" : "+t),$.publish(Events.SHOW_NOTIFICATION,[{content:e,hideDelay:1e4}]),this.afterSaving_(),Q.reject(t)},t.StorageService.prototype.afterSaving_=function(){$.publish(Events.AFTER_SAVING_PIXETOR)},t.StorageService.prototype.setSavingFlag_=function(t){this.savingFlag_=t}}(),!function(){var t=$.namespace("pxtr.service.storage");t.FileDownloadStorageService=function(){},t.FileDownloadStorageService.prototype.init=function(){},t.FileDownloadStorageService.prototype.save=function(r){var t=pxtr.utils.serialization.Serializer.serialize(r),i=Q.defer();return pxtr.utils.BlobUtils.stringToBlob(t,function(t){var e=r.getDescriptor().name+"-"+pxtr.utils.DateUtils.format(new Date,"{{Y}}{{M}}{{D}}-{{H}}{{m}}{{s}}")+".pixetor";try{pxtr.utils.FileUtils.downloadAsFile(t,e),i.resolve()}catch(t){i.reject(t.message)}}.bind(this),"application/pixetor+json"),i.promise}}(),!function(){var t=$.namespace("pxtr.service.storage");t.IndexedDbStorageService=function(t){this.pixetorController=t,this.pixetorDatabase=new pxtr.database.PixetorDatabase},t.IndexedDbStorageService.prototype.init=function(){this.pixetorDatabase.init().catch(function(t){console.log("Failed to initialize PixetorDatabase, local browser saves will be unavailable.")})},t.IndexedDbStorageService.prototype.save=function(t){var e=t.getDescriptor().name,r=t.getDescriptor().description,i=Date.now(),t=pxtr.utils.serialization.Serializer.serialize(t);return this.save_(e,r,i,t)},t.IndexedDbStorageService.prototype.save_=function(e,r,i,o){return this.pixetorDatabase.get(e).then(function(t){return void 0!==t?this.pixetorDatabase.update(e,r,i,o):this.pixetorDatabase.create(e,r,i,o)}.bind(this))},t.IndexedDbStorageService.prototype.load=function(e){return this.pixetorDatabase.get(e).then(function(t){void 0!==t?(t=t.serialized,pxtr.utils.serialization.Deserializer.deserialize(JSON.parse(t),function(t){pxtr.app.pixetorController.setPixetor(t)})):console.log("no local browser save found for name: "+e)})},t.IndexedDbStorageService.prototype.remove=function(t){return this.pixetorDatabase.delete(t)},t.IndexedDbStorageService.prototype.getKeys=function(){return this.pixetorDatabase.list()}}(),!function(){var t=$.namespace("pxtr.service.storage");t.LocalStorageService=function(t){if(void 0===t)throw"Bad LocalStorageService initialization: <undefined pixetorController>";this.pixetorController=t},t.LocalStorageService.prototype.init=function(){},t.LocalStorageService.prototype.save=function(t){var e=t.getDescriptor().name,r=t.getDescriptor().description,t=pxtr.utils.serialization.Serializer.serialize(t);if(pxtr.app.localStorageService.getPixetor(e)&&!window.confirm("There is already a pixetor saved as "+e+". Overwrite ?"))return Q.reject('Cancelled by user, "'+e+'" already exists');try{return this.removeFromKeys_(e),this.addToKeys_(e,r,Date.now()),window.localStorage.setItem("pixetor."+e,t),Q.resolve()}catch(t){return Q.reject(t.message)}},t.LocalStorageService.prototype.load=function(t){var e=this.getPixetor(t);this.getKey_(t);pxtr.utils.serialization.Deserializer.deserialize(JSON.parse(e),function(t){pxtr.app.pixetorController.setPixetor(t)})},t.LocalStorageService.prototype.remove=function(t){this.removeFromKeys_(t),window.localStorage.removeItem("pixetor."+t)},t.LocalStorageService.prototype.saveKeys_=function(t){window.localStorage.setItem("pixetor.keys",JSON.stringify(t))},t.LocalStorageService.prototype.removeFromKeys_=function(e){var t=this.getKeys().filter(function(t){return t.name!==e});this.saveKeys_(t)},t.LocalStorageService.prototype.getKey_=function(e){var t=this.getKeys().filter(function(t){return t.name===e});return 0<t.length?t[0]:null},t.LocalStorageService.prototype.addToKeys_=function(t,e,r){var i=this.getKeys();i.push({name:t,description:e,date:r}),this.saveKeys_(i)},t.LocalStorageService.prototype.getPixetor=function(t){return window.localStorage.getItem("pixetor."+t)},t.LocalStorageService.prototype.getKeys=function(t){var e=window.localStorage.getItem("pixetor.keys");return JSON.parse(e)||[]}}(),!function(){var t=$.namespace("pxtr.service.storage");t.GalleryStorageService=function(t){this.pixetorController=t},t.GalleryStorageService.prototype.init=function(){},t.GalleryStorageService.prototype.save=function(t){var e=t.getDescriptor(),r=Q.defer(),t=pxtr.utils.serialization.Serializer.serialize(t),i={framesheet:t,fps:this.pixetorController.getFPS(),name:e.name,description:e.description,frames:this.pixetorController.getFrameCount(),first_frame_as_png:pxtr.app.getFirstFrameAsPng(),framesheet_as_png:pxtr.app.getFramesheetAsPng()};t.length>Constants.APPENGINE_SAVE_LIMIT&&r.reject("This sprite is too big to be saved on the gallery. Try saving it as a .pixetor file."),e.isPublic&&(i.public=!0);return pxtr.utils.Xhr.post(Constants.APPENGINE_SAVE_URL,i,function(t){r.resolve()},function(t){r.reject(this.getErrorMessage_(t))}.bind(this)),r.promise},t.GalleryStorageService.prototype.getErrorMessage_=function(t){return 401===t.status?"Session expired, please log in again.":403===t.status?"Unauthorized action, this sprite belongs to another account.":500===t.status?"Unexpected server error, please contact us on Github (pixetor) or Twitter (@pixetorapp)":"Unknown error"}}(),!function(){var t=$.namespace("pxtr.service.storage"),r=".pixetor";t.DesktopStorageService=function(t){this.pixetorController=t||pxtr.app.pixetorController,this.hideNotificationTimeoutID=0},t.DesktopStorageService.prototype.init=function(){},t.DesktopStorageService.prototype.save=function(t,e){return t.savePath&&!e?this.saveAtPath_(t,t.savePath):(e=t.getDescriptor().name,pxtr.utils.FileUtilsDesktop.chooseFilenameDialog(e,r).then(this.saveAtPath_.bind(this,t)))},t.DesktopStorageService.prototype.saveAtPath_=function(t,e){var r;return e?(r=pxtr.utils.serialization.Serializer.serialize(t),e=this.addExtensionIfNeeded_(e),t.savePath=e,t.setName(this.extractFilename_(e)),pxtr.utils.FileUtilsDesktop.saveToFile(r,e)):Q.reject("Invalid file name")},t.DesktopStorageService.prototype.openPixetor=function(){return pxtr.utils.FileUtilsDesktop.chooseFilenameDialog().then(this.load)},t.DesktopStorageService.prototype.load=function(e){pxtr.utils.FileUtilsDesktop.readFile(e).then(function(t){pxtr.utils.PixetorFileUtils.decodePixetorFile(t,function(t){t.savePath=e,pxtr.app.pixetorController.setPixetor(t)})})},t.DesktopStorageService.prototype.addExtensionIfNeeded_=function(t){return t.substr(-r.length)===r?t:t+r},t.DesktopStorageService.prototype.extractFilename_=function(t){t=/[\/\\]([^\/\\]*)\.pixetor$/gi.exec(t);if(t&&t[1])return t[1]}}(),!function(){var t=$.namespace("pxtr.service");t.BackupService=function(t,e){this.pixetorController=t,this.lastHash=this.pixetorController.getPixetor().getHash(),this.nextSnapshotDate=-1,this.backupDatabase=e||new pxtr.database.BackupDatabase},t.BackupService.prototype.init=function(){this.backupDatabase.init().then(function(){window.setInterval(this.backup.bind(this),6e4)}.bind(this))},t.BackupService.prototype.currentDate_=function(){return Date.now()},t.BackupService.prototype.backup=function(){var t=this.pixetorController.getPixetor(),e=t.getHash();if(e===this.lastHash)return Q.resolve();this.lastHash=e;var e=t.getDescriptor(),r=this.currentDate_(),i={session_id:pxtr.app.sessionId,date:r,name:e.name,description:e.description,frames:t.getFrameCount(),width:t.getWidth(),height:t.getHeight(),fps:t.getFPS(),serialized:pxtr.utils.serialization.Serializer.serialize(t)};return this.getSnapshotsBySessionId(pxtr.app.sessionId).then(function(t){var e=t[0];return e&&r<this.nextSnapshotDate?(i.id=e.id,this.backupDatabase.updateSnapshot(i)):(this.nextSnapshotDate=r+3e5,this.backupDatabase.createSnapshot(i).then(function(){if(12<=t.length)return this.backupDatabase.deleteSnapshot(t[t.length-1])}.bind(this)).then(function(){if(!e)return this.backupDatabase.getSessions().then(function(t){if(!(t.length<=10))return t=t.sort(function(t,e){return t.startDate-e.startDate}).map(function(t){return t.id}).slice(0,t.length-10),Q.all(t.map(function(t){return this.deleteSession(t)}.bind(this)))}.bind(this))}.bind(this)))}.bind(this)).catch(function(t){console.error(t)})},t.BackupService.prototype.getSnapshotsBySessionId=function(t){return this.backupDatabase.getSnapshotsBySessionId(t)},t.BackupService.prototype.deleteSession=function(t){return this.backupDatabase.deleteSnapshotsForSession(t)},t.BackupService.prototype.getPreviousPixetorInfo=function(){return this.backupDatabase.findLastSnapshot(function(t){return t.session_id!==pxtr.app.sessionId})},t.BackupService.prototype.list=function(){return this.backupDatabase.getSessions()},t.BackupService.prototype.loadSnapshotById=function(t){var e=Q.defer();return this.backupDatabase.getSnapshot(t).then(function(t){pxtr.utils.serialization.Deserializer.deserialize(JSON.parse(t.serialized),function(t){pxtr.app.pixetorController.setPixetor(t),e.resolve()})}),e.promise},t.BackupService.prototype.load=function(){var e=Q.defer();return this.getPreviousPixetorInfo().then(function(t){pxtr.utils.serialization.Deserializer.deserialize(JSON.parse(t.serialized),function(t){pxtr.app.pixetorController.setPixetor(t),e.resolve()})}),e.promise}}(),!function(){var t=$.namespace("pxtr.service");t.BeforeUnloadService=function(t){this.pixetorController=t},t.BeforeUnloadService.prototype.init=function(){var t;pxtr.utils.Environment.detectNodeWebkit()&&(t=require("nw.gui").Window.get()).on("close",this.onNwWindowClose.bind(this,t)),window.addEventListener("beforeunload",this.onBeforeUnload.bind(this))},t.BeforeUnloadService.prototype.onNwWindowClose=function(t){var e=this.onBeforeUnload();if(e&&!window.confirm(e))return!1;t.close(!0)},t.BeforeUnloadService.prototype.onBeforeUnload=function(t){var e;if(pxtr.app.backupService.backup(),pxtr.app.savedStatusService.isDirty())return e="Your current sprite has unsaved changes. Are you sure you want to quit?",(t=t||window.event)&&(t.returnValue=e),e}}(),!function(){var i=$.namespace("pxtr.service");i.HistoryService=function(t,e,r,i){this.pixetorController=t.getWrappedPixetorController(),this.shortcutService=e||pxtr.app.shortcutService,this.deserializer=r||pxtr.utils.serialization.arraybuffer.ArrayBufferDeserializer,this.serializer=i||pxtr.utils.serialization.arraybuffer.ArrayBufferSerializer,this.stateQueue=[],this.currentIndex=-1,this.lastLoadState=-1},i.HistoryService.SNAPSHOT="SNAPSHOT",i.HistoryService.REPLAY="REPLAY",i.HistoryService.SNAPSHOT_PERIOD=50,i.HistoryService.LOAD_STATE_INTERVAL=50,i.HistoryService.MAX_SAVED_STATES=500,i.HistoryService.prototype.init=function(){$.subscribe(Events.PIXETOR_SAVE_STATE,this.onSaveStateEvent.bind(this));var t=pxtr.service.keyboard.Shortcuts;this.shortcutService.registerShortcut(t.MISC.UNDO,this.undo.bind(this)),this.shortcutService.registerShortcut(t.MISC.REDO,this.redo.bind(this)),this.saveState({type:i.HistoryService.SNAPSHOT})},i.HistoryService.prototype.onSaveStateEvent=function(t,e){this.saveState(e)},i.HistoryService.prototype.saveState=function(t){this.stateQueue=this.stateQueue.slice(0,this.currentIndex+1),this.currentIndex=this.currentIndex+1;var e={action:t,frameIndex:t.state?t.state.frameIndex:this.pixetorController.currentFrameIndex,layerIndex:t.state?t.state.layerIndex:this.pixetorController.currentLayerIndex,fps:this.pixetorController.getFPS(),uuid:pxtr.utils.Uuid.generate()},t=t.type===i.HistoryService.SNAPSHOT,r=this.currentIndex%i.HistoryService.SNAPSHOT_PERIOD==0;(t||r)&&(t=this.pixetorController.getPixetor(),e.pixetor=this.serializer.serialize(t)),this.stateQueue.length>i.HistoryService.MAX_SAVED_STATES&&(r=this.getNextSnapshotIndex_(1),this.stateQueue.splice(0,r),this.currentIndex=this.currentIndex-r),this.stateQueue.push(e),$.publish(Events.HISTORY_STATE_SAVED)},i.HistoryService.prototype.getCurrentStateId=function(){var t=this.stateQueue[this.currentIndex];return!!t&&t.uuid},i.HistoryService.prototype.undo=function(){this.loadState(this.currentIndex-1)},i.HistoryService.prototype.redo=function(){this.loadState(this.currentIndex+1)},i.HistoryService.prototype.isLoadStateAllowed_=function(t){var e=Date.now()-this.lastLoadState>i.HistoryService.LOAD_STATE_INTERVAL,t=0<=t&&t<this.stateQueue.length;return e&&t},i.HistoryService.prototype.getPreviousSnapshotIndex_=function(t){for(;this.stateQueue[t]&&!this.stateQueue[t].pixetor;)t-=1;return t},i.HistoryService.prototype.getNextSnapshotIndex_=function(t){for(;this.stateQueue[t]&&!this.stateQueue[t].pixetor;)t+=1;return t},i.HistoryService.prototype.loadState=function(t){try{if(this.isLoadStateAllowed_(t)){this.lastLoadState=Date.now();var e=this.getPreviousSnapshotIndex_(t);if(e<0)throw"Could not find previous SNAPSHOT saved in history stateQueue";var r=this.getSnapshotFromState_(e),i=this.onPixetorLoaded_.bind(this,t,e);this.deserializer.deserialize(r,i)}}catch(t){console.error("[CRITICAL ERROR] : Unable to load a history state."),this.logError_(t),this.stateQueue=[],this.currentIndex=-1}},i.HistoryService.prototype.logError_=function(t){"string"==typeof t?console.error(t):(console.error(t.message),console.error(t.stack))},i.HistoryService.prototype.getSnapshotFromState_=function(t){var t=this.stateQueue[t],e=t.pixetor;return t.pixetor=e},i.HistoryService.prototype.onPixetorLoaded_=function(t,e,r){var i=this.getPixetorSize_();r.setDescriptor(this.pixetorController.pixetor.getDescriptor()),r.savePath=this.pixetorController.pixetor.savePath,this.pixetorController.setPixetor(r);for(var o=e+1;o<=t;o++){var n=this.stateQueue[o];this.setupState(n),this.replayState(n)}r=this.stateQueue[t+1];r&&this.setupState(r),this.currentIndex=t,$.publish(Events.PIXETOR_RESET),$.publish(Events.HISTORY_STATE_LOADED),i!==this.getPixetorSize_()&&$.publish(Events.FRAME_SIZE_CHANGED)},i.HistoryService.prototype.getPixetorSize_=function(){return this.pixetorController.getWidth()+"x"+this.pixetorController.getHeight()},i.HistoryService.prototype.setupState=function(t){this.pixetorController.setCurrentFrameIndex(t.frameIndex),this.pixetorController.setCurrentLayerIndex(t.layerIndex),this.pixetorController.setFPS(t.fps)},i.HistoryService.prototype.replayState=function(t){var e=t.action,t=(e.type,this.pixetorController.getLayerAt(t.layerIndex).getFrameAt(t.frameIndex));e.scope.replay(t,e.replay)}}(),!function(){for(var t=$.namespace("pxtr.service.color"),s=[],e=0;e<10;e++)s.push(36*e);t.ColorSorter=function(){this.colorsHslMap_={}},t.ColorSorter.prototype.sort=function(t){this.colorsHslMap_={},t.forEach(function(t){this.colorsHslMap_[t]=window.tinycolor(t).toHsl()}.bind(this));var e=t.filter(function(t){return this.colorsHslMap_[t].l<=.1}.bind(this)),r=t.filter(function(t){return.9<=this.colorsHslMap_[t].l}.bind(this)),i=t.filter(function(t){return-1===r.indexOf(t)&&-1===e.indexOf(t)}).filter(function(t){return this.colorsHslMap_[t].s<=.1}.bind(this)),e=this.sortOnHslProperty_(e,"l"),r=this.sortOnHslProperty_(r,"l"),i=this.sortOnHslProperty_(i,"h"),o=e.concat(r,i),n=t.filter(function(t){return-1===o.indexOf(t)}),i=s.map(function(e){var t=n.filter(function(t){t=this.colorsHslMap_[t];return t.h>=e&&t.h<e+36}.bind(this));return this.sortRegularColors_(t)}.bind(this));return Array.prototype.concat.apply(o,i)},t.ColorSorter.prototype.sortRegularColors_=function(t){return t.sort(function(t,e){var t=this.colorsHslMap_[t],e=this.colorsHslMap_[e],r=Math.abs(t.h-e.h),i=Math.abs(t.s-e.s),o=Math.abs(t.l-e.l);return r<10?o<i?this.compareValues_(t.s,e.s):this.compareValues_(t.l,e.l):this.compareValues_(t.h,e.h)}.bind(this))},t.ColorSorter.prototype.sortOnHslProperty_=function(t,r){return t.sort(function(t,e){t=this.colorsHslMap_[t],e=this.colorsHslMap_[e];return this.compareValues_(t[r],e[r])}.bind(this))},t.ColorSorter.prototype.compareValues_=function(t,e){return e<t?1:t<e?-1:0}}(),!function(){var t=$.namespace("pxtr.service.palette");t.CurrentColorsPalette=function(){this.name="Current colors",this.id=Constants.CURRENT_COLORS_PALETTE_ID,this.colorSorter=new pxtr.service.color.ColorSorter},t.CurrentColorsPalette.prototype.getColors=function(){var t=(t=pxtr.app.currentColorsService.getCurrentColors()).slice(0,Constants.MAX_PALETTE_COLORS);return this.colorSorter.sort(t)}}(),!function(){var t=$.namespace("pxtr.service.palette");t.PaletteService=function(){this.dynamicPalettes=[],this.localStorageGlobal=window.localStorage},t.PaletteService.prototype.getPalettes=function(){var t=this.localStorageGlobal.getItem("pixetor.palettes"),t=(t=JSON.parse(t)||[]).map(function(t){return pxtr.model.Palette.fromObject(t)});return this.dynamicPalettes.concat(t)},t.PaletteService.prototype.getPaletteById=function(t){var e=this.getPalettes();return this.findPaletteInArray_(t,e)},t.PaletteService.prototype.savePalette=function(t){var e=this.getPalettes(),r=this.findPaletteInArray_(t.id,e);r?(r=e.indexOf(r),e.splice(r,1,t)):e.push(t),this.savePalettes_(e),$.publish(Events.SHOW_NOTIFICATION,[{content:"Palette "+t.name+" successfully saved !"}]),window.setTimeout($.publish.bind($,Events.HIDE_NOTIFICATION),2e3)},t.PaletteService.prototype.addDynamicPalette=function(t){this.dynamicPalettes.push(t)},t.PaletteService.prototype.deletePaletteById=function(e){var t=this.getPalettes().filter(function(t){return t.id!==e});this.savePalettes_(t)},t.PaletteService.prototype.savePalettes_=function(t){t=t.filter(function(t){return-1===this.dynamicPalettes.indexOf(t)}.bind(this)),this.localStorageGlobal.setItem("pixetor.palettes",JSON.stringify(t)),$.publish(Events.PALETTE_LIST_UPDATED)},t.PaletteService.prototype.findPaletteInArray_=function(e,t){var r=null;return t.forEach(function(t){t.id===e&&(r=t)}),r}}(),!function(){var t=$.namespace("pxtr.service.palette");t.PaletteGplWriter=function(t){this.palette=t},t.PaletteGplWriter.prototype.write=function(){var e=[];return e.push("GIMP Palette"),e.push("Name: "+this.palette.name),e.push("Columns: 0"),e.push("#"),this.palette.getColors().forEach(function(t){e.push(this.writeColorLine(t))}.bind(this)),e.push("\r\n"),e.join("\r\n")},t.PaletteGplWriter.prototype.writeColorLine=function(t){var t=window.tinycolor(t).toRgb(),e=[];return e.push(this.padString(t.r,3)),e.push(this.padString(t.g,3)),e.push(this.padString(t.b,3)),e.push("Untitled"),e.join(" ")},t.PaletteGplWriter.prototype.padString=function(t,e){return t=t.toString(),new Array(1+e-t.length).join(" ")+t}}(),!function(){var t=$.namespace("pxtr.service.palette.reader");t.AbstractPaletteFileReader=function(t,e,r,i){this.file=t,this.onSuccess=e,this.onError=r,this.colorLineRegexp=i},t.AbstractPaletteFileReader.prototype.extractColorFromLine=Constants.ABSTRACT_FUNCTION,t.AbstractPaletteFileReader.prototype.read=function(){pxtr.utils.FileUtils.readFile(this.file,this.onFileLoaded_.bind(this))},t.AbstractPaletteFileReader.prototype.onFileLoaded_=function(t){var e,t=pxtr.utils.Base64.toText(t).match(/[^\r\n]+/g).filter(function(t){return this.colorLineRegexp.test(t)}.bind(this)).map(this.extractColorFromLine.bind(this));t.length?(e=pxtr.utils.Uuid.generate(),e=new pxtr.model.Palette(e,this.file.name,t),this.onSuccess(e)):this.onError()}}(),!function(){var t=$.namespace("pxtr.service.palette.reader"),i=/^(\s*\d{1,3})(\s*\d{1,3})(\s*\d{1,3})/;t.PaletteGplReader=function(t,e,r){this.superclass.constructor.call(this,t,e,r,i)},pxtr.utils.inherit(t.PaletteGplReader,t.AbstractPaletteFileReader),t.PaletteGplReader.prototype.extractColorFromLine=function(t){t=t.match(i);return window.tinycolor({r:parseInt(t[1],10),g:parseInt(t[2],10),b:parseInt(t[3],10)}).toHexString()}}(),!function(){var t=$.namespace("pxtr.service.palette.reader");t.PaletteImageReader=function(t,e,r){this.file=t,this.onSuccess=e,this.onError=r,this.colorSorter_=new pxtr.service.color.ColorSorter},t.PaletteImageReader.prototype.read=function(){pxtr.utils.FileUtils.readImageFile(this.file,this.onImageLoaded_.bind(this))},t.PaletteImageReader.prototype.onImageLoaded_=function(t){t=new pxtr.worker.imageprocessor.ImageProcessor(t,this.onWorkerSuccess_.bind(this),this.onWorkerStep_.bind(this),this.onWorkerError_.bind(this));$.publish(Events.SHOW_PROGRESS,[{name:"Processing image colors ..."}]),t.process()},t.PaletteImageReader.prototype.onWorkerSuccess_=function(t){var e,t=t.data.colorsMap,t=Object.keys(t);t.length>Constants.MAX_PALETTE_COLORS?this.onError("Too many colors : "+t.length):(e=pxtr.utils.Uuid.generate(),t=this.colorSorter_.sort(t),e=new pxtr.model.Palette(e,this.file.name+" palette",t),this.onSuccess(e)),$.publish(Events.HIDE_PROGRESS)},t.PaletteImageReader.prototype.onWorkerStep_=function(t){t=t.data.progress;$.publish(Events.UPDATE_PROGRESS,[{progress:t}])},t.PaletteImageReader.prototype.onWorkerError_=function(t){$.publish(Events.HIDE_PROGRESS),this.onError("Unable to process the image : "+t.data.message)}}(),!function(){var t=$.namespace("pxtr.service.palette.reader"),i=/^(\d{1,3})\s+(\d{1,3})\s+(\d{1,3})/;t.PalettePalReader=function(t,e,r){this.superclass.constructor.call(this,t,e,r,i)},pxtr.utils.inherit(t.PalettePalReader,t.AbstractPaletteFileReader),t.PalettePalReader.prototype.extractColorFromLine=function(t){t=t.match(i),t="rgb("+t[1]+","+t[2]+","+t[3]+")";return window.tinycolor(t).toHexString()}}(),!function(){var t=$.namespace("pxtr.service.palette.reader"),i=/^[A-F0-9]{2}([A-F0-9]{2})([A-F0-9]{2})([A-F0-9]{2})/;t.PaletteTxtReader=function(t,e,r){this.superclass.constructor.call(this,t,e,r,i)},pxtr.utils.inherit(t.PaletteTxtReader,t.AbstractPaletteFileReader),t.PaletteTxtReader.prototype.extractColorFromLine=function(t){t=t.match(i);return("#"+t[1]+t[2]+t[3]).toLowerCase()}}(),!function(){var t=$.namespace("pxtr.service.palette"),e={gpl:t.reader.PaletteGplReader,pal:t.reader.PalettePalReader,txt:t.reader.PaletteTxtReader,img:t.reader.PaletteImageReader};t.PaletteImportService=function(){},t.PaletteImportService.prototype.init=function(){},t.PaletteImportService.prototype.read=function(t,e,r){e=this.getReader_(t,e,r);e?e.read():console.error("Could not find reader for file : %s",t.name)},t.PaletteImportService.prototype.isImage_=function(t){return 0===t.type.indexOf("image")},t.PaletteImportService.prototype.getReader_=function(t,e,r){var i=this.getReaderClass_(t);return i?new i(t,e,r):null},t.PaletteImportService.prototype.getReaderClass_=function(t){return this.isImage_(t)?e.img:(t=this.getExtension_(t),e[t])},t.PaletteImportService.prototype.getExtension_=function(t){t=t.name.split(".");return t[t.length-1].toLowerCase()}}(),!function(){var t=$.namespace("pxtr.service.pensize");t.PenSizeService=function(){this.size=1},t.PenSizeService.prototype.init=function(){this.size=pxtr.UserSettings.get(pxtr.UserSettings.PEN_SIZE);var t=pxtr.service.keyboard.Shortcuts;pxtr.app.shortcutService.registerShortcut(t.MISC.INCREASE_PENSIZE,this.increasePenSize_.bind(this)),pxtr.app.shortcutService.registerShortcut(t.MISC.DECREASE_PENSIZE,this.decreasePenSize_.bind(this))},t.PenSizeService.prototype.increasePenSize_=function(){this.setPenSize(this.size+1)},t.PenSizeService.prototype.decreasePenSize_=function(){this.setPenSize(this.size-1)},t.PenSizeService.prototype.getPenSize=function(){return this.size},t.PenSizeService.prototype.setPenSize=function(t){this.isPenSizeValid_(t)&&t!=this.size&&(this.size=t,pxtr.UserSettings.set(pxtr.UserSettings.PEN_SIZE,t),$.publish(Events.PEN_SIZE_CHANGED))},t.PenSizeService.prototype.isPenSizeValid_=function(t){return!isNaN(t)&&(1<=t&&t<=32)}}(),!function(){var t=$.namespace("pxtr.service");t.SavedStatusService=function(t,e){this.pixetorController=t,this.historyService=e,this.lastSavedStateIndex="",this.publishStatusUpdateEvent_=this.publishStatusUpdateEvent_.bind(this)},t.SavedStatusService.prototype.init=function(){$.subscribe(Events.TOOL_RELEASED,this.publishStatusUpdateEvent_),$.subscribe(Events.PIXETOR_RESET,this.publishStatusUpdateEvent_),$.subscribe(Events.PIXETOR_SAVED,this.onPixetorSaved.bind(this)),this.lastSavedStateIndex=this.historyService.getCurrentStateId()},t.SavedStatusService.prototype.onPixetorSaved=function(){this.lastSavedStateIndex=this.historyService.getCurrentStateId(),this.publishStatusUpdateEvent_()},t.SavedStatusService.prototype.publishStatusUpdateEvent_=function(){$.publish(Events.PIXETOR_SAVED_STATUS_UPDATE)},t.SavedStatusService.prototype.isDirty=function(){return this.lastSavedStateIndex!=this.historyService.getCurrentStateId()}}(),!function(){var e={8:"back",13:"enter",27:"esc",32:"space",37:"left",38:"up",39:"right",40:"down",46:"del",189:"-",109:"-",173:"-",187:"+",107:"+",61:"+",188:"<",190:">",191:"?",219:"[",221:"]"};$.namespace("pxtr.service.keyboard").KeycodeTranslator={toChar:function(t){return 48<=t&&t<=57?t-48+"":96<=t&&t<=105?t-96+"":65<=t&&t<=90?(t-65+10).toString(36):e[t]}}}(),!function(){var r=$.namespace("pxtr.service.keyboard");r.KeyUtils={createKeyFromString:function(t){var e={alt:-1!=(t=t.toLowerCase()).indexOf("alt+"),shift:-1!=t.indexOf("shift+"),ctrl:-1!=t.indexOf("ctrl+")},t=t.split(/\+(?!$)/);return{key:t[t.length-1].toUpperCase(),modifiers:e}},createKeyFromEvent:function(t){var e=t.which,e=r.KeycodeTranslator.toChar(e);return e?{key:e.toUpperCase(),modifiers:{alt:t.altKey,shift:t.shiftKey,ctrl:r.KeyUtils.isCtrlKeyPressed_(t)}}:null},equals:function(t,e){return t="string"==typeof t?r.KeyUtils.createKeyFromString(t):t,e="string"==typeof e?r.KeyUtils.createKeyFromString(e):e,t.key===e.key&&t.modifiers.alt===e.modifiers.alt&&t.modifiers.shift===e.modifiers.shift&&t.modifiers.ctrl===e.modifiers.ctrl},stringify:function(t){var e=r.KeyUtils.getModifiersString(t.modifiers);return e?e+"+"+t.key:t.key},getModifiersString:function(t){var e=[];return t.alt&&e.push("alt"),t.ctrl&&e.push("ctrl"),t.shift&&e.push("shift"),e.join("+")},isCtrlKeyPressed_:function(t){return pxtr.utils.UserAgent.isMac?t.metaKey:t.ctrlKey}}}(),!function(){var i=$.namespace("pxtr.service.keyboard");i.Shortcut=function(t,e,r,i){this.id_=t,this.description_=e,this.defaultKeys_=r="string"==typeof r?[r]:r,this.displayKey_=i},i.Shortcut.USER_SETTINGS_PREFIX="shortcut.",i.Shortcut.prototype.getId=function(){return this.id_},i.Shortcut.prototype.getDescription=function(){return this.description_},i.Shortcut.prototype.getKeys=function(){var t=pxtr.UserSettings.get(this.getLocalStorageKey_())||this.defaultKeys_;return"string"==typeof t?[t]:Array.isArray(t)?t:[]},i.Shortcut.prototype.isEditable=function(){return 0===this.getKeys().length||1===this.getKeys().length&&-1===i.Shortcuts.FORBIDDEN_KEYS.indexOf(this.getKeys()[0])},i.Shortcut.prototype.isCustom=function(){var t=this.getKeys();return t.length!==this.defaultKeys_.length||this.defaultKeys_.some(function(e){return!t.some(function(t){return i.KeyUtils.equals(t,e)})})},i.Shortcut.prototype.isUndefined=function(){return 0===this.getKeys().length},i.Shortcut.prototype.getDisplayKey=function(){return this.isUndefined()?"???":this.displayKey_||this.getKeys()[0]},i.Shortcut.prototype.restoreDefault=function(t){pxtr.UserSettings.set(this.getLocalStorageKey_(),"")},i.Shortcut.prototype.updateKeys=function(t){pxtr.UserSettings.set(this.getLocalStorageKey_(),t)},i.Shortcut.prototype.removeKeys=function(t){var e,r;if(this.isEditable())return(r=(e=this.getKeys()).filter(function(e){return!t.some(function(t){return i.KeyUtils.equals(e,t)})})).length!==e.length&&(this.updateKeys(r),!0)},i.Shortcut.prototype.getLocalStorageKey_=function(){return i.Shortcut.USER_SETTINGS_PREFIX+this.id_}}(),!function(){function t(t,e,r,i){return new o.Shortcut(t,e,r,i)}var o=$.namespace("pxtr.service.keyboard");o.Shortcuts={FORBIDDEN_KEYS:["1","2","3","4","5","6","7","8","9","?","shift+?","DEL","BACK","ENTER","ctrl+Y","ctrl+shift+Z"],TOOL:{PEN:t("tool-pen","Pen tool","P"),MIRROR_PEN:t("tool-vertical-mirror-pen","Vertical mirror pen tool","V"),PAINT_BUCKET:t("tool-paint-bucket","Paint bucket tool","B"),COLORSWAP:t("tool-colorswap","Magic bucket tool","A"),ERASER:t("tool-eraser","Eraser pen tool","E"),STROKE:t("tool-stroke","Stroke tool","L"),RECTANGLE:t("tool-rectangle","Rectangle tool","R"),CIRCLE:t("tool-circle","Circle tool","C"),MOVE:t("tool-move","Move tool","M"),SHAPE_SELECT:t("tool-shape-select","Shape selection","Z"),RECTANGLE_SELECT:t("tool-rectangle-select","Rectangle selection","S"),LASSO_SELECT:t("tool-lasso-select","Lasso selection","H"),LIGHTEN:t("tool-lighten","Lighten tool","U"),DITHERING:t("tool-dithering","Dithering tool","T"),COLORPICKER:t("tool-colorpicker","Color picker","O")},SELECTION:{CUT:t("selection-cut","Cut selection","ctrl+X"),COPY:t("selection-copy","Copy selection","ctrl+C"),PASTE:t("selection-paste","Paste selection","ctrl+V"),DELETE:t("selection-delete","Delete selection",["DEL","BACK"]),COMMIT:t("selection-commit","Commit selection",["ENTER"])},MISC:{RESET_ZOOM:t("reset-zoom","Reset zoom level","0"),INCREASE_ZOOM:t("increase-zoom","Increase zoom level","+"),DECREASE_ZOOM:t("decrease-zoom","Decrease zoom level","-"),INCREASE_PENSIZE:t("increase-pensize","Increase pen size","]"),DECREASE_PENSIZE:t("decrease-pensize","Decrease pen size","["),UNDO:t("undo","Undo","ctrl+Z"),REDO:t("redo","Redo",["ctrl+Y","ctrl+shift+Z"]),PREVIOUS_FRAME:t("previous-frame","Select previous frame","up"),NEXT_FRAME:t("next-frame","Select next frame","down"),NEW_FRAME:t("new-frame","Create new empty frame","N"),DUPLICATE_FRAME:t("duplicate-frame","Duplicate selected frame","shift+N"),CHEATSHEET:t("cheatsheet","Open the keyboard shortcut cheatsheet",["?","shift+?"]),X1_PREVIEW:t("x1-preview","Select original size preview","alt+1"),BEST_PREVIEW:t("best-preview","Select best size preview","alt+2"),FULL_PREVIEW:t("full-preview","Select full size preview","alt+3"),ONION_SKIN:t("onion-skin","Toggle onion skin","alt+O"),TOGGLE_GRID:t("toggle-grid","Show/Hide grid","alt+G"),LAYER_PREVIEW:t("layer-preview","Toggle layer preview","alt+L"),MERGE_ANIMATION:t("import-animation","Open merge animation popup","ctrl+shift+M"),CLOSE_POPUP:t("close-popup","Close an opened popup","ESC"),OFFSET_UP:t("move-up","Move viewport up","shift+up"),OFFSET_RIGHT:t("move-right","Move viewport right","shift+right"),OFFSET_DOWN:t("move-down","Move viewport down","shift+down"),OFFSET_LEFT:t("move-left","Move viewport left","shift+left")},STORAGE:{SAVE:t("save","Save the current sprite","ctrl+S"),OPEN:t("open","(desktop) Open a .pixetor file","ctrl+O"),SAVE_AS:t("save-as","(desktop) Save as new","ctrl+shift+S")},COLOR:{SWAP:t("swap-colors","Swap primary/secondary colors","X"),RESET:t("reset-colors","Reset default colors","D"),CREATE_PALETTE:t("create-palette","Open the palette creation popup","alt+P"),PREVIOUS_COLOR:t("previous-color","Select the previous color in the current palette","<"),NEXT_COLOR:t("next-color","Select the next color in the current palette",">"),SELECT_COLOR:t("select-color","Select a palette color in the current palette","123456789".split(""),"1 to 9")},DEBUG:{RELOAD_STYLES:t("move-left","Move viewport left","ctrl+alt+R")},CATEGORIES:["TOOL","SELECTION","MISC","STORAGE","COLOR"]}}(),!function(){var o=$.namespace("pxtr.service.keyboard");o.ShortcutService=function(){this.shortcuts_=[]},o.ShortcutService.prototype.init=function(){document.body.addEventListener("keydown",this.onKeyDown_.bind(this))},o.ShortcutService.prototype.registerShortcut=function(t,e){if(!(t instanceof o.Shortcut))throw"Invalid shortcut argument, please use instances of pxtr.service.keyboard.Shortcut";if("function"!=typeof e)throw"Invalid callback argument, please provide a function";this.shortcuts_.push({shortcut:t,callback:e})},o.ShortcutService.prototype.unregisterShortcut=function(r){var i=-1;this.shortcuts_.forEach(function(t,e){t.shortcut===r&&(i=e)}),-1!=i&&this.shortcuts_.splice(i,1)},o.ShortcutService.prototype.onKeyDown_=function(r){var i=o.KeyUtils.createKeyFromEvent(r);!this.isInInput_(r)&&i&&this.shortcuts_.forEach(function(e){e.shortcut.getKeys().forEach(function(t){o.KeyUtils.equals(t,i)&&(!0!==e.callback(i.key)&&r.preventDefault(),$.publish(Events.KEYBOARD_EVENT,[r]))}.bind(this))}.bind(this))},o.ShortcutService.prototype.isInInput_=function(t){t=t.target.nodeName.toUpperCase();return"INPUT"===t||"TEXTAREA"===t},o.ShortcutService.prototype.getShortcutById=function(e){return pxtr.utils.Array.find(this.getShortcuts(),function(t){return t.getId()===e})},o.ShortcutService.prototype.getShortcuts=function(){var r=[];return o.Shortcuts.CATEGORIES.forEach(function(t){var e=o.Shortcuts[t];Object.keys(e).forEach(function(t){r.push(e[t])})}),r},o.ShortcutService.prototype.updateShortcut=function(t,e){var r=e.replace(/\s/g,"");-1!=o.Shortcuts.FORBIDDEN_KEYS.indexOf(r)?$.publish(Events.SHOW_NOTIFICATION,[{content:"Key cannot be remapped ("+e+")",hideDelay:5e3}]):(this.removeKeyFromAllShortcuts_(r),t.updateKeys([r]),$.publish(Events.SHORTCUTS_CHANGED))},o.ShortcutService.prototype.removeKeyFromAllShortcuts_=function(e){this.getShortcuts().forEach(function(t){t.removeKeys([e])&&$.publish(Events.SHOW_NOTIFICATION,[{content:"Shortcut key removed for "+t.getId(),hideDelay:5e3}])})},o.ShortcutService.prototype.restoreDefaultShortcuts=function(){this.getShortcuts().forEach(function(t){t.restoreDefault()}),$.publish(Events.SHORTCUTS_CHANGED)}}(),!function(){var t=$.namespace("pxtr.service");t.ImportService=function(t){this.pixetorController_=t},t.ImportService.prototype.init=function(){$.subscribe(Events.PIXETOR_FILE_IMPORT_FAILED,this.onPixetorFileImportFailed_)},t.ImportService.prototype.onPixetorFileImportFailed_=function(t,e){$.publish(Events.SHOW_NOTIFICATION,[{content:"Pixetor file import failed ("+e+")",hideDelay:1e4}])},t.ImportService.prototype.newPixetorFromImage=function(e,t,r){r=r||Constants.EMPTY_FUNCTION;var i=t.importType,o=t.name,n=t.smoothing,s=t.frameSizeX,a=t.frameSizeY,l=t.frameOffsetX,c=t.frameOffsetY,p=new window.SuperGif({gif:e});p.load({success:function(){var t=p.getFrames().map(function(t){return pxtr.utils.CanvasUtils.createFromImageData(t.data)});t="single"===i||1<t.length?this.createPixetorFromImages_(t,o,s,a,n):(t=this.createImagesFromSheet_(t[0],s,a,l,c),this.createPixetorFromImages_(t,o,s,a,n)),r(t)}.bind(this),error:function(){var t;t="single"===i?this.createPixetorFromImages_([e],o,s,a,n):(t=this.createImagesFromSheet_(e,s,a,l,c),this.createPixetorFromImages_(t,o,s,a,n)),r(t)}.bind(this)})},t.ImportService.prototype.createImagesFromSheet_=function(t,e,r,i,o){return pxtr.utils.CanvasUtils.createFramesFromImage(t,i,o,e,r,!0,!0)},t.ImportService.prototype.createPixetorFromImages_=function(t,e,r,i,o){e=e||"Imported pixetor";t=this.createFramesFromImages_(t,r,i,o),r=pxtr.model.Layer.fromFrames("Layer 1",t),i=new pxtr.model.pixetor.Descriptor(e,"");return pxtr.model.Pixetor.fromLayers([r],Constants.DEFAULT.FPS,i)},t.ImportService.prototype.createFramesFromImages_=function(t,e,r,i){return t.map(function(t){t=pxtr.utils.ImageResizer.resize(t,e,r,i);return pxtr.utils.FrameUtils.createFromImage(t)})}}(),!function(){var t=$.namespace("pxtr.service");t.ImageUploadService=function(){},t.ImageUploadService.prototype.init=function(){},t.ImageUploadService.prototype.upload=function(t,r,e){var t={data:t},i=pxtr.utils.Environment.isHttps()?"https":"http",o=pxtr.utils.Template.replace(Constants.IMAGE_SERVICE_UPLOAD_URL,{protocol:i});pxtr.utils.Xhr.post(o,t,function(t){var e=pxtr.utils.Template.replace(Constants.IMAGE_SERVICE_GET_URL,{protocol:i});r(e+t.responseText)},e)}}(),!function(){var t=$.namespace("pxtr.service");t.ClipboardService=function(t){this.pixetorController=t},t.ClipboardService.prototype.init=function(){window.addEventListener("copy",this._onCopy.bind(this),!0),window.addEventListener("cut",this._onCut.bind(this),!0),window.addEventListener("paste",this._onPaste.bind(this),!0)},t.ClipboardService.prototype._onCut=function(t){$.publish(Events.CLIPBOARD_CUT,t)},t.ClipboardService.prototype._onCopy=function(t){$.publish(Events.CLIPBOARD_COPY,t)},t.ClipboardService.prototype._onPaste=function(t){$.publish(Events.CLIPBOARD_PASTE,t)}}(),!function(){var t=$.namespace("pxtr.service");t.CurrentColorsService=function(t){this.pixetorController=t,this.cache={},this.currentColors=[],this.cachedFrameProcessor=new pxtr.model.frame.AsyncCachedFrameProcessor,this.cachedFrameProcessor.setFrameProcessor(this.getFrameColors_.bind(this)),this.throttledUpdateCurrentColors_=pxtr.utils.FunctionUtils.throttle(this.updateCurrentColors_.bind(this),1e3),this.paletteService=pxtr.app.paletteService},t.CurrentColorsService.prototype.init=function(){$.subscribe(Events.HISTORY_STATE_SAVED,this.throttledUpdateCurrentColors_),$.subscribe(Events.HISTORY_STATE_LOADED,this.loadColorsFromCache_.bind(this))},t.CurrentColorsService.prototype.getCurrentColors=function(){return this.currentColors},t.CurrentColorsService.prototype.setCurrentColors=function(t){var e=pxtr.app.historyService.currentIndex;(this.cache[e]=t).join("")!==this.currentColors.join("")&&(this.currentColors=t,$.publish(Events.CURRENT_COLORS_UPDATED))},t.CurrentColorsService.prototype.isCurrentColorsPaletteSelected_=function(){var t=pxtr.UserSettings.get(pxtr.UserSettings.SELECTED_PALETTE);return this.paletteService.getPaletteById(t).id===Constants.CURRENT_COLORS_PALETTE_ID},t.CurrentColorsService.prototype.loadColorsFromCache_=function(){var t=pxtr.app.historyService.currentIndex,t=this.cache[t];t?this.setCurrentColors(t):this.updateCurrentColors_()};t.CurrentColorsService.prototype.updateCurrentColors_=function(){!function(t,r){var e=[];for(t=t.slice(0);t.length;)e.push(t.splice(0,10));var i=Q([]);return e.forEach(function(t){i=i.then(function(e){return Q.all(t.map(r)).then(function(t){return e.concat(t)})})}),i}(this.pixetorController.getLayers().map(function(t){return t.getFrames()}).reduce(function(t,e){return t.concat(e)}),function(t){return this.cachedFrameProcessor.get(t)}.bind(this)).then(function(t){var e={},t=(t.forEach(function(t){Object.keys(t).forEach(function(t){e[t]=!0})}),delete e[pxtr.utils.colorToInt(Constants.TRANSPARENT_COLOR)],Object.keys(e).map(function(t){return pxtr.utils.intToHex(t)}));this.setCurrentColors(t)}.bind(this))},t.CurrentColorsService.prototype.isCurrentColorsPaletteSelected_=function(){var t=pxtr.UserSettings.get(pxtr.UserSettings.SELECTED_PALETTE),t=this.paletteService.getPaletteById(t);return t&&t.id===Constants.CURRENT_COLORS_PALETTE_ID},t.CurrentColorsService.prototype.loadColorsFromCache_=function(){var t=pxtr.app.historyService.currentIndex,t=this.cache[t];t&&this.setCurrentColors(t)},t.CurrentColorsService.prototype.getFrameColors_=function(t,e){new pxtr.worker.framecolors.FrameColors(t,function(t){e(t.data.colors)},function(){},function(t){e({})}).process()}}(),!function(){var t=$.namespace("pxtr.service");t.FileDropperService=function(t){this.pixetorController=t,this.dropPosition_=null},t.FileDropperService.prototype.init=function(){document.body.addEventListener("drop",this.onFileDrop.bind(this),!1),document.body.addEventListener("dragover",this.onFileDragOver.bind(this),!1)},t.FileDropperService.prototype.onFileDragOver=function(t){t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="copy"},t.FileDropperService.prototype.onFileDrop=function(t){t.preventDefault(),t.stopPropagation(),this.dropPosition_={x:t.clientX,y:t.clientY};var e=t.dataTransfer.files;this.isMultipleFiles_=1<e.length;for(var r=0;r<e.length;r++){var i=e[r],o=0===i.type.indexOf("image"),n=/\.pixetor$/i.test(i.name),s=/\.(gpl|txt|pal)$/i.test(i.name);o?pxtr.utils.FileUtils.readImageFile(i,function(t){this.onImageLoaded_(t,i)}.bind(this)):n?pxtr.utils.PixetorFileUtils.loadFromFile(i,this.onPixetorFileLoaded_,this.onPixetorFileError_):s&&pxtr.app.paletteImportService.read(i,this.onPaletteLoaded_.bind(this))}},t.FileDropperService.prototype.onPaletteLoaded_=function(t){pxtr.app.paletteService.savePalette(t),pxtr.UserSettings.set(pxtr.UserSettings.SELECTED_PALETTE,t.id)},t.FileDropperService.prototype.onPixetorFileLoaded_=function(t){window.confirm(Constants.CONFIRM_OVERWRITE)&&pxtr.app.pixetorController.setPixetor(t)},t.FileDropperService.prototype.onPixetorFileError_=function(t){$.publish(Events.PIXETOR_FILE_IMPORT_FAILED,[t])},t.FileDropperService.prototype.onImageLoaded_=function(t,e){var r=pxtr.app.pixetorController.getWidth(),i=pxtr.app.pixetorController.getHeight();if(this.isMultipleFiles_)this.pixetorController.addFrameAtCurrentIndex(),this.pixetorController.selectNextFrame();else if(t.width>r||t.height>i)return void $.publish(Events.DIALOG_SHOW,{dialogId:"import",initArgs:{rawFiles:[e]}});r=this.pixetorController.getCurrentFrame(),i=pxtr.app.drawingController.getSpriteCoordinates(this.dropPosition_.x,this.dropPosition_.y),e=i.x,i=i.y;pxtr.utils.FrameUtils.addImageToFrame(r,t,e,i),$.publish(Events.PIXETOR_RESET),$.publish(Events.PIXETOR_SAVE_STATE,{type:pxtr.service.HistoryService.SNAPSHOT})}}(),!function(){var t=$.namespace("pxtr.service");t.SelectedColorsService=function(){this.primaryColor_=Constants.DEFAULT_PEN_COLOR,this.secondaryColor_=Constants.TRANSPARENT_COLOR},t.SelectedColorsService.prototype.init=function(){$.subscribe(Events.PRIMARY_COLOR_SELECTED,this.onPrimaryColorUpdate_.bind(this)),$.subscribe(Events.SECONDARY_COLOR_SELECTED,this.onSecondaryColorUpdate_.bind(this))},t.SelectedColorsService.prototype.getPrimaryColor=function(){return this.primaryColor_},t.SelectedColorsService.prototype.getSecondaryColor=function(){return this.secondaryColor_},t.SelectedColorsService.prototype.onPrimaryColorUpdate_=function(t,e){this.primaryColor_=e},t.SelectedColorsService.prototype.onSecondaryColorUpdate_=function(t,e){this.secondaryColor_=e}}(),!function(){var t=$.namespace("pxtr.service");t.MouseStateService=function(){this.lastButtonPressed_=null},t.MouseStateService.prototype.init=function(){$.subscribe(Events.MOUSE_EVENT,this.onMouseEvent_.bind(this))},t.MouseStateService.prototype.isLeftButtonPressed=function(){return this.isMouseButtonPressed_(Constants.LEFT_BUTTON)},t.MouseStateService.prototype.isRightButtonPressed=function(){return this.isMouseButtonPressed_(Constants.RIGHT_BUTTON)},t.MouseStateService.prototype.isMiddleButtonPressed=function(){return this.isMouseButtonPressed_(Constants.MIDDLE_BUTTON)},t.MouseStateService.prototype.isMouseButtonPressed_=function(t){return null!=this.lastButtonPressed_&&this.lastButtonPressed_==t},t.MouseStateService.prototype.onMouseEvent_=function(t,e){"mousedown"==e.type?this.lastButtonPressed_=e.button:"mouseup"==e.type&&(this.lastButtonPressed_=null)}}(),!function(){var e=$.namespace("pxtr.service.performance");e.PerformanceReport=function(t,e){var r=t.getWidth()*t.getHeight(),i=(this.resolution=262144<r,t.getLayers().length),t=(this.layers=25<i,t.getLayerAt(0).size()),r=(this.frames=100<t,this.colors=256<=e,r/2620+4*i+t+100*e/256);this.overall=200<r},e.PerformanceReport.prototype.equals=function(t){return t instanceof e.PerformanceReport&&this.resolution==t.resolution&&this.layers==t.layers&&this.frames==t.frames&&this.colors==t.colors&&this.overall==t.overall},e.PerformanceReport.prototype.hasProblem=function(){return this.resolution||this.layers||this.frames||this.colors||this.overall}}(),!function(){var e=$.namespace("pxtr.service.performance");e.PerformanceReportService=function(t,e){this.pixetorController=t,this.currentColorsService=e,this.currentReport=null},e.PerformanceReportService.prototype.init=function(){$.subscribe(Events.HISTORY_STATE_SAVED,this.createReport_.bind(this))},e.PerformanceReportService.prototype.createReport_=function(){var t=new e.PerformanceReport(this.pixetorController.getPixetor(),this.currentColorsService.getCurrentColors().length);t.equals(this.currentReport)||($.publish(Events.PERFORMANCE_REPORT_CHANGED,[t]),this.currentReport=t)},e.PerformanceReportService.prototype.hasProblem=function(){return this.currentReport&&this.currentReport.hasProblem()}}(),$.namespace("pxtr.tools"));ns.ToolsHelper={getTargetFrames:function(t,r){var i=pxtr.app.pixetorController.getCurrentFrameIndex();return(t?pxtr.app.pixetorController.getLayers():[pxtr.app.pixetorController.getCurrentLayer()]).reduce(function(t,e){e=r?e.getFrames():[e.getFrameAt(i)];return t.concat(e)},[])}},function(){var t=$.namespace("pxtr.tools");t.Tool=function(){this.toolId="tool",this.helpText="Abstract tool",this.tooltipDescriptors=[]},t.Tool.prototype.getHelpText=function(){return this.helpText},t.Tool.prototype.getId=function(){return this.toolId},t.Tool.prototype.raiseSaveStateEvent=function(t){$.publish(Events.PIXETOR_SAVE_STATE,{type:pxtr.service.HistoryService.REPLAY,scope:this,replay:t})}}(),function(){var t=$.namespace("pxtr.tools");t.ToolIconBuilder=function(){},t.ToolIconBuilder.prototype.createIcon=function(t,e){e=e||"right";var r=pxtr.utils.Template.get("drawingTool-item-template");return pxtr.utils.Template.replace(r,{cssclass:["tool-icon","icon-"+t.toolId].join(" "),toolid:t.toolId,title:this.getTooltipText(t),tooltipposition:e})},t.ToolIconBuilder.prototype.getTooltipText=function(t){var e=t.tooltipDescriptors;return pxtr.utils.TooltipFormatter.format(t.getHelpText(),t.shortcut,e)}}(),function(){var t=$.namespace("pxtr.tools.drawing");t.BaseTool=function(){pxtr.tool.Tool.call(this),this.toolId="tool-base"},pxtr.utils.inherit(t.BaseTool,pxtr.tools.Tool),t.BaseTool.prototype.applyToolAt=function(t,e,r,i,o){},t.BaseTool.prototype.moveToolAt=function(t,e,r,i,o){},t.BaseTool.prototype.replay=Constants.ABSTRACT_FUNCTION,t.BaseTool.prototype.supportsDynamicPenSize=function(){return!1},t.BaseTool.prototype.getToolColor=function(){return pxtr.app.mouseStateService.isRightButtonPressed()?pxtr.app.selectedColorsService.getSecondaryColor():pxtr.app.selectedColorsService.getPrimaryColor()},t.BaseTool.prototype.moveUnactiveToolAt=function(t,e,r,i,o){i.containsPixel(t,e)?this.updateHighlightedPixel(r,i,t,e):this.hideHighlightedPixel(i)},t.BaseTool.prototype.updateHighlightedPixel=function(t,e,r,i){isNaN(this.highlightedPixelCol)||isNaN(this.highlightedPixelRow)||this.highlightedPixelRow==i&&this.highlightedPixelCol==r||e.clear();var t=pxtr.utils.intToColor(t.getPixel(r,i)),o=this.getHighlightColor_(t),t=this.supportsDynamicPenSize()?pxtr.app.penSizeService.getPenSize():1;pxtr.PixelUtils.resizePixel(r,i,t).forEach(function(t){e.setPixel(t[0],t[1],o)}),this.highlightedPixelCol=r,this.highlightedPixelRow=i},t.BaseTool.prototype.getHighlightColor_=function(t){return!t||.5<window.tinycolor(t).toHsl().l?Constants.TOOL_HIGHLIGHT_COLOR_DARK:Constants.TOOL_HIGHLIGHT_COLOR_LIGHT},t.BaseTool.prototype.hideHighlightedPixel=function(t){null!==this.highlightedPixelRow&&null!==this.highlightedPixelCol&&(t.clear(),this.highlightedPixelRow=null,this.highlightedPixelCol=null)},t.BaseTool.prototype.releaseToolAt=function(t,e,r,i,o){},t.BaseTool.prototype.supportsAlt=function(){return!1}}(),function(){var t=$.namespace("pxtr.tools.drawing");t.ShapeTool=function(){this.startCol=null,this.startRow=null,this.tooltipDescriptors=[{key:"shift",description:"Keep 1 to 1 ratio"}]},pxtr.utils.inherit(t.ShapeTool,t.BaseTool),t.ShapeTool.prototype.supportsDynamicPenSize=function(){return!0},t.ShapeTool.prototype.applyToolAt=function(t,e,r,i,o){$.publish(Events.DRAG_START,[t,e]),this.startCol=t,this.startRow=e;var n=pxtr.app.penSizeService.getPenSize();this.draw(t,e,this.getToolColor(),i,n)},t.ShapeTool.prototype.moveToolAt=function(t,e,r,i,o){t=this.getCoordinates_(t,e,o),$.publish(Events.CURSOR_MOVED,[t.col,t.row]),i.clear(),e=this.getToolColor(),e==Constants.TRANSPARENT_COLOR&&(e=Constants.SELECTION_TRANSPARENT_COLOR),o=pxtr.app.penSizeService.getPenSize();this.draw(t.col,t.row,e,i,o)},t.ShapeTool.prototype.releaseToolAt=function(t,e,r,i,o){i.clear();i=this.getCoordinates_(t,e,o),t=this.getToolColor(),e=pxtr.app.penSizeService.getPenSize();this.draw(i.col,i.row,t,r,e),$.publish(Events.DRAG_END),this.raiseSaveStateEvent({col:i.col,row:i.row,startCol:this.startCol,startRow:this.startRow,color:t,penSize:e})},t.ShapeTool.prototype.replay=function(t,e){this.startCol=e.startCol,this.startRow=e.startRow,this.draw(e.col,e.row,e.color,t,e.penSize)},t.ShapeTool.prototype.getCoordinates_=function(t,e,r){return r.shiftKey?this.getScaledCoordinates_(t,e):{col:t,row:e}},t.ShapeTool.prototype.getScaledCoordinates_=function(t,e){var r=this.startCol-t,i=Math.abs(r),o=this.startRow-e,n=Math.abs(o),s=Math.min(i,n);return e=this.startRow-o/n*s,{col:t=this.startCol-r/i*s,row:e}},t.ShapeTool.prototype.draw=Constants.ABSTRACT_FUNCTION}(),function(){var t=$.namespace("pxtr.tools.drawing");t.SimplePen=function(){this.toolId="tool-pen",this.helpText="Pen tool",this.shortcut=pxtr.service.keyboard.Shortcuts.TOOL.PEN,this.previousCol=null,this.previousRow=null,this.pixels=[]},pxtr.utils.inherit(t.SimplePen,t.BaseTool),t.SimplePen.prototype.supportsDynamicPenSize=function(){return!0},t.SimplePen.prototype.applyToolAt=function(t,e,r,i,o){this.previousCol=t,this.previousRow=e;var n=this.getToolColor();this.drawUsingPenSize(n,t,e,r,i)},t.SimplePen.prototype.drawUsingPenSize=function(e,t,r,i,o){var n=pxtr.app.penSizeService.getPenSize();pxtr.PixelUtils.resizePixel(t,r,n).forEach(function(t){this.draw(e,t[0],t[1],i,o)}.bind(this))},t.SimplePen.prototype.draw=function(t,e,r,i,o){o.setPixel(e,r,t),t===Constants.TRANSPARENT_COLOR&&i.setPixel(e,r,t),this.pixels.push({col:e,row:r,color:t})},t.SimplePen.prototype.moveToolAt=function(t,e,r,i,o){if(1<Math.abs(t-this.previousCol)||1<Math.abs(e-this.previousRow))for(var n=pxtr.PixelUtils.getLinePixels(t,this.previousCol,e,this.previousRow),s=0,a=n.length;s<a;s++){var l=n[s];this.applyToolAt(l.col,l.row,r,i,o)}else this.applyToolAt(t,e,r,i,o);this.previousCol=t,this.previousRow=e},t.SimplePen.prototype.releaseToolAt=function(t,e,r,i,o){this.setPixelsToFrame_(r,this.pixels),this.raiseSaveStateEvent({pixels:this.pixels.slice(0),color:this.getToolColor()}),this.resetUsedPixels_()},t.SimplePen.prototype.replay=function(t,e){this.setPixelsToFrame_(t,e.pixels,e.color)},t.SimplePen.prototype.setPixelsToFrame_=function(e,t,r){t.forEach(function(t){e.setPixel(t.col,t.row,t.color)})},t.SimplePen.prototype.resetUsedPixels_=function(){this.pixels=[]}}(),function(){var t=$.namespace("pxtr.tools.drawing");t.Lighten=function(){this.superclass.constructor.call(this),this.toolId="tool-lighten",this.helpText="Lighten",this.shortcut=pxtr.service.keyboard.Shortcuts.TOOL.LIGHTEN,this.tooltipDescriptors=[{key:"ctrl",description:"Darken"},{key:"shift",description:"Apply only once per pixel"}]},pxtr.utils.inherit(t.Lighten,t.SimplePen),t.Lighten.prototype.applyToolAt=function(t,e,r,i,o){this.previousCol=t,this.previousRow=e;var n=pxtr.app.penSizeService.getPenSize();pxtr.PixelUtils.resizePixel(t,e,n).forEach(function(t){var e=this.getModifiedColor_(t[0],t[1],r,i,o);this.draw(e,t[0],t[1],r,i)}.bind(this))},t.Lighten.prototype.getModifiedColor_=function(t,e,r,i,o){var i=i.getPixel(t,e),r=r.getPixel(t,e),t=i!==pxtr.utils.colorToInt(Constants.TRANSPARENT_COLOR),e=t?i:r;return e===pxtr.utils.colorToInt(Constants.TRANSPARENT_COLOR)?Constants.TRANSPARENT_COLOR:(i=o.shiftKey)&&t?e:(r=i?6:3,((pxtr.utils.UserAgent.isMac?o.metaKey:o.ctrlKey)?window.tinycolor.darken(pxtr.utils.intToColor(e),r):window.tinycolor.lighten(pxtr.utils.intToColor(e),r)).toHexString())}}(),function(){var t=$.namespace("pxtr.tools.drawing");t.VerticalMirrorPen=function(){this.superclass.constructor.call(this),this.toolId="tool-vertical-mirror-pen",this.helpText="Vertical Mirror pen",this.shortcut=pxtr.service.keyboard.Shortcuts.TOOL.MIRROR_PEN,this.tooltipDescriptors=[{key:"ctrl",description:"Use horizontal axis"},{key:"shift",description:"Use horizontal and vertical axis"}]},pxtr.utils.inherit(t.VerticalMirrorPen,t.SimplePen),t.VerticalMirrorPen.prototype.applyToolAt=function(t,e,r,i,o){var n=this.getToolColor(),s=(this.drawUsingPenSize(n,t,e,r,i),this.getSymmetricCol_(t,r)),a=this.getSymmetricRow_(e,r),l=pxtr.utils.UserAgent.isMac?o.metaKey:o.ctrlKey;l||this.drawUsingPenSize(n,s,e,r,i),(o.shiftKey||l)&&this.drawUsingPenSize(n,t,a,r,i),o.shiftKey&&this.drawUsingPenSize(n,s,a,r,i),this.previousCol=t,this.previousRow=e},t.VerticalMirrorPen.prototype.getSymmetricCol_=function(t,e){return e.getWidth()-t-this.getPenSizeOffset_()},t.VerticalMirrorPen.prototype.getSymmetricRow_=function(t,e){return e.getHeight()-t-this.getPenSizeOffset_()},t.VerticalMirrorPen.prototype.getPenSizeOffset_=function(t,e){return pxtr.app.penSizeService.getPenSize()%2}}(),function(){var t=$.namespace("pxtr.tools.drawing");t.Eraser=function(){this.superclass.constructor.call(this),this.toolId="tool-eraser",this.helpText="Eraser tool",this.shortcut=pxtr.service.keyboard.Shortcuts.TOOL.ERASER},pxtr.utils.inherit(t.Eraser,t.SimplePen),t.Eraser.prototype.getToolColor=function(){return Constants.TRANSPARENT_COLOR}}(),function(){var t=$.namespace("pxtr.tools.drawing");t.Stroke=function(){this.toolId="tool-stroke",this.helpText="Stroke tool",this.shortcut=pxtr.service.keyboard.Shortcuts.TOOL.STROKE,this.tooltipDescriptors=[{key:"shift",description:"Hold shift to draw straight lines"}],this.startCol=null,this.startRow=null},pxtr.utils.inherit(t.Stroke,t.BaseTool),t.Stroke.prototype.supportsDynamicPenSize=function(){return!0},t.Stroke.prototype.applyToolAt=function(t,e,r,i,o){this.startCol=t,this.startRow=e,i.setPixel(t,e,this.getToolColor())},t.Stroke.prototype.moveToolAt=function(t,e,r,i,o){i.clear();var n=pxtr.app.penSizeService.getPenSize(),o=o.shiftKey,s=this.getToolColor();s==Constants.TRANSPARENT_COLOR&&(s=Constants.SELECTION_TRANSPARENT_COLOR),this.draw_(t,e,s,i,n,o)},t.Stroke.prototype.releaseToolAt=function(t,e,r,i,o){var n=pxtr.app.penSizeService.getPenSize(),o=o.shiftKey,s=this.getToolColor();this.draw_(t,e,s,r,n,o),i.clear(),this.raiseSaveStateEvent({col:t,row:e,startCol:this.startCol,startRow:this.startRow,color:s,penSize:n,isStraight:o})},t.Stroke.prototype.draw_=function(t,e,r,i,o,n){n=n?pxtr.PixelUtils.getUniformLinePixels(this.startCol,t,this.startRow,e):pxtr.PixelUtils.getLinePixels(t,this.startCol,e,this.startRow);pxtr.PixelUtils.resizePixel(n[0].col,n[0].row,o).forEach(function(t){i.setPixel(t[0],t[1],r)}),pxtr.PixelUtils.resizePixel(n[n.length-1].col,n[n.length-1].row,o).forEach(function(t){i.setPixel(t[0],t[1],r)}),n.forEach(function(t){for(var e=0;e<o;e++)i.setPixel(t.col-Math.floor(o/2)+e,t.row-Math.floor(o/2)+e,r),i.setPixel(t.col-Math.floor(o/2)+e,t.row+Math.ceil(o/2)-e-1,r),0!==e&&(i.setPixel(t.col-Math.floor(o/2)+e,t.row-Math.floor(o/2)+e-1,r),i.setPixel(t.col-Math.floor(o/2)+e,t.row+Math.ceil(o/2)-e,r))})},t.Stroke.prototype.replay=function(t,e){this.startCol=e.startCol,this.startRow=e.startRow,this.draw_(e.col,e.row,e.color,t,e.penSize,e.isStraight)}}(),function(){var t=$.namespace("pxtr.tools.drawing");t.PaintBucket=function(){this.toolId="tool-paint-bucket",this.helpText="Paint bucket tool",this.shortcut=pxtr.service.keyboard.Shortcuts.TOOL.PAINT_BUCKET},pxtr.utils.inherit(t.PaintBucket,t.BaseTool),t.PaintBucket.prototype.applyToolAt=function(t,e,r,i,o){var n=this.getToolColor();pxtr.PixelUtils.paintSimilarConnectedPixelsFromFrame(r,t,e,n),this.raiseSaveStateEvent({col:t,row:e,color:n})},t.PaintBucket.prototype.replay=function(t,e){pxtr.PixelUtils.paintSimilarConnectedPixelsFromFrame(t,e.col,e.row,e.color)}}(),function(){var t=$.namespace("pxtr.tools.drawing");t.Rectangle=function(){t.ShapeTool.call(this),this.toolId="tool-rectangle",this.helpText="Rectangle tool",this.shortcut=pxtr.service.keyboard.Shortcuts.TOOL.RECTANGLE},pxtr.utils.inherit(t.Rectangle,t.ShapeTool),t.Rectangle.prototype.draw=function(t,e,r,i,o){for(var n=pxtr.PixelUtils.getOrderedRectangleCoordinates(this.startCol,this.startRow,t,e),s=n.x0;s<=n.x1;s++)for(var a=n.y0;a<=n.y1;a++)(s>n.x1-o||s<n.x0+o||a>n.y1-o||a<n.y0+o)&&i.setPixel(s,a,r)}}(),function(){var t=$.namespace("pxtr.tools.drawing");t.Circle=function(){t.ShapeTool.call(this),this.toolId="tool-circle",this.helpText="Circle tool",this.shortcut=pxtr.service.keyboard.Shortcuts.TOOL.CIRCLE},pxtr.utils.inherit(t.Circle,t.ShapeTool),t.Circle.prototype.draw=function(t,e,r,i,o){this.getCirclePixels_(this.startCol,this.startRow,t,e,o).forEach(function(t){i.setPixel(t[0],t[1],r)})},t.Circle.prototype.getCirclePixels_=function(t,e,r,i,o){var n,s,a,l,t=pxtr.PixelUtils.getOrderedRectangleCoordinates(t,e,r,i),c=[],p=Math.round((t.x0+t.x1)/2),h=Math.round((t.y0+t.y1)/2),u=(t.x0+t.x1)%2,d=(t.y0+t.y1)%2,f=t.x1-p,g=t.y1-h;if(1==o){for(n=t.x0;n<=p;n++)a=Math.acos((n-p)/f),s=Math.round(g*Math.sin(a)+h),c.push([n-u,s]),c.push([n-u,2*h-s-d]),c.push([2*p-n,s]),c.push([2*p-n,2*h-s-d]);for(s=t.y0;s<=h;s++)a=Math.asin((s-h)/g),n=Math.round(f*Math.cos(a)+p),c.push([n,s-d]),c.push([2*p-n-u,s-d]),c.push([n,2*h-s]),c.push([2*p-n-u,2*h-s])}else{var m=f-o,y=g-o;for(m<0&&(m=0),y<0&&(y=0),n=0;n<=f;n++)for(s=0;s<=g;s++)a=Math.atan(s/n),l=Math.sqrt(n*n+s*s),(f<=o||g<=o||l>m*y/Math.sqrt(y*y*Math.pow(Math.cos(a),2)+m*m*Math.pow(Math.sin(a),2))+.5)&&l<f*g/Math.sqrt(g*g*Math.pow(Math.cos(a),2)+f*f*Math.pow(Math.sin(a),2))+.5&&(c.push([p+n,h+s]),c.push([p-n-u,h+s]),c.push([p+n,h-s-d]),c.push([p-n-u,h-s-d]))}return c}}(),function(){var t=$.namespace("pxtr.tools.drawing");t.Move=function(){this.toolId=t.Move.TOOL_ID,this.helpText="Move tool",this.shortcut=pxtr.service.keyboard.Shortcuts.TOOL.MOVE,this.tooltipDescriptors=[{key:"ctrl",description:"Apply to all layers"},{key:"shift",description:"Apply to all frames"},{key:"alt",description:"Wrap canvas borders"}],this.startCol=null,this.startRow=null},t.Move.TOOL_ID="tool-move",pxtr.utils.inherit(t.Move,t.BaseTool),t.Move.prototype.applyToolAt=function(t,e,r,i,o){this.startCol=t,this.startRow=e,this.currentFrame=r,this.currentFrameClone=r.clone()},t.Move.prototype.moveToolAt=function(t,e,r,i,o){t-=this.startCol,e-=this.startRow;this.shiftFrame(t,e,r,this.currentFrameClone,o)},t.Move.prototype.shiftFrame=function(t,e,r,i,o){for(var n=r.getWidth(),s=r.getHeight(),a=0;a<n;a++)for(var l=0;l<s;l++){var c=a-t,p=l-e;o.altKey&&(c=(c+n)%n,p=(p+s)%s),c=i.containsPixel(c,p)?i.getPixel(c,p):Constants.TRANSPARENT_COLOR,r.setPixel(a,l,c)}},t.Move.prototype.releaseToolAt=function(t,e,r,i,o){var n=t-this.startCol,s=e-this.startRow,t=pxtr.utils.UserAgent.isMac?o.metaKey:o.ctrlKey;pxtr.tools.ToolsHelper.getTargetFrames(t,o.shiftKey).forEach(function(t){var e=this.currentFrame==t?this.currentFrameClone:t.clone();this.shiftFrame(n,s,t,e,o)}.bind(this)),this.raiseSaveStateEvent({colDiff:n,rowDiff:s,ctrlKey:t,altKey:o.altKey,shiftKey:o.shiftKey})},t.Move.prototype.replay=function(t,e){var r={shiftKey:e.shiftKey,altKey:e.altKey,ctrlKey:e.ctrlKey};pxtr.tools.ToolsHelper.getTargetFrames(r.ctrlKey,r.shiftKey).forEach(function(t){this.shiftFrame(e.colDiff,e.rowDiff,t,t.clone(),r)}.bind(this))},t.Move.prototype.supportsAlt=function(){return!0}}(),function(){var t=$.namespace("pxtr.tools.drawing.selection");t.BaseSelect=function(){this.secondaryToolId=pxtr.tools.drawing.Move.TOOL_ID,this.startCol=null,this.startRow=null,this.lastMoveCol=null,this.lastMoveRow=null,this.selection=null,this.hasSelection=!1,this.tooltipDescriptors=[{description:"Drag the selection to move it. You may switch to other layers and frames."},{key:"ctrl+c",description:"Copy the selected area"},{key:"ctrl+v",description:"Paste the copied area"},{key:"shift",description:"Hold to move the content"}],$.subscribe(Events.SELECTION_DISMISSED,this.onSelectionDismissed_.bind(this))},pxtr.utils.inherit(t.BaseSelect,pxtr.tools.drawing.BaseTool),t.BaseSelect.prototype.applyToolAt=function(t,e,r,i,o){this.startCol=t,this.startRow=e,this.lastMoveCol=t,this.lastMoveRow=e,this.isInSelection(t,e)?(this.mode="moveSelection",o.shiftKey&&!this.isMovingContent_&&(this.isMovingContent_=!0,$.publish(Events.CLIPBOARD_CUT),this.drawSelectionOnOverlay_(i)),this.onSelectionMoveStart_(t,e,r,i)):(this.mode="select",this.onSelectStart_(t,e,r,i))},t.BaseSelect.prototype.moveToolAt=function(t,e,r,i,o){"select"==this.mode?this.onSelect_(t,e,r,i):"moveSelection"==this.mode&&this.onSelectionMove_(t,e,r,i)},t.BaseSelect.prototype.releaseToolAt=function(t,e,r,i,o){"select"==this.mode?this.onSelectEnd_(t,e,r,i):"moveSelection"==this.mode&&this.onSelectionMoveEnd_(t,e,r,i)},t.BaseSelect.prototype.moveUnactiveToolAt=function(t,e,r,i,o){i.containsPixel(t,e)&&(this.isInSelection(t,e)?(document.body.classList.add(this.secondaryToolId),document.body.classList.remove(this.toolId)):(document.body.classList.add(this.toolId),document.body.classList.remove(this.secondaryToolId))),this.hasSelection||pxtr.tools.drawing.BaseTool.prototype.moveUnactiveToolAt.apply(this,arguments)},t.BaseSelect.prototype.isInSelection=function(e,r){return this.selection&&this.selection.pixels.some(function(t){return t.col===e&&t.row===r})},t.BaseSelect.prototype.commitSelection=function(){this.isMovingContent_&&($.publish(Events.CLIPBOARD_PASTE),this.isMovingContent_=!1),$.publish(Events.SELECTION_DISMISSED)},t.BaseSelect.prototype.onSelectionDismissed_=function(){pxtr.app.drawingController.overlayFrame.clear(),this.hasSelection=!1},t.BaseSelect.prototype.drawSelectionOnOverlay_=function(t){for(var e=this.selection.pixels,r=0,i=e.length;r<i;r++){var o=e[r],o=o.color&&o.color!==Constants.TRANSPARENT_COLOR?this.getTransparentVariant_(o.color):Constants.SELECTION_TRANSPARENT_COLOR;t.setPixel(e[r].col,e[r].row,o)}},t.BaseSelect.prototype.getTransparentVariant_=pxtr.utils.FunctionUtils.memo(function(t){t=window.tinycolor(t);return(t=window.tinycolor.lighten(t,10)).setAlpha(.5),t.toRgbString()},{}),t.BaseSelect.prototype.onSelectStart_=function(t,e,r,i){},t.BaseSelect.prototype.onSelect_=function(t,e,r,i){},t.BaseSelect.prototype.onSelectEnd_=function(t,e,r,i){},t.BaseSelect.prototype.onSelectionMoveStart_=function(t,e,r,i){},t.BaseSelect.prototype.onSelectionMove_=function(t,e,r,i){var o=t-this.lastMoveCol,n=e-this.lastMoveRow;this.startCol,this.startRow;this.selection.move(o,n),i.clear(),this.drawSelectionOnOverlay_(i),this.lastMoveCol=t,this.lastMoveRow=e},t.BaseSelect.prototype.onSelectionMoveEnd_=function(t,e,r,i){this.onSelectionMove_(t,e,r,i)}}(),function(){var t=$.namespace("pxtr.tools.drawing.selection");t.AbstractDragSelect=function(){t.BaseSelect.call(this)},pxtr.utils.inherit(t.AbstractDragSelect,t.BaseSelect),t.AbstractDragSelect.prototype.onSelectStart_=function(t,e,r,i){this.hasSelection?(this.hasSelection=!1,this.commitSelection()):(this.hasSelection=!0,this.onDragSelectStart_(t,e),i.setPixel(t,e,this.getTransparentVariant_(Constants.SELECTION_TRANSPARENT_COLOR)))},t.AbstractDragSelect.prototype.onSelect_=function(t,e,r,i){this.hasSelection||this.startCol===t&&this.startRow===e||(this.hasSelection=!0,this.onDragSelectStart_(t,e)),this.hasSelection&&this.onDragSelect_(t,e,r,i)},t.AbstractDragSelect.prototype.onSelectEnd_=function(t,e,r,i){this.hasSelection&&this.onDragSelectEnd_(t,e,r,i)},t.AbstractDragSelect.prototype.startDragSelection_=function(t,e,r){this.hasSelection=!0,this.onDragSelectStart_(t,e),r.setPixel(t,e,this.getTransparentVariant_(Constants.SELECTION_TRANSPARENT_COLOR))},t.AbstractDragSelect.prototype.onDragSelectStart_=function(t,e,r,i){},t.AbstractDragSelect.prototype.onDragSelect_=function(t,e,r,i){},t.AbstractDragSelect.prototype.onDragSelectEnd_=function(t,e,r,i){}}(),function(){var t=$.namespace("pxtr.tools.drawing.selection");t.LassoSelect=function(){t.AbstractDragSelect.call(this),this.toolId="tool-lasso-select",this.helpText="Lasso selection",this.shortcut=pxtr.service.keyboard.Shortcuts.TOOL.LASSO_SELECT},pxtr.utils.inherit(t.LassoSelect,t.AbstractDragSelect),t.LassoSelect.prototype.onDragSelectStart_=function(t,e){this.pixels=[{col:t,row:e}],this.startCol=t,this.startRow=e,this.previousCol=t,this.previousRow=e,$.publish(Events.DRAG_START,[t,e])},t.LassoSelect.prototype.onDragSelect_=function(t,e,r,i){this.addPixel_(t,e,r);t=new pxtr.selection.ShapeSelection(this.getLassoPixels_());this.setSelection_(t,i)},t.LassoSelect.prototype.onDragSelectEnd_=function(t,e,r,i){this.addPixel_(t,e,r);t=new pxtr.selection.LassoSelection(this.getLassoPixels_(),r);this.setSelection_(t,i),$.publish(Events.DRAG_END)},t.LassoSelect.prototype.getLassoPixels_=function(){var t=pxtr.PixelUtils.getLinePixels(this.previousCol,this.startCol,this.previousRow,this.startRow);return this.pixels.concat(t)},t.LassoSelect.prototype.addPixel_=function(t,e,r){t=pxtr.utils.Math.minmax(t,0,r.getWidth()-1),e=pxtr.utils.Math.minmax(e,0,r.getHeight()-1);r=pxtr.PixelUtils.getLinePixels(t,this.previousCol,e,this.previousRow);this.pixels=this.pixels.concat(r),this.previousCol=t,this.previousRow=e},t.LassoSelect.prototype.setSelection_=function(t,e){this.selection=t,$.publish(Events.SELECTION_CREATED,[this.selection]),e.clear(),this.drawSelectionOnOverlay_(e)}}(),function(){var t=$.namespace("pxtr.tools.drawing.selection");t.RectangleSelect=function(){t.AbstractDragSelect.call(this),this.toolId="tool-rectangle-select",this.helpText="Rectangle selection",this.shortcut=pxtr.service.keyboard.Shortcuts.TOOL.RECTANGLE_SELECT},pxtr.utils.inherit(t.RectangleSelect,t.AbstractDragSelect),t.RectangleSelect.prototype.onDragSelectStart_=function(t,e){$.publish(Events.DRAG_START,[t,e])},t.RectangleSelect.prototype.onDragSelect_=function(t,e,r,i){i.clear(),this.selection=new pxtr.selection.RectangularSelection(this.startCol,this.startRow,t,e),$.publish(Events.SELECTION_CREATED,[this.selection]),this.drawSelectionOnOverlay_(i)},t.RectangleSelect.prototype.onDragSelectEnd_=function(t,e,r,i){this.onSelect_(t,e,r,i),$.publish(Events.DRAG_END)}}(),function(){var t=$.namespace("pxtr.tools.drawing.selection");t.ShapeSelect=function(){t.BaseSelect.call(this),this.toolId="tool-shape-select",this.helpText="Shape selection",this.shortcut=pxtr.service.keyboard.Shortcuts.TOOL.SHAPE_SELECT},pxtr.utils.inherit(t.ShapeSelect,t.BaseSelect),t.ShapeSelect.prototype.onSelectStart_=function(t,e,r,i){this.hasSelection?(this.hasSelection=!1,this.commitSelection()):(this.hasSelection=!0,r=pxtr.PixelUtils.getSimilarConnectedPixelsFromFrame(r,t,e),this.selection=new pxtr.selection.ShapeSelection(r),$.publish(Events.SELECTION_CREATED,[this.selection]),this.drawSelectionOnOverlay_(i))}}(),function(){var t=$.namespace("pxtr.tools.drawing");t.ColorPicker=function(){this.toolId="tool-colorpicker",this.helpText="Color picker",this.shortcut=pxtr.service.keyboard.Shortcuts.TOOL.COLORPICKER},pxtr.utils.inherit(t.ColorPicker,t.BaseTool),t.ColorPicker.prototype.applyToolAt=function(t,e,r,i,o){r.containsPixel(t,e)&&(r=pxtr.utils.intToColor(r.getPixel(t,e)),pxtr.app.mouseStateService.isLeftButtonPressed()?$.publish(Events.SELECT_PRIMARY_COLOR,[r]):pxtr.app.mouseStateService.isRightButtonPressed()&&$.publish(Events.SELECT_SECONDARY_COLOR,[r]))}}(),function(){var t=$.namespace("pxtr.tools.drawing");t.ColorSwap=function(){this.toolId="tool-colorswap",this.helpText="Paint all pixels of the same color",this.shortcut=pxtr.service.keyboard.Shortcuts.TOOL.COLORSWAP,this.tooltipDescriptors=[{key:"ctrl",description:"Apply to all layers"},{key:"shift",description:"Apply to all frames"}]},pxtr.utils.inherit(t.ColorSwap,t.BaseTool),t.ColorSwap.prototype.applyToolAt=function(t,e,r,i,o){r.containsPixel(t,e)&&(r=r.getPixel(t,e),t=this.getToolColor(),e=pxtr.utils.UserAgent.isMac?o.metaKey:o.ctrlKey,o=o.shiftKey,this.swapColors_(r,t,e,o),this.raiseSaveStateEvent({allLayers:e,allFrames:o,oldColor:r,newColor:t}))},t.ColorSwap.prototype.replay=function(t,e){this.swapColors_(e.oldColor,e.newColor,e.allLayers,e.allFrames)},t.ColorSwap.prototype.swapColors_=function(e,r,t,i){var o=pxtr.app.pixetorController.getCurrentFrameIndex();(t?pxtr.app.pixetorController.getLayers():[pxtr.app.pixetorController.getCurrentLayer()]).forEach(function(t){(i?t.getFrames():[t.getFrameAt(o)]).forEach(function(t){this.applyToolOnFrame_(t,e,r)}.bind(this))}.bind(this))},t.ColorSwap.prototype.applyToolOnFrame_=function(i,o,n){o=pxtr.utils.colorToInt(o),n=pxtr.utils.colorToInt(n),i.forEachPixel(function(t,e,r){null!==t&&t==o&&i.setPixel(e,r,n)})}}(),function(){var t=$.namespace("pxtr.tools.drawing");t.DitheringTool=function(){t.SimplePen.call(this),this.toolId="tool-dithering",this.helpText="Dithering tool",this.shortcut=pxtr.service.keyboard.Shortcuts.TOOL.DITHERING},pxtr.utils.inherit(t.DitheringTool,t.SimplePen),t.DitheringTool.prototype.supportsDynamicPenSize=function(){return!0},t.DitheringTool.prototype.applyToolAt=function(t,e,r,i,o){this.previousCol=t,this.previousRow=e;var n=pxtr.app.penSizeService.getPenSize();pxtr.PixelUtils.resizePixel(t,e,n).forEach(function(t){this.applyToolOnPixel(t[0],t[1],r,i,o)}.bind(this))},t.DitheringTool.prototype.applyToolOnPixel=function(t,e,r,i,o){var n=(t+e)%2,n=(n=pxtr.app.mouseStateService.isRightButtonPressed()?!n:n)?pxtr.app.selectedColorsService.getPrimaryColor():pxtr.app.selectedColorsService.getSecondaryColor();this.draw(n,t,e,r,i)}}(),function(){var t=$.namespace("pxtr.tools.transform");t.AbstractTransformTool=function(){},pxtr.utils.inherit(t.AbstractTransformTool,pxtr.tools.Tool),t.AbstractTransformTool.prototype.applyTransformation=function(t){var e=t.shiftKey,r=pxtr.utils.UserAgent.isMac?t.metaKey:t.ctrlKey;this.applyTool_(t.altKey,e,r),$.publish(Events.PIXETOR_RESET),this.raiseSaveStateEvent({altKey:t.altKey,allFrames:e,allLayers:r})},t.AbstractTransformTool.prototype.applyTool_=function(e,r,t){var i=pxtr.app.pixetorController.getCurrentFrameIndex();(t?pxtr.app.pixetorController.getLayers():[pxtr.app.pixetorController.getCurrentLayer()]).forEach(function(t){(r?t.getFrames():[t.getFrameAt(i)]).forEach(function(t){this.applyToolOnFrame_(t,e)}.bind(this))}.bind(this))},t.AbstractTransformTool.prototype.replay=function(t,e){this.applyTool_(e.altKey,e.allFrames,e.allLayers)}}(),function(){var e=$.namespace("pxtr.tools.transform");e.Center=function(){this.toolId="tool-center",this.helpText="Align image to the center",this.tooltipDescriptors=[{key:"ctrl",description:"Apply to all layers"},{key:"shift",description:"Apply to all frames"}]},pxtr.utils.inherit(e.Center,e.AbstractTransformTool),e.Center.prototype.applyToolOnFrame_=function(t){e.TransformUtils.center(t)}}(),function(){var t=$.namespace("pxtr.tools.transform");t.Clone=function(){this.toolId="tool-clone",this.helpText="Clone current layer to all frames",this.tooltipDescriptors=[]},pxtr.utils.inherit(t.Clone,t.AbstractTransformTool),t.Clone.prototype.applyTool_=function(t,e,r){var i=pxtr.app.pixetorController.getCurrentFrame();pxtr.app.pixetorController.getCurrentLayer().getFrames().forEach(function(t){t!==i&&t.setPixels(i.getPixels())})}}(),function(){var t=$.namespace("pxtr.tools.transform");t.Crop=function(){this.toolId="tool-crop",this.helpText="Crop the sprite",this.tooltipDescriptors=[{description:"Crop to fit the content or the selection. Applies to all frames and layers!"}]},pxtr.utils.inherit(t.Crop,pxtr.tools.Tool),t.Crop.prototype.applyTransformation=function(t){var e=this.getFrames_(),r=pxtr.app.selectionManager.currentSelection?this.getBoundariesForSelection_():pxtr.tools.transform.TransformUtils.getBoundaries(e);this.applyTool_(e,r)&&this.raiseSaveStateEvent({boundaries:r})},t.Crop.prototype.replay=function(t,e){var r=this.getFrames_();this.applyTool_(r,e.boundaries)},t.Crop.prototype.applyTool_=function(t,e){if(e.minx>=e.maxx)return!1;var r=pxtr.app.pixetorController.getPixetor(),i=1+e.maxx-e.minx,o=1+e.maxy-e.miny;if(i===r.getWidth()&&o===r.getHeight())return!1;t.forEach(function(t){pxtr.tools.transform.TransformUtils.moveFramePixels(t,-e.minx,-e.miny)});i=pxtr.utils.ResizeUtils.resizePixetor(r,{width:1+e.maxx-e.minx,height:1+e.maxy-e.miny,origin:"TOP-LEFT",resizeContent:!1});return $.publish(Events.SELECTION_DISMISSED),pxtr.app.pixetorController.setPixetor(i,{preserveState:!0,noSnapshot:!0}),!0},t.Crop.prototype.getFrames_=function(){return pxtr.app.pixetorController.getPixetor().getLayers().map(function(t){return t.getFrames()}).reduce(function(t,e){return t.concat(e)})},t.Crop.prototype.getBoundariesForSelection_=function(){var i=pxtr.app.selectionManager.currentSelection.pixels,o=pxtr.app.pixetorController.getPixetor().getLayerAt(0).getFrameAt(0);return pxtr.tools.transform.TransformUtils.getBoundaries([{forEachPixel:function(t){for(var e=0;e<i.length;e++){var r=i[e];o.containsPixel(r.col,r.row)&&t(1,r.col,r.row)}}}])}}(),function(){var r=$.namespace("pxtr.tools.transform");r.Flip=function(){this.toolId="tool-flip",this.helpText="Flip horizontally",this.tooltipDescriptors=[{key:"alt",description:"Flip vertically"},{key:"ctrl",description:"Apply to all layers"},{key:"shift",description:"Apply to all frames"}]},pxtr.utils.inherit(r.Flip,r.AbstractTransformTool),r.Flip.prototype.applyToolOnFrame_=function(t,e){e=e?r.TransformUtils.HORIZONTAL:r.TransformUtils.VERTICAL;r.TransformUtils.flip(t,e)}}(),function(){var r=$.namespace("pxtr.tools.transform");r.Rotate=function(){this.toolId="tool-rotate",this.helpText="Counter-clockwise rotation",this.tooltipDescriptors=[{key:"alt",description:"Clockwise rotation"},{key:"ctrl",description:"Apply to all layers"},{key:"shift",description:"Apply to all frames"}]},pxtr.utils.inherit(r.Rotate,r.AbstractTransformTool),r.Rotate.prototype.applyToolOnFrame_=function(t,e){e=e?r.TransformUtils.CLOCKWISE:r.TransformUtils.COUNTERCLOCKWISE;r.TransformUtils.rotate(t,e)}}(),function(){var d=$.namespace("pxtr.tools.transform");d.TransformUtils={VERTICAL:"VERTICAL",HORIZONTAL:"HORIZONTAL",flip:function(i,o){var t=i.clone(),n=i.getWidth(),s=i.getHeight();return t.forEachPixel(function(t,e,r){o===d.TransformUtils.VERTICAL?e=n-e-1:o===d.TransformUtils.HORIZONTAL&&(r=s-r-1),i.setPixel(e,r,t)}),i},CLOCKWISE:"clockwise",COUNTERCLOCKWISE:"counterclockwise",rotate:function(a,l){var c=a.clone(),t=a.getWidth(),e=a.getHeight(),p=Math.max(t,e),h=Math.ceil((p-t)/2),u=Math.ceil((p-e)/2);return a.forEachPixel(function(t,e,r){var i=e,o=r,n=e+=h,s=r+=u;l===d.TransformUtils.CLOCKWISE?(e=s,r=p-1-n):l===d.TransformUtils.COUNTERCLOCKWISE&&(r=n,e=p-1-s),c.containsPixel(e-=h,r-=u)?a.setPixel(i,o,c.getPixel(e,r)):a.setPixel(i,o,Constants.TRANSPARENT_COLOR)}),a},getBoundaries:function(t){var i=1/0,o=1/0,n=0,s=0,a=pxtr.utils.colorToInt(Constants.TRANSPARENT_COLOR);return t.forEach(function(t){t.forEachPixel(function(t,e,r){t!==a&&(i=Math.min(i,e),n=Math.max(n,e),o=Math.min(o,r),s=Math.max(s,r))})}),{minx:i,maxx:n,miny:o,maxy:s}},moveFramePixels:function(n,s,a){var l=n.clone();n.forEachPixel(function(t,e,r){var i=e,o=r;l.containsPixel(e-=s,r-=a)?n.setPixel(i,o,l.getPixel(e,r)):n.setPixel(i,o,Constants.TRANSPARENT_COLOR)})},center:function(t){var e=d.TransformUtils.getBoundaries([t]),r=(e.maxx-e.minx+1)/2,i=(e.maxy-e.miny+1)/2,o=t.width/2,n=t.height/2,o=Math.floor(o-r-e.minx),r=Math.floor(n-i-e.miny);return d.TransformUtils.moveFramePixels(t,o,r),t}}}(),function(){var t=$.namespace("pxtr.worker.framecolors");if("rgba(0, 0, 0, 0)"!==Constants.TRANSPARENT_COLOR)throw"Constants.TRANSPARENT_COLOR, please update FrameColorsWorker";t.FrameColorsWorker=function(){this.onmessage=function(t){try{this.TRANSPARENT_COLOR=t.data[0],this.MAX_WORKER_COLORS=t.data[1];var e=function(t){for(var e={},r=this.TRANSPARENT_COLOR,i=0,o=0,n=t.length;o<n&&i<this.MAX_WORKER_COLORS;o++){var s=t[o];s===r||e[s]||(e[s]=!0,i++)}return e}(t.data[2]);this.postMessage({type:"SUCCESS",colors:e})}catch(t){this.postMessage({type:"ERROR",message:t.message})}}}}(),function(){var o=$.namespace("pxtr.worker.framecolors");o.FrameColors=function(t,e,r,i){this.pixels=t.pixels,this.onStep=r,this.onSuccess=e,this.onError=i,this.worker=pxtr.utils.WorkerUtils.createWorker(o.FrameColorsWorker,"frame-colors"),this.worker.onmessage=this.onWorkerMessage.bind(this)},o.FrameColors.prototype.process=function(){this.worker.postMessage([pxtr.utils.colorToInt(Constants.TRANSPARENT_COLOR),Constants.MAX_WORKER_COLORS,this.pixels])},o.FrameColors.prototype.onWorkerMessage=function(t){"STEP"===t.data.type?this.onStep(t):"SUCCESS"===t.data.type?(this.onSuccess(t),this.worker.terminate()):"ERROR"===t.data.type&&(this.onError(t),this.worker.terminate())}}(),$.namespace("pxtr.worker.hash").HashWorker=function(){this.onmessage=function(t){try{var e=function(t){var e=0;if(0!==t.length)for(var r=0,i=t.length;r<i;r++){e=(e<<5)-e+t.charCodeAt(r);e|=0}return e}(t.data.str);this.postMessage({type:"SUCCESS",hash:e})}catch(t){this.postMessage({type:"ERROR",message:t.message})}}},function(){var o=$.namespace("pxtr.worker.hash");o.Hash=function(t,e,r,i){this.str=t,this.onStep=r,this.onSuccess=e,this.onError=i,this.worker=pxtr.utils.WorkerUtils.createWorker(o.HashWorker,"hash"),this.worker.onmessage=this.onWorkerMessage.bind(this)},o.Hash.prototype.process=function(){this.worker.postMessage({str:this.str})},o.Hash.prototype.onWorkerMessage=function(t){"STEP"===t.data.type?this.onStep(t):"SUCCESS"===t.data.type?(this.onSuccess(t),this.worker.terminate()):"ERROR"===t.data.type&&(this.onError(t),this.worker.terminate())}}(),$.namespace("pxtr.worker.imageprocessor").ImageProcessorWorker=function(){function i(t){return 1==(t=t.toString(16)).length?"0"+t:t}function o(t,e,r){for(var i=function(t,e,r,i){for(var o=[],n=0;n<e;n++){o[n]=[],h();for(var s=0;s<r;s++){var a=4*(s*e+n),l=t[a],c=t[1+a],p=t[2+a],a=t[3+a];o[n][s]=a<125?i:u(l,c,p)}}return o}(t,e,r,"transparent"),o={},n=0;n<i.length;n++){h();for(var s=0;s<i[n].length;s++){var a=i[n][s];"transparent"!=a&&(o[a]=!0)}}return o}var n,s,a,h=function(){var t=((n+=1)/a*100).toFixed(1);t!=s&&(s=t,this.postMessage({type:"STEP",progress:s,currentStep:n,total:a}))},u=function(t,e,r){return"#"+i(t)+i(e)+i(r)};this.onmessage=function(t){try{var e=t.data,r=(i=2*e.width,s=n=0,a=i,o(e.imageData,e.width,e.height));this.postMessage({type:"SUCCESS",colorsMap:r})}catch(t){this.postMessage({type:"ERROR",message:t.message})}var i}},function(){var o=$.namespace("pxtr.worker.imageprocessor");o.ImageProcessor=function(t,e,r,i){this.image=t,this.onStep=r,this.onSuccess=e,this.onError=i,this.worker=pxtr.utils.WorkerUtils.createWorker(o.ImageProcessorWorker,"image-colors-processor"),this.worker.onmessage=this.onWorkerMessage.bind(this)},o.ImageProcessor.prototype.process=function(){var t=pxtr.utils.CanvasUtils.createFromImage(this.image),t=pxtr.utils.CanvasUtils.getImageDataFromCanvas(t);this.worker.postMessage({imageData:t,width:this.image.width,height:this.image.height})},o.ImageProcessor.prototype.onWorkerMessage=function(t){"STEP"===t.data.type?this.onStep(t):"SUCCESS"===t.data.type?(this.onSuccess(t),this.worker.terminate()):"ERROR"===t.data.type&&(this.onError(t),this.worker.terminate())}}(),$.namespace("pxtr").app={init:function(){this.isAppEngineVersion=!!pxtr.appEngineToken_,this.sessionId=pxtr.utils.Uuid.generate(),this.shortcutService=new pxtr.service.keyboard.ShortcutService,this.shortcutService.init();var t=pxtr.UserSettings.get(pxtr.UserSettings.DEFAULT_SIZE),e=Constants.DEFAULT.FPS,r=new pxtr.model.pixetor.Descriptor("New Pixetor",""),e=new pxtr.model.Pixetor(t.width,t.height,e,r),r=new pxtr.model.Layer("Layer 1"),t=new pxtr.model.Frame(t.width,t.height),t=(r.addFrame(t),e.addLayer(r),this.corePixetorController=new pxtr.controller.pixetor.PixetorController(e),this.corePixetorController.init(),this.pixetorController=new pxtr.controller.pixetor.PublicPixetorController(this.corePixetorController),this.pixetorController.init(),this.paletteImportService=new pxtr.service.palette.PaletteImportService,this.paletteImportService.init(),this.paletteService=new pxtr.service.palette.PaletteService,this.paletteService.addDynamicPalette(new pxtr.service.palette.CurrentColorsPalette),this.selectedColorsService=new pxtr.service.SelectedColorsService,this.selectedColorsService.init(),this.mouseStateService=new pxtr.service.MouseStateService,this.mouseStateService.init(),this.paletteController=new pxtr.controller.PaletteController,this.paletteController.init(),this.currentColorsService=new pxtr.service.CurrentColorsService(this.pixetorController),this.currentColorsService.init(),this.palettesListController=new pxtr.controller.PalettesListController(this.currentColorsService),this.palettesListController.init(),this.cursorCoordinatesController=new pxtr.controller.CursorCoordinatesController(this.pixetorController),this.cursorCoordinatesController.init(),this.drawingController=new pxtr.controller.DrawingController(this.pixetorController,document.querySelector("#drawing-canvas-container")),this.drawingController.init(),this.previewController=new pxtr.controller.preview.PreviewController(this.pixetorController,document.querySelector("#animated-preview-canvas-container")),this.previewController.init(),this.minimapController=new pxtr.controller.MinimapController(this.pixetorController,this.previewController,this.drawingController,document.querySelector(".minimap-container")),this.minimapController.init(),this.framesListController=new pxtr.controller.FramesListController(this.pixetorController,document.querySelector("#preview-list-wrapper")),this.framesListController.init(),this.layersListController=new pxtr.controller.LayersListController(this.pixetorController),this.layersListController.init(),this.settingsController=new pxtr.controller.settings.SettingsController(this.pixetorController),this.settingsController.init(),this.dialogsController=new pxtr.controller.dialogs.DialogsController(this.pixetorController),this.dialogsController.init(),this.toolController=new pxtr.controller.ToolController,this.toolController.init(),this.selectionManager=new pxtr.selection.SelectionManager(this.pixetorController),this.selectionManager.init(),this.historyService=new pxtr.service.HistoryService(this.pixetorController),this.historyService.init(),this.notificationController=new pxtr.controller.NotificationController,this.notificationController.init(),this.transformationsController=new pxtr.controller.TransformationsController,this.transformationsController.init(),this.progressBarController=new pxtr.controller.ProgressBarController,this.progressBarController.init(),this.canvasBackgroundController=new pxtr.controller.CanvasBackgroundController,this.canvasBackgroundController.init(),this.indexedDbStorageService=new pxtr.service.storage.IndexedDbStorageService(this.pixetorController),this.indexedDbStorageService.init(),this.localStorageService=new pxtr.service.storage.LocalStorageService(this.pixetorController),this.localStorageService.init(),this.fileDownloadStorageService=new pxtr.service.storage.FileDownloadStorageService(this.pixetorController),this.fileDownloadStorageService.init(),this.desktopStorageService=new pxtr.service.storage.DesktopStorageService(this.pixetorController),this.desktopStorageService.init(),this.galleryStorageService=new pxtr.service.storage.GalleryStorageService(this.pixetorController),this.galleryStorageService.init(),this.storageService=new pxtr.service.storage.StorageService(this.pixetorController),this.storageService.init(),this.importService=new pxtr.service.ImportService(this.pixetorController),this.importService.init(),this.imageUploadService=new pxtr.service.ImageUploadService,this.imageUploadService.init(),this.savedStatusService=new pxtr.service.SavedStatusService(this.pixetorController,this.historyService),this.savedStatusService.init(),this.backupService=new pxtr.service.BackupService(this.pixetorController),this.backupService.init(),this.beforeUnloadService=new pxtr.service.BeforeUnloadService(this.pixetorController),this.beforeUnloadService.init(),this.headerController=new pxtr.controller.HeaderController(this.pixetorController,this.savedStatusService),this.headerController.init(),this.penSizeService=new pxtr.service.pensize.PenSizeService,this.penSizeService.init(),this.penSizeController=new pxtr.controller.PenSizeController,this.penSizeController.init(),this.fileDropperService=new pxtr.service.FileDropperService(this.pixetorController),this.fileDropperService.init(),this.userWarningController=new pxtr.controller.UserWarningController(this.pixetorController),this.userWarningController.init(),this.performanceReportService=new pxtr.service.performance.PerformanceReportService(this.pixetorController,this.currentColorsService),this.performanceReportService.init(),this.clipboardService=new pxtr.service.ClipboardService(this.pixetorController),this.clipboardService.init(),this.drawingLoop=new pxtr.rendering.DrawingLoop,this.drawingLoop.addCallback(this.render,this),this.drawingLoop.start(),this.initTooltips_(),this.getPixetorInitData_());t&&t.pixetor&&this.loadPixetor_(t),pxtr.devtools&&pxtr.devtools.init(),pxtr.utils.Environment.detectNodeWebkit()&&pxtr.utils.UserAgent.isMac&&((e=new(r=require("nw.gui")).Menu({type:"menubar"})).createMacBuiltin("Pixetor"),r.Window.get().menu=e),!pxtr.utils.Environment.isIntegrationTest()&&pxtr.utils.UserAgent.isUnsupported()&&$.publish(Events.DIALOG_SHOW,{dialogId:"unsupported-browser"}),pxtr.utils.Environment.isDebug()&&pxtr.app.shortcutService.registerShortcut(pxtr.service.keyboard.Shortcuts.DEBUG.RELOAD_STYLES,window.reloadStyles)},loadPixetor_:function(e){var t=e.pixetor;pxtr.utils.serialization.Deserializer.deserialize(t,function(t){pxtr.app.pixetorController.setPixetor(t),$.publish(Events.PIXETOR_SAVED),e.descriptor&&t.setDescriptor(e.descriptor)})},getPixetorInitData_:function(){return pxtr.appEnginePixetorData_},isLoggedIn:function(){var t=this.getPixetorInitData_();return t&&t.isLoggedIn},initTooltips_:function(){$("body").tooltip({selector:"[rel=tooltip]"})},render:function(t){this.drawingController.render(t),this.previewController.render(t),this.framesListController.render(t)},getFirstFrameAsPng:function(){var t=pxtr.utils.LayerUtils.mergeFrameAt(this.pixetorController.getLayers(),0),t=t instanceof pxtr.model.frame.RenderedFrame?pxtr.utils.CanvasUtils.createFromImage(t.getRenderedFrame()):pxtr.utils.FrameUtils.toImage(t);return t.toDataURL("image/png")},getFramesheetAsPng:function(){return new pxtr.rendering.PixetorRenderer(this.pixetorController).renderAsCanvas().toDataURL("image/png")}};